{"componentChunkName":"component---node-modules-antv-gatsby-theme-antv-site-templates-document-tsx","path":"/en/docs/api/rendering/renderer","result":{"data":{"site":{"siteMetadata":{"title":"GWebGPU","githubUrl":"https://github.com/antvis/gatsby-theme-antv","docs":[{"slug":"api/gpgpu","title":{"zh":"GPGPU","en":"GPGPU"},"order":0},{"slug":"api/rendering","title":{"zh":"渲染","en":"Rendering"},"order":0},{"slug":"tutorial/gpgpu","title":{"zh":"GPGPU","en":"GPGPU"},"order":0},{"slug":"tutorial/rendering","title":{"zh":"渲染","en":"Rendering"},"order":0}]},"pathPrefix":""},"markdownRemark":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Renderer"}]},{"type":"text","value":" 负责渲染一个或多个 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"View"}]},{"type":"text","value":"。通常我们有两种方式调用渲染方法："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"使用 rAF 逐帧渲染"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"按需渲染"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"rendererrenderviews-view","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#rendererrenderviews-view","ariaLabel":"rendererrenderviews view permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"renderer.render(...views: View[])"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"功能描述：渲染一个或多个 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"View"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用示例："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ts"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ts"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ts"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 使用 rAF 逐帧渲染"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" renderer "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" world"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"createRenderer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"render"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    renderer"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"render"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"view"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    frameId "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" window"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"requestAnimationFrame"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"render"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"render"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]}],"data":{"quirksMode":false}},"tableOfContents":"<ul>\n<li><a href=\"/en/docs/api/rendering/renderer/#rendererrenderviews-view\">renderer.render(...views: View[])</a></li>\n</ul>","fields":{"slug":"/en/docs/api/rendering/renderer","readingTime":{"text":"1 min read","time":11100}},"frontmatter":{"title":"Renderer"},"parent":{"__typename":"File","relativePath":"api/rendering/renderer.en.md"}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/en/docs/tutorial/gpgpu/quickstart"},"frontmatter":{"title":"Quick Start","order":0}}},{"node":{"fields":{"slug":"/zh/docs/tutorial/gpgpu/quickstart"},"frontmatter":{"title":"快速上手","order":0}}},{"node":{"fields":{"slug":"/en/docs/api/rendering/world"},"frontmatter":{"title":"World","order":0}}},{"node":{"fields":{"slug":"/zh/docs/api/rendering/world"},"frontmatter":{"title":"World","order":0}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/gwebgpu"},"frontmatter":{"title":"简介","order":0}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/gwebgpu"},"frontmatter":{"title":"简介","order":0}}},{"node":{"fields":{"slug":"/en/docs/tutorial/gpgpu/add2vectors"},"frontmatter":{"title":"两个向量相加","order":1}}},{"node":{"fields":{"slug":"/zh/docs/tutorial/gpgpu/add2vectors"},"frontmatter":{"title":"两个向量相加","order":1}}},{"node":{"fields":{"slug":"/en/docs/api/rendering/renderer"},"frontmatter":{"title":"Renderer","order":1}}},{"node":{"fields":{"slug":"/zh/docs/api/rendering/renderer"},"frontmatter":{"title":"Renderer","order":1}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/syntax"},"frontmatter":{"title":"Shader 语法介绍","order":1}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/syntax"},"frontmatter":{"title":"Shader 语法介绍","order":1}}},{"node":{"fields":{"slug":"/en/docs/tutorial/gpgpu/bellman-ford"},"frontmatter":{"title":"Bellman-Ford 最短路径算法","order":2}}},{"node":{"fields":{"slug":"/zh/docs/tutorial/gpgpu/bellman-ford"},"frontmatter":{"title":"Bellman-Ford 最短路径算法","order":2}}},{"node":{"fields":{"slug":"/en/docs/tutorial/gpgpu/fruchterman"},"frontmatter":{"title":"Fruchterman 布局算法","order":2}}},{"node":{"fields":{"slug":"/zh/docs/tutorial/gpgpu/fruchterman"},"frontmatter":{"title":"Fruchterman 布局算法","order":2}}},{"node":{"fields":{"slug":"/en/docs/api/rendering/camera"},"frontmatter":{"title":"View","order":2}}},{"node":{"fields":{"slug":"/en/docs/api/rendering/view"},"frontmatter":{"title":"View","order":2}}},{"node":{"fields":{"slug":"/zh/docs/api/rendering/view"},"frontmatter":{"title":"View","order":2}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/compute-pipeline"},"frontmatter":{"title":"Compiler & Kernel API","order":2}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/compute-pipeline"},"frontmatter":{"title":"Compiler & Kernel API","order":2}}},{"node":{"fields":{"slug":"/en/docs/tutorial/gpgpu/reduce"},"frontmatter":{"title":"Reduce 求和","order":3}}},{"node":{"fields":{"slug":"/zh/docs/tutorial/gpgpu/reduce"},"frontmatter":{"title":"Reduce 求和","order":3}}},{"node":{"fields":{"slug":"/zh/docs/api/rendering/camera"},"frontmatter":{"title":"Camera","order":3}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/workgroup"},"frontmatter":{"title":"线程、共享内存和同步","order":3}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/workgroup"},"frontmatter":{"title":"线程、共享内存和同步","order":3}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/debug"},"frontmatter":{"title":"Debug Shader","order":4}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/debug"},"frontmatter":{"title":"Debug Shader","order":4}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/vscode-extension"},"frontmatter":{"title":"VS Code 扩展","order":5}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/vscode-extension"},"frontmatter":{"title":"VS Code Extension","order":5}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/implements"},"frontmatter":{"title":"经典 GPGPU 的实现原理","order":6}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/implements"},"frontmatter":{"title":"经典 GPGPU 的实现原理","order":6}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/faq"},"frontmatter":{"title":"FAQ","order":10}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/faq"},"frontmatter":{"title":"FAQ","order":10}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/roadmap"},"frontmatter":{"title":"Roadmap","order":10}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/roadmap"},"frontmatter":{"title":"Roadmap","order":10}}},{"node":{"fields":{"slug":"/en/docs/api/gpgpu/changelog"},"frontmatter":{"title":"更新日志","order":20}}},{"node":{"fields":{"slug":"/zh/docs/api/gpgpu/changelog"},"frontmatter":{"title":"更新日志","order":20}}}]}},"pageContext":{"examples":[{"relativePath":"rendering/scenegraph/demo/cubes.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/scenegraph/demo/cubes.tsx","order":1,"filename":"cubes.tsx","title":"Attach cubes to a rotating group","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*OEcdTJOyRQMAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst CUBE_NUM = 300;\n\nfunction rand(min: number, max: number) {\n  if (max === undefined) {\n    max = min;\n    min = 0;\n  }\n  return min + (max - min) * Math.random();\n}\n\nconst App = function Group() {\n  let frameId;\n\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // all cubes share the same geometry\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [0.1, 0.1, 0.1],\n    });\n\n    const cubeGroup = world.createRenderable();\n\n    for (let i = 0; i < CUBE_NUM; i++) {\n      const material = world.createMaterial(Material.BASIC).setUniform({\n        color: i > 0 ? [1, 0, 0, 1] : [0, 1, 0, 1],\n      });\n\n      const cube = world\n        .createRenderable()\n        .setGeometry(boxGeometry)\n        .setMaterial(material);\n\n      const randomScale = rand(0.1, 0.5);\n\n      cube\n        .getTransformComponent()\n        .translate([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)])\n        .setLocalScale([randomScale, randomScale, randomScale]);\n\n      // attach every cube to group\n      if (i > 0) {\n        cube.attach(cubeGroup);\n      }\n\n      scene.addRenderable(cube);\n    }\n    scene.addRenderable(cubeGroup);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      cubeGroup\n        .getTransformComponent()\n        .rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const groupFolder = gui.addFolder('group');\n    const cubes = [];\n    const groupConfig = {\n      scale: 1,\n      addCube: () => {\n        const material = world.createMaterial(Material.BASIC).setUniform({\n          color: [rand(0, 1), rand(0, 1), rand(0, 1), 1],\n        });\n        const cube = world\n          .createRenderable()\n          .setGeometry(boxGeometry)\n          .setMaterial(material);\n\n        const randomScale = rand(1, 2);\n        cube\n          .getTransformComponent()\n          .translate([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)])\n          .setLocalScale([randomScale, randomScale, randomScale]);\n        cube.attach(cubeGroup);\n        scene.addRenderable(cube);\n        cubes.push(cube);\n      },\n      removeCube: () => {\n        const cube = cubes.pop();\n        if (cube) {\n          cube.detach();\n          scene.removeEntity(cube);\n        }\n      },\n      toggleGroupVisible: () => {\n        cubeGroup.setVisible(!cubeGroup.isVisible());\n      },\n    };\n    groupFolder.add(groupConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      cubeGroup.getTransformComponent().setLocalScale([size, size, size]);\n    });\n    groupFolder.add(groupConfig, 'addCube').name('Add Cube');\n    groupFolder.add(groupConfig, 'removeCube').name('Remove Cube');\n    groupFolder.add(groupConfig, 'toggleGroupVisible').name('Hide/Show Group');\n    groupFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  }, []);\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.cubes = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var CUBE_NUM = 300;\n\n  function rand(min, max) {\n    if (max === undefined) {\n      max = min;\n      min = 0;\n    }\n\n    return min + (max - min) * Math.random();\n  }\n\n  var App = function Group() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // all cubes share the same geometry\n\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [0.1, 0.1, 0.1]\n      });\n      var cubeGroup = world.createRenderable();\n\n      for (var i = 0; i < CUBE_NUM; i++) {\n        var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n          color: i > 0 ? [1, 0, 0, 1] : [0, 1, 0, 1]\n        });\n        var cube = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n        var randomScale = rand(0.1, 0.5);\n        cube.getTransformComponent().translate([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)]).setLocalScale([randomScale, randomScale, randomScale]); // attach every cube to group\n\n        if (i > 0) {\n          cube.attach(cubeGroup);\n        }\n\n        scene.addRenderable(cube);\n      }\n\n      scene.addRenderable(cubeGroup);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        cubeGroup.getTransformComponent().rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var groupFolder = gui.addFolder('group');\n      var cubes = [];\n      var groupConfig = {\n        scale: 1,\n        addCube: function addCube() {\n          var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n            color: [rand(0, 1), rand(0, 1), rand(0, 1), 1]\n          });\n          var cube = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n          var randomScale = rand(1, 2);\n          cube.getTransformComponent().translate([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)]).setLocalScale([randomScale, randomScale, randomScale]);\n          cube.attach(cubeGroup);\n          scene.addRenderable(cube);\n          cubes.push(cube);\n        },\n        removeCube: function removeCube() {\n          var cube = cubes.pop();\n\n          if (cube) {\n            cube.detach();\n            scene.removeEntity(cube);\n          }\n        },\n        toggleGroupVisible: function toggleGroupVisible() {\n          cubeGroup.setVisible(!cubeGroup.isVisible());\n        }\n      };\n      groupFolder.add(groupConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        cubeGroup.getTransformComponent().setLocalScale([size, size, size]);\n      });\n      groupFolder.add(groupConfig, 'addCube').name('Add Cube');\n      groupFolder.add(groupConfig, 'removeCube').name('Remove Cube');\n      groupFolder.add(groupConfig, 'toggleGroupVisible').name('Hide/Show Group');\n      groupFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/scenegraph/demo/solar-system.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/scenegraph/demo/solar-system.tsx","order":0,"filename":"solar-system.tsx","title":"Solar system","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*0d6WQa-BbUQAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\n// @see https://threejsfundamentals.org/threejs/lessons/threejs-scenegraph.html\nfunction SolarSystem() {\n  let frameId;\n\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 10)\n      .setPerspective(0.1, 1000, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // sun, earth and moon will share the same geometry\n    const sphereGeometry = world.createGeometry(Geometry.SPHERE, {\n      radius: 0.5,\n      latitudeBands: 4,\n      longitudeBands: 4,\n    });\n\n    const sunMaterial = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n    const sun = world\n      .createRenderable()\n      .setGeometry(sphereGeometry)\n      .setMaterial(sunMaterial);\n    sun.getTransformComponent().setLocalScale([5, 5, 5]);\n\n    const earthMaterial = world.createMaterial(Material.BASIC).setUniform({\n      color: [0, 0, 1, 1],\n    });\n    const earth = world\n      .createRenderable()\n      .setGeometry(sphereGeometry)\n      .setMaterial(earthMaterial);\n\n    const moonMaterial = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 1, 0, 1],\n    });\n    const moon = world\n      .createRenderable()\n      .setGeometry(sphereGeometry)\n      .setMaterial(moonMaterial);\n    moon.getTransformComponent().setLocalScale([0.5, 0.5, 0.5]);\n\n    const solarSystem = world.createRenderable();\n    const earthOrbit = world.createRenderable();\n    earthOrbit.getTransformComponent().translateLocal([5, 0, 0]);\n    const moonOrbit = world.createRenderable();\n    moonOrbit.getTransformComponent().translateLocal([0.5, 0, 0]);\n\n    scene.addRenderable(solarSystem);\n    scene.addRenderable(sun);\n    scene.addRenderable(earthOrbit);\n    scene.addRenderable(earth);\n    scene.addRenderable(moonOrbit);\n    scene.addRenderable(moon);\n\n    sun.attach(solarSystem);\n    earthOrbit.attach(solarSystem);\n    earth.attach(earthOrbit);\n    moonOrbit.attach(earthOrbit);\n    moon.attach(moonOrbit);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      solarSystem\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 0, 1));\n      earthOrbit\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 0, 2));\n      moon\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 0, 3));\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  }, []);\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<SolarSystem />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.solarSystem = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  // @see https://threejsfundamentals.org/threejs/lessons/threejs-scenegraph.html\n  function SolarSystem() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 10).setPerspective(0.1, 1000, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // sun, earth and moon will share the same geometry\n\n      var sphereGeometry = world.createGeometry(_gWebgpu.Geometry.SPHERE, {\n        radius: 0.5,\n        latitudeBands: 4,\n        longitudeBands: 4\n      });\n      var sunMaterial = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var sun = world.createRenderable().setGeometry(sphereGeometry).setMaterial(sunMaterial);\n      sun.getTransformComponent().setLocalScale([5, 5, 5]);\n      var earthMaterial = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [0, 0, 1, 1]\n      });\n      var earth = world.createRenderable().setGeometry(sphereGeometry).setMaterial(earthMaterial);\n      var moonMaterial = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 1, 0, 1]\n      });\n      var moon = world.createRenderable().setGeometry(sphereGeometry).setMaterial(moonMaterial);\n      moon.getTransformComponent().setLocalScale([0.5, 0.5, 0.5]);\n      var solarSystem = world.createRenderable();\n      var earthOrbit = world.createRenderable();\n      earthOrbit.getTransformComponent().translateLocal([5, 0, 0]);\n      var moonOrbit = world.createRenderable();\n      moonOrbit.getTransformComponent().translateLocal([0.5, 0, 0]);\n      scene.addRenderable(solarSystem);\n      scene.addRenderable(sun);\n      scene.addRenderable(earthOrbit);\n      scene.addRenderable(earth);\n      scene.addRenderable(moonOrbit);\n      scene.addRenderable(moon);\n      sun.attach(solarSystem);\n      earthOrbit.attach(solarSystem);\n      earth.attach(earthOrbit);\n      moonOrbit.attach(earthOrbit);\n      moon.attach(moonOrbit);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        solarSystem.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 0, 1));\n        earthOrbit.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 0, 2));\n        moon.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 0, 3));\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  ;\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(SolarSystem, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/renderables/demo/cube.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/renderables/demo/cube.tsx","order":3,"filename":"cube.tsx","title":"A Rotating Cube","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function RotatingCube() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    // create geometry, material and attach them to mesh\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [0.5, 0.5, 0.5],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    scene.addRenderable(box);\n\n    const transformComponent = box.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      transformComponent.rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('cube');\n    const cubeConfig = {\n      scale: 1,\n      color: [255, 255, 255],\n    };\n    cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    cubeFolder.addColor(cubeConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.cube = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function RotatingCube() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      }); // create geometry, material and attach them to mesh\n\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [0.5, 0.5, 0.5]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      scene.addRenderable(box);\n      var transformComponent = box.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        transformComponent.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('cube');\n      var cubeConfig = {\n        scale: 1,\n        color: [255, 255, 255]\n      };\n      cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      cubeFolder.addColor(cubeConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/renderables/demo/grid.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/renderables/demo/grid.tsx","order":2,"filename":"grid.tsx","title":"Grid","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*dYVxQoW7gmIAAAAAAAAAAAAAARQnAQ","source":"import { Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst $wrapper = document.getElementById('wrapper');\n\nfunction Grid() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const grid = world.createRenderable(Renderable.GRID, {\n      gridColor: [1, 0, 0, 1],\n      gridSize: 0.5,\n    });\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const gridFolder = gui.addFolder('grid');\n    const gridConfig = {\n      gridColor: [255, 0, 0],\n      gridSize: 0.5,\n    };\n    gridFolder.addColor(gridConfig, 'gridColor').onChange((color) => {\n      grid.setAttributes({\n        gridColor: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    gridFolder.add(gridConfig, 'gridSize', 0, 2, 0.1).onChange((gridSize) => {\n      grid.setAttributes({\n        gridSize,\n      });\n    });\n    gridFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<Grid />, $wrapper);\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.grid = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var $wrapper = document.getElementById('wrapper');\n\n  function Grid() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID, {\n        gridColor: [1, 0, 0, 1],\n        gridSize: 0.5\n      });\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var gridFolder = gui.addFolder('grid');\n      var gridConfig = {\n        gridColor: [255, 0, 0],\n        gridSize: 0.5\n      };\n      gridFolder.addColor(gridConfig, 'gridColor').onChange(function (color) {\n        grid.setAttributes({\n          gridColor: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      gridFolder.add(gridConfig, 'gridSize', 0, 2, 0.1).onChange(function (gridSize) {\n        grid.setAttributes({\n          gridSize: gridSize\n        });\n      });\n      gridFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  ;\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(Grid, null), $wrapper);\n});"},{"relativePath":"rendering/renderables/demo/line.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/renderables/demo/line.tsx","order":1,"filename":"line.tsx","title":"2D Line","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function Line() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const line = world.createRenderable(Renderable.LINE, {\n      points: [\n        [0, 0],\n        [1, 1],\n        [1, -1],\n        [-1, -1],\n        [1, -0.85],\n      ],\n      color: [0, 0, 0, 1],\n      thickness: 0.02,\n      dashArray: 0.02,\n      dashOffset: 0,\n      dashRatio: 0.5,\n    });\n    scene.addRenderable(line);\n    const meshComponent = line.getMeshComponent();\n    const transformComponent = line.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const lineFolder = gui.addFolder('line');\n    const lineConfig = {\n      scale: 1,\n      color: [0, 0, 0],\n      thickness: 0.02,\n      dashArray: 0.02,\n      dashOffset: 0,\n      dashRatio: 0.5,\n    };\n    lineFolder.add(lineConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    lineFolder.addColor(lineConfig, 'color').onChange((color) => {\n      line.setAttributes({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    lineFolder.add(lineConfig, 'thickness', 0, 0.1).onChange((thickness) => {\n      line.setAttributes({\n        thickness,\n      });\n    });\n    lineFolder.add(lineConfig, 'dashArray', 0, 1).onChange((dashArray) => {\n      line.setAttributes({\n        dashArray,\n      });\n    });\n    lineFolder.add(lineConfig, 'dashOffset', 0, 1).onChange((dashOffset) => {\n      line.setAttributes({\n        dashOffset,\n      });\n    });\n    lineFolder.add(lineConfig, 'dashRatio', 0, 1).onChange((dashRatio) => {\n      line.setAttributes({\n        dashRatio,\n      });\n    });\n    lineFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.line = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function Line() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var line = world.createRenderable(_gWebgpu.Renderable.LINE, {\n        points: [[0, 0], [1, 1], [1, -1], [-1, -1], [1, -0.85]],\n        color: [0, 0, 0, 1],\n        thickness: 0.02,\n        dashArray: 0.02,\n        dashOffset: 0,\n        dashRatio: 0.5\n      });\n      scene.addRenderable(line);\n      var meshComponent = line.getMeshComponent();\n      var transformComponent = line.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var lineFolder = gui.addFolder('line');\n      var lineConfig = {\n        scale: 1,\n        color: [0, 0, 0],\n        thickness: 0.02,\n        dashArray: 0.02,\n        dashOffset: 0,\n        dashRatio: 0.5\n      };\n      lineFolder.add(lineConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      lineFolder.addColor(lineConfig, 'color').onChange(function (color) {\n        line.setAttributes({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      lineFolder.add(lineConfig, 'thickness', 0, 0.1).onChange(function (thickness) {\n        line.setAttributes({\n          thickness: thickness\n        });\n      });\n      lineFolder.add(lineConfig, 'dashArray', 0, 1).onChange(function (dashArray) {\n        line.setAttributes({\n          dashArray: dashArray\n        });\n      });\n      lineFolder.add(lineConfig, 'dashOffset', 0, 1).onChange(function (dashOffset) {\n        line.setAttributes({\n          dashOffset: dashOffset\n        });\n      });\n      lineFolder.add(lineConfig, 'dashRatio', 0, 1).onChange(function (dashRatio) {\n        line.setAttributes({\n          dashRatio: dashRatio\n        });\n      });\n      lineFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/renderables/demo/point.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/renderables/demo/point.tsx","order":0,"filename":"point.tsx","title":"2D Point","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*UOGoTILse-0AAAAAAAAAAAAAARQnAQ","source":"import { Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst shapes = [\n  'circle',\n  'triangle',\n  'square',\n  'pentagon',\n  'hexagon',\n  'octogon',\n  'hexagram',\n  'rhombus',\n  'vesica',\n];\n\nconst App = function Point() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height)\n      .setMinDistance(1)\n      .setMaxDistance(3);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world).attachControl(view);\n\n    const points = world.createRenderable(\n      Renderable.POINT,\n      new Array(100).fill(undefined).map((_, i) => ({\n        shape: shapes[Math.floor(Math.random() * 9)],\n        size: [0.2, 0.2],\n        position: [Math.random() * 2 - 1, Math.random() * 2 - 1],\n        color: [Math.random(), Math.random(), Math.random(), 1],\n        strokeWidth: 0.01,\n      })),\n    );\n    scene.addRenderable(points);\n    const meshComponent = points.getMeshComponent();\n    const transformComponent = points.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const pointFolder = gui.addFolder('point');\n    const pointConfig = {\n      scale: 1,\n      color: [255, 255, 255],\n      opacity: 0.2,\n      strokeWidth: 0.01,\n      strokeColor: [0, 0, 0],\n      strokeOpacity: 0.2,\n      blur: 0,\n    };\n    pointFolder.add(pointConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    pointFolder.add(pointConfig, 'opacity', 0, 1, 0.1).onChange((opacity) => {\n      points.setAttributes({\n        opacity,\n      });\n    });\n    pointFolder\n      .add(pointConfig, 'strokeWidth', 0, 0.1, 0.01)\n      .onChange((strokeWidth) => {\n        points.setAttributes({\n          strokeWidth,\n        });\n      });\n    pointFolder.addColor(pointConfig, 'strokeColor').onChange((color) => {\n      points.setAttributes({\n        strokeColor: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    pointFolder\n      .add(pointConfig, 'strokeOpacity', 0, 1)\n      .onChange((strokeOpacity) => {\n        points.setAttributes({\n          strokeOpacity,\n        });\n      });\n    pointFolder.add(pointConfig, 'blur', 0, 1).onChange((blur) => {\n      points.setAttributes({\n        blur,\n      });\n    });\n    pointFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.point = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var shapes = ['circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'];\n\n  var App = function Point() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height).setMinDistance(1).setMaxDistance(3);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world).attachControl(view);\n\n      var points = world.createRenderable(_gWebgpu.Renderable.POINT, new Array(100).fill(undefined).map(function (_, i) {\n        return {\n          shape: shapes[Math.floor(Math.random() * 9)],\n          size: [0.2, 0.2],\n          position: [Math.random() * 2 - 1, Math.random() * 2 - 1],\n          color: [Math.random(), Math.random(), Math.random(), 1],\n          strokeWidth: 0.01\n        };\n      }));\n      scene.addRenderable(points);\n      var meshComponent = points.getMeshComponent();\n      var transformComponent = points.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var pointFolder = gui.addFolder('point');\n      var pointConfig = {\n        scale: 1,\n        color: [255, 255, 255],\n        opacity: 0.2,\n        strokeWidth: 0.01,\n        strokeColor: [0, 0, 0],\n        strokeOpacity: 0.2,\n        blur: 0\n      };\n      pointFolder.add(pointConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      pointFolder.add(pointConfig, 'opacity', 0, 1, 0.1).onChange(function (opacity) {\n        points.setAttributes({\n          opacity: opacity\n        });\n      });\n      pointFolder.add(pointConfig, 'strokeWidth', 0, 0.1, 0.01).onChange(function (strokeWidth) {\n        points.setAttributes({\n          strokeWidth: strokeWidth\n        });\n      });\n      pointFolder.addColor(pointConfig, 'strokeColor').onChange(function (color) {\n        points.setAttributes({\n          strokeColor: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      pointFolder.add(pointConfig, 'strokeOpacity', 0, 1).onChange(function (strokeOpacity) {\n        points.setAttributes({\n          strokeOpacity: strokeOpacity\n        });\n      });\n      pointFolder.add(pointConfig, 'blur', 0, 1).onChange(function (blur) {\n        points.setAttributes({\n          blur: blur\n        });\n      });\n      pointFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/material/demo/basic.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/material/demo/basic.tsx","order":0,"filename":"basic.tsx","title":"Basic Material","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*dV0gTafuRHsAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nfunction BasicMaterial() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // create geometry, material and attach them to mesh\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [0.5, 0.5, 0.5],\n    });\n\n    // create a texture by url\n    const texture = world.createTexture2D({\n      url: 'https://threejs.org/examples/textures/crate.gif',\n    });\n    const material = world\n      .createMaterial(Material.BASIC, {\n        map: texture,\n      })\n      .setUniform({\n        color: [1, 1, 1, 1],\n      });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    scene.addRenderable(box);\n\n    const transformComponent = box.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      transformComponent.rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('cube');\n    const cubeConfig = {\n      scale: 1,\n      color: [255, 255, 255],\n    };\n    cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    cubeFolder.addColor(cubeConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<BasicMaterial />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.basic = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function BasicMaterial() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      });\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // create geometry, material and attach them to mesh\n\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [0.5, 0.5, 0.5]\n      }); // create a texture by url\n\n      var texture = world.createTexture2D({\n        url: 'https://threejs.org/examples/textures/crate.gif'\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC, {\n        map: texture\n      }).setUniform({\n        color: [1, 1, 1, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      scene.addRenderable(box);\n      var transformComponent = box.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        transformComponent.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('cube');\n      var cubeConfig = {\n        scale: 1,\n        color: [255, 255, 255]\n      };\n      cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      cubeFolder.addColor(cubeConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(BasicMaterial, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/interaction/demo/multi-canvas.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/interaction/demo/multi-canvas.tsx","order":2,"filename":"multi-canvas.tsx","hidden":true,"title":"Multi canvas contexts(Not recommended)","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Material, Geometry, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport { Button } from 'antd';\nimport { vec3, vec4 } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport SplitPane from 'react-split-pane';\nimport Stats from 'stats.js';\n\nconst App = function MultiWorld() {\n  let frameId: number;\n  let camera1;\n  let camera2;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas1 = document.getElementById(\n      'application1',\n    ) as HTMLCanvasElement;\n    const canvas2 = document.getElementById(\n      'application2',\n    ) as HTMLCanvasElement;\n\n    const world1 = World.create({\n      canvas: canvas1,\n    });\n    const world2 = World.create({\n      canvas: canvas2,\n    });\n\n    const renderer1 = world1.createRenderer();\n    const scene1 = world1.createScene();\n    const boxEntity1 = world1.createEntity();\n    scene1.addEntity(boxEntity1);\n\n    const renderer2 = world2.createRenderer();\n    const scene2 = world2.createScene();\n    const boxEntity2 = world2.createEntity();\n    scene2.addEntity(boxEntity2);\n\n    camera1 = world1\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas1.width / canvas1.height);\n    camera2 = world2\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas2.width / canvas2.height);\n\n    const view1 = world1\n      .createView()\n      .setCamera(camera1)\n      .setScene(scene1);\n    const view2 = world2\n      .createView()\n      .setCamera(camera2)\n      .setScene(scene2);\n\n    // const tracker1 = Tracker.create(world1);\n    // tracker1.attachControl(view1);\n    // const tracker2 = Tracker.create(world2);\n    // tracker2.attachControl(view2);\n\n    const boxGeometry1 = world1.createGeometry(Geometry.BOX, {\n      halfExtents: vec3.fromValues(1, 1, 1),\n    });\n    const material1 = world1.createMaterial(Material.BASIC).setUniform({\n      color: vec4.fromValues(1, 0, 0, 1),\n    });\n    const boxGeometry2 = world2.createBoxGeometry({\n      halfExtents: vec3.fromValues(1, 1, 1),\n    });\n    const material2 = world2.createMaterial(Material.BASIC).setUniform({\n      color: vec4.fromValues(1, 0, 0, 1),\n    });\n\n    world1\n      .createRenderable(boxEntity1)\n      .setGeometry(boxGeometry1)\n      .setMaterial(material1);\n    world2\n      .createRenderable(boxEntity2)\n      .setGeometry(boxGeometry2)\n      .setMaterial(material2);\n\n    console.log(boxEntity1, boxEntity2, boxGeometry1, boxGeometry2);\n\n    const resizeRenderer1ToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas1.clientWidth * dpr;\n      const height = canvas1.clientHeight * dpr;\n      const needResize = canvas1.width !== width || canvas1.height !== height;\n      if (needResize) {\n        view1.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      return needResize;\n    };\n    const resizeRenderer2ToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas2.clientWidth * dpr;\n      const height = canvas2.clientHeight * dpr;\n      const needResize = canvas2.width !== width || canvas2.height !== height;\n      if (needResize) {\n        view2.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas2.width = width;\n        canvas2.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      if (resizeRenderer1ToDisplaySize()) {\n        camera1.setAspect(canvas1.clientWidth / canvas1.clientHeight);\n      }\n      if (resizeRenderer2ToDisplaySize()) {\n        camera2.setAspect(canvas2.clientWidth / canvas2.clientHeight);\n      }\n\n      renderer1.render(view1);\n      renderer2.render(view2);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world1.destroy();\n      world2.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <>\n      <SplitPane split=\"vertical\" defaultSize={200} primary=\"second\">\n        <canvas\n          id=\"application1\"\n          style={{\n            width: '100%',\n            height: '100%',\n            display: 'block',\n          }}\n        />\n        <canvas\n          id=\"application2\"\n          style={{\n            width: '100%',\n            height: '100%',\n            display: 'block',\n          }}\n        />\n      </SplitPane>\n    </>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"gl-matrix\", \"react\", \"react-dom\", \"react-split-pane\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"react-split-pane\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.glMatrix, global.react, global.reactDom, global.reactSplitPane, global.stats);\n    global.multiCanvas = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _glMatrix, _react, _reactDom, _reactSplitPane, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _reactSplitPane = _interopRequireDefault(_reactSplitPane);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function MultiWorld() {\n    var frameId;\n    var camera1;\n    var camera2;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas1 = document.getElementById('application1');\n      var canvas2 = document.getElementById('application2');\n\n      var world1 = _gWebgpu.World.create({\n        canvas: canvas1\n      });\n\n      var world2 = _gWebgpu.World.create({\n        canvas: canvas2\n      });\n\n      var renderer1 = world1.createRenderer();\n      var scene1 = world1.createScene();\n      var boxEntity1 = world1.createEntity();\n      scene1.addEntity(boxEntity1);\n      var renderer2 = world2.createRenderer();\n      var scene2 = world2.createScene();\n      var boxEntity2 = world2.createEntity();\n      scene2.addEntity(boxEntity2);\n      camera1 = world1.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas1.width / canvas1.height);\n      camera2 = world2.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas2.width / canvas2.height);\n      var view1 = world1.createView().setCamera(camera1).setScene(scene1);\n      var view2 = world2.createView().setCamera(camera2).setScene(scene2); // const tracker1 = Tracker.create(world1);\n      // tracker1.attachControl(view1);\n      // const tracker2 = Tracker.create(world2);\n      // tracker2.attachControl(view2);\n\n      var boxGeometry1 = world1.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: _glMatrix.vec3.fromValues(1, 1, 1)\n      });\n      var material1 = world1.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: _glMatrix.vec4.fromValues(1, 0, 0, 1)\n      });\n      var boxGeometry2 = world2.createBoxGeometry({\n        halfExtents: _glMatrix.vec3.fromValues(1, 1, 1)\n      });\n      var material2 = world2.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: _glMatrix.vec4.fromValues(1, 0, 0, 1)\n      });\n      world1.createRenderable(boxEntity1).setGeometry(boxGeometry1).setMaterial(material1);\n      world2.createRenderable(boxEntity2).setGeometry(boxGeometry2).setMaterial(material2);\n      console.log(boxEntity1, boxEntity2, boxGeometry1, boxGeometry2);\n\n      var resizeRenderer1ToDisplaySize = function resizeRenderer1ToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas1.clientWidth * dpr;\n        var height = canvas1.clientHeight * dpr;\n        var needResize = canvas1.width !== width || canvas1.height !== height;\n\n        if (needResize) {\n          view1.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas1.width = width;\n          canvas1.height = height;\n        }\n\n        return needResize;\n      };\n\n      var resizeRenderer2ToDisplaySize = function resizeRenderer2ToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas2.clientWidth * dpr;\n        var height = canvas2.clientHeight * dpr;\n        var needResize = canvas2.width !== width || canvas2.height !== height;\n\n        if (needResize) {\n          view2.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas2.width = width;\n          canvas2.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRenderer1ToDisplaySize()) {\n          camera1.setAspect(canvas1.clientWidth / canvas1.clientHeight);\n        }\n\n        if (resizeRenderer2ToDisplaySize()) {\n          camera2.setAspect(canvas2.clientWidth / canvas2.clientHeight);\n        }\n\n        renderer1.render(view1);\n        renderer2.render(view2);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world1.destroy();\n        world2.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_reactSplitPane.default, {\n      split: \"vertical\",\n      defaultSize: 200,\n      primary: \"second\"\n    }, /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application1\",\n      style: {\n        width: '100%',\n        height: '100%',\n        display: 'block'\n      }\n    }), /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application2\",\n      style: {\n        width: '100%',\n        height: '100%',\n        display: 'block'\n      }\n    })));\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/interaction/demo/multi-view.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/interaction/demo/multi-view.tsx","order":1,"filename":"multi-view.tsx","title":"Multi views(Recommended)","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*ytT4SoKan_0AAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst $wrapper = document.getElementById('wrapper');\n\nfunction MultiView() {\n  let frameId: number;\n  let camera1;\n  let camera2;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene1 = world.createScene();\n    const scene2 = world.createScene();\n\n    camera1 = world\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n    camera2 = world\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n\n    const view1 = world\n      .createView()\n      .setCamera(camera1)\n      .setScene(scene1);\n    const view2 = world\n      .createView()\n      .setCamera(camera2)\n      .setScene(scene2);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view1, view2);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material1 = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n    const material2 = world.createMaterial(Material.BASIC).setUniform({\n      color: [0, 1, 0, 1],\n    });\n\n    const box1 = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material1);\n    scene1.addRenderable(box1);\n    const transformComponent1 = box1.getTransformComponent();\n    transformComponent1.translateLocal([-1.2, 0, 0]);\n\n    const box2 = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material2);\n    scene2.addRenderable(box2);\n    const transformComponent2 = box2.getTransformComponent();\n    transformComponent2.translateLocal([1.2, 0, 0]);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        renderer.setSize({ width, height });\n        view1.setViewport({\n          x: 0,\n          y: 0,\n          width: width / 2,\n          height,\n        });\n        view2.setViewport({\n          x: width / 2,\n          y: 0,\n          width: width / 2,\n          height,\n        });\n      }\n      return needResize;\n    };\n\n    const render = async () => {\n      if (stats) {\n        stats.update();\n      }\n\n      transformComponent1.rotateLocal(quat.fromEuler(quat.create(), 0, 1, 0));\n      transformComponent2.rotateLocal(quat.fromEuler(quat.create(), 0, 1, 0));\n\n      if (resizeRendererToDisplaySize()) {\n        camera1.setAspect(canvas.clientWidth / canvas.clientHeight);\n        camera2.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n\n      renderer.render(view1, view2);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <>\n      <canvas\n        id=\"application\"\n        style={{\n          width: '100%',\n          height: '100%',\n          display: 'block',\n        }}\n      />\n      <div\n        style={{\n          position: 'absolute',\n          left: 0,\n          top: 0,\n          width: '50%',\n          height: '100%',\n          textAlign: 'right',\n          borderRight: '1px solid',\n          pointerEvents: 'none',\n        }}\n      >\n        Viewport 1\n      </div>\n      <div style={{ position: 'absolute', left: '50%', top: 0 }}>\n        Viewport 2\n      </div>\n    </>\n  );\n}\n\nReactDOM.render(<MultiView />, $wrapper);\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.multiView = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var $wrapper = document.getElementById('wrapper');\n\n  function MultiView() {\n    var frameId;\n    var camera1;\n    var camera2;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene1 = world.createScene();\n      var scene2 = world.createScene();\n      camera1 = world.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      camera2 = world.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      var view1 = world.createView().setCamera(camera1).setScene(scene1);\n      var view2 = world.createView().setCamera(camera2).setScene(scene2);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view1, view2);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material1 = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var material2 = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [0, 1, 0, 1]\n      });\n      var box1 = world.createRenderable().setGeometry(boxGeometry).setMaterial(material1);\n      scene1.addRenderable(box1);\n      var transformComponent1 = box1.getTransformComponent();\n      transformComponent1.translateLocal([-1.2, 0, 0]);\n      var box2 = world.createRenderable().setGeometry(boxGeometry).setMaterial(material2);\n      scene2.addRenderable(box2);\n      var transformComponent2 = box2.getTransformComponent();\n      transformComponent2.translateLocal([1.2, 0, 0]);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          renderer.setSize({\n            width: width,\n            height: height\n          });\n          view1.setViewport({\n            x: 0,\n            y: 0,\n            width: width / 2,\n            height: height\n          });\n          view2.setViewport({\n            x: width / 2,\n            y: 0,\n            width: width / 2,\n            height: height\n          });\n        }\n\n        return needResize;\n      };\n\n      var render = async function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        transformComponent1.rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n        transformComponent2.rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (resizeRendererToDisplaySize()) {\n          camera1.setAspect(canvas.clientWidth / canvas.clientHeight);\n          camera2.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view1, view2);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: '100%',\n        height: '100%',\n        display: 'block'\n      }\n    }), /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        left: 0,\n        top: 0,\n        width: '50%',\n        height: '100%',\n        textAlign: 'right',\n        borderRight: '1px solid',\n        pointerEvents: 'none'\n      }\n    }, \"Viewport 1\"), /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        left: '50%',\n        top: 0\n      }\n    }, \"Viewport 2\"));\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(MultiView, null), $wrapper);\n});"},{"relativePath":"rendering/interaction/demo/pixel-picker.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/interaction/demo/pixel-picker.tsx","order":4,"filename":"pixel-picker.tsx","title":"PixelPicker","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World, Renderable } from '@antv/g-webgpu';\nimport { PixelPicker, Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst shapes = [\n  'circle',\n  'triangle',\n  'square',\n  'pentagon',\n  'hexagon',\n  'octogon',\n  'hexagram',\n  'rhombus',\n  'vesica',\n];\n\nconst App = function PixelPickerDemo() {\n  let frameId;\n  const [pickResult, setPickResult] = useState<{\n    id: number | undefined;\n    x: number;\n    y: number;\n  }>({\n    id: undefined,\n    x: -1,\n    y: -1,\n  });\n\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n    const pointsEntity = world.createEntity();\n    scene.addEntity(pointsEntity);\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 5)\n      .setPerspective(0.1, 200, 60, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n    const picker = PixelPicker.create(world);\n    picker.attachControl(view);\n    picker.on(\n      'pick',\n      (result: { id: number | undefined; x: number; y: number }) => {\n        setPickResult(result);\n      },\n    );\n\n    world.createRenderable(\n      pointsEntity,\n      Renderable.POINT,\n      new Array(100).fill(undefined).map((_, i) => ({\n        id: i, // used by pixel picker\n        shape: shapes[Math.floor(Math.random() * 9)],\n        size: [50, 50],\n        position: [Math.random() * 2 - 1, Math.random() * 2 - 1],\n        color: [Math.random(), Math.random(), Math.random(), 1],\n      })),\n    );\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const pixelPickerFolder = gui.addFolder('pixel picker');\n    const pickConfig = {\n      enableHighlight: true,\n      highlightColor: [255, 0, 0],\n    };\n    pixelPickerFolder.add(pickConfig, 'enableHighlight').onChange((enabled) => {\n      picker.enableHighlight(enabled);\n    });\n    pixelPickerFolder\n      .addColor(pickConfig, 'highlightColor')\n      .onChange((color) => {\n        picker.setHighlightColor([\n          color[0] / 255,\n          color[1] / 255,\n          color[2] / 255,\n          1,\n        ]);\n      });\n    pixelPickerFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  }, []);\n\n  return (\n    <>\n      <div\n        style={{\n          position: 'absolute',\n          top: 100,\n          left: 0,\n        }}\n      >\n        Picked ID: {pickResult.id}, x: {pickResult.x}, y: {pickResult.y}\n      </div>\n      <canvas\n        id=\"application\"\n        style={{\n          width: 600,\n          height: 600,\n          display: 'block',\n        }}\n      />\n    </>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.pixelPicker = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var shapes = ['circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'];\n\n  var App = function PixelPickerDemo() {\n    var frameId;\n\n    var _useState = (0, _react.useState)({\n      id: undefined,\n      x: -1,\n      y: -1\n    }),\n        _useState2 = _slicedToArray(_useState, 2),\n        pickResult = _useState2[0],\n        setPickResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var pointsEntity = world.createEntity();\n      scene.addEntity(pointsEntity);\n      var camera = world.createCamera().setPosition(0, 0, 5).setPerspective(0.1, 200, 60, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n\n      var picker = _gWebgpuInteractor.PixelPicker.create(world);\n\n      picker.attachControl(view);\n      picker.on('pick', function (result) {\n        setPickResult(result);\n      });\n      world.createRenderable(pointsEntity, _gWebgpu.Renderable.POINT, new Array(100).fill(undefined).map(function (_, i) {\n        return {\n          id: i,\n          // used by pixel picker\n          shape: shapes[Math.floor(Math.random() * 9)],\n          size: [50, 50],\n          position: [Math.random() * 2 - 1, Math.random() * 2 - 1],\n          color: [Math.random(), Math.random(), Math.random(), 1]\n        };\n      }));\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var pixelPickerFolder = gui.addFolder('pixel picker');\n      var pickConfig = {\n        enableHighlight: true,\n        highlightColor: [255, 0, 0]\n      };\n      pixelPickerFolder.add(pickConfig, 'enableHighlight').onChange(function (enabled) {\n        picker.enableHighlight(enabled);\n      });\n      pixelPickerFolder.addColor(pickConfig, 'highlightColor').onChange(function (color) {\n        picker.setHighlightColor([color[0] / 255, color[1] / 255, color[2] / 255, 1]);\n      });\n      pixelPickerFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        top: 100,\n        left: 0\n      }\n    }, \"Picked ID: \", pickResult.id, \", x: \", pickResult.x, \", y: \", pickResult.y), /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    }));\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/interaction/demo/ray-picker.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/interaction/demo/ray-picker.tsx","order":3,"filename":"ray-picker.tsx","title":"RayPicker","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { RayPicker, Tracker } from '@antv/g-webgpu-interactor';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst CUBE_NUM = 100;\n\nfunction rand(min: number, max: number) {\n  if (max === undefined) {\n    max = min;\n    min = 0;\n  }\n  return min + (max - min) * Math.random();\n}\n\nconst App = function RayPickerDemo() {\n  let frameId;\n  const [pickResult, setPickResult] = useState<{\n    id: number | undefined;\n    x: number;\n    y: number;\n  }>({\n    id: undefined,\n    x: -1,\n    y: -1,\n  });\n\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n    const picker = RayPicker.create(world);\n    picker.attachControl(view);\n    picker.on(\n      'pick',\n      (result: { id: number | undefined; x: number; y: number }) => {\n        setPickResult(result);\n      },\n    );\n\n    // all cubes share the same geometry\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [0.1, 0.1, 0.1],\n    });\n    const cubeGroup = world.createRenderable();\n\n    for (let i = 0; i < CUBE_NUM; i++) {\n      const material = world.createMaterial(Material.BASIC).setUniform({\n        color: [1, 0, 0, 1],\n      });\n\n      const cube = world\n        .createRenderable()\n        .setGeometry(boxGeometry)\n        .setMaterial(material);\n\n      const randomScale = rand(1, 2);\n      cube\n        .getTransformComponent()\n        .translateLocal([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)])\n        .setLocalScale([randomScale, randomScale, randomScale]);\n\n      cube.attach(cubeGroup);\n      scene.addRenderable(cube);\n    }\n    scene.addRenderable(cubeGroup);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      cubeGroup\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 1, 0));\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  }, []);\n\n  return (\n    <>\n      <div\n        style={{\n          position: 'absolute',\n          top: 100,\n          left: 0,\n        }}\n      >\n        Picked ID: {pickResult.id}, x: {pickResult.x}, y: {pickResult.y}\n      </div>\n      <canvas\n        id=\"application\"\n        style={{\n          width: 600,\n          height: 600,\n          display: 'block',\n        }}\n      />\n    </>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.rayPicker = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var CUBE_NUM = 100;\n\n  function rand(min, max) {\n    if (max === undefined) {\n      max = min;\n      min = 0;\n    }\n\n    return min + (max - min) * Math.random();\n  }\n\n  var App = function RayPickerDemo() {\n    var frameId;\n\n    var _useState = (0, _react.useState)({\n      id: undefined,\n      x: -1,\n      y: -1\n    }),\n        _useState2 = _slicedToArray(_useState, 2),\n        pickResult = _useState2[0],\n        setPickResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n\n      var picker = _gWebgpuInteractor.RayPicker.create(world);\n\n      picker.attachControl(view);\n      picker.on('pick', function (result) {\n        setPickResult(result);\n      }); // all cubes share the same geometry\n\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [0.1, 0.1, 0.1]\n      });\n      var cubeGroup = world.createRenderable();\n\n      for (var i = 0; i < CUBE_NUM; i++) {\n        var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n          color: [1, 0, 0, 1]\n        });\n        var cube = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n        var randomScale = rand(1, 2);\n        cube.getTransformComponent().translateLocal([rand(-1.2, 1.2), rand(-1.2, 1.2), rand(-1.2, 1.2)]).setLocalScale([randomScale, randomScale, randomScale]);\n        cube.attach(cubeGroup);\n        scene.addRenderable(cube);\n      }\n\n      scene.addRenderable(cubeGroup);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        cubeGroup.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        top: 100,\n        left: 0\n      }\n    }, \"Picked ID: \", pickResult.id, \", x: \", pickResult.x, \", y: \", pickResult.y), /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    }));\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/interaction/demo/responsive.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/interaction/demo/responsive.tsx","order":0,"filename":"responsive.tsx","title":"Use a responsive viewport","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*ByguS56BAO0AAAAAAAAAAAAAARQnAQ","source":"import { Material, Geometry, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport SplitPane from 'react-split-pane';\nimport Stats from 'stats.js';\n\nconst App = function Responsive() {\n  let frameId: number;\n  let camera;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    camera = world\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n    camera.createLandmark('mark1', {\n      position: [0, 5, 5],\n      focalPoint: [0, 0, 0],\n    });\n    camera.createLandmark('mark2', {\n      position: [10, 0, 10],\n      focalPoint: [5, 0, 0],\n    });\n    camera.createLandmark('mark3', {\n      position: [3, 2, 5],\n      focalPoint: [0, 0, 0],\n      roll: 30,\n    });\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    scene.addRenderable(box);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    return () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n  });\n\n  return (\n    <>\n      <SplitPane split=\"vertical\" defaultSize={200} primary=\"second\">\n        <canvas\n          id=\"application\"\n          style={{\n            width: '100%',\n            height: '100%',\n            display: 'block',\n          }}\n        />\n        <div>⇐ Drag this bar</div>\n      </SplitPane>\n    </>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"react\", \"react-dom\", \"react-split-pane\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"react\"), require(\"react-dom\"), require(\"react-split-pane\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.react, global.reactDom, global.reactSplitPane, global.stats);\n    global.responsive = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _react, _reactDom, _reactSplitPane, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _reactSplitPane = _interopRequireDefault(_reactSplitPane);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function Responsive() {\n    var frameId;\n    var camera;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      camera = world.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      camera.createLandmark('mark1', {\n        position: [0, 5, 5],\n        focalPoint: [0, 0, 0]\n      });\n      camera.createLandmark('mark2', {\n        position: [10, 0, 10],\n        focalPoint: [5, 0, 0]\n      });\n      camera.createLandmark('mark3', {\n        position: [3, 2, 5],\n        focalPoint: [0, 0, 0],\n        roll: 30\n      });\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      scene.addRenderable(box);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n      return function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_reactSplitPane.default, {\n      split: \"vertical\",\n      defaultSize: 200,\n      primary: \"second\"\n    }, /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: '100%',\n        height: '100%',\n        display: 'block'\n      }\n    }), /*#__PURE__*/_react.default.createElement(\"div\", null, \"\\u21D0 Drag this bar\")));\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/geometry/demo/box.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/geometry/demo/box.tsx","order":0,"filename":"box.tsx","title":"Box","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*dV0gTafuRHsAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nfunction BoxGeometry() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // create geometry, material and attach them to mesh\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [0.5, 0.5, 0.5],\n    });\n\n    // create a texture by url\n    const texture = world.createTexture2D({\n      url: 'https://threejs.org/examples/textures/crate.gif',\n    });\n    const material = world\n      .createMaterial(Material.BASIC, {\n        map: texture,\n      })\n      .setUniform({\n        color: [1, 1, 1, 1],\n      });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    scene.addRenderable(box);\n    const transformComponent = box.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      transformComponent.rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('cube');\n    const cubeConfig = {\n      scale: 1,\n      color: [255, 255, 255],\n    };\n    cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    cubeFolder.addColor(cubeConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<BoxGeometry />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.box = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function BoxGeometry() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      });\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // create geometry, material and attach them to mesh\n\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [0.5, 0.5, 0.5]\n      }); // create a texture by url\n\n      var texture = world.createTexture2D({\n        url: 'https://threejs.org/examples/textures/crate.gif'\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC, {\n        map: texture\n      }).setUniform({\n        color: [1, 1, 1, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      scene.addRenderable(box);\n      var transformComponent = box.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        transformComponent.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('cube');\n      var cubeConfig = {\n        scale: 1,\n        color: [255, 255, 255]\n      };\n      cubeFolder.add(cubeConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      cubeFolder.addColor(cubeConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(BoxGeometry, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/geometry/demo/merged.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/geometry/demo/merged.tsx","order":3,"filename":"merged.tsx","title":"Merged geometry","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*_fOKRJ18IcUAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst CUBE_NUM = 1000;\n\nfunction rand(min: number, max: number) {\n  if (max === undefined) {\n    max = min;\n    min = 0;\n  }\n  return min + (max - min) * Math.random();\n}\n\nfunction MergedGeometry() {\n  let frameId;\n\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 100, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n    const geometries = [];\n    // reused by every geometry\n    const transformComponent = world.createRenderable().getTransformComponent();\n\n    const unmergedCubes = world.createRenderable();\n    scene.addRenderable(unmergedCubes);\n\n    for (let i = 0; i < CUBE_NUM; i++) {\n      const boxGeometry = world.createGeometry(Geometry.BOX, {\n        halfExtents: [1, 1, 1],\n      });\n      const randomScale = rand(0.02, 0.05);\n      const translation = [rand(-1, 1), rand(-1, 1), rand(-1, 1)];\n      const scale = [randomScale, randomScale, randomScale];\n\n      // do RTS transformation\n      transformComponent.translateLocal(translation).setLocalScale(scale);\n      transformComponent.updateTransform();\n\n      // apply transform matrix to every geometry\n      boxGeometry.applyMatrix(transformComponent.worldTransform);\n      // clear for next time\n      transformComponent.clearTransform();\n      geometries.push(boxGeometry);\n\n      // bad performance...\n      const boxGeometry2 = world.createGeometry(Geometry.BOX, {\n        halfExtents: [1, 1, 1],\n      });\n      const cube = world\n        .createRenderable()\n        .setGeometry(boxGeometry2)\n        .setMaterial(material);\n      cube\n        .getTransformComponent()\n        .translate(translation)\n        .setLocalScale(scale);\n      cube.attach(unmergedCubes);\n      scene.addRenderable(cube);\n      unmergedCubes.setVisible(false);\n    }\n\n    // good performance...\n    // merge all the boxes into a single geometry\n    const mergedGeometry = world.createGeometry(Geometry.MERGED, {\n      geometries,\n    });\n\n    const mergedCubes = world\n      .createRenderable()\n      .setGeometry(mergedGeometry)\n      .setMaterial(material);\n    scene.addRenderable(mergedCubes);\n\n    const grid = world.createRenderable(Renderable.GRID);\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      mergedCubes\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 1, 0));\n      unmergedCubes\n        .getTransformComponent()\n        .rotateLocal(quat.fromEuler(quat.create(), 0, 1, 0));\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('merged geometry');\n    const cubeConfig = {\n      merged: true,\n    };\n    cubeFolder\n      .add(cubeConfig, 'merged')\n      .onChange((merged) => {\n        if (merged) {\n          mergedCubes.setVisible(true);\n          unmergedCubes.setVisible(false);\n        } else {\n          mergedCubes.setVisible(false);\n          unmergedCubes.setVisible(true);\n        }\n      })\n      .name('enable merged geometry');\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  }, []);\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<MergedGeometry />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.merged = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var CUBE_NUM = 1000;\n\n  function rand(min, max) {\n    if (max === undefined) {\n      max = min;\n      min = 0;\n    }\n\n    return min + (max - min) * Math.random();\n  }\n\n  function MergedGeometry() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 100, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var geometries = []; // reused by every geometry\n\n      var transformComponent = world.createRenderable().getTransformComponent();\n      var unmergedCubes = world.createRenderable();\n      scene.addRenderable(unmergedCubes);\n\n      for (var i = 0; i < CUBE_NUM; i++) {\n        var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n          halfExtents: [1, 1, 1]\n        });\n        var randomScale = rand(0.02, 0.05);\n        var translation = [rand(-1, 1), rand(-1, 1), rand(-1, 1)];\n        var scale = [randomScale, randomScale, randomScale]; // do RTS transformation\n\n        transformComponent.translateLocal(translation).setLocalScale(scale);\n        transformComponent.updateTransform(); // apply transform matrix to every geometry\n\n        boxGeometry.applyMatrix(transformComponent.worldTransform); // clear for next time\n\n        transformComponent.clearTransform();\n        geometries.push(boxGeometry); // bad performance...\n\n        var boxGeometry2 = world.createGeometry(_gWebgpu.Geometry.BOX, {\n          halfExtents: [1, 1, 1]\n        });\n        var cube = world.createRenderable().setGeometry(boxGeometry2).setMaterial(material);\n        cube.getTransformComponent().translate(translation).setLocalScale(scale);\n        cube.attach(unmergedCubes);\n        scene.addRenderable(cube);\n        unmergedCubes.setVisible(false);\n      } // good performance...\n      // merge all the boxes into a single geometry\n\n\n      var mergedGeometry = world.createGeometry(_gWebgpu.Geometry.MERGED, {\n        geometries: geometries\n      });\n      var mergedCubes = world.createRenderable().setGeometry(mergedGeometry).setMaterial(material);\n      scene.addRenderable(mergedCubes);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID);\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        mergedCubes.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n        unmergedCubes.getTransformComponent().rotateLocal(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('merged geometry');\n      var cubeConfig = {\n        merged: true\n      };\n      cubeFolder.add(cubeConfig, 'merged').onChange(function (merged) {\n        if (merged) {\n          mergedCubes.setVisible(true);\n          unmergedCubes.setVisible(false);\n        } else {\n          mergedCubes.setVisible(false);\n          unmergedCubes.setVisible(true);\n        }\n      }).name('enable merged geometry');\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(MergedGeometry, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/geometry/demo/plane.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/geometry/demo/plane.tsx","order":2,"filename":"plane.tsx","title":"Plane","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*6zGmSbSJHgcAAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nfunction PlaneGeometry() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 2, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // create geometry, material and attach them to mesh\n    const planeGeometry = world.createGeometry(Geometry.PLANE);\n\n    // create a texture by url\n    const texture = world.createTexture2D({\n      url: 'https://threejs.org/examples/textures/crate.gif',\n    });\n    const material = world\n      .createMaterial(Material.BASIC, {\n        map: texture,\n      })\n      .setUniform({\n        color: [1, 1, 1, 1],\n      });\n\n    const plane = world\n      .createRenderable()\n      .setGeometry(planeGeometry)\n      .setMaterial(material);\n    scene.addRenderable(plane);\n\n    const transformComponent = plane.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      transformComponent.rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const planeFolder = gui.addFolder('plane');\n    const planeConfig = {\n      scale: 1,\n      color: [255, 255, 255],\n    };\n    planeFolder.add(planeConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    planeFolder.addColor(planeConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    planeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<PlaneGeometry />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.plane = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function PlaneGeometry() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 2, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      });\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // create geometry, material and attach them to mesh\n\n      var planeGeometry = world.createGeometry(_gWebgpu.Geometry.PLANE); // create a texture by url\n\n      var texture = world.createTexture2D({\n        url: 'https://threejs.org/examples/textures/crate.gif'\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC, {\n        map: texture\n      }).setUniform({\n        color: [1, 1, 1, 1]\n      });\n      var plane = world.createRenderable().setGeometry(planeGeometry).setMaterial(material);\n      scene.addRenderable(plane);\n      var transformComponent = plane.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        transformComponent.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var planeFolder = gui.addFolder('plane');\n      var planeConfig = {\n        scale: 1,\n        color: [255, 255, 255]\n      };\n      planeFolder.add(planeConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      planeFolder.addColor(planeConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      planeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(PlaneGeometry, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/geometry/demo/world.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/geometry/demo/world.tsx","order":4,"filename":"world.tsx","title":"World","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*jQpbRrS6en0AAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat, vec3, vec4 } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nfunction parseData(text) {\n  const data = [];\n  const settings = { data };\n  let max;\n  let min;\n  // split into lines\n  text.split('\\n').forEach((line) => {\n    // split the line by whitespace\n    const parts = line.trim().split(/\\s+/);\n    if (parts.length === 2) {\n      // only 2 parts, must be a key/value pair\n      settings[parts[0]] = parseFloat(parts[1]);\n    } else if (parts.length > 2) {\n      // more than 2 parts, must be data\n      const values = parts.map((v) => {\n        const value = parseFloat(v);\n        if (value === settings.NODATA_value) {\n          return undefined;\n        }\n        max = Math.max(max === undefined ? value : max, value);\n        min = Math.min(min === undefined ? value : min, value);\n        return value;\n      });\n      data.push(values);\n    }\n  });\n  return {...settings,  min, max};\n}\n\nfunction SphereGeometry() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // create geometry, material and attach them to mesh\n    const sphereGeometry = world.createGeometry(Geometry.SPHERE, {\n      radius: 0.5,\n      latitudeBands: 64,\n      longitudeBands: 32,\n    });\n\n    // create a texture by url\n    const texture = world.createTexture2D({\n      url:\n        'https://2.bp.blogspot.com/-Jfw4jY6vBWM/UkbwZhdKxuI/AAAAAAAAK94/QTmtnuDFlC8/s1600/2_no_clouds_4k.jpg',\n    });\n    const material = world\n      .createMaterial(Material.BASIC, {\n        map: texture,\n      })\n      .setUniform({\n        color: [1, 1, 1, 1],\n      });\n\n    const sphere = world\n      .createRenderable()\n      .setGeometry(sphereGeometry)\n      .setMaterial(material);\n    scene.addRenderable(sphere);\n\n    const transformComponent = sphere.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    // render();\n\n    const load = async () => {\n      const req = await fetch(\n        'https://threejsfundamentals.org/threejs/resources/data/gpw/gpw_v4_basic_demographic_characteristics_rev10_a000_014mt_2010_cntm_1_deg.asc',\n      );\n      const text = await req.text();\n      const { min, max, data } = parseData(text);\n      const range = max - min;\n      const boxGeometry = world.createGeometry(Geometry.BOX);\n      // const boxMaterial = world\n      //       .createMaterial(Material.BASIC)\n      //       .setUniform({\n      //         color: [1, 1, 1, 1],\n      //       });\n\n      // these helpers will make it easy to position the boxes\n      // We can rotate the lon helper on its Y axis to the longitude\n      // const lonHelperEntity = world.createEntity();\n      // const lonHelper = world.createRenderable(lonHelperEntity);\n      // scene.addEntity(lonHelperEntity);\n      // // We rotate the latHelper on its X axis to the latitude\n      // const latHelperEntity = world.createEntity();\n      // const latHelper = world.createRenderable(latHelperEntity);\n      // latHelper.attach(lonHelper);\n      // // The position helper moves the object to the edge of the sphere\n      // const positionHelperEntity = world.createEntity();\n      // const positionHelper = world.createRenderable(positionHelperEntity);\n      // positionHelper\n      //   .getTransformComponent()\n      //   .translate([0, 0, 1]);\n      // positionHelper.attach(latHelper);\n\n      const lonFudge = Math.PI * 0.5;\n      const latFudge = Math.PI * -0.135;\n      data.forEach((row, latNdx) => {\n        row.forEach((value, lonNdx) => {\n          if (value === undefined || latNdx > 20 || lonNdx > 20) {\n            return;\n          }\n          const amount = (value - min) / range;\n\n          const boxMaterial = world.createMaterial(Material.BASIC).setUniform({\n            color: [1, 0, 0, 1],\n          });\n          // const material = new THREE.MeshBasicMaterial();\n          // const hue = THREE.MathUtils.lerp(0.7, 0.3, amount);\n          // const saturation = 1;\n          // const lightness = THREE.MathUtils.lerp(0.4, 1.0, amount);\n          // material.color.setHSL(hue, saturation, lightness);\n\n          const boxEntity = world.createEntity();\n          const box = world\n            .createRenderable(boxEntity)\n            .setGeometry(boxGeometry)\n            .setMaterial(boxMaterial);\n          // box.attach(positionHelper);\n          box.getTransformComponent().localScale = [1, 1, 1];\n          box.getTransformComponent().scale([0.05, 0.05, 0.05]);\n          box.getTransformComponent().translate([0, 0, 1]);\n\n          scene.addEntity(boxEntity);\n\n          // console.log(boxEntity);\n\n          // const mesh = new THREE.Mesh(geometry, material);\n          // scene.add(mesh);\n\n          // adjust the helpers to point to the latitude and longitude\n          // lonHelper.rotation.y = THREE.MathUtils.degToRad(lonNdx + file.xllcorner) + lonFudge;\n          // latHelper.rotation.x = THREE.MathUtils.degToRad(latNdx + file.yllcorner) + latFudge;\n\n          // use the world matrix of the position helper to\n          // position this mesh.\n          // positionHelper.updateWorldMatrix(true, false);\n          // mesh.applyMatrix4(positionHelper.matrixWorld);\n\n          // mesh.scale.set(0.005, 0.005, THREE.MathUtils.lerp(0.01, 0.5, amount));\n        });\n      });\n\n      render();\n    };\n    load();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const sphereFolder = gui.addFolder('sphere');\n    const sphereConfig = {\n      scale: 1,\n      radius: 0.5,\n      color: [255, 255, 255],\n    };\n    sphereFolder.add(sphereConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setScaleLocal(vec3.fromValues(size, size, size));\n    });\n    sphereFolder.addColor(sphereConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: vec4.fromValues(\n          color[0] / 255,\n          color[1] / 255,\n          color[2] / 255,\n          1,\n        ),\n      });\n    });\n    sphereFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<SphereGeometry />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.world = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function parseData(text) {\n    var data = [];\n    var settings = {\n      data: data\n    };\n    var max;\n    var min; // split into lines\n\n    text.split('\\n').forEach(function (line) {\n      // split the line by whitespace\n      var parts = line.trim().split(/\\s+/);\n\n      if (parts.length === 2) {\n        // only 2 parts, must be a key/value pair\n        settings[parts[0]] = parseFloat(parts[1]);\n      } else if (parts.length > 2) {\n        // more than 2 parts, must be data\n        var values = parts.map(function (v) {\n          var value = parseFloat(v);\n\n          if (value === settings.NODATA_value) {\n            return undefined;\n          }\n\n          max = Math.max(max === undefined ? value : max, value);\n          min = Math.min(min === undefined ? value : min, value);\n          return value;\n        });\n        data.push(values);\n      }\n    });\n    return { ...settings,\n      min: min,\n      max: max\n    };\n  }\n\n  function SphereGeometry() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      });\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // create geometry, material and attach them to mesh\n\n      var sphereGeometry = world.createGeometry(_gWebgpu.Geometry.SPHERE, {\n        radius: 0.5,\n        latitudeBands: 64,\n        longitudeBands: 32\n      }); // create a texture by url\n\n      var texture = world.createTexture2D({\n        url: 'https://2.bp.blogspot.com/-Jfw4jY6vBWM/UkbwZhdKxuI/AAAAAAAAK94/QTmtnuDFlC8/s1600/2_no_clouds_4k.jpg'\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC, {\n        map: texture\n      }).setUniform({\n        color: [1, 1, 1, 1]\n      });\n      var sphere = world.createRenderable().setGeometry(sphereGeometry).setMaterial(material);\n      scene.addRenderable(sphere);\n      var transformComponent = sphere.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      }; // render();\n\n\n      var load = async function load() {\n        var req = await fetch('https://threejsfundamentals.org/threejs/resources/data/gpw/gpw_v4_basic_demographic_characteristics_rev10_a000_014mt_2010_cntm_1_deg.asc');\n        var text = await req.text();\n\n        var _parseData = parseData(text),\n            min = _parseData.min,\n            max = _parseData.max,\n            data = _parseData.data;\n\n        var range = max - min;\n        var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX); // const boxMaterial = world\n        //       .createMaterial(Material.BASIC)\n        //       .setUniform({\n        //         color: [1, 1, 1, 1],\n        //       });\n        // these helpers will make it easy to position the boxes\n        // We can rotate the lon helper on its Y axis to the longitude\n        // const lonHelperEntity = world.createEntity();\n        // const lonHelper = world.createRenderable(lonHelperEntity);\n        // scene.addEntity(lonHelperEntity);\n        // // We rotate the latHelper on its X axis to the latitude\n        // const latHelperEntity = world.createEntity();\n        // const latHelper = world.createRenderable(latHelperEntity);\n        // latHelper.attach(lonHelper);\n        // // The position helper moves the object to the edge of the sphere\n        // const positionHelperEntity = world.createEntity();\n        // const positionHelper = world.createRenderable(positionHelperEntity);\n        // positionHelper\n        //   .getTransformComponent()\n        //   .translate([0, 0, 1]);\n        // positionHelper.attach(latHelper);\n\n        var lonFudge = Math.PI * 0.5;\n        var latFudge = Math.PI * -0.135;\n        data.forEach(function (row, latNdx) {\n          row.forEach(function (value, lonNdx) {\n            if (value === undefined || latNdx > 20 || lonNdx > 20) {\n              return;\n            }\n\n            var amount = (value - min) / range;\n            var boxMaterial = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n              color: [1, 0, 0, 1]\n            }); // const material = new THREE.MeshBasicMaterial();\n            // const hue = THREE.MathUtils.lerp(0.7, 0.3, amount);\n            // const saturation = 1;\n            // const lightness = THREE.MathUtils.lerp(0.4, 1.0, amount);\n            // material.color.setHSL(hue, saturation, lightness);\n\n            var boxEntity = world.createEntity();\n            var box = world.createRenderable(boxEntity).setGeometry(boxGeometry).setMaterial(boxMaterial); // box.attach(positionHelper);\n\n            box.getTransformComponent().localScale = [1, 1, 1];\n            box.getTransformComponent().scale([0.05, 0.05, 0.05]);\n            box.getTransformComponent().translate([0, 0, 1]);\n            scene.addEntity(boxEntity); // console.log(boxEntity);\n            // const mesh = new THREE.Mesh(geometry, material);\n            // scene.add(mesh);\n            // adjust the helpers to point to the latitude and longitude\n            // lonHelper.rotation.y = THREE.MathUtils.degToRad(lonNdx + file.xllcorner) + lonFudge;\n            // latHelper.rotation.x = THREE.MathUtils.degToRad(latNdx + file.yllcorner) + latFudge;\n            // use the world matrix of the position helper to\n            // position this mesh.\n            // positionHelper.updateWorldMatrix(true, false);\n            // mesh.applyMatrix4(positionHelper.matrixWorld);\n            // mesh.scale.set(0.005, 0.005, THREE.MathUtils.lerp(0.01, 0.5, amount));\n          });\n        });\n        render();\n      };\n\n      load(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var sphereFolder = gui.addFolder('sphere');\n      var sphereConfig = {\n        scale: 1,\n        radius: 0.5,\n        color: [255, 255, 255]\n      };\n      sphereFolder.add(sphereConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setScaleLocal(_glMatrix.vec3.fromValues(size, size, size));\n      });\n      sphereFolder.addColor(sphereConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: _glMatrix.vec4.fromValues(color[0] / 255, color[1] / 255, color[2] / 255, 1)\n        });\n      });\n      sphereFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(SphereGeometry, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/geometry/demo/sphere.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/geometry/demo/sphere.tsx","order":1,"filename":"sphere.tsx","title":"Sphere","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*jQpbRrS6en0AAAAAAAAAAAAAARQnAQ","source":"import { Geometry, Material, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport { quat } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nfunction SphereGeometry() {\n  let frameId;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    const camera = world\n      .createCamera()\n      .setPosition(0, 0, 2)\n      .setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene)\n      .setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height,\n      });\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    // create geometry, material and attach them to mesh\n    const sphereGeometry = world.createGeometry(Geometry.SPHERE, {\n      radius: 0.5,\n    });\n\n    // create a texture by url\n    const texture = world.createTexture2D({\n      url: 'https://threejs.org/examples/textures/crate.gif',\n    });\n    const material = world\n      .createMaterial(Material.BASIC, {\n        map: texture,\n      })\n      .setUniform({\n        color: [1, 1, 1, 1],\n      });\n\n    const sphere = world\n      .createRenderable()\n      .setGeometry(sphereGeometry)\n      .setMaterial(material);\n    scene.addRenderable(sphere);\n\n    const transformComponent = sphere.getTransformComponent();\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      transformComponent.rotate(quat.fromEuler(quat.create(), 0, 1, 0));\n      if (stats) {\n        stats.update();\n      }\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const sphereFolder = gui.addFolder('sphere');\n    const sphereConfig = {\n      scale: 1,\n      radius: 0.5,\n      color: [255, 255, 255],\n    };\n    sphereFolder.add(sphereConfig, 'scale', 0.1, 5.0).onChange((size) => {\n      transformComponent.setLocalScale([size, size, size]);\n    });\n    sphereFolder.addColor(sphereConfig, 'color').onChange((color) => {\n      material.setUniform({\n        color: [color[0] / 255, color[1] / 255, color[2] / 255, 1],\n      });\n    });\n    sphereFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n}\n\nReactDOM.render(<SphereGeometry />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"gl-matrix\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"gl-matrix\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.glMatrix, global.react, global.reactDom, global.stats);\n    global.sphere = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _glMatrix, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function SphereGeometry() {\n    var frameId;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      var camera = world.createCamera().setPosition(0, 0, 2).setPerspective(0.1, 5, 75, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene).setViewport({\n        x: 0,\n        y: 0,\n        width: canvas.width,\n        height: canvas.height\n      });\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view); // create geometry, material and attach them to mesh\n\n      var sphereGeometry = world.createGeometry(_gWebgpu.Geometry.SPHERE, {\n        radius: 0.5\n      }); // create a texture by url\n\n      var texture = world.createTexture2D({\n        url: 'https://threejs.org/examples/textures/crate.gif'\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC, {\n        map: texture\n      }).setUniform({\n        color: [1, 1, 1, 1]\n      });\n      var sphere = world.createRenderable().setGeometry(sphereGeometry).setMaterial(material);\n      scene.addRenderable(sphere);\n      var transformComponent = sphere.getTransformComponent();\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        transformComponent.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(), 0, 1, 0));\n\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var sphereFolder = gui.addFolder('sphere');\n      var sphereConfig = {\n        scale: 1,\n        radius: 0.5,\n        color: [255, 255, 255]\n      };\n      sphereFolder.add(sphereConfig, 'scale', 0.1, 5.0).onChange(function (size) {\n        transformComponent.setLocalScale([size, size, size]);\n      });\n      sphereFolder.addColor(sphereConfig, 'color').onChange(function (color) {\n        material.setUniform({\n          color: [color[0] / 255, color[1] / 255, color[2] / 255, 1]\n        });\n      });\n      sphereFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  }\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(SphereGeometry, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/camera/demo/landmark.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/camera/demo/landmark.tsx","order":0,"filename":"landmark.tsx","title":"Switch to landmarks of a camera","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*nIKoSa3zNBMAAAAAAAAAAAAAARQnAQ","source":"import { Material, Geometry, Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport { Button } from 'antd';\nimport { vec3, vec4 } from 'gl-matrix';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function Landmark() {\n  let frameId: number;\n  let camera;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    camera = world\n      .createCamera()\n      .setPosition(0, 5, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n    camera.createLandmark('mark1', {\n      position: [0, 5, 5],\n      focalPoint: [0, 0, 0],\n    });\n    camera.createLandmark('mark2', {\n      position: [10, 0, 10],\n      focalPoint: [5, 0, 0],\n    });\n    camera.createLandmark('mark3', {\n      position: [3, 2, 5],\n      focalPoint: [0, 0, 0],\n      roll: 30,\n    });\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    scene.addRenderable(box);\n\n    const grid = world.createRenderable(Renderable.GRID);\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  const gotoLandmark = (mark: string) => {\n    camera.gotoLandmark(mark, 2000);\n  };\n\n  return (\n    <>\n      <div style={{ textAlign: 'right' }}>\n        <Button size=\"small\" onClick={() => gotoLandmark('mark1')}>\n          Go to landmark1\n        </Button>\n        <Button size=\"small\" onClick={() => gotoLandmark('mark2')}>\n          Go to landmark2\n        </Button>\n        <Button size=\"small\" onClick={() => gotoLandmark('mark3')}>\n          Go to landmark3\n        </Button>\n      </div>\n      <canvas\n        id=\"application\"\n        style={{\n          width: 600,\n          height: 600,\n          display: 'block',\n        }}\n      />\n    </>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"antd\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"antd\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.antd, global.react, global.reactDom, global.stats);\n    global.landmark = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _antd, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function Landmark() {\n    var frameId;\n    var camera;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      camera = world.createCamera().setPosition(0, 5, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      camera.createLandmark('mark1', {\n        position: [0, 5, 5],\n        focalPoint: [0, 0, 0]\n      });\n      camera.createLandmark('mark2', {\n        position: [10, 0, 10],\n        focalPoint: [5, 0, 0]\n      });\n      camera.createLandmark('mark3', {\n        position: [3, 2, 5],\n        focalPoint: [0, 0, 0],\n        roll: 30\n      });\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      scene.addRenderable(box);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID);\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n\n    var gotoLandmark = function gotoLandmark(mark) {\n      camera.gotoLandmark(mark, 2000);\n    };\n\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        textAlign: 'right'\n      }\n    }, /*#__PURE__*/_react.default.createElement(_antd.Button, {\n      size: \"small\",\n      onClick: function onClick() {\n        return gotoLandmark('mark1');\n      }\n    }, \"Go to landmark1\"), /*#__PURE__*/_react.default.createElement(_antd.Button, {\n      size: \"small\",\n      onClick: function onClick() {\n        return gotoLandmark('mark2');\n      }\n    }, \"Go to landmark2\"), /*#__PURE__*/_react.default.createElement(_antd.Button, {\n      size: \"small\",\n      onClick: function onClick() {\n        return gotoLandmark('mark3');\n      }\n    }, \"Go to landmark3\")), /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    }));\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/camera/demo/perspective.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/camera/demo/perspective.tsx","order":2,"filename":"perspective.tsx","title":"Camera with perspective projection","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*5aAORoqcdI0AAAAAAAAAAAAAARQnAQ","source":"import { Material, Geometry, Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function Perspective() {\n  let frameId: number;\n  let camera;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    camera = world\n      .createCamera()\n      .setPosition(0, 0, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    const grid = world.createRenderable(Renderable.GRID);\n    scene.addRenderable(box);\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('perspective projection');\n    const cubeConfig = {\n      near: 0.1,\n      far: 1000,\n      fov: 72,\n    };\n    cubeFolder.add(cubeConfig, 'near', 0, 10).onChange((near) => {\n      camera.setPerspective(\n        near,\n        cubeConfig.far,\n        cubeConfig.fov,\n        canvas.width / canvas.height,\n      );\n    });\n    cubeFolder.add(cubeConfig, 'far', 10, 1000).onChange((far) => {\n      camera.setPerspective(\n        cubeConfig.near,\n        far,\n        cubeConfig.fov,\n        canvas.width / canvas.height,\n      );\n    });\n    cubeFolder.add(cubeConfig, 'fov', 0, 180).onChange((fov) => {\n      camera.setPerspective(\n        cubeConfig.near,\n        cubeConfig.far,\n        fov,\n        canvas.width / canvas.height,\n      );\n    });\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.perspective = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function Perspective() {\n    var frameId;\n    var camera;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      camera = world.createCamera().setPosition(0, 0, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID);\n      scene.addRenderable(box);\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('perspective projection');\n      var cubeConfig = {\n        near: 0.1,\n        far: 1000,\n        fov: 72\n      };\n      cubeFolder.add(cubeConfig, 'near', 0, 10).onChange(function (near) {\n        camera.setPerspective(near, cubeConfig.far, cubeConfig.fov, canvas.width / canvas.height);\n      });\n      cubeFolder.add(cubeConfig, 'far', 10, 1000).onChange(function (far) {\n        camera.setPerspective(cubeConfig.near, far, cubeConfig.fov, canvas.width / canvas.height);\n      });\n      cubeFolder.add(cubeConfig, 'fov', 0, 180).onChange(function (fov) {\n        camera.setPerspective(cubeConfig.near, cubeConfig.far, fov, canvas.width / canvas.height);\n      });\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/camera/demo/tracking.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/camera/demo/tracking.tsx","order":3,"filename":"tracking.tsx","title":"Tracking","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*RApkT63FesAAAAAAAAAAAAAAARQnAQ","source":"import { Material, Geometry, Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function TrackingMode() {\n  let frameId: number;\n  let camera;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    camera = world\n      .createCamera()\n      .setType('TRACKING')\n      .setPosition(0, 0, 5)\n      .setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    const grid = world.createRenderable(Renderable.GRID);\n    scene.addRenderable(box);\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      if (resizeRendererToDisplaySize()) {\n        camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n      }\n\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.react, global.reactDom, global.stats);\n    global.tracking = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function TrackingMode() {\n    var frameId;\n    var camera;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      camera = world.createCamera().setType('TRACKING').setPosition(0, 0, 5).setPerspective(0.1, 1000, 72, canvas.width / canvas.height);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID);\n      scene.addRenderable(box);\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        if (resizeRendererToDisplaySize()) {\n          camera.setAspect(canvas.clientWidth / canvas.clientHeight);\n        }\n\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"rendering/camera/demo/ortho.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/rendering/camera/demo/ortho.tsx","order":1,"filename":"ortho.tsx","title":"Camera with orthographic projection","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*QQghSadPJnkAAAAAAAAAAAAAARQnAQ","source":"import { Material, Geometry, Renderable, World } from '@antv/g-webgpu';\nimport { Tracker } from '@antv/g-webgpu-interactor';\nimport * as dat from 'dat.gui';\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport Stats from 'stats.js';\n\nconst App = function Orthographic() {\n  let frameId: number;\n  let camera;\n  useEffect(() => {\n    const stats = new Stats();\n    stats.showPanel(0);\n    const $stats = stats.dom;\n    $stats.style.position = 'absolute';\n    $stats.style.left = '0px';\n    $stats.style.top = '0px';\n    const $wrapper = document.getElementById('wrapper');\n    $wrapper.appendChild($stats);\n\n    const canvas = document.getElementById('application') as HTMLCanvasElement;\n\n    const world = World.create({\n      canvas,\n    });\n\n    const renderer = world.createRenderer();\n    const scene = world.createScene();\n\n    camera = world\n      .createCamera()\n      .setPosition(0, 0, 5)\n      .setOrthographic(-4, 4, -4, 4, 1, 600);\n\n    const view = world\n      .createView()\n      .setCamera(camera)\n      .setScene(scene);\n    const tracker = Tracker.create(world);\n    tracker.attachControl(view);\n\n    const boxGeometry = world.createGeometry(Geometry.BOX, {\n      halfExtents: [1, 1, 1],\n    });\n    const material = world.createMaterial(Material.BASIC).setUniform({\n      color: [1, 0, 0, 1],\n    });\n\n    const box = world\n      .createRenderable()\n      .setGeometry(boxGeometry)\n      .setMaterial(material);\n    const grid = world.createRenderable(Renderable.GRID);\n    scene.addRenderable(box);\n    scene.addRenderable(grid);\n\n    const resizeRendererToDisplaySize = () => {\n      const dpr = window.devicePixelRatio;\n      const width = canvas.clientWidth * dpr;\n      const height = canvas.clientHeight * dpr;\n      const needResize = canvas.width !== width || canvas.height !== height;\n      if (needResize) {\n        view.setViewport({\n          x: 0,\n          y: 0,\n          width,\n          height,\n        });\n        canvas.width = width;\n        canvas.height = height;\n      }\n      return needResize;\n    };\n\n    const render = () => {\n      if (stats) {\n        stats.update();\n      }\n\n      resizeRendererToDisplaySize();\n\n      renderer.render(view);\n      frameId = window.requestAnimationFrame(render);\n    };\n\n    render();\n\n    // GUI\n    const gui = new dat.GUI({ autoPlace: false });\n    $wrapper.appendChild(gui.domElement);\n    const cubeFolder = gui.addFolder('orthographic projection');\n    const cubeConfig = {\n      left: 4,\n      top: 4,\n    };\n    cubeFolder.add(cubeConfig, 'left', 1, 10).onChange((left) => {\n      camera.setOrthographic(\n        -left,\n        left,\n        -cubeConfig.top,\n        cubeConfig.top,\n        1,\n        600,\n      );\n    });\n    cubeFolder.add(cubeConfig, 'top', 1, 10).onChange((top) => {\n      camera.setOrthographic(\n        -cubeConfig.left,\n        cubeConfig.left,\n        -top,\n        top,\n        1,\n        600,\n      );\n    });\n    cubeFolder.open();\n\n    window.gwebgpuClean = () => {\n      window.cancelAnimationFrame(frameId);\n      world.destroy();\n    };\n\n    return () => {\n      window.gwebgpuClean();\n    };\n  });\n\n  return (\n    <canvas\n      id=\"application\"\n      style={{\n        width: 600,\n        height: 600,\n        display: 'block',\n      }}\n    />\n  );\n};\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-interactor\", \"dat.gui\", \"react\", \"react-dom\", \"stats.js\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-interactor\"), require(\"dat.gui\"), require(\"react\"), require(\"react-dom\"), require(\"stats.js\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuInteractor, global.dat, global.react, global.reactDom, global.stats);\n    global.ortho = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuInteractor, dat, _react, _reactDom, _stats) {\n  \"use strict\";\n\n  dat = _interopRequireWildcard(dat);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n  _stats = _interopRequireDefault(_stats);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var App = function Orthographic() {\n    var frameId;\n    var camera;\n    (0, _react.useEffect)(function () {\n      var stats = new _stats.default();\n      stats.showPanel(0);\n      var $stats = stats.dom;\n      $stats.style.position = 'absolute';\n      $stats.style.left = '0px';\n      $stats.style.top = '0px';\n      var $wrapper = document.getElementById('wrapper');\n      $wrapper.appendChild($stats);\n      var canvas = document.getElementById('application');\n\n      var world = _gWebgpu.World.create({\n        canvas: canvas\n      });\n\n      var renderer = world.createRenderer();\n      var scene = world.createScene();\n      camera = world.createCamera().setPosition(0, 0, 5).setOrthographic(-4, 4, -4, 4, 1, 600);\n      var view = world.createView().setCamera(camera).setScene(scene);\n\n      var tracker = _gWebgpuInteractor.Tracker.create(world);\n\n      tracker.attachControl(view);\n      var boxGeometry = world.createGeometry(_gWebgpu.Geometry.BOX, {\n        halfExtents: [1, 1, 1]\n      });\n      var material = world.createMaterial(_gWebgpu.Material.BASIC).setUniform({\n        color: [1, 0, 0, 1]\n      });\n      var box = world.createRenderable().setGeometry(boxGeometry).setMaterial(material);\n      var grid = world.createRenderable(_gWebgpu.Renderable.GRID);\n      scene.addRenderable(box);\n      scene.addRenderable(grid);\n\n      var resizeRendererToDisplaySize = function resizeRendererToDisplaySize() {\n        var dpr = window.devicePixelRatio;\n        var width = canvas.clientWidth * dpr;\n        var height = canvas.clientHeight * dpr;\n        var needResize = canvas.width !== width || canvas.height !== height;\n\n        if (needResize) {\n          view.setViewport({\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          });\n          canvas.width = width;\n          canvas.height = height;\n        }\n\n        return needResize;\n      };\n\n      var render = function render() {\n        if (stats) {\n          stats.update();\n        }\n\n        resizeRendererToDisplaySize();\n        renderer.render(view);\n        frameId = window.requestAnimationFrame(render);\n      };\n\n      render(); // GUI\n\n      var gui = new dat.GUI({\n        autoPlace: false\n      });\n      $wrapper.appendChild(gui.domElement);\n      var cubeFolder = gui.addFolder('orthographic projection');\n      var cubeConfig = {\n        left: 4,\n        top: 4\n      };\n      cubeFolder.add(cubeConfig, 'left', 1, 10).onChange(function (left) {\n        camera.setOrthographic(-left, left, -cubeConfig.top, cubeConfig.top, 1, 600);\n      });\n      cubeFolder.add(cubeConfig, 'top', 1, 10).onChange(function (top) {\n        camera.setOrthographic(-cubeConfig.left, cubeConfig.left, -top, top, 1, 600);\n      });\n      cubeFolder.open();\n\n      window.gwebgpuClean = function () {\n        window.cancelAnimationFrame(frameId);\n        world.destroy();\n      };\n\n      return function () {\n        window.gwebgpuClean();\n      };\n    });\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      style: {\n        width: 600,\n        height: 600,\n        display: 'block'\n      }\n    });\n  };\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/graph/sssp/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/graph/sssp/demo/index.tsx","order":0,"filename":"index.tsx","title":"Bellman-Ford","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*U_ynS4APYr8AAAAAAAAAAAAAARQnAQ","source":"import { Canvas } from '@antv/g-canvas';\nimport { Kernel, World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport G6 from '@antv/g6';\nimport { Select, Table } from 'antd';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\nconst MAX_EDGE_PER_VERTEX;\nconst VERTEX_COUNT;\nconst MAX_DISTANCE;\n\n@numthreads(16, 1, 1)\nclass BellmanFord {\n  @in @out\n  gData: vec4[];\n\n  @shared(16)\n  sData: vec4[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    if (i >= VERTEX_COUNT) {\n      return;\n    }\n\n    this.sData[tid] = this.gData[i];\n    barrier();\n\n    const currentNode = this.sData[tid];\n\n    const arr_offset = floor(currentNode[2]);\n    const length = floor(currentNode[3]);\n    const node_buffer: vec4;\n    for (let p: int = 0; p < MAX_EDGE_PER_VERTEX; p++) {\n      if (p >= length) break;\n      const arr_idx = arr_offset + p * 2;\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\n      if (p == 0 || buf_offset == 0) {\n        node_buffer = this.gData[int(arr_idx / 4)];\n      }\n      const float_j = buf_offset == 0 ? node_buffer[0] : node_buffer[2];\n      const w = buf_offset == 0 ? node_buffer[1] : node_buffer[3];\n\n      const du = this.sData[tid].x;\n      const dv = this.sData[int(float_j)].x;\n      let newDist = du + w;\n\n      if (newDist < dv) {\n        this.sData[int(float_j)].x = newDist;\n        this.sData[int(float_j)].y = tid;\n        barrier();\n      }\n    }\n\n    this.gData[i].xy = this.sData[tid].xy;\n  }\n}\n`;\n\nconst data = {\n  nodes: [\n    {\n      id: 'A',\n      label: 'A',\n    },\n    {\n      id: 'B',\n      label: 'B',\n    },\n    {\n      id: 'C',\n      label: 'C',\n    },\n    {\n      id: 'D',\n      label: 'D',\n    },\n    {\n      id: 'E',\n      label: 'E',\n    },\n  ],\n  edges: [\n    {\n      source: 'A',\n      target: 'B',\n      value: 9,\n    },\n    {\n      source: 'A',\n      target: 'C',\n      value: 4,\n    },\n    {\n      source: 'B',\n      target: 'C',\n      value: 10,\n    },\n    {\n      source: 'B',\n      target: 'D',\n      value: 2,\n    },\n    {\n      source: 'B',\n      target: 'E',\n      value: 3,\n    },\n    {\n      source: 'C',\n      target: 'D',\n      value: 2,\n    },\n    {\n      source: 'C',\n      target: 'E',\n      value: 11,\n    },\n    {\n      source: 'D',\n      target: 'B',\n      value: 2,\n    },\n    {\n      source: 'E',\n      target: 'D',\n      value: 2,\n    },\n  ],\n};\n\nlet kernel: Kernel;\nconst MAX_DISTANCE = 10000;\n\nconst App = React.memo(function BellmanFord() {\n  const [timeElapsed, setTimeElapsed] = useState(0);\n  const [datasource, setDatasource] = useState<\n    Array<{\n      destination: string;\n      weight: number;\n      prevPoint: string;\n    }>\n  >([]);\n\n  const renderFruchterman = () => {\n    const graph = new G6.Graph({\n      container: 'container',\n      width: 300,\n      height: 300,\n      modes: {\n        default: ['drag-canvas', 'drag-node'],\n      },\n      layout: {\n        type: 'fruchterman',\n        gravity: 5,\n        speed: 5,\n      },\n      animate: true,\n      defaultNode: {\n        size: 30,\n        style: {\n          lineWidth: 2,\n          stroke: '#5B8FF9',\n          fill: '#C6E5FF',\n        },\n      },\n      defaultEdge: {\n        size: 1,\n        color: '#e2e2e2',\n        style: {\n          endArrow: {\n            path: 'M 0,0 L 8,4 L 8,-4 Z',\n            fill: '#e2e2e2',\n          },\n        },\n      },\n    });\n    graph.data(data);\n    graph.render();\n  };\n\n  const buildAdjacencyList = (\n    nodes: Array<{\n      id: string;\n      label: string;\n    }>,\n    edges: Array<{\n      source: string;\n      target: string;\n      value: number;\n    }>,\n    sourceNodeIdx: number,\n  ) => {\n    const adjacencyList = [];\n    const nodeDict = [];\n    const mapIdPos = {};\n    let i = 0;\n    for (i = 0; i < nodes.length; i++) {\n      const n = nodes[i];\n      mapIdPos[n.id] = i;\n      if (i === sourceNodeIdx) {\n        adjacencyList.push(0); // distance\n      } else {\n        adjacencyList.push(MAX_DISTANCE); // Infinity\n      }\n      adjacencyList.push(-1); // predecessor\n      adjacencyList.push(0); // offset\n      adjacencyList.push(0); // outputing edge length\n      nodeDict.push([]);\n    }\n    for (i = 0; i < edges.length; i++) {\n      const e = edges[i];\n      nodeDict[mapIdPos[e.source]].push({\n        target: mapIdPos[e.target],\n        weight: e.value,\n      });\n    }\n\n    let maxEdgePerVertex = 0;\n    for (i = 0; i < nodes.length; i++) {\n      const offset = adjacencyList.length;\n      const dests = nodeDict[i];\n      adjacencyList[i * 4 + 2] = offset;\n      adjacencyList[i * 4 + 3] = dests.length;\n      maxEdgePerVertex = Math.max(maxEdgePerVertex, dests.length);\n      for (const dest of dests) {\n        const { target, weight } = dest;\n        adjacencyList.push(target); // dest vertex index\n        adjacencyList.push(weight); // edge weight\n      }\n    }\n\n    while (adjacencyList.length % 4 !== 0) {\n      adjacencyList.push(0);\n    }\n    return [new Float32Array(adjacencyList), maxEdgePerVertex];\n  };\n\n  const calcShortestPath = async (source: string) => {\n    const [adjacencyList, maxEdgePerVertex] = buildAdjacencyList(\n      data.nodes,\n      data.edges,\n      data.nodes.findIndex((n) => n.id === source),\n    );\n    const vertexNum = data.nodes.length;\n\n    if (kernel) {\n      const timeStart = window.performance.now();\n      kernel.setBinding({\n        gData: adjacencyList,\n        MAX_EDGE_PER_VERTEX: maxEdgePerVertex,\n        VERTEX_COUNT: data.nodes.length,\n        MAX_DISTANCE,\n      });\n\n      // relax all edges |V|-1 times\n      await kernel.execute(vertexNum - 1);\n\n      const output = await kernel.getOutput();\n      setTimeElapsed(window.performance.now() - timeStart);\n\n      setDatasource(\n        new Array(data.nodes.length).fill(0).map((_, i) => {\n          const prevPoint = data.nodes[output[i * 4 + 1]];\n          const weight = output[i * 4];\n\n          return {\n            destination: data.nodes[i].id,\n            weight: weight === MAX_DISTANCE ? 'MAX' : weight,\n            prevPoint: (prevPoint && prevPoint.id) || '-',\n          };\n        }),\n      );\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      renderFruchterman();\n\n      // compile our kernel code\n      const compiler = new Compiler();\n      const precompiledBundle = compiler.compileBundle(gCode);\n\n      // create world\n      const world = World.create({\n        engineOptions: {\n          supportCompute: true,\n        },\n      });\n\n      const vertexNum = data.nodes.length;\n\n      kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([Math.ceil(vertexNum / 16), 1, 1]);\n\n      await calcShortestPath('A');\n    })();\n  }, []);\n\n  return (\n    <>\n      <div id=\"container\" />\n      <div>Elapsed time: {Math.round(timeElapsed)} ms</div>\n      <div>\n        Shortest path from\n        <Select\n          defaultValue=\"A\"\n          options={data.nodes.map((node) => ({\n            value: node.id,\n            label: node.label,\n          }))}\n          onChange={calcShortestPath}\n        />\n      </div>\n      <Table\n        rowKey=\"destination\"\n        columns={[\n          {\n            dataIndex: 'destination',\n            title: 'destination',\n          },\n          {\n            dataIndex: 'weight',\n            title: 'weight',\n          },\n          {\n            dataIndex: 'prevPoint',\n            title: 'previous point',\n          },\n        ]}\n        dataSource={datasource}\n        pagination={false}\n      />\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"@antv/g6\", \"antd\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"@antv/g6\"), require(\"antd\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.g6, global.antd, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _g, _antd, _react, _reactDom) {\n  \"use strict\";\n\n  _g = _interopRequireDefault(_g);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\nconst MAX_EDGE_PER_VERTEX;\\nconst VERTEX_COUNT;\\nconst MAX_DISTANCE;\\n\\n@numthreads(16, 1, 1)\\nclass BellmanFord {\\n  @in @out\\n  gData: vec4[];\\n\\n  @shared(16)\\n  sData: vec4[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    if (i >= VERTEX_COUNT) {\\n      return;\\n    }\\n\\n    this.sData[tid] = this.gData[i];\\n    barrier();\\n\\n    const currentNode = this.sData[tid];\\n\\n    const arr_offset = floor(currentNode[2]);\\n    const length = floor(currentNode[3]);\\n    const node_buffer: vec4;\\n    for (let p: int = 0; p < MAX_EDGE_PER_VERTEX; p++) {\\n      if (p >= length) break;\\n      const arr_idx = arr_offset + p * 2;\\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\\n      if (p == 0 || buf_offset == 0) {\\n        node_buffer = this.gData[int(arr_idx / 4)];\\n      }\\n      const float_j = buf_offset == 0 ? node_buffer[0] : node_buffer[2];\\n      const w = buf_offset == 0 ? node_buffer[1] : node_buffer[3];\\n\\n      const du = this.sData[tid].x;\\n      const dv = this.sData[int(float_j)].x;\\n      let newDist = du + w;\\n\\n      if (newDist < dv) {\\n        this.sData[int(float_j)].x = newDist;\\n        this.sData[int(float_j)].y = tid;\\n        barrier();\\n      }\\n    }\\n\\n    this.gData[i].xy = this.sData[tid].xy;\\n  }\\n}\\n\";\n  var data = {\n    nodes: [{\n      id: 'A',\n      label: 'A'\n    }, {\n      id: 'B',\n      label: 'B'\n    }, {\n      id: 'C',\n      label: 'C'\n    }, {\n      id: 'D',\n      label: 'D'\n    }, {\n      id: 'E',\n      label: 'E'\n    }],\n    edges: [{\n      source: 'A',\n      target: 'B',\n      value: 9\n    }, {\n      source: 'A',\n      target: 'C',\n      value: 4\n    }, {\n      source: 'B',\n      target: 'C',\n      value: 10\n    }, {\n      source: 'B',\n      target: 'D',\n      value: 2\n    }, {\n      source: 'B',\n      target: 'E',\n      value: 3\n    }, {\n      source: 'C',\n      target: 'D',\n      value: 2\n    }, {\n      source: 'C',\n      target: 'E',\n      value: 11\n    }, {\n      source: 'D',\n      target: 'B',\n      value: 2\n    }, {\n      source: 'E',\n      target: 'D',\n      value: 2\n    }]\n  };\n  var kernel;\n  var MAX_DISTANCE = 10000;\n\n  var App = /*#__PURE__*/_react.default.memo(function BellmanFord() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeElapsed = _useState2[0],\n        setTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        datasource = _useState4[0],\n        setDatasource = _useState4[1];\n\n    var renderFruchterman = function renderFruchterman() {\n      var graph = new _g.default.Graph({\n        container: 'container',\n        width: 300,\n        height: 300,\n        modes: {\n          default: ['drag-canvas', 'drag-node']\n        },\n        layout: {\n          type: 'fruchterman',\n          gravity: 5,\n          speed: 5\n        },\n        animate: true,\n        defaultNode: {\n          size: 30,\n          style: {\n            lineWidth: 2,\n            stroke: '#5B8FF9',\n            fill: '#C6E5FF'\n          }\n        },\n        defaultEdge: {\n          size: 1,\n          color: '#e2e2e2',\n          style: {\n            endArrow: {\n              path: 'M 0,0 L 8,4 L 8,-4 Z',\n              fill: '#e2e2e2'\n            }\n          }\n        }\n      });\n      graph.data(data);\n      graph.render();\n    };\n\n    var buildAdjacencyList = function buildAdjacencyList(nodes, edges, sourceNodeIdx) {\n      var adjacencyList = [];\n      var nodeDict = [];\n      var mapIdPos = {};\n      var i = 0;\n\n      for (i = 0; i < nodes.length; i++) {\n        var n = nodes[i];\n        mapIdPos[n.id] = i;\n\n        if (i === sourceNodeIdx) {\n          adjacencyList.push(0); // distance\n        } else {\n          adjacencyList.push(MAX_DISTANCE); // Infinity\n        }\n\n        adjacencyList.push(-1); // predecessor\n\n        adjacencyList.push(0); // offset\n\n        adjacencyList.push(0); // outputing edge length\n\n        nodeDict.push([]);\n      }\n\n      for (i = 0; i < edges.length; i++) {\n        var e = edges[i];\n        nodeDict[mapIdPos[e.source]].push({\n          target: mapIdPos[e.target],\n          weight: e.value\n        });\n      }\n\n      var maxEdgePerVertex = 0;\n\n      for (i = 0; i < nodes.length; i++) {\n        var offset = adjacencyList.length;\n        var dests = nodeDict[i];\n        adjacencyList[i * 4 + 2] = offset;\n        adjacencyList[i * 4 + 3] = dests.length;\n        maxEdgePerVertex = Math.max(maxEdgePerVertex, dests.length);\n\n        var _iterator = _createForOfIteratorHelper(dests),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var dest = _step.value;\n            var target = dest.target,\n                weight = dest.weight;\n            adjacencyList.push(target); // dest vertex index\n\n            adjacencyList.push(weight); // edge weight\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      }\n\n      while (adjacencyList.length % 4 !== 0) {\n        adjacencyList.push(0);\n      }\n\n      return [new Float32Array(adjacencyList), maxEdgePerVertex];\n    };\n\n    var calcShortestPath = async function calcShortestPath(source) {\n      var _buildAdjacencyList = buildAdjacencyList(data.nodes, data.edges, data.nodes.findIndex(function (n) {\n        return n.id === source;\n      })),\n          _buildAdjacencyList2 = _slicedToArray(_buildAdjacencyList, 2),\n          adjacencyList = _buildAdjacencyList2[0],\n          maxEdgePerVertex = _buildAdjacencyList2[1];\n\n      var vertexNum = data.nodes.length;\n\n      if (kernel) {\n        var timeStart = window.performance.now();\n        kernel.setBinding({\n          gData: adjacencyList,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVertex,\n          VERTEX_COUNT: data.nodes.length,\n          MAX_DISTANCE: MAX_DISTANCE\n        }); // relax all edges |V|-1 times\n\n        await kernel.execute(vertexNum - 1);\n        var output = await kernel.getOutput();\n        setTimeElapsed(window.performance.now() - timeStart);\n        setDatasource(new Array(data.nodes.length).fill(0).map(function (_, i) {\n          var prevPoint = data.nodes[output[i * 4 + 1]];\n          var weight = output[i * 4];\n          return {\n            destination: data.nodes[i].id,\n            weight: weight === MAX_DISTANCE ? 'MAX' : weight,\n            prevPoint: prevPoint && prevPoint.id || '-'\n          };\n        }));\n      }\n    };\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        renderFruchterman(); // compile our kernel code\n\n        var compiler = new _gWebgpuCompiler.Compiler();\n        var precompiledBundle = compiler.compileBundle(gCode); // create world\n\n        var world = _gWebgpu.World.create({\n          engineOptions: {\n            supportCompute: true\n          }\n        });\n\n        var vertexNum = data.nodes.length;\n        kernel = world.createKernel(precompiledBundle).setDispatch([Math.ceil(vertexNum / 16), 1, 1]);\n        await calcShortestPath('A');\n      })();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      id: \"container\"\n    }), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Elapsed time: \", Math.round(timeElapsed), \" ms\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Shortest path from\", /*#__PURE__*/_react.default.createElement(_antd.Select, {\n      defaultValue: \"A\",\n      options: data.nodes.map(function (node) {\n        return {\n          value: node.id,\n          label: node.label\n        };\n      }),\n      onChange: calcShortestPath\n    })), /*#__PURE__*/_react.default.createElement(_antd.Table, {\n      rowKey: \"destination\",\n      columns: [{\n        dataIndex: 'destination',\n        title: 'destination'\n      }, {\n        dataIndex: 'weight',\n        title: 'weight'\n      }, {\n        dataIndex: 'prevPoint',\n        title: 'previous point'\n      }],\n      dataSource: datasource,\n      pagination: false\n    }));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/graph/sssp/demo/perf.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/graph/sssp/demo/perf.tsx","order":1,"filename":"perf.tsx","title":"Bellman-Ford in a large directed graph","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Canvas } from '@antv/g-canvas';\nimport { Kernel, World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport { Select, Table } from 'antd';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\nconst MAX_EDGE_PER_VERTEX;\nconst VERTEX_COUNT;\nconst MAX_DISTANCE;\n\n@numthreads(16, 1, 1)\nclass BellmanFord {\n  @in @out\n  gData: vec4[];\n\n  @shared(16)\n  sData: vec4[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    if (i >= VERTEX_COUNT) {\n      return;\n    }\n\n    this.sData[tid] = this.gData[i];\n    barrier();\n\n    const currentNode = this.sData[tid];\n\n    const arr_offset = floor(currentNode[2]);\n    const length = floor(currentNode[3]);\n    const node_buffer: vec4;\n    for (let p: int = 0; p < MAX_EDGE_PER_VERTEX; p++) {\n      if (p >= length) break;\n      const arr_idx = arr_offset + p * 2;\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\n      if (p == 0 || buf_offset == 0) {\n        node_buffer = this.gData[int(arr_idx / 4)];\n      }\n      const float_j = buf_offset == 0 ? node_buffer[0] : node_buffer[2];\n      const w = buf_offset == 0 ? node_buffer[1] : node_buffer[3];\n\n      const du = this.sData[tid].x;\n      const dv = this.sData[int(float_j)].x;\n      let newDist = du + w;\n\n      if (newDist < dv) {\n        this.sData[int(float_j)].x = newDist;\n        this.sData[int(float_j)].y = tid;\n        barrier();\n      }\n    }\n\n    this.gData[i].xy = this.sData[tid].xy;\n  }\n}\n`;\n\nconst rawData = `1 0 2.5\n3 2 0.25\n4 2 0.25\n4 3 0.25\n5 2 0.25\n5 3 0.25\n5 4 0.25\n6 2 0.25\n6 3 0.25\n6 4 0.25\n6 5 0.25\n8 7 1\n9 7 3.16667\n10 7 1.16667\n10 9 1.16667\n11 7 0.666667\n11 10 0.666667\n11 9 0.666667\n13 12 0.333333\n14 12 0.333333\n14 13 0.333333\n15 12 0.333333\n15 13 0.333333\n15 14 0.333333\n17 16 0.5\n18 16 0.5\n18 17 0.5\n21 20 0.5\n22 20 0.5\n22 21 0.5\n24 23 0.5\n25 23 0.5\n25 24 2.33333\n28 27 0.5\n29 27 0.5\n29 28 0.5\n31 30 0.5\n32 30 0.5\n32 31 0.5\n33 30 3.58333\n34 30 1.58333\n34 33 4.225\n36 35 0.2\n37 35 0.2\n37 36 0.2\n38 35 0.2\n38 36 0.2\n38 37 0.2\n39 35 0.2\n39 36 0.2\n39 37 0.2\n39 38 0.2\n40 35 0.2\n40 36 0.2\n40 37 0.2\n40 38 0.2\n40 39 0.2\n43 42 1\n45 44 0.5\n46 44 0.5\n46 45 0.5\n48 47 0.333333\n49 47 0.333333\n49 48 0.333333\n50 47 0.333333\n50 48 0.333333\n50 49 0.333333\n51 33 0.75\n52 51 0.25\n52 33 0.25\n53 51 0.25\n53 52 0.25\n53 33 1.85833\n53 34 0.775\n54 51 0.25\n54 52 0.25\n54 53 0.625\n54 33 2.99167\n54 34 1.15833\n54 30 0.25\n55 51 0.5\n56 51 0.5\n56 55 3.83333\n57 51 1\n58 51 1\n58 57 1\n60 59 0.5\n61 59 0.5\n61 60 0.5\n63 62 0.47619\n64 62 0.333333\n64 63 0.333333\n65 62 0.333333\n65 63 0.333333\n65 64 0.333333\n67 66 0.5\n68 66 0.5\n68 67 0.5\n70 69 0.833333\n71 69 2.16667\n71 70 0.833333\n72 69 0.916667\n72 70 0.333333\n72 71 0.666667\n74 73 0.333333\n75 73 0.333333\n75 74 0.333333\n76 73 0.333333\n76 74 0.333333\n76 75 0.333333\n78 77 0.333333\n78 46 1\n79 77 0.333333\n79 78 0.333333\n80 77 0.333333\n80 78 0.333333\n80 79 0.333333\n82 81 0.5\n83 81 0.5\n83 82 0.5\n85 84 0.5\n86 84 0.5\n86 85 0.5\n88 87 2.5\n90 55 1\n92 91 0.5\n93 91 0.5\n93 92 0.5\n95 94 0.5\n96 94 2.66667\n96 95 0.5\n97 94 2.33333\n97 95 0.5\n97 96 2.33333\n97 69 1.83333\n98 94 0.5\n98 95 0.5\n98 96 0.5\n98 97 0.5\n99 94 0.5\n99 96 0.5\n99 97 0.5\n100 94 0.25\n100 99 1.25\n100 96 0.25\n100 97 0.25\n103 102 0.5\n104 102 0.5\n104 103 0.5\n106 105 0.5\n107 105 0.5\n107 106 0.5\n109 108 1\n112 111 1\n114 113 1\n117 116 1\n119 118 1\n121 120 1\n121 78 1\n123 122 0.5\n124 122 0.5\n124 123 0.5\n127 126 0.7\n128 126 0.5\n128 127 0.75\n130 129 1\n131 33 1.33333\n131 30 0.333333\n131 34 0.333333\n132 33 2.275\n132 34 0.525\n132 53 1.025\n132 54 0.375\n133 33 1.025\n133 34 1.025\n133 132 0.525\n133 53 0.525\n133 54 0.125\n134 33 0.525\n134 34 0.525\n134 132 0.525\n134 133 0.525\n134 53 0.525\n134 54 0.125\n136 135 1\n138 137 1\n140 139 0.111111\n141 139 0.111111\n141 140 0.111111\n142 139 0.111111\n142 140 0.111111\n142 141 0.111111\n143 139 0.111111\n143 140 0.111111\n143 141 0.111111\n143 142 0.111111\n144 139 0.111111\n144 140 0.111111\n144 141 0.111111\n144 142 0.111111\n144 143 0.111111\n145 139 0.111111\n145 140 0.111111\n145 141 0.111111\n145 142 0.111111\n145 143 0.111111\n145 144 0.111111\n146 139 0.111111\n146 140 0.111111\n146 141 0.111111\n146 142 0.111111\n146 143 0.111111\n146 144 0.111111\n146 145 0.111111\n147 139 0.111111\n147 140 0.111111\n147 141 0.111111\n147 142 0.111111\n147 143 0.111111\n147 144 0.111111\n147 145 0.111111\n147 146 0.111111\n148 139 0.111111\n148 140 0.111111\n148 141 0.111111\n148 142 0.111111\n148 143 0.111111\n148 144 0.111111\n148 145 0.111111\n148 146 0.111111\n148 147 0.111111\n149 71 1.16667\n150 149 0.666667\n150 71 0.666667\n150 96 0.833333\n150 94 0.333333\n151 149 1.16667\n151 71 1.16667\n151 150 4.75\n151 127 0.333333\n152 149 1\n154 153 1.33333\n155 153 0.333333\n155 154 0.333333\n156 153 0.333333\n156 154 0.333333\n156 155 0.333333\n157 71 0.5\n158 71 0.5\n158 157 0.5\n161 160 1\n163 162 1\n165 164 1\n167 166 1\n170 169 0.5\n171 169 0.5\n171 170 0.5\n173 172 0.5\n174 172 1.5\n174 173 0.5\n176 175 0.5\n177 175 0.5\n177 176 0.5\n180 179 1\n181 179 1\n181 180 1\n183 182 1\n184 55 0.5\n184 56 0.5\n185 184 0.5\n186 184 0.5\n186 185 0.5\n188 187 1.5\n189 187 0.5\n189 188 0.5\n190 33 0.583333\n191 46 0.833333\n192 191 0.333333\n192 46 0.333333\n193 191 0.333333\n193 192 0.333333\n193 46 0.333333\n194 191 0.5\n194 46 0.5\n196 195 1.25\n197 195 0.25\n197 196 0.25\n198 195 0.25\n198 196 0.25\n198 197 0.25\n199 195 0.25\n199 196 0.25\n199 197 0.25\n199 198 0.25\n201 200 0.5\n201 24 0.333333\n201 25 0.333333\n202 200 0.5\n202 201 0.833333\n202 24 0.333333\n202 25 0.333333\n203 131 1\n206 205 1\n208 207 0.5\n209 207 0.5\n209 208 0.5\n211 210 0.5\n212 210 0.5\n212 211 0.5\n214 213 0.5\n215 213 0.5\n215 214 0.5\n216 48 0.333333\n216 136 0.5\n217 216 1.08333\n217 48 0.333333\n218 216 1.66667\n218 217 1.08333\n218 48 0.333333\n219 216 0.5\n219 218 0.25\n220 216 1.5\n220 219 0.5\n220 218 0.25\n221 216 0.25\n221 219 0.583333\n221 220 0.25\n222 216 0.25\n222 219 1.75\n222 220 0.25\n222 221 0.25\n223 216 0.5\n223 136 0.5\n224 216 0.583333\n224 220 0.25\n224 219 0.25\n224 218 0.583333\n225 150 2.08333\n225 96 0.333333\n225 94 0.333333\n225 151 0.75\n227 226 1\n229 228 1.33333\n230 228 0.333333\n230 229 0.333333\n231 228 0.333333\n231 229 0.333333\n231 230 0.333333\n234 233 0.5\n235 233 0.5\n235 234 0.5\n235 72 1\n238 237 1\n240 239 1\n241 239 1\n243 242 1\n245 244 3.5\n246 244 1\n247 244 1\n249 248 0.5\n250 248 0.5\n250 249 0.5\n251 217 0.25\n251 216 0.25\n251 218 0.25\n252 217 0.25\n252 216 0.5\n252 251 0.25\n252 218 0.25\n255 254 1\n256 254 0.5\n256 255 0.5\n259 258 1.33333\n261 260 1\n263 262 0.142857\n264 262 0.142857\n264 263 0.142857\n265 262 0.142857\n265 263 0.67619\n265 264 0.142857\n266 262 0.142857\n266 263 0.67619\n266 264 0.142857\n266 265 0.92619\n267 262 0.142857\n267 263 0.142857\n267 264 0.142857\n267 265 0.142857\n267 266 0.142857\n268 262 0.142857\n268 263 0.67619\n268 264 0.142857\n268 265 0.92619\n268 266 0.92619\n268 267 0.142857\n269 262 0.142857\n269 263 0.142857\n269 264 0.142857\n269 265 0.142857\n269 266 0.142857\n269 267 0.142857\n269 268 0.142857\n271 270 1\n274 273 0.5\n275 273 0.5\n275 274 0.5\n277 276 0.5\n278 276 0.5\n278 277 1\n280 279 0.166667\n281 279 0.166667\n281 280 0.166667\n281 78 1\n281 150 1.83333\n282 279 0.166667\n282 280 0.166667\n282 281 0.166667\n283 279 0.166667\n283 280 0.166667\n283 281 3.16667\n283 282 0.166667\n284 279 0.166667\n284 280 0.166667\n284 281 0.166667\n284 282 0.166667\n284 283 0.166667\n285 279 0.166667\n285 280 0.166667\n285 281 0.166667\n285 282 0.166667\n285 283 0.166667\n285 284 0.166667\n287 286 0.5\n288 286 1\n288 287 0.5\n289 286 0.5\n289 288 0.5\n291 290 0.5\n292 290 0.5\n292 291 0.5\n294 293 2.1\n297 296 1\n298 296 0.333333\n299 296 0.333333\n299 298 0.333333\n300 296 1.33333\n300 298 0.333333\n300 299 0.333333\n301 203 1.16667\n301 150 0.5\n301 151 0.5\n301 162 0.25\n302 301 1.33333\n302 203 0.833333\n303 301 0.333333\n303 203 0.333333\n303 302 0.333333\n304 301 0.5\n304 302 0.5\n305 78 0.583333\n306 305 0.25\n306 78 0.25\n307 305 0.25\n307 306 0.25\n307 78 0.25\n307 265 0.25\n307 266 0.25\n307 268 0.25\n308 305 0.583333\n308 306 0.25\n308 307 0.25\n308 78 1.58333\n309 305 0.333333\n309 78 3.33333\n309 308 2.33333\n310 97 0.5\n310 69 0.5\n312 311 1\n314 313 0.5\n315 313 0.5\n315 314 0.5\n316 203 0.333333\n316 301 0.583333\n316 162 0.25\n317 203 0.333333\n317 316 0.333333\n317 301 0.333333\n319 318 1\n321 320 0.833333\n322 320 0.333333\n322 321 0.333333\n323 320 0.666667\n323 321 0.333333\n323 322 0.333333\n324 320 0.333333\n324 323 0.333333\n325 320 0.333333\n325 323 0.333333\n325 324 0.333333\n327 326 0.333333\n327 30 0.333333\n328 326 0.333333\n328 327 1.16667\n329 326 0.333333\n329 327 0.333333\n329 328 0.333333\n330 151 0.5\n331 330 0.5\n331 151 0.5\n333 332 0.333333\n334 332 0.333333\n334 333 0.333333\n335 332 0.333333\n335 333 0.333333\n335 334 0.333333\n337 336 1\n339 338 0.333333\n340 338 0.333333\n340 339 0.333333\n341 338 0.333333\n341 339 1.33333\n341 340 0.333333\n343 342 0.5\n343 221 0.333333\n343 219 2.47619\n344 342 0.5\n344 343 0.5\n345 252 0.25\n345 216 0.583333\n346 345 0.583333\n346 252 0.25\n346 216 0.916667\n347 345 0.583333\n347 346 0.583333\n347 252 0.25\n347 216 0.583333\n349 348 0.2\n350 348 0.2\n350 349 0.2\n351 348 0.2\n351 349 0.2\n351 350 0.2\n352 348 0.2\n352 349 0.2\n352 350 0.2\n352 351 0.2\n353 348 0.2\n353 349 0.2\n353 350 0.2\n353 351 0.2\n353 352 0.2\n355 354 0.5\n356 354 0.5\n356 355 0.5\n358 357 0.833333\n359 357 0.5\n359 358 0.5\n360 357 0.333333\n360 358 0.333333\n361 357 0.333333\n361 360 0.333333\n361 358 0.333333\n362 62 0.2\n363 362 1\n364 362 0.5\n365 362 0.5\n365 364 0.5\n367 366 0.5\n368 366 0.5\n368 367 0.5\n369 24 0.5\n369 25 0.5\n370 78 0.5\n371 370 0.5\n371 78 2.5\n371 309 0.5\n373 372 0.5\n374 372 0.5\n374 373 0.5\n375 33 0.25\n376 375 1.91667\n376 33 0.25\n377 375 2.91667\n377 376 1.91667\n377 33 0.25\n378 375 0.333333\n378 376 0.333333\n378 377 0.333333\n380 379 0.5\n381 379 0.5\n381 380 0.5\n383 382 0.5\n384 382 0.5\n384 383 0.5\n386 385 0.142857\n387 385 0.142857\n387 386 0.142857\n388 385 0.142857\n388 386 0.142857\n388 387 0.142857\n389 385 0.142857\n389 386 0.142857\n389 387 0.142857\n389 388 0.142857\n390 385 0.142857\n390 386 0.142857\n390 387 0.142857\n390 388 0.142857\n390 389 0.142857\n391 385 0.142857\n391 386 0.142857\n391 387 0.142857\n391 388 0.142857\n391 389 0.142857\n391 390 0.142857\n392 385 0.142857\n392 386 0.142857\n392 387 0.142857\n392 388 0.142857\n392 389 0.142857\n392 390 0.142857\n392 391 0.142857\n394 393 0.333333\n395 393 0.333333\n395 394 0.333333\n396 393 0.333333\n396 394 0.333333\n396 395 0.333333\n398 397 0.333333\n399 397 0.333333\n399 398 0.333333\n400 397 0.333333\n400 398 0.333333\n400 399 0.333333\n401 277 0.166667\n401 278 0.166667\n402 401 0.166667\n402 277 0.166667\n402 278 0.166667\n402 327 2.16667\n402 328 0.333333\n402 30 0.333333\n403 401 0.166667\n403 402 0.166667\n403 277 0.5\n403 278 0.5\n404 401 0.166667\n404 402 0.166667\n404 277 0.166667\n404 403 0.166667\n404 278 0.166667\n405 401 0.166667\n405 402 0.166667\n405 277 0.166667\n405 403 0.166667\n405 278 0.166667\n405 404 0.166667\n406 166 1\n409 408 0.25\n410 408 0.583333\n410 409 0.25\n411 408 0.25\n411 409 0.25\n411 410 0.25\n412 408 0.583333\n412 409 0.25\n412 410 0.583333\n412 411 0.25\n413 408 0.333333\n413 410 0.333333\n413 412 0.333333\n415 414 1\n415 247 0.333333\n416 402 0.833333\n416 327 3.5\n416 328 0.333333\n417 402 1\n417 327 1\n419 418 1\n421 319 1\n423 422 0.5\n424 422 0.5\n424 423 0.5\n426 425 0.5\n427 425 0.5\n427 426 0.5\n428 46 1.33333\n429 428 1\n431 430 1\n432 430 1\n434 433 1\n435 245 1\n435 244 1\n437 436 0.5\n438 436 0.5\n438 437 0.5\n439 118 0.5\n440 439 1\n441 439 0.5\n441 118 0.5\n443 442 1\n443 72 0.5\n445 444 1\n447 446 0.333333\n448 446 0.333333\n448 447 0.333333\n449 446 0.333333\n449 447 0.333333\n449 448 0.333333\n450 282 1\n453 452 0.142857\n454 452 0.142857\n454 453 0.142857\n455 452 0.142857\n455 453 0.142857\n455 454 0.142857\n456 452 0.142857\n456 453 0.142857\n456 454 0.142857\n456 455 0.142857\n457 452 0.142857\n457 453 0.142857\n457 454 0.142857\n457 455 0.142857\n457 456 0.142857\n458 452 0.142857\n458 453 0.642857\n458 454 0.142857\n458 455 0.142857\n458 456 0.142857\n458 457 0.142857\n459 452 0.142857\n459 453 0.642857\n459 454 0.142857\n459 455 0.142857\n459 456 0.142857\n459 457 0.142857\n459 458 0.642857\n461 460 0.333333\n462 460 0.333333\n462 461 0.333333\n463 460 0.333333\n463 461 0.333333\n463 462 0.333333\n463 301 0.5\n464 33 1\n465 464 1.5\n466 464 0.5\n466 465 0.5\n468 467 0.25\n469 467 0.25\n469 468 0.25\n470 467 0.25\n470 468 0.25\n470 469 0.25\n471 467 0.25\n471 468 0.25\n471 469 0.25\n471 470 0.25\n473 472 0.833333\n473 222 0.5\n473 219 0.5\n474 472 0.5\n474 473 0.5\n476 475 1\n477 475 0.5\n478 475 0.5\n478 477 0.5\n480 479 0.333333\n481 479 0.333333\n481 480 0.333333\n482 479 0.333333\n482 480 0.333333\n482 481 0.333333\n484 483 1\n485 33 1\n487 486 1\n488 33 0.333333\n488 54 0.333333\n489 488 0.333333\n489 33 0.333333\n489 54 0.333333\n490 309 1.5\n490 78 0.5\n491 490 0.5\n491 309 0.5\n492 490 1\n493 490 0.5\n493 309 0.5\n495 494 0.5\n496 494 0.5\n496 495 0.5\n498 497 1\n499 303 1\n500 150 0.5\n501 500 1\n502 500 2.5\n502 501 1\n503 500 1.5\n503 502 0.5\n506 505 1\n507 190 0.583333\n507 33 0.583333\n508 507 1.08333\n508 190 0.583333\n508 33 0.583333\n509 507 0.75\n509 508 0.75\n509 190 0.25\n509 33 0.25\n512 511 1\n513 245 0.5\n513 244 0.5\n515 514 0.833333\n516 514 0.833333\n516 515 2.33333\n516 346 0.333333\n516 216 0.333333\n516 151 1.58333\n516 150 1.08333\n516 225 0.25\n517 514 0.333333\n517 515 0.333333\n517 516 2.91667\n517 151 2.25\n517 150 1.58333\n517 225 0.25\n517 127 0.333333\n517 152 1\n519 518 1\n521 520 1\n522 76 1\n523 522 0.25\n524 522 0.25\n524 523 0.25\n525 522 0.25\n525 523 0.25\n525 524 0.25\n526 522 0.25\n526 523 0.25\n526 524 0.25\n526 525 0.25\n527 522 2\n529 528 1\n531 530 0.533333\n532 530 0.533333\n532 531 0.533333\n533 530 0.333333\n533 531 0.333333\n533 532 0.333333\n535 534 1\n538 537 0.5\n539 537 0.833333\n539 538 0.5\n540 537 0.333333\n541 537 0.333333\n541 540 0.333333\n542 537 0.333333\n542 540 0.333333\n542 541 0.333333\n545 544 1\n547 546 1\n547 55 0.5\n547 56 0.5\n547 329 1.5\n548 121 0.333333\n549 548 0.333333\n549 121 0.333333\n550 548 0.333333\n550 549 0.333333\n550 121 1.83333\n553 552 0.5\n554 552 0.5\n554 553 0.5\n557 556 0.5\n558 556 0.5\n558 557 0.5\n560 559 1\n561 33 0.708333\n561 53 0.708333\n561 34 0.375\n561 133 0.125\n561 54 0.375\n561 132 0.125\n561 134 0.125\n562 561 0.458333\n562 33 0.458333\n562 53 0.458333\n562 34 0.125\n562 133 0.125\n562 54 0.125\n562 132 0.125\n562 134 0.125\n563 82 1\n564 563 0.333333\n565 563 0.333333\n565 564 0.333333\n566 563 0.333333\n566 564 0.333333\n566 565 0.333333\n567 189 2.33333\n569 568 1\n571 570 1\n573 572 1\n574 281 2.5\n574 283 0.5\n575 574 0.5\n575 281 0.5\n576 574 0.5\n576 281 0.5\n578 577 1\n581 580 0.5\n582 580 0.5\n582 581 0.5\n584 583 1\n585 136 0.333333\n586 585 0.333333\n586 136 0.333333\n587 585 0.333333\n587 586 0.333333\n587 136 1.83333\n590 589 0.583333\n590 307 1\n591 589 0.583333\n591 590 1.58333\n592 589 0.333333\n592 590 0.333333\n592 591 0.333333\n594 593 1\n595 277 0.333333\n595 403 0.333333\n595 278 0.333333\n596 327 0.5\n596 416 0.5\n596 46 1\n598 597 1\n600 599 1\n603 602 1\n606 275 0.333333\n607 275 0.333333\n607 606 0.333333\n608 275 0.333333\n608 606 0.333333\n608 607 0.333333\n609 45 0.833333\n610 609 0.5\n610 45 0.5\n611 609 0.333333\n611 45 0.333333\n612 609 0.333333\n612 45 0.333333\n612 611 0.333333\n615 614 1\n617 616 1\n619 618 0.5\n620 618 0.5\n620 619 0.5\n622 621 1\n624 623 1\n626 625 0.333333\n627 625 0.333333\n627 626 0.333333\n628 625 0.333333\n628 626 0.333333\n628 627 0.333333\n630 629 0.5\n631 629 0.5\n631 630 1\n631 337 0.2\n633 632 1\n636 635 0.5\n637 635 0.5\n637 636 0.5\n638 162 0.25\n638 316 0.25\n638 301 0.75\n638 463 0.5\n639 638 0.25\n639 162 0.25\n639 316 0.25\n639 301 0.25\n640 638 1\n641 78 1\n643 642 1\n646 78 2.5\n648 647 1\n650 189 0.333333\n650 567 0.333333\n651 650 0.333333\n651 189 0.333333\n651 567 0.333333\n652 34 0.25\n653 652 0.333333\n654 652 2.08333\n654 653 0.333333\n654 34 1.25\n654 55 0.333333\n654 56 0.333333\n655 652 2.08333\n655 653 0.333333\n655 654 2.08333\n655 34 0.25\n656 652 0.333333\n656 654 0.333333\n656 655 0.333333\n657 652 0.583333\n657 34 0.25\n657 654 0.916667\n657 655 0.583333\n659 658 0.333333\n660 658 0.333333\n660 659 0.333333\n661 658 0.333333\n661 659 0.333333\n661 660 0.333333\n663 662 0.75\n664 662 0.25\n664 663 0.25\n665 662 0.25\n665 663 0.25\n665 664 0.25\n666 662 0.25\n666 663 0.25\n666 664 0.25\n666 665 0.25\n668 667 1\n670 669 1\n671 669 1\n673 672 1\n674 515 0.5\n674 516 0.5\n675 443 0.5\n676 675 0.5\n676 443 0.5\n677 663 0.5\n677 662 0.5\n679 678 0.5\n680 678 0.5\n680 679 0.5\n682 681 0.333333\n683 681 0.333333\n683 682 0.333333\n684 681 0.333333\n684 682 0.333333\n684 683 0.333333\n685 57 1\n686 350 1\n689 537 0.333333\n689 539 0.333333\n690 689 0.333333\n690 537 0.333333\n690 539 0.333333\n692 342 1\n694 693 0.2\n695 693 0.2\n695 694 0.2\n696 693 0.2\n696 694 0.2\n696 695 0.2\n697 693 1.2\n697 694 0.2\n697 695 0.2\n697 696 0.2\n697 219 0.142857\n697 343 0.142857\n698 693 0.2\n698 694 0.2\n698 695 0.2\n698 696 0.2\n698 697 0.2\n699 445 1\n700 96 0.333333\n701 700 0.333333\n701 96 0.333333\n702 700 0.333333\n702 96 0.333333\n702 701 0.333333\n705 704 0.333333\n706 704 0.333333\n706 705 0.333333\n707 704 0.333333\n707 705 0.333333\n707 706 0.333333\n708 97 0.583333\n708 94 0.583333\n708 96 0.583333\n708 99 0.25\n709 97 0.333333\n709 69 0.666667\n709 71 0.333333\n709 72 0.333333\n710 97 0.333333\n710 709 0.333333\n710 69 0.333333\n711 87 0.5\n711 88 0.5\n712 642 0.5\n713 712 0.5\n713 642 0.5\n715 695 0.25\n716 695 0.25\n716 715 0.25\n717 695 0.25\n717 715 0.25\n717 716 0.25\n718 695 0.25\n718 715 0.25\n718 716 0.25\n718 717 0.25\n720 719 2\n721 670 1\n724 723 0.333333\n725 723 0.333333\n725 724 0.333333\n726 723 0.333333\n726 724 0.333333\n726 725 0.333333\n729 136 0.5\n729 587 0.5\n731 730 1\n733 732 0.5\n734 732 0.5\n734 733 0.5\n736 71 0.5\n737 736 0.5\n737 71 0.5\n738 443 0.5\n738 72 0.5\n739 443 1\n742 293 0.9\n742 294 1.9\n742 523 0.333333\n743 742 1.4\n743 293 0.9\n743 294 1.4\n744 742 1.2\n744 293 0.7\n744 743 0.7\n744 294 2.7\n745 742 1\n746 742 2.33333\n746 294 0.333333\n746 523 0.333333\n748 747 1\n751 750 1\n752 719 0.5\n753 752 0.5\n753 719 0.5\n755 754 1\n756 34 0.5\n756 78 0.5\n757 756 0.5\n757 69 0.75\n757 72 0.25\n758 756 0.5\n758 757 1.25\n758 69 0.75\n758 72 0.25\n759 756 1\n759 78 0.5\n759 371 0.5\n760 756 1.5\n760 34 0.5\n761 756 1.86667\n761 34 0.333333\n762 756 0.333333\n762 761 0.666667\n762 34 0.333333\n763 756 0.333333\n763 761 0.666667\n763 762 0.666667\n763 34 0.333333\n764 756 0.533333\n764 761 0.533333\n764 121 0.833333\n765 756 0.533333\n765 764 0.866667\n765 761 0.533333\n765 121 0.333333\n767 766 0.333333\n768 766 0.333333\n768 767 0.333333\n769 766 0.333333\n769 767 0.333333\n769 768 0.333333\n770 127 0.2\n770 126 0.2\n771 770 0.2\n771 127 0.2\n771 126 0.2\n772 770 0.2\n772 771 0.2\n772 127 0.2\n772 126 0.2\n773 770 0.2\n773 771 0.2\n773 127 0.2\n773 772 0.2\n773 126 0.2\n774 761 1.33333\n774 657 0.333333\n774 654 0.333333\n775 774 1.33333\n775 761 1.53333\n775 764 0.2\n775 756 0.2\n775 765 0.2\n776 774 0.333333\n776 761 0.333333\n776 775 0.333333\n778 777 1\n780 496 0.5\n781 780 0.5\n781 496 0.5\n783 631 1\n784 631 0.5\n784 783 0.5\n786 785 0.5\n787 785 0.5\n787 786 0.5\n788 346 0.333333\n788 216 0.333333\n788 516 0.333333\n789 597 1\n790 789 1\n790 597 1\n792 662 0.333333\n793 792 0.333333\n793 662 0.333333\n794 792 0.333333\n794 662 0.333333\n794 793 0.333333\n795 64 0.25\n796 795 0.25\n796 64 0.25\n797 795 0.25\n797 796 0.25\n797 64 0.25\n798 795 0.25\n798 796 0.25\n798 797 0.25\n798 64 0.25\n800 799 0.2\n801 799 0.2\n801 800 0.2\n802 799 0.2\n802 800 0.2\n802 801 0.2\n803 799 0.2\n803 800 0.2\n803 801 0.2\n803 802 0.2\n804 799 0.2\n804 800 0.2\n804 801 0.2\n804 802 0.2\n804 803 0.2\n805 62 0.92619\n805 362 0.2\n806 805 0.92619\n806 62 1.25952\n806 362 0.2\n807 805 0.92619\n807 806 0.92619\n807 62 0.92619\n807 362 0.2\n808 805 0.25\n808 806 0.25\n808 807 0.25\n808 62 0.25\n810 809 1\n813 812 1\n815 814 0.5\n816 814 0.5\n816 815 0.5\n818 817 1\n820 819 1\n822 821 0.333333\n823 821 0.333333\n823 822 0.333333\n824 821 0.333333\n824 822 0.333333\n824 823 0.333333\n826 825 0.111111\n827 825 0.111111\n827 826 0.111111\n828 825 0.111111\n828 826 0.111111\n828 827 0.111111\n829 825 0.111111\n829 826 0.111111\n829 827 0.111111\n829 828 0.111111\n830 825 0.111111\n830 826 0.111111\n830 827 0.111111\n830 828 0.111111\n830 829 0.111111\n831 825 0.111111\n831 826 0.111111\n831 827 0.111111\n831 828 0.111111\n831 829 0.111111\n831 830 0.111111\n832 825 0.111111\n832 826 0.111111\n832 827 0.111111\n832 828 0.111111\n832 829 0.111111\n832 830 0.111111\n832 831 0.111111\n833 825 0.111111\n833 826 0.111111\n833 827 0.111111\n833 828 0.111111\n833 829 0.111111\n833 830 0.111111\n833 831 0.111111\n833 832 0.111111\n834 825 0.111111\n834 826 0.111111\n834 827 0.111111\n834 828 0.111111\n834 829 0.111111\n834 830 0.111111\n834 831 0.111111\n834 832 0.111111\n834 833 0.111111\n836 835 0.5\n837 835 0.5\n837 836 0.5\n839 34 0.333333\n839 33 0.333333\n839 54 0.333333\n840 34 0.45\n840 30 0.25\n840 54 0.45\n840 33 0.45\n842 841 1.5\n843 841 0.5\n843 842 0.5\n845 844 0.333333\n846 844 0.333333\n846 845 0.333333\n847 844 0.333333\n847 845 0.333333\n847 846 0.333333\n849 848 1\n851 850 0.5\n852 850 0.5\n852 851 0.5\n853 646 0.5\n853 78 0.5\n856 855 0.5\n857 855 0.5\n857 856 0.5\n859 106 1\n860 294 0.2\n861 860 0.5\n862 860 0.5\n862 861 0.5\n863 654 0.5\n864 863 0.5\n864 654 0.5\n865 654 0.5\n865 34 0.5\n866 371 0.5\n867 866 0.5\n867 371 0.5\n871 870 0.25\n872 870 0.25\n872 871 0.25\n873 870 0.25\n873 871 0.25\n873 872 0.25\n874 870 0.25\n874 871 0.25\n874 872 0.25\n874 873 0.25\n878 877 0.25\n879 877 0.25\n879 878 0.25\n880 877 0.25\n880 878 0.25\n880 879 0.25\n881 877 0.25\n881 878 0.25\n881 879 0.25\n881 880 0.25\n884 883 0.5\n885 883 0.5\n885 884 0.5\n887 886 1\n889 888 0.5\n890 888 0.5\n890 889 0.5\n892 761 0.2\n892 764 0.2\n892 756 0.2\n892 765 0.2\n892 775 0.2\n893 652 0.333333\n893 654 0.666667\n893 655 0.333333\n893 55 0.333333\n893 56 0.333333\n894 402 0.333333\n894 30 0.333333\n894 327 0.333333\n896 895 0.25\n897 895 0.25\n897 896 0.25\n898 895 0.25\n898 896 0.25\n898 897 0.25\n899 895 0.25\n899 896 0.25\n899 897 0.25\n899 898 0.25\n901 900 0.5\n902 900 0.5\n902 901 0.5\n904 903 0.5\n905 903 0.5\n905 904 0.5\n907 906 1\n908 307 0.25\n908 265 0.25\n908 266 0.25\n908 268 0.25\n910 909 0.5\n911 909 0.5\n911 910 0.5\n913 912 0.2\n914 912 0.2\n914 913 0.342857\n915 912 0.2\n915 913 0.342857\n915 914 0.342857\n916 912 0.2\n916 913 0.985714\n916 914 0.342857\n916 915 0.342857\n917 912 0.2\n917 913 0.2\n917 914 0.2\n917 915 0.2\n917 916 0.2\n918 171 1\n921 920 1\n922 415 1\n924 923 0.5\n925 923 0.5\n925 924 0.5\n926 177 1\n927 243 1.25\n930 929 1\n931 742 0.7\n931 293 0.4\n931 743 0.2\n931 294 0.4\n932 931 1.9\n932 742 0.7\n932 293 0.4\n932 743 0.2\n932 294 0.4\n933 931 1\n934 55 0.5\n934 56 0.5\n935 117 0.25\n936 935 0.25\n936 117 0.25\n937 935 0.25\n937 936 0.25\n937 117 0.25\n938 935 0.25\n938 936 0.25\n938 937 0.25\n938 117 0.25\n940 478 1\n942 941 0.5\n943 941 0.5\n943 942 0.5\n944 263 0.2\n944 265 0.2\n944 266 0.2\n944 268 0.2\n945 263 0.2\n945 265 0.2\n945 266 0.2\n945 944 0.2\n945 268 0.2\n946 1 1\n948 947 1\n950 949 1\n952 951 1.16667\n953 951 1.16667\n953 952 1.16667\n954 951 0.666667\n954 953 0.666667\n954 952 0.666667\n955 194 0.5\n956 955 0.5\n956 194 1.08333\n958 957 0.5\n959 957 0.5\n959 958 0.5\n961 960 0.5\n962 960 0.5\n962 961 0.5\n963 517 0.333333\n963 151 0.333333\n964 963 0.333333\n964 517 0.333333\n964 151 0.333333\n966 965 0.2\n967 965 0.2\n967 966 0.2\n968 965 0.2\n968 966 0.2\n968 967 0.2\n969 965 0.2\n969 966 0.2\n969 967 0.2\n969 968 0.2\n970 965 0.2\n970 966 0.2\n970 967 0.2\n970 968 0.2\n970 969 0.2\n973 972 1\n973 300 1\n975 974 0.5\n976 974 0.5\n976 975 0.5\n976 88 1\n977 758 0.25\n977 757 0.25\n977 69 0.25\n977 72 0.25\n979 978 1\n981 980 0.5\n982 980 0.5\n982 981 0.5\n984 983 1\n984 473 2.16667\n984 472 0.333333\n985 983 0.5\n985 984 0.833333\n985 473 0.333333\n986 983 0.5\n986 984 0.5\n988 987 1\n989 973 1\n991 88 2\n993 992 1\n995 994 0.25\n996 994 0.25\n996 995 0.25\n997 994 0.25\n997 995 0.25\n997 996 0.25\n998 994 0.25\n998 995 0.25\n998 996 0.25\n998 997 0.25\n1000 999 1\n1000 913 0.142857\n1000 916 0.142857\n1000 255 0.5\n1000 254 0.5\n1002 973 0.833333\n1003 1002 0.833333\n1003 973 0.833333\n1004 1002 0.333333\n1004 1003 0.333333\n1004 973 0.333333\n1005 78 1\n1007 1006 1\n1008 51 0.5\n1008 33 0.5\n1010 1009 1\n1012 1011 1\n1014 1013 1\n1016 62 1.33333\n1016 806 0.333333\n1018 1017 1.2\n1021 127 0.25\n1021 128 0.75\n1022 127 0.25\n1022 128 0.25\n1022 1021 0.25\n1023 127 0.25\n1023 128 1.75\n1023 1021 0.75\n1023 1022 0.25\n1024 53 0.5\n1025 1024 0.5\n1025 53 0.5\n1026 303 0.333333\n1027 1026 1\n1028 746 0.333333\n1028 294 0.333333\n1029 1028 0.333333\n1029 746 0.333333\n1029 294 0.333333\n1030 550 0.5\n1030 121 0.5\n1032 1031 1\n1034 1033 1\n1036 1035 1\n1037 1035 0.5\n1038 1035 0.5\n1038 1037 0.5\n1039 308 0.5\n1040 1039 0.5\n1040 308 1.5\n1041 224 0.333333\n1041 218 0.333333\n1041 216 0.333333\n1043 1042 0.5\n1044 1042 0.5\n1044 1043 0.5\n1045 1010 1\n1046 482 1\n1047 12 0.25\n1048 1047 0.25\n1048 12 0.25\n1049 1047 0.25\n1049 1048 0.25\n1049 12 0.25\n1050 1047 0.25\n1050 1048 0.25\n1050 1049 0.25\n1050 12 0.25\n1053 1052 1\n1055 1054 1\n1056 1054 0.333333\n1057 1054 0.333333\n1057 1056 0.333333\n1058 1054 0.333333\n1058 1056 0.333333\n1058 1057 0.333333\n1061 1060 0.111111\n1062 1060 0.111111\n1062 1061 0.111111\n1063 1060 0.111111\n1063 1061 0.111111\n1063 1062 0.111111\n1064 1060 0.111111\n1064 1061 0.111111\n1064 1062 0.111111\n1064 1063 0.111111\n1065 1060 0.111111\n1065 1061 0.111111\n1065 1062 0.111111\n1065 1063 0.111111\n1065 1064 0.111111\n1066 1060 0.111111\n1066 1061 0.111111\n1066 1062 0.111111\n1066 1063 0.111111\n1066 1064 0.111111\n1066 1065 0.111111\n1067 1060 0.111111\n1067 1061 0.111111\n1067 1062 0.111111\n1067 1063 0.111111\n1067 1064 0.111111\n1067 1065 0.111111\n1067 1066 0.111111\n1068 1060 0.111111\n1068 1061 0.111111\n1068 1062 0.111111\n1068 1063 0.111111\n1068 1064 0.111111\n1068 1065 0.111111\n1068 1066 0.111111\n1068 1067 0.111111\n1069 1060 0.111111\n1069 1061 0.111111\n1069 1062 0.111111\n1069 1063 0.111111\n1069 1064 0.111111\n1069 1065 0.111111\n1069 1066 0.111111\n1069 1067 0.111111\n1069 1068 0.111111\n1070 806 0.142857\n1070 805 0.142857\n1070 807 0.142857\n1070 62 0.142857\n1071 806 0.67619\n1071 805 0.342857\n1071 807 0.342857\n1071 1070 0.142857\n1071 62 0.67619\n1071 362 0.2\n1071 1016 0.333333\n1072 806 0.142857\n1072 805 0.142857\n1072 807 0.142857\n1072 1070 0.142857\n1072 1071 0.142857\n1072 62 0.142857\n1073 806 0.142857\n1073 805 0.142857\n1073 807 0.142857\n1073 1070 0.142857\n1073 1071 0.142857\n1073 1072 0.142857\n1073 62 0.142857\n1074 227 1\n1079 1078 1\n1081 281 2\n1082 69 0.5\n1083 1082 0.5\n1083 69 0.5\n1084 0 0.5\n1084 1 0.5\n1086 516 0.5\n1087 516 2.5\n1087 1086 0.5\n1088 516 1\n1088 1087 0.5\n1088 151 0.5\n1089 516 0.5\n1089 1087 0.5\n1091 473 0.333333\n1091 472 0.333333\n1091 984 0.333333\n1092 473 0.833333\n1092 984 0.833333\n1092 985 0.333333\n1094 1093 0.333333\n1095 1093 0.333333\n1095 1094 0.333333\n1096 1093 0.333333\n1096 1094 0.333333\n1096 1095 0.333333\n1098 1097 0.5\n1099 1097 0.5\n1099 1098 0.5\n1102 1101 0.5\n1103 1101 0.5\n1103 1102 0.5\n1106 1105 0.125\n1107 1105 0.125\n1107 1106 0.125\n1108 1105 0.125\n1108 1106 0.125\n1108 1107 0.125\n1109 1105 0.125\n1109 1106 0.125\n1109 1107 0.125\n1109 1108 0.125\n1110 1105 0.125\n1110 1106 0.125\n1110 1107 0.125\n1110 1108 0.125\n1110 1109 0.125\n1111 1105 0.125\n1111 1106 0.125\n1111 1107 0.125\n1111 1108 0.125\n1111 1109 0.125\n1111 1110 0.125\n1112 1105 0.125\n1112 1106 0.125\n1112 1107 0.125\n1112 1108 0.125\n1112 1109 0.125\n1112 1110 0.125\n1112 1111 0.125\n1113 1105 0.125\n1113 1106 0.125\n1113 1107 0.125\n1113 1108 0.125\n1113 1109 0.125\n1113 1110 0.125\n1113 1111 0.125\n1113 1112 0.125\n1115 1114 1\n1117 1116 0.25\n1118 1116 0.25\n1118 1117 0.25\n1119 1116 0.25\n1119 1117 0.25\n1119 1118 0.25\n1120 1116 0.25\n1120 1117 0.25\n1120 1118 0.25\n1120 1119 0.25\n1121 78 0.5\n1122 78 0.5\n1122 1121 0.5\n1123 78 0.5\n1123 756 0.5\n1124 247 0.333333\n1124 415 0.333333\n1125 1124 0.333333\n1125 247 0.333333\n1125 415 0.333333\n1128 1127 1\n1129 976 1\n1130 657 0.333333\n1130 774 0.333333\n1130 654 0.833333\n1130 34 0.5\n1132 1131 1\n1134 1133 1\n1135 956 0.583333\n1135 194 0.583333\n1136 1135 0.25\n1136 956 0.25\n1136 194 0.25\n1137 1135 0.25\n1137 1136 0.25\n1137 956 0.25\n1137 194 0.25\n1138 1135 0.333333\n1138 194 0.333333\n1138 956 0.333333\n1140 1139 1\n1142 1141 1\n1145 221 0.333333\n1145 343 1.47619\n1145 219 2.14286\n1145 697 0.142857\n1147 1146 0.25\n1148 1146 0.25\n1148 1147 0.25\n1149 1146 0.25\n1149 1147 0.25\n1149 1148 0.25\n1150 1146 0.25\n1150 1147 0.25\n1150 1148 0.25\n1150 1149 0.25\n1153 1152 0.125\n1154 1152 0.125\n1154 1153 0.125\n1155 1152 0.125\n1155 1153 0.125\n1155 1154 0.125\n1156 1152 0.125\n1156 1153 0.125\n1156 1154 0.125\n1156 1155 0.125\n1157 1152 0.125\n1157 1153 0.125\n1157 1154 0.125\n1157 1155 0.125\n1157 1156 0.125\n1158 1152 0.125\n1158 1153 0.125\n1158 1154 0.125\n1158 1155 0.125\n1158 1156 0.125\n1158 1157 0.125\n1159 1152 0.125\n1159 1153 0.125\n1159 1154 0.125\n1159 1155 0.125\n1159 1156 0.125\n1159 1157 0.125\n1159 1158 0.125\n1160 1152 0.125\n1160 1153 0.125\n1160 1154 0.125\n1160 1155 0.125\n1160 1156 0.125\n1160 1157 0.125\n1160 1158 0.125\n1160 1159 0.125\n1162 114 0.5\n1162 186 1.25\n1163 114 0.5\n1163 1162 0.5\n1165 1164 1\n1166 259 0.333333\n1166 258 0.333333\n1167 259 0.333333\n1167 258 0.333333\n1167 1166 0.333333\n1169 1168 1\n1170 820 1\n1172 78 1\n1175 931 0.5\n1176 1175 0.5\n1176 931 0.5\n1177 150 0.5\n1177 96 0.5\n1178 150 0.833333\n1178 281 0.833333\n1180 589 0.25\n1180 590 0.25\n1180 591 0.25\n1181 1180 0.25\n1181 589 0.25\n1181 590 0.25\n1181 591 0.25\n1182 302 1\n1185 1184 0.5\n1186 1184 0.5\n1186 1185 0.5\n1189 327 0.5\n1189 328 0.5\n1190 54 0.2\n1190 34 0.2\n1190 840 0.2\n1190 33 0.2\n1191 1190 0.2\n1191 54 0.2\n1191 34 0.2\n1191 840 0.2\n1191 33 0.2\n1194 1193 1\n1195 78 0.333333\n1196 1195 0.333333\n1196 78 0.333333\n1197 1195 0.333333\n1197 1196 0.333333\n1197 78 0.333333\n1199 1198 0.5\n1200 1198 0.5\n1200 1199 0.5\n1201 913 0.785714\n1201 916 1.11905\n1201 1000 0.142857\n1201 914 0.142857\n1201 915 0.142857\n1202 913 0.142857\n1202 916 0.142857\n1202 1201 0.142857\n1202 1000 0.142857\n1203 913 0.142857\n1203 916 0.142857\n1203 1201 0.142857\n1203 1202 0.142857\n1203 1000 0.142857\n1204 913 0.142857\n1204 916 0.142857\n1204 1201 0.142857\n1204 1202 0.142857\n1204 1203 0.142857\n1204 1000 0.142857\n1205 913 0.142857\n1205 916 0.142857\n1205 1201 0.142857\n1205 1202 0.142857\n1205 1203 0.142857\n1205 1204 0.142857\n1205 1000 0.142857\n1206 913 0.142857\n1206 916 0.142857\n1206 1201 0.142857\n1206 914 0.142857\n1206 915 0.142857\n1207 913 0.142857\n1207 1206 0.142857\n1207 916 0.142857\n1207 1201 0.142857\n1207 914 0.142857\n1207 915 0.142857\n1208 913 0.142857\n1208 1206 0.142857\n1208 916 0.142857\n1208 1201 0.142857\n1208 914 0.142857\n1208 1207 0.142857\n1208 915 0.142857\n1210 1209 0.333333\n1211 1209 0.333333\n1211 1210 0.333333\n1212 1209 0.333333\n1212 1210 0.333333\n1212 1211 0.333333\n1214 330 0.25\n1215 1214 0.25\n1215 330 0.25\n1216 1214 0.25\n1216 330 0.25\n1216 1215 0.25\n1217 1214 0.25\n1217 330 0.25\n1217 1215 0.25\n1217 1216 0.25\n1219 1218 1\n1221 500 0.5\n1221 150 0.5\n1223 1222 0.5\n1224 1222 0.5\n1224 1223 0.5\n1226 1225 1\n1227 1225 1\n1228 132 0.25\n1228 54 0.25\n1228 33 0.25\n1229 132 0.25\n1229 1228 0.25\n1229 54 0.25\n1229 33 0.25\n1230 244 1\n1232 1231 1\n1233 415 0.5\n1234 1233 0.5\n1234 415 0.5\n1235 481 0.5\n1236 1235 0.5\n1236 481 0.5\n1238 1237 1\n1239 547 1\n1241 1240 1\n1243 1242 1\n1244 482 0.25\n1245 1244 0.25\n1245 482 0.25\n1246 1244 0.25\n1246 1245 0.25\n1246 482 0.25\n1247 1244 0.25\n1247 1245 0.25\n1247 1246 0.25\n1247 482 0.25\n1249 1248 1\n1250 481 0.5\n1251 1250 0.5\n1251 481 0.5\n1253 1252 0.5\n1254 1252 1.5\n1254 1253 0.5\n1255 764 0.833333\n1255 765 0.333333\n1255 121 0.833333\n1256 1201 0.333333\n1256 916 0.333333\n1257 1201 0.333333\n1257 1256 0.333333\n1257 916 0.333333\n1259 1258 1\n1261 1260 0.5\n1262 1260 0.5\n1262 1261 0.5\n1263 375 0.333333\n1263 376 0.333333\n1263 377 0.333333\n1265 1264 0.333333\n1266 1264 0.333333\n1266 1265 0.333333\n1267 1264 0.333333\n1267 1265 0.333333\n1267 1266 0.333333\n1268 872 1\n1270 320 0.5\n1270 321 0.5\n1271 947 0.5\n1272 1271 0.5\n1272 947 0.5\n1273 843 0.75\n1274 1273 0.75\n1274 843 0.75\n1275 1273 0.25\n1275 1274 0.25\n1275 843 0.25\n1276 1273 0.25\n1276 1274 0.25\n1276 843 0.25\n1276 1275 0.25\n1278 744 0.7\n1278 294 0.7\n1278 743 0.2\n1278 742 0.2\n1278 293 0.2\n1279 744 0.333333\n1280 744 0.333333\n1280 1279 0.333333\n1281 744 0.333333\n1281 1279 0.333333\n1281 1280 0.333333\n1282 1145 0.333333\n1282 219 0.333333\n1283 1282 0.333333\n1283 1145 0.333333\n1283 219 0.333333\n1287 1286 0.25\n1288 1286 0.25\n1288 1287 0.25\n1289 1286 0.25\n1289 1287 0.25\n1289 1288 0.25\n1290 1286 0.25\n1290 1287 0.25\n1290 1288 0.25\n1290 1289 0.25\n1293 1292 0.5\n1294 1292 0.5\n1294 1293 0.5\n1295 375 0.25\n1295 376 0.25\n1295 33 0.25\n1295 377 0.25\n1299 1298 1\n1303 1018 0.5\n1304 1018 0.5\n1304 1303 0.5\n1305 1018 1\n1306 1018 0.2\n1306 1017 0.2\n1307 1018 0.2\n1307 1306 0.2\n1307 1017 0.2\n1308 1018 0.2\n1308 1306 0.2\n1308 1307 0.2\n1308 1017 0.2\n1309 1018 0.2\n1309 1306 0.2\n1309 1307 0.2\n1309 1308 0.2\n1309 1017 0.2\n1311 1310 1\n1313 1312 0.25\n1314 1312 0.25\n1314 1313 0.25\n1315 1312 0.25\n1315 1313 0.25\n1315 1314 0.25\n1315 53 0.25\n1316 1312 0.25\n1316 1313 0.25\n1316 1314 0.25\n1316 1315 0.25\n1318 900 1\n1321 1320 1\n1322 524 1\n1324 1323 0.5\n1325 1323 0.5\n1325 1324 0.5\n1327 1326 1\n1329 1328 1\n1332 1331 0.5\n1333 1331 0.5\n1333 1332 0.5\n1336 1335 0.333333\n1337 1335 0.333333\n1337 1336 0.333333\n1338 1335 0.333333\n1338 1336 0.333333\n1338 1337 0.333333\n1339 882 1\n1341 517 1\n1342 281 0.333333\n1342 150 0.333333\n1342 1178 0.333333\n1343 281 0.5\n1344 281 0.5\n1344 1343 0.5\n1345 1225 1\n1346 721 1\n1347 377 0.5\n1348 1347 0.5\n1348 377 0.5\n1349 362 0.25\n1350 1349 0.25\n1350 362 0.25\n1351 1349 0.25\n1351 1350 0.25\n1351 362 0.25\n1352 1349 0.25\n1352 1350 0.25\n1352 1351 0.25\n1352 362 0.25\n1355 1354 1\n1356 523 0.333333\n1356 746 0.333333\n1356 742 0.333333\n1356 931 1\n1357 1356 1\n1357 1107 0.333333\n1358 1356 1\n1358 1357 2.33333\n1358 1107 0.333333\n1359 1356 1\n1361 46 1.33333\n1361 428 0.333333\n1362 46 0.333333\n1362 1361 0.333333\n1362 428 0.333333\n1363 46 1\n1364 1286 0.25\n1365 1364 0.25\n1365 1286 0.25\n1366 1364 0.25\n1366 1365 0.25\n1366 1286 0.25\n1367 1364 0.25\n1367 1365 0.25\n1367 1366 0.25\n1367 1286 0.25\n1368 932 0.2\n1368 293 0.2\n1368 294 0.2\n1368 931 0.2\n1369 932 0.2\n1369 1368 0.2\n1369 293 0.2\n1369 294 0.2\n1369 931 0.2\n1371 1370 1\n1373 1372 1\n1375 1374 0.5\n1376 1374 0.5\n1376 1375 0.5\n1377 1294 0.5\n1378 1377 0.5\n1378 1294 0.5\n1381 522 0.5\n1381 76 0.5\n1384 194 0.5\n1385 1384 0.5\n1385 194 0.5\n1387 1386 1\n1389 329 1.5\n1389 547 0.5\n1391 1390 0.5\n1392 1390 0.5\n1392 1391 0.5\n1394 1145 0.142857\n1394 219 0.142857\n1394 343 0.142857\n1394 697 0.142857\n1395 1394 0.142857\n1395 1145 0.142857\n1395 219 0.142857\n1395 343 0.142857\n1395 697 0.142857\n1396 1394 0.142857\n1396 1145 0.142857\n1396 1395 0.142857\n1396 219 0.142857\n1396 343 0.142857\n1396 697 0.142857\n1397 1394 0.142857\n1397 1145 0.142857\n1397 1395 0.142857\n1397 219 0.142857\n1397 343 0.142857\n1397 1396 0.142857\n1397 697 0.142857\n1398 314 1\n1400 1399 0.25\n1401 1399 0.25\n1401 1400 0.25\n1402 1399 0.25\n1402 1400 0.25\n1402 1401 0.25\n1403 1399 0.25\n1403 1400 0.25\n1403 1401 0.25\n1403 1402 0.25\n1404 327 0.166667\n1404 416 0.166667\n1405 1404 0.166667\n1405 327 0.166667\n1405 416 0.166667\n1406 1404 0.166667\n1406 1405 0.166667\n1406 327 0.166667\n1406 416 0.166667\n1407 1404 0.166667\n1407 1405 0.166667\n1407 327 0.166667\n1407 1406 0.166667\n1407 416 0.166667\n1408 1404 0.166667\n1408 1405 0.166667\n1408 327 0.166667\n1408 1406 0.166667\n1408 416 0.166667\n1408 1407 0.166667\n1409 496 0.5\n1410 1409 0.5\n1410 496 0.5\n1411 1357 0.333333\n1411 1107 0.333333\n1411 1358 0.333333\n1412 1060 1\n1413 186 0.25\n1413 1162 0.25\n1414 186 0.25\n1414 1413 0.25\n1414 1162 0.25\n1415 186 0.25\n1415 1413 0.25\n1415 1162 0.25\n1415 1414 0.25\n1416 303 0.333333\n1416 1026 0.333333\n1417 1416 0.333333\n1417 303 0.333333\n1417 1026 0.333333\n1418 930 1\n1419 1336 1\n1421 1420 0.333333\n1422 1420 0.333333\n1422 1421 0.333333\n1423 1420 0.333333\n1423 1421 0.333333\n1423 1422 0.333333\n1424 9 0.5\n1425 1424 0.5\n1425 9 1.5\n1427 1426 0.5\n1428 1426 0.5\n1428 1427 0.5\n1429 645 0.0526316\n1430 1429 0.385965\n1430 645 0.0526316\n1431 1429 0.385965\n1431 645 0.0526316\n1431 1430 0.385965\n1432 1429 0.0526316\n1432 645 0.0526316\n1432 1430 0.0526316\n1432 1431 0.0526316\n1433 1429 0.0526316\n1433 645 0.0526316\n1433 1430 0.0526316\n1433 1431 0.0526316\n1433 1432 0.0526316\n1434 1429 0.0526316\n1434 645 0.0526316\n1434 1430 0.0526316\n1434 1431 0.0526316\n1434 1432 0.0526316\n1434 1433 0.0526316\n1435 1429 0.0526316\n1435 645 0.0526316\n1435 1430 0.0526316\n1435 1431 0.0526316\n1435 1432 0.0526316\n1435 1433 0.0526316\n1435 1434 0.0526316\n1436 1429 0.0526316\n1436 645 0.0526316\n1436 1430 0.0526316\n1436 1431 0.0526316\n1436 1432 0.0526316\n1436 1433 0.0526316\n1436 1434 0.0526316\n1436 1435 0.0526316\n1437 1429 0.0526316\n1437 645 0.0526316\n1437 1430 0.0526316\n1437 1431 0.0526316\n1437 1432 0.0526316\n1437 1433 0.0526316\n1437 1434 0.0526316\n1437 1435 0.0526316\n1437 1436 0.0526316\n1438 1429 0.0526316\n1438 645 0.0526316\n1438 1430 0.0526316\n1438 1431 0.0526316\n1438 1432 0.0526316\n1438 1433 0.0526316\n1438 1434 0.0526316\n1438 1435 0.0526316\n1438 1436 0.0526316\n1438 1437 0.0526316\n1439 1429 0.0526316\n1439 645 0.0526316\n1439 1430 0.0526316\n1439 1431 0.0526316\n1439 1432 0.0526316\n1439 1433 0.0526316\n1439 1434 0.0526316\n1439 1435 0.0526316\n1439 1436 0.0526316\n1439 1437 0.0526316\n1439 1438 0.0526316\n1440 1429 0.0526316\n1440 645 0.0526316\n1440 1430 0.0526316\n1440 1431 0.0526316\n1440 1432 0.0526316\n1440 1433 0.0526316\n1440 1434 0.0526316\n1440 1435 0.0526316\n1440 1436 0.0526316\n1440 1437 0.0526316\n1440 1438 0.0526316\n1440 1439 0.0526316\n1441 1429 0.0526316\n1441 645 0.0526316\n1441 1430 0.0526316\n1441 1431 0.0526316\n1441 1432 0.0526316\n1441 1433 0.0526316\n1441 1434 0.0526316\n1441 1435 0.0526316\n1441 1436 0.0526316\n1441 1437 0.0526316\n1441 1438 0.0526316\n1441 1439 0.0526316\n1441 1440 0.0526316\n1442 1429 0.0526316\n1442 645 0.0526316\n1442 1430 0.0526316\n1442 1431 0.0526316\n1442 1432 0.0526316\n1442 1433 0.0526316\n1442 1434 0.0526316\n1442 1435 0.0526316\n1442 1436 0.0526316\n1442 1437 0.0526316\n1442 1438 0.0526316\n1442 1439 0.0526316\n1442 1440 0.0526316\n1442 1441 0.0526316\n1443 1429 0.0526316\n1443 645 0.0526316\n1443 1430 0.0526316\n1443 1431 0.0526316\n1443 1432 0.0526316\n1443 1433 0.0526316\n1443 1434 0.0526316\n1443 1435 0.0526316\n1443 1436 0.0526316\n1443 1437 0.0526316\n1443 1438 0.0526316\n1443 1439 0.0526316\n1443 1440 0.0526316\n1443 1441 0.0526316\n1443 1442 0.0526316\n1444 1429 0.0526316\n1444 645 0.0526316\n1444 1430 0.0526316\n1444 1431 0.0526316\n1444 1432 0.0526316\n1444 1433 0.0526316\n1444 1434 0.0526316\n1444 1435 0.0526316\n1444 1436 0.0526316\n1444 1437 0.0526316\n1444 1438 0.0526316\n1444 1439 0.0526316\n1444 1440 0.0526316\n1444 1441 0.0526316\n1444 1442 0.0526316\n1444 1443 0.0526316\n1445 1429 0.0526316\n1445 645 0.0526316\n1445 1430 0.0526316\n1445 1431 0.0526316\n1445 1432 0.0526316\n1445 1433 0.0526316\n1445 1434 0.0526316\n1445 1435 0.0526316\n1445 1436 0.0526316\n1445 1437 0.0526316\n1445 1438 0.0526316\n1445 1439 0.0526316\n1445 1440 0.0526316\n1445 1441 0.0526316\n1445 1442 0.0526316\n1445 1443 0.0526316\n1445 1444 0.0526316\n1446 1429 0.0526316\n1446 645 0.0526316\n1446 1430 0.0526316\n1446 1431 0.0526316\n1446 1432 0.0526316\n1446 1433 0.0526316\n1446 1434 0.0526316\n1446 1435 0.0526316\n1446 1436 0.0526316\n1446 1437 0.0526316\n1446 1438 0.0526316\n1446 1439 0.0526316\n1446 1440 0.0526316\n1446 1441 0.0526316\n1446 1442 0.0526316\n1446 1443 0.0526316\n1446 1444 0.0526316\n1446 1445 0.0526316\n1447 1429 0.0526316\n1447 645 0.0526316\n1447 1430 0.0526316\n1447 1431 0.0526316\n1447 1432 0.0526316\n1447 1433 0.0526316\n1447 1434 0.0526316\n1447 1435 0.0526316\n1447 1436 0.0526316\n1447 1437 0.0526316\n1447 1438 0.0526316\n1447 1439 0.0526316\n1447 1440 0.0526316\n1447 1441 0.0526316\n1447 1442 0.0526316\n1447 1443 0.0526316\n1447 1444 0.0526316\n1447 1445 0.0526316\n1447 1446 0.0526316\n1448 1429 0.333333\n1448 1430 0.333333\n1448 1431 0.333333\n1450 1449 1\n1451 283 0.5\n1451 281 0.5\n1452 216 1\n1453 1360 1\n1454 721 1\n1455 482 1\n1457 1456 0.333333\n1458 1456 0.333333\n1458 1457 0.333333\n1459 1456 0.333333\n1459 1457 0.333333\n1459 1458 0.333333\n1460 517 0.333333\n1460 127 0.333333\n1460 151 0.333333\n1461 55 0.5\n1461 56 0.5\n1464 860 0.2\n1464 294 0.2\n1465 1464 0.2\n1465 860 0.2\n1465 294 0.2\n1466 1464 0.2\n1466 1465 0.2\n1466 860 0.2\n1466 294 0.2\n1467 1464 0.2\n1467 1465 0.2\n1467 860 0.2\n1467 1466 0.2\n1467 294 0.2\n1468 53 0.25\n1468 1315 0.25\n1469 53 0.25\n1469 1468 0.25\n1469 1315 0.25\n1470 53 0.25\n1470 1468 0.25\n1470 1315 0.25\n1470 1469 0.25\n1472 1471 0.5\n1473 1471 0.5\n1473 1472 0.5\n1475 1474 0.5\n1476 1474 0.5\n1476 1475 0.5\n1477 207 0.5\n1478 1477 0.5\n1478 207 0.5\n1480 1479 1\n1481 96 0.5\n1482 1481 0.5\n1482 96 0.5\n1484 1483 0.5\n1485 1483 0.5\n1485 1484 0.5\n1487 1486 1\n1488 1142 0.5\n1489 1488 0.5\n1489 1142 0.5\n1492 1491 1\n1493 1491 0.25\n1494 1493 1\n1496 1495 1\n1497 300 1\n1498 82 1\n1500 239 0.25\n1501 1500 0.25\n1501 239 0.25\n1502 1500 0.25\n1502 1501 0.25\n1502 239 0.25\n1503 1500 0.25\n1503 1501 0.25\n1503 239 0.25\n1503 1502 0.25\n1504 1000 0.5\n1505 1504 0.2\n1506 1504 0.2\n1506 1505 0.2\n1507 1504 0.2\n1507 1505 0.2\n1507 1506 0.2\n1508 1504 0.2\n1508 1505 0.2\n1508 1506 0.2\n1508 1507 0.2\n1509 1504 0.2\n1509 1505 0.2\n1509 1506 0.2\n1509 1507 0.2\n1509 1508 0.2\n1512 1511 0.5\n1513 1511 0.5\n1513 1512 0.5\n1514 1000 0.5\n1514 1504 0.5\n1515 1120 0.333333\n1516 1120 0.333333\n1516 1515 0.333333\n1517 1120 0.333333\n1517 1515 0.333333\n1517 1516 0.333333\n1518 243 0.25\n1518 927 0.25\n1519 1518 0.25\n1519 243 0.25\n1519 927 0.25\n1520 1518 0.25\n1520 1519 0.25\n1520 243 0.25\n1520 927 0.25\n1523 1522 1\n1526 1525 1\n1529 54 0.5\n1529 33 0.5\n1531 1530 1\n1532 9 1\n1533 532 0.2\n1533 531 0.2\n1533 530 0.2\n1534 532 0.2\n1534 1533 0.2\n1534 531 0.2\n1534 530 0.2\n1535 532 0.2\n1535 1533 0.2\n1535 1534 0.2\n1535 531 0.2\n1535 530 0.2\n1536 843 1\n1538 1537 0.5\n1539 1537 0.5\n1539 1538 0.5\n1540 1493 0.25\n1540 1491 0.25\n1541 1540 0.25\n1541 1493 0.25\n1541 1491 0.25\n1542 1540 0.25\n1542 1541 0.25\n1542 1493 0.25\n1542 1491 0.25\n1544 1543 1\n1546 1545 0.333333\n1547 1545 0.333333\n1547 1546 0.333333\n1548 1545 0.333333\n1548 1546 0.333333\n1548 1547 0.333333\n1549 308 1\n1550 34 0.833333\n1550 33 1.33333\n1550 54 0.5\n1551 1550 0.333333\n1551 34 0.333333\n1551 33 0.333333\n1553 294 0.333333\n1554 294 0.333333\n1554 1553 0.333333\n1555 294 0.333333\n1555 1553 0.333333\n1555 1554 0.333333\n1556 676 0.333333\n1557 1556 0.333333\n1557 676 0.333333\n1558 1556 0.333333\n1558 676 0.333333\n1558 1557 0.333333\n1560 1145 0.333333\n1560 219 0.333333\n1561 1560 0.333333\n1561 1145 0.333333\n1561 219 0.333333\n1562 63 0.142857\n1562 62 0.142857\n1563 1562 0.142857\n1563 63 0.142857\n1563 62 0.142857\n1564 1562 0.142857\n1564 1563 0.142857\n1564 63 0.142857\n1564 62 0.142857\n1565 1562 0.142857\n1565 1563 0.142857\n1565 1564 0.142857\n1565 63 0.142857\n1565 62 0.142857\n1566 1562 0.142857\n1566 1563 0.142857\n1566 1564 0.142857\n1566 1565 0.142857\n1566 63 0.142857\n1566 62 0.142857\n1567 1562 0.142857\n1567 1563 0.142857\n1567 1564 0.142857\n1567 1565 0.142857\n1567 1566 0.142857\n1567 63 0.142857\n1567 62 0.142857\n1569 1568 1\n1570 337 0.2\n1570 631 0.2\n1571 337 0.2\n1571 631 0.2\n1571 1570 0.2\n1572 337 0.2\n1572 631 0.2\n1572 1570 0.2\n1572 1571 0.2\n1573 337 0.2\n1573 631 0.2\n1573 1570 0.2\n1573 1571 0.2\n1573 1572 0.2\n1574 631 0.5\n1574 783 0.5\n1576 1575 0.333333\n1577 1575 0.333333\n1577 1576 0.333333\n1578 1575 0.333333\n1578 1576 0.333333\n1578 1577 0.333333\n1579 631 0.5\n1579 630 0.5\n1581 1580 1\n1584 1583 1\n1586 1585 1\n1587 1585 1\n1588 522 0.5\n1588 76 0.5`;\n\nconst nodes = new Set();\nconst edges = [];\nrawData.split('\\n').forEach((line) => {\n  const d = line.split(' ');\n  const u = d[0];\n  const v = d[1];\n  const weight = parseFloat(d[2]);\n\n  nodes.add(u);\n  nodes.add(v);\n\n  edges.push({\n    source: `${u}`,\n    target: `${v}`,\n    value: weight,\n  });\n});\n\nconst data = {\n  nodes: Array.from(nodes).map((u) => ({\n    id: `${u}`,\n    label: `${u}`,\n  })),\n  edges,\n};\n\nlet kernel: Kernel;\n\nconst App = React.memo(function BellmanFord() {\n  const [timeElapsed, setTimeElapsed] = useState(0);\n  const [datasource, setDatasource] = useState<\n    Array<{\n      destination: string;\n      weight: number;\n      prevPoint: string;\n    }>\n  >([]);\n\n  // @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\n  const buildTextureData = (nodes, edges, sourceNodeIdx) => {\n    const dataArray = [];\n    const nodeDict = [];\n    const mapIdPos = {};\n    let i = 0;\n    for (i = 0; i < nodes.length; i++) {\n      const n = nodes[i];\n      mapIdPos[n.id] = i;\n      if (i === sourceNodeIdx) {\n        dataArray.push(0); // distance\n      } else {\n        dataArray.push(10000); // Infinity\n      }\n      dataArray.push(-1); // predecessor\n      dataArray.push(0); // offset\n      dataArray.push(0); // outputing edge length\n      nodeDict.push([]);\n    }\n    for (i = 0; i < edges.length; i++) {\n      const e = edges[i];\n      nodeDict[mapIdPos[e.source]].push({\n        target: mapIdPos[e.target],\n        weight: e.value,\n      });\n      // lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n    }\n\n    let maxEdgePerVetex = 0;\n    for (i = 0; i < nodes.length; i++) {\n      const offset = dataArray.length;\n      const dests = nodeDict[i];\n      const len = dests.length;\n      dataArray[i * 4 + 2] = offset;\n      dataArray[i * 4 + 3] = dests.length;\n      maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n      for (let j = 0; j < len; ++j) {\n        const { target, weight } = dests[j];\n        dataArray.push(+target); // dest vertex index\n        dataArray.push(+weight); // edge weight\n      }\n    }\n\n    while (dataArray.length % 4 !== 0) {\n      dataArray.push(0);\n    }\n    return [new Float32Array(dataArray), maxEdgePerVetex];\n  };\n\n  const calcShortestPath = async (source: string) => {\n    const [nodesEdgesArray, maxEdgePerVetex] = buildTextureData(\n      data.nodes,\n      data.edges,\n      data.nodes.findIndex((n) => n.id === source),\n    );\n    const vertexNum = data.nodes.length;\n\n    if (kernel) {\n      const timeStart = window.performance.now();\n      kernel.setBinding({\n        gData: nodesEdgesArray,\n        MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n        VERTEX_COUNT: data.nodes.length,\n        MAX_DISTANCE: 10000,\n      });\n\n      // relax all edges |V|-1 times\n      await kernel.execute(vertexNum - 1);\n\n      const output = await kernel.getOutput();\n      setTimeElapsed(window.performance.now() - timeStart);\n\n      setDatasource(\n        new Array(data.nodes.length)\n          .fill(0)\n          .map((_, i) => {\n            const prevPoint = data.nodes[output[i * 4 + 1]];\n            const weight = output[i * 4];\n\n            return {\n              destination: data.nodes[i].id,\n              weight: weight === 10000 ? 'MAX' : weight,\n              prevPoint: (prevPoint && prevPoint.id) || '-',\n            };\n          })\n          .filter(({ weight }) => weight !== 'MAX'),\n      );\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // compile our kernel code\n      const compiler = new Compiler();\n      const precompiledBundle = compiler.compileBundle(gCode);\n\n      // create world\n      const world = World.create({\n        engineOptions: {\n          supportCompute: true,\n        },\n      });\n\n      const vertexNum = data.nodes.length;\n\n      kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([Math.ceil(vertexNum / 16), 1, 1]);\n\n      await calcShortestPath('1');\n    })();\n  }, []);\n\n  return (\n    <>\n      <div id=\"container\" />\n      <div>Directed Graph: {nodes.size} nodes, {edges.length} edges</div>\n      <div>Elapsed time: {timeElapsed} ms</div>\n      <div>\n        Shortest path from\n        <Select\n          defaultValue=\"1\"\n          options={data.nodes.map((node) => ({\n            value: node.id,\n            label: node.label,\n          }))}\n          onChange={calcShortestPath}\n        />\n      </div>\n      <Table\n        rowKey=\"destination\"\n        columns={[\n          {\n            dataIndex: 'destination',\n            title: 'destination',\n          },\n          {\n            dataIndex: 'weight',\n            title: 'weight',\n          },\n          {\n            dataIndex: 'prevPoint',\n            title: 'previous point',\n          },\n        ]}\n        dataSource={datasource}\n        pagination={false}\n      />\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"antd\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"antd\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.antd, global.react, global.reactDom);\n    global.perf = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _antd, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\nconst MAX_EDGE_PER_VERTEX;\\nconst VERTEX_COUNT;\\nconst MAX_DISTANCE;\\n\\n@numthreads(16, 1, 1)\\nclass BellmanFord {\\n  @in @out\\n  gData: vec4[];\\n\\n  @shared(16)\\n  sData: vec4[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    if (i >= VERTEX_COUNT) {\\n      return;\\n    }\\n\\n    this.sData[tid] = this.gData[i];\\n    barrier();\\n\\n    const currentNode = this.sData[tid];\\n\\n    const arr_offset = floor(currentNode[2]);\\n    const length = floor(currentNode[3]);\\n    const node_buffer: vec4;\\n    for (let p: int = 0; p < MAX_EDGE_PER_VERTEX; p++) {\\n      if (p >= length) break;\\n      const arr_idx = arr_offset + p * 2;\\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\\n      if (p == 0 || buf_offset == 0) {\\n        node_buffer = this.gData[int(arr_idx / 4)];\\n      }\\n      const float_j = buf_offset == 0 ? node_buffer[0] : node_buffer[2];\\n      const w = buf_offset == 0 ? node_buffer[1] : node_buffer[3];\\n\\n      const du = this.sData[tid].x;\\n      const dv = this.sData[int(float_j)].x;\\n      let newDist = du + w;\\n\\n      if (newDist < dv) {\\n        this.sData[int(float_j)].x = newDist;\\n        this.sData[int(float_j)].y = tid;\\n        barrier();\\n      }\\n    }\\n\\n    this.gData[i].xy = this.sData[tid].xy;\\n  }\\n}\\n\";\n  var rawData = \"1 0 2.5\\n3 2 0.25\\n4 2 0.25\\n4 3 0.25\\n5 2 0.25\\n5 3 0.25\\n5 4 0.25\\n6 2 0.25\\n6 3 0.25\\n6 4 0.25\\n6 5 0.25\\n8 7 1\\n9 7 3.16667\\n10 7 1.16667\\n10 9 1.16667\\n11 7 0.666667\\n11 10 0.666667\\n11 9 0.666667\\n13 12 0.333333\\n14 12 0.333333\\n14 13 0.333333\\n15 12 0.333333\\n15 13 0.333333\\n15 14 0.333333\\n17 16 0.5\\n18 16 0.5\\n18 17 0.5\\n21 20 0.5\\n22 20 0.5\\n22 21 0.5\\n24 23 0.5\\n25 23 0.5\\n25 24 2.33333\\n28 27 0.5\\n29 27 0.5\\n29 28 0.5\\n31 30 0.5\\n32 30 0.5\\n32 31 0.5\\n33 30 3.58333\\n34 30 1.58333\\n34 33 4.225\\n36 35 0.2\\n37 35 0.2\\n37 36 0.2\\n38 35 0.2\\n38 36 0.2\\n38 37 0.2\\n39 35 0.2\\n39 36 0.2\\n39 37 0.2\\n39 38 0.2\\n40 35 0.2\\n40 36 0.2\\n40 37 0.2\\n40 38 0.2\\n40 39 0.2\\n43 42 1\\n45 44 0.5\\n46 44 0.5\\n46 45 0.5\\n48 47 0.333333\\n49 47 0.333333\\n49 48 0.333333\\n50 47 0.333333\\n50 48 0.333333\\n50 49 0.333333\\n51 33 0.75\\n52 51 0.25\\n52 33 0.25\\n53 51 0.25\\n53 52 0.25\\n53 33 1.85833\\n53 34 0.775\\n54 51 0.25\\n54 52 0.25\\n54 53 0.625\\n54 33 2.99167\\n54 34 1.15833\\n54 30 0.25\\n55 51 0.5\\n56 51 0.5\\n56 55 3.83333\\n57 51 1\\n58 51 1\\n58 57 1\\n60 59 0.5\\n61 59 0.5\\n61 60 0.5\\n63 62 0.47619\\n64 62 0.333333\\n64 63 0.333333\\n65 62 0.333333\\n65 63 0.333333\\n65 64 0.333333\\n67 66 0.5\\n68 66 0.5\\n68 67 0.5\\n70 69 0.833333\\n71 69 2.16667\\n71 70 0.833333\\n72 69 0.916667\\n72 70 0.333333\\n72 71 0.666667\\n74 73 0.333333\\n75 73 0.333333\\n75 74 0.333333\\n76 73 0.333333\\n76 74 0.333333\\n76 75 0.333333\\n78 77 0.333333\\n78 46 1\\n79 77 0.333333\\n79 78 0.333333\\n80 77 0.333333\\n80 78 0.333333\\n80 79 0.333333\\n82 81 0.5\\n83 81 0.5\\n83 82 0.5\\n85 84 0.5\\n86 84 0.5\\n86 85 0.5\\n88 87 2.5\\n90 55 1\\n92 91 0.5\\n93 91 0.5\\n93 92 0.5\\n95 94 0.5\\n96 94 2.66667\\n96 95 0.5\\n97 94 2.33333\\n97 95 0.5\\n97 96 2.33333\\n97 69 1.83333\\n98 94 0.5\\n98 95 0.5\\n98 96 0.5\\n98 97 0.5\\n99 94 0.5\\n99 96 0.5\\n99 97 0.5\\n100 94 0.25\\n100 99 1.25\\n100 96 0.25\\n100 97 0.25\\n103 102 0.5\\n104 102 0.5\\n104 103 0.5\\n106 105 0.5\\n107 105 0.5\\n107 106 0.5\\n109 108 1\\n112 111 1\\n114 113 1\\n117 116 1\\n119 118 1\\n121 120 1\\n121 78 1\\n123 122 0.5\\n124 122 0.5\\n124 123 0.5\\n127 126 0.7\\n128 126 0.5\\n128 127 0.75\\n130 129 1\\n131 33 1.33333\\n131 30 0.333333\\n131 34 0.333333\\n132 33 2.275\\n132 34 0.525\\n132 53 1.025\\n132 54 0.375\\n133 33 1.025\\n133 34 1.025\\n133 132 0.525\\n133 53 0.525\\n133 54 0.125\\n134 33 0.525\\n134 34 0.525\\n134 132 0.525\\n134 133 0.525\\n134 53 0.525\\n134 54 0.125\\n136 135 1\\n138 137 1\\n140 139 0.111111\\n141 139 0.111111\\n141 140 0.111111\\n142 139 0.111111\\n142 140 0.111111\\n142 141 0.111111\\n143 139 0.111111\\n143 140 0.111111\\n143 141 0.111111\\n143 142 0.111111\\n144 139 0.111111\\n144 140 0.111111\\n144 141 0.111111\\n144 142 0.111111\\n144 143 0.111111\\n145 139 0.111111\\n145 140 0.111111\\n145 141 0.111111\\n145 142 0.111111\\n145 143 0.111111\\n145 144 0.111111\\n146 139 0.111111\\n146 140 0.111111\\n146 141 0.111111\\n146 142 0.111111\\n146 143 0.111111\\n146 144 0.111111\\n146 145 0.111111\\n147 139 0.111111\\n147 140 0.111111\\n147 141 0.111111\\n147 142 0.111111\\n147 143 0.111111\\n147 144 0.111111\\n147 145 0.111111\\n147 146 0.111111\\n148 139 0.111111\\n148 140 0.111111\\n148 141 0.111111\\n148 142 0.111111\\n148 143 0.111111\\n148 144 0.111111\\n148 145 0.111111\\n148 146 0.111111\\n148 147 0.111111\\n149 71 1.16667\\n150 149 0.666667\\n150 71 0.666667\\n150 96 0.833333\\n150 94 0.333333\\n151 149 1.16667\\n151 71 1.16667\\n151 150 4.75\\n151 127 0.333333\\n152 149 1\\n154 153 1.33333\\n155 153 0.333333\\n155 154 0.333333\\n156 153 0.333333\\n156 154 0.333333\\n156 155 0.333333\\n157 71 0.5\\n158 71 0.5\\n158 157 0.5\\n161 160 1\\n163 162 1\\n165 164 1\\n167 166 1\\n170 169 0.5\\n171 169 0.5\\n171 170 0.5\\n173 172 0.5\\n174 172 1.5\\n174 173 0.5\\n176 175 0.5\\n177 175 0.5\\n177 176 0.5\\n180 179 1\\n181 179 1\\n181 180 1\\n183 182 1\\n184 55 0.5\\n184 56 0.5\\n185 184 0.5\\n186 184 0.5\\n186 185 0.5\\n188 187 1.5\\n189 187 0.5\\n189 188 0.5\\n190 33 0.583333\\n191 46 0.833333\\n192 191 0.333333\\n192 46 0.333333\\n193 191 0.333333\\n193 192 0.333333\\n193 46 0.333333\\n194 191 0.5\\n194 46 0.5\\n196 195 1.25\\n197 195 0.25\\n197 196 0.25\\n198 195 0.25\\n198 196 0.25\\n198 197 0.25\\n199 195 0.25\\n199 196 0.25\\n199 197 0.25\\n199 198 0.25\\n201 200 0.5\\n201 24 0.333333\\n201 25 0.333333\\n202 200 0.5\\n202 201 0.833333\\n202 24 0.333333\\n202 25 0.333333\\n203 131 1\\n206 205 1\\n208 207 0.5\\n209 207 0.5\\n209 208 0.5\\n211 210 0.5\\n212 210 0.5\\n212 211 0.5\\n214 213 0.5\\n215 213 0.5\\n215 214 0.5\\n216 48 0.333333\\n216 136 0.5\\n217 216 1.08333\\n217 48 0.333333\\n218 216 1.66667\\n218 217 1.08333\\n218 48 0.333333\\n219 216 0.5\\n219 218 0.25\\n220 216 1.5\\n220 219 0.5\\n220 218 0.25\\n221 216 0.25\\n221 219 0.583333\\n221 220 0.25\\n222 216 0.25\\n222 219 1.75\\n222 220 0.25\\n222 221 0.25\\n223 216 0.5\\n223 136 0.5\\n224 216 0.583333\\n224 220 0.25\\n224 219 0.25\\n224 218 0.583333\\n225 150 2.08333\\n225 96 0.333333\\n225 94 0.333333\\n225 151 0.75\\n227 226 1\\n229 228 1.33333\\n230 228 0.333333\\n230 229 0.333333\\n231 228 0.333333\\n231 229 0.333333\\n231 230 0.333333\\n234 233 0.5\\n235 233 0.5\\n235 234 0.5\\n235 72 1\\n238 237 1\\n240 239 1\\n241 239 1\\n243 242 1\\n245 244 3.5\\n246 244 1\\n247 244 1\\n249 248 0.5\\n250 248 0.5\\n250 249 0.5\\n251 217 0.25\\n251 216 0.25\\n251 218 0.25\\n252 217 0.25\\n252 216 0.5\\n252 251 0.25\\n252 218 0.25\\n255 254 1\\n256 254 0.5\\n256 255 0.5\\n259 258 1.33333\\n261 260 1\\n263 262 0.142857\\n264 262 0.142857\\n264 263 0.142857\\n265 262 0.142857\\n265 263 0.67619\\n265 264 0.142857\\n266 262 0.142857\\n266 263 0.67619\\n266 264 0.142857\\n266 265 0.92619\\n267 262 0.142857\\n267 263 0.142857\\n267 264 0.142857\\n267 265 0.142857\\n267 266 0.142857\\n268 262 0.142857\\n268 263 0.67619\\n268 264 0.142857\\n268 265 0.92619\\n268 266 0.92619\\n268 267 0.142857\\n269 262 0.142857\\n269 263 0.142857\\n269 264 0.142857\\n269 265 0.142857\\n269 266 0.142857\\n269 267 0.142857\\n269 268 0.142857\\n271 270 1\\n274 273 0.5\\n275 273 0.5\\n275 274 0.5\\n277 276 0.5\\n278 276 0.5\\n278 277 1\\n280 279 0.166667\\n281 279 0.166667\\n281 280 0.166667\\n281 78 1\\n281 150 1.83333\\n282 279 0.166667\\n282 280 0.166667\\n282 281 0.166667\\n283 279 0.166667\\n283 280 0.166667\\n283 281 3.16667\\n283 282 0.166667\\n284 279 0.166667\\n284 280 0.166667\\n284 281 0.166667\\n284 282 0.166667\\n284 283 0.166667\\n285 279 0.166667\\n285 280 0.166667\\n285 281 0.166667\\n285 282 0.166667\\n285 283 0.166667\\n285 284 0.166667\\n287 286 0.5\\n288 286 1\\n288 287 0.5\\n289 286 0.5\\n289 288 0.5\\n291 290 0.5\\n292 290 0.5\\n292 291 0.5\\n294 293 2.1\\n297 296 1\\n298 296 0.333333\\n299 296 0.333333\\n299 298 0.333333\\n300 296 1.33333\\n300 298 0.333333\\n300 299 0.333333\\n301 203 1.16667\\n301 150 0.5\\n301 151 0.5\\n301 162 0.25\\n302 301 1.33333\\n302 203 0.833333\\n303 301 0.333333\\n303 203 0.333333\\n303 302 0.333333\\n304 301 0.5\\n304 302 0.5\\n305 78 0.583333\\n306 305 0.25\\n306 78 0.25\\n307 305 0.25\\n307 306 0.25\\n307 78 0.25\\n307 265 0.25\\n307 266 0.25\\n307 268 0.25\\n308 305 0.583333\\n308 306 0.25\\n308 307 0.25\\n308 78 1.58333\\n309 305 0.333333\\n309 78 3.33333\\n309 308 2.33333\\n310 97 0.5\\n310 69 0.5\\n312 311 1\\n314 313 0.5\\n315 313 0.5\\n315 314 0.5\\n316 203 0.333333\\n316 301 0.583333\\n316 162 0.25\\n317 203 0.333333\\n317 316 0.333333\\n317 301 0.333333\\n319 318 1\\n321 320 0.833333\\n322 320 0.333333\\n322 321 0.333333\\n323 320 0.666667\\n323 321 0.333333\\n323 322 0.333333\\n324 320 0.333333\\n324 323 0.333333\\n325 320 0.333333\\n325 323 0.333333\\n325 324 0.333333\\n327 326 0.333333\\n327 30 0.333333\\n328 326 0.333333\\n328 327 1.16667\\n329 326 0.333333\\n329 327 0.333333\\n329 328 0.333333\\n330 151 0.5\\n331 330 0.5\\n331 151 0.5\\n333 332 0.333333\\n334 332 0.333333\\n334 333 0.333333\\n335 332 0.333333\\n335 333 0.333333\\n335 334 0.333333\\n337 336 1\\n339 338 0.333333\\n340 338 0.333333\\n340 339 0.333333\\n341 338 0.333333\\n341 339 1.33333\\n341 340 0.333333\\n343 342 0.5\\n343 221 0.333333\\n343 219 2.47619\\n344 342 0.5\\n344 343 0.5\\n345 252 0.25\\n345 216 0.583333\\n346 345 0.583333\\n346 252 0.25\\n346 216 0.916667\\n347 345 0.583333\\n347 346 0.583333\\n347 252 0.25\\n347 216 0.583333\\n349 348 0.2\\n350 348 0.2\\n350 349 0.2\\n351 348 0.2\\n351 349 0.2\\n351 350 0.2\\n352 348 0.2\\n352 349 0.2\\n352 350 0.2\\n352 351 0.2\\n353 348 0.2\\n353 349 0.2\\n353 350 0.2\\n353 351 0.2\\n353 352 0.2\\n355 354 0.5\\n356 354 0.5\\n356 355 0.5\\n358 357 0.833333\\n359 357 0.5\\n359 358 0.5\\n360 357 0.333333\\n360 358 0.333333\\n361 357 0.333333\\n361 360 0.333333\\n361 358 0.333333\\n362 62 0.2\\n363 362 1\\n364 362 0.5\\n365 362 0.5\\n365 364 0.5\\n367 366 0.5\\n368 366 0.5\\n368 367 0.5\\n369 24 0.5\\n369 25 0.5\\n370 78 0.5\\n371 370 0.5\\n371 78 2.5\\n371 309 0.5\\n373 372 0.5\\n374 372 0.5\\n374 373 0.5\\n375 33 0.25\\n376 375 1.91667\\n376 33 0.25\\n377 375 2.91667\\n377 376 1.91667\\n377 33 0.25\\n378 375 0.333333\\n378 376 0.333333\\n378 377 0.333333\\n380 379 0.5\\n381 379 0.5\\n381 380 0.5\\n383 382 0.5\\n384 382 0.5\\n384 383 0.5\\n386 385 0.142857\\n387 385 0.142857\\n387 386 0.142857\\n388 385 0.142857\\n388 386 0.142857\\n388 387 0.142857\\n389 385 0.142857\\n389 386 0.142857\\n389 387 0.142857\\n389 388 0.142857\\n390 385 0.142857\\n390 386 0.142857\\n390 387 0.142857\\n390 388 0.142857\\n390 389 0.142857\\n391 385 0.142857\\n391 386 0.142857\\n391 387 0.142857\\n391 388 0.142857\\n391 389 0.142857\\n391 390 0.142857\\n392 385 0.142857\\n392 386 0.142857\\n392 387 0.142857\\n392 388 0.142857\\n392 389 0.142857\\n392 390 0.142857\\n392 391 0.142857\\n394 393 0.333333\\n395 393 0.333333\\n395 394 0.333333\\n396 393 0.333333\\n396 394 0.333333\\n396 395 0.333333\\n398 397 0.333333\\n399 397 0.333333\\n399 398 0.333333\\n400 397 0.333333\\n400 398 0.333333\\n400 399 0.333333\\n401 277 0.166667\\n401 278 0.166667\\n402 401 0.166667\\n402 277 0.166667\\n402 278 0.166667\\n402 327 2.16667\\n402 328 0.333333\\n402 30 0.333333\\n403 401 0.166667\\n403 402 0.166667\\n403 277 0.5\\n403 278 0.5\\n404 401 0.166667\\n404 402 0.166667\\n404 277 0.166667\\n404 403 0.166667\\n404 278 0.166667\\n405 401 0.166667\\n405 402 0.166667\\n405 277 0.166667\\n405 403 0.166667\\n405 278 0.166667\\n405 404 0.166667\\n406 166 1\\n409 408 0.25\\n410 408 0.583333\\n410 409 0.25\\n411 408 0.25\\n411 409 0.25\\n411 410 0.25\\n412 408 0.583333\\n412 409 0.25\\n412 410 0.583333\\n412 411 0.25\\n413 408 0.333333\\n413 410 0.333333\\n413 412 0.333333\\n415 414 1\\n415 247 0.333333\\n416 402 0.833333\\n416 327 3.5\\n416 328 0.333333\\n417 402 1\\n417 327 1\\n419 418 1\\n421 319 1\\n423 422 0.5\\n424 422 0.5\\n424 423 0.5\\n426 425 0.5\\n427 425 0.5\\n427 426 0.5\\n428 46 1.33333\\n429 428 1\\n431 430 1\\n432 430 1\\n434 433 1\\n435 245 1\\n435 244 1\\n437 436 0.5\\n438 436 0.5\\n438 437 0.5\\n439 118 0.5\\n440 439 1\\n441 439 0.5\\n441 118 0.5\\n443 442 1\\n443 72 0.5\\n445 444 1\\n447 446 0.333333\\n448 446 0.333333\\n448 447 0.333333\\n449 446 0.333333\\n449 447 0.333333\\n449 448 0.333333\\n450 282 1\\n453 452 0.142857\\n454 452 0.142857\\n454 453 0.142857\\n455 452 0.142857\\n455 453 0.142857\\n455 454 0.142857\\n456 452 0.142857\\n456 453 0.142857\\n456 454 0.142857\\n456 455 0.142857\\n457 452 0.142857\\n457 453 0.142857\\n457 454 0.142857\\n457 455 0.142857\\n457 456 0.142857\\n458 452 0.142857\\n458 453 0.642857\\n458 454 0.142857\\n458 455 0.142857\\n458 456 0.142857\\n458 457 0.142857\\n459 452 0.142857\\n459 453 0.642857\\n459 454 0.142857\\n459 455 0.142857\\n459 456 0.142857\\n459 457 0.142857\\n459 458 0.642857\\n461 460 0.333333\\n462 460 0.333333\\n462 461 0.333333\\n463 460 0.333333\\n463 461 0.333333\\n463 462 0.333333\\n463 301 0.5\\n464 33 1\\n465 464 1.5\\n466 464 0.5\\n466 465 0.5\\n468 467 0.25\\n469 467 0.25\\n469 468 0.25\\n470 467 0.25\\n470 468 0.25\\n470 469 0.25\\n471 467 0.25\\n471 468 0.25\\n471 469 0.25\\n471 470 0.25\\n473 472 0.833333\\n473 222 0.5\\n473 219 0.5\\n474 472 0.5\\n474 473 0.5\\n476 475 1\\n477 475 0.5\\n478 475 0.5\\n478 477 0.5\\n480 479 0.333333\\n481 479 0.333333\\n481 480 0.333333\\n482 479 0.333333\\n482 480 0.333333\\n482 481 0.333333\\n484 483 1\\n485 33 1\\n487 486 1\\n488 33 0.333333\\n488 54 0.333333\\n489 488 0.333333\\n489 33 0.333333\\n489 54 0.333333\\n490 309 1.5\\n490 78 0.5\\n491 490 0.5\\n491 309 0.5\\n492 490 1\\n493 490 0.5\\n493 309 0.5\\n495 494 0.5\\n496 494 0.5\\n496 495 0.5\\n498 497 1\\n499 303 1\\n500 150 0.5\\n501 500 1\\n502 500 2.5\\n502 501 1\\n503 500 1.5\\n503 502 0.5\\n506 505 1\\n507 190 0.583333\\n507 33 0.583333\\n508 507 1.08333\\n508 190 0.583333\\n508 33 0.583333\\n509 507 0.75\\n509 508 0.75\\n509 190 0.25\\n509 33 0.25\\n512 511 1\\n513 245 0.5\\n513 244 0.5\\n515 514 0.833333\\n516 514 0.833333\\n516 515 2.33333\\n516 346 0.333333\\n516 216 0.333333\\n516 151 1.58333\\n516 150 1.08333\\n516 225 0.25\\n517 514 0.333333\\n517 515 0.333333\\n517 516 2.91667\\n517 151 2.25\\n517 150 1.58333\\n517 225 0.25\\n517 127 0.333333\\n517 152 1\\n519 518 1\\n521 520 1\\n522 76 1\\n523 522 0.25\\n524 522 0.25\\n524 523 0.25\\n525 522 0.25\\n525 523 0.25\\n525 524 0.25\\n526 522 0.25\\n526 523 0.25\\n526 524 0.25\\n526 525 0.25\\n527 522 2\\n529 528 1\\n531 530 0.533333\\n532 530 0.533333\\n532 531 0.533333\\n533 530 0.333333\\n533 531 0.333333\\n533 532 0.333333\\n535 534 1\\n538 537 0.5\\n539 537 0.833333\\n539 538 0.5\\n540 537 0.333333\\n541 537 0.333333\\n541 540 0.333333\\n542 537 0.333333\\n542 540 0.333333\\n542 541 0.333333\\n545 544 1\\n547 546 1\\n547 55 0.5\\n547 56 0.5\\n547 329 1.5\\n548 121 0.333333\\n549 548 0.333333\\n549 121 0.333333\\n550 548 0.333333\\n550 549 0.333333\\n550 121 1.83333\\n553 552 0.5\\n554 552 0.5\\n554 553 0.5\\n557 556 0.5\\n558 556 0.5\\n558 557 0.5\\n560 559 1\\n561 33 0.708333\\n561 53 0.708333\\n561 34 0.375\\n561 133 0.125\\n561 54 0.375\\n561 132 0.125\\n561 134 0.125\\n562 561 0.458333\\n562 33 0.458333\\n562 53 0.458333\\n562 34 0.125\\n562 133 0.125\\n562 54 0.125\\n562 132 0.125\\n562 134 0.125\\n563 82 1\\n564 563 0.333333\\n565 563 0.333333\\n565 564 0.333333\\n566 563 0.333333\\n566 564 0.333333\\n566 565 0.333333\\n567 189 2.33333\\n569 568 1\\n571 570 1\\n573 572 1\\n574 281 2.5\\n574 283 0.5\\n575 574 0.5\\n575 281 0.5\\n576 574 0.5\\n576 281 0.5\\n578 577 1\\n581 580 0.5\\n582 580 0.5\\n582 581 0.5\\n584 583 1\\n585 136 0.333333\\n586 585 0.333333\\n586 136 0.333333\\n587 585 0.333333\\n587 586 0.333333\\n587 136 1.83333\\n590 589 0.583333\\n590 307 1\\n591 589 0.583333\\n591 590 1.58333\\n592 589 0.333333\\n592 590 0.333333\\n592 591 0.333333\\n594 593 1\\n595 277 0.333333\\n595 403 0.333333\\n595 278 0.333333\\n596 327 0.5\\n596 416 0.5\\n596 46 1\\n598 597 1\\n600 599 1\\n603 602 1\\n606 275 0.333333\\n607 275 0.333333\\n607 606 0.333333\\n608 275 0.333333\\n608 606 0.333333\\n608 607 0.333333\\n609 45 0.833333\\n610 609 0.5\\n610 45 0.5\\n611 609 0.333333\\n611 45 0.333333\\n612 609 0.333333\\n612 45 0.333333\\n612 611 0.333333\\n615 614 1\\n617 616 1\\n619 618 0.5\\n620 618 0.5\\n620 619 0.5\\n622 621 1\\n624 623 1\\n626 625 0.333333\\n627 625 0.333333\\n627 626 0.333333\\n628 625 0.333333\\n628 626 0.333333\\n628 627 0.333333\\n630 629 0.5\\n631 629 0.5\\n631 630 1\\n631 337 0.2\\n633 632 1\\n636 635 0.5\\n637 635 0.5\\n637 636 0.5\\n638 162 0.25\\n638 316 0.25\\n638 301 0.75\\n638 463 0.5\\n639 638 0.25\\n639 162 0.25\\n639 316 0.25\\n639 301 0.25\\n640 638 1\\n641 78 1\\n643 642 1\\n646 78 2.5\\n648 647 1\\n650 189 0.333333\\n650 567 0.333333\\n651 650 0.333333\\n651 189 0.333333\\n651 567 0.333333\\n652 34 0.25\\n653 652 0.333333\\n654 652 2.08333\\n654 653 0.333333\\n654 34 1.25\\n654 55 0.333333\\n654 56 0.333333\\n655 652 2.08333\\n655 653 0.333333\\n655 654 2.08333\\n655 34 0.25\\n656 652 0.333333\\n656 654 0.333333\\n656 655 0.333333\\n657 652 0.583333\\n657 34 0.25\\n657 654 0.916667\\n657 655 0.583333\\n659 658 0.333333\\n660 658 0.333333\\n660 659 0.333333\\n661 658 0.333333\\n661 659 0.333333\\n661 660 0.333333\\n663 662 0.75\\n664 662 0.25\\n664 663 0.25\\n665 662 0.25\\n665 663 0.25\\n665 664 0.25\\n666 662 0.25\\n666 663 0.25\\n666 664 0.25\\n666 665 0.25\\n668 667 1\\n670 669 1\\n671 669 1\\n673 672 1\\n674 515 0.5\\n674 516 0.5\\n675 443 0.5\\n676 675 0.5\\n676 443 0.5\\n677 663 0.5\\n677 662 0.5\\n679 678 0.5\\n680 678 0.5\\n680 679 0.5\\n682 681 0.333333\\n683 681 0.333333\\n683 682 0.333333\\n684 681 0.333333\\n684 682 0.333333\\n684 683 0.333333\\n685 57 1\\n686 350 1\\n689 537 0.333333\\n689 539 0.333333\\n690 689 0.333333\\n690 537 0.333333\\n690 539 0.333333\\n692 342 1\\n694 693 0.2\\n695 693 0.2\\n695 694 0.2\\n696 693 0.2\\n696 694 0.2\\n696 695 0.2\\n697 693 1.2\\n697 694 0.2\\n697 695 0.2\\n697 696 0.2\\n697 219 0.142857\\n697 343 0.142857\\n698 693 0.2\\n698 694 0.2\\n698 695 0.2\\n698 696 0.2\\n698 697 0.2\\n699 445 1\\n700 96 0.333333\\n701 700 0.333333\\n701 96 0.333333\\n702 700 0.333333\\n702 96 0.333333\\n702 701 0.333333\\n705 704 0.333333\\n706 704 0.333333\\n706 705 0.333333\\n707 704 0.333333\\n707 705 0.333333\\n707 706 0.333333\\n708 97 0.583333\\n708 94 0.583333\\n708 96 0.583333\\n708 99 0.25\\n709 97 0.333333\\n709 69 0.666667\\n709 71 0.333333\\n709 72 0.333333\\n710 97 0.333333\\n710 709 0.333333\\n710 69 0.333333\\n711 87 0.5\\n711 88 0.5\\n712 642 0.5\\n713 712 0.5\\n713 642 0.5\\n715 695 0.25\\n716 695 0.25\\n716 715 0.25\\n717 695 0.25\\n717 715 0.25\\n717 716 0.25\\n718 695 0.25\\n718 715 0.25\\n718 716 0.25\\n718 717 0.25\\n720 719 2\\n721 670 1\\n724 723 0.333333\\n725 723 0.333333\\n725 724 0.333333\\n726 723 0.333333\\n726 724 0.333333\\n726 725 0.333333\\n729 136 0.5\\n729 587 0.5\\n731 730 1\\n733 732 0.5\\n734 732 0.5\\n734 733 0.5\\n736 71 0.5\\n737 736 0.5\\n737 71 0.5\\n738 443 0.5\\n738 72 0.5\\n739 443 1\\n742 293 0.9\\n742 294 1.9\\n742 523 0.333333\\n743 742 1.4\\n743 293 0.9\\n743 294 1.4\\n744 742 1.2\\n744 293 0.7\\n744 743 0.7\\n744 294 2.7\\n745 742 1\\n746 742 2.33333\\n746 294 0.333333\\n746 523 0.333333\\n748 747 1\\n751 750 1\\n752 719 0.5\\n753 752 0.5\\n753 719 0.5\\n755 754 1\\n756 34 0.5\\n756 78 0.5\\n757 756 0.5\\n757 69 0.75\\n757 72 0.25\\n758 756 0.5\\n758 757 1.25\\n758 69 0.75\\n758 72 0.25\\n759 756 1\\n759 78 0.5\\n759 371 0.5\\n760 756 1.5\\n760 34 0.5\\n761 756 1.86667\\n761 34 0.333333\\n762 756 0.333333\\n762 761 0.666667\\n762 34 0.333333\\n763 756 0.333333\\n763 761 0.666667\\n763 762 0.666667\\n763 34 0.333333\\n764 756 0.533333\\n764 761 0.533333\\n764 121 0.833333\\n765 756 0.533333\\n765 764 0.866667\\n765 761 0.533333\\n765 121 0.333333\\n767 766 0.333333\\n768 766 0.333333\\n768 767 0.333333\\n769 766 0.333333\\n769 767 0.333333\\n769 768 0.333333\\n770 127 0.2\\n770 126 0.2\\n771 770 0.2\\n771 127 0.2\\n771 126 0.2\\n772 770 0.2\\n772 771 0.2\\n772 127 0.2\\n772 126 0.2\\n773 770 0.2\\n773 771 0.2\\n773 127 0.2\\n773 772 0.2\\n773 126 0.2\\n774 761 1.33333\\n774 657 0.333333\\n774 654 0.333333\\n775 774 1.33333\\n775 761 1.53333\\n775 764 0.2\\n775 756 0.2\\n775 765 0.2\\n776 774 0.333333\\n776 761 0.333333\\n776 775 0.333333\\n778 777 1\\n780 496 0.5\\n781 780 0.5\\n781 496 0.5\\n783 631 1\\n784 631 0.5\\n784 783 0.5\\n786 785 0.5\\n787 785 0.5\\n787 786 0.5\\n788 346 0.333333\\n788 216 0.333333\\n788 516 0.333333\\n789 597 1\\n790 789 1\\n790 597 1\\n792 662 0.333333\\n793 792 0.333333\\n793 662 0.333333\\n794 792 0.333333\\n794 662 0.333333\\n794 793 0.333333\\n795 64 0.25\\n796 795 0.25\\n796 64 0.25\\n797 795 0.25\\n797 796 0.25\\n797 64 0.25\\n798 795 0.25\\n798 796 0.25\\n798 797 0.25\\n798 64 0.25\\n800 799 0.2\\n801 799 0.2\\n801 800 0.2\\n802 799 0.2\\n802 800 0.2\\n802 801 0.2\\n803 799 0.2\\n803 800 0.2\\n803 801 0.2\\n803 802 0.2\\n804 799 0.2\\n804 800 0.2\\n804 801 0.2\\n804 802 0.2\\n804 803 0.2\\n805 62 0.92619\\n805 362 0.2\\n806 805 0.92619\\n806 62 1.25952\\n806 362 0.2\\n807 805 0.92619\\n807 806 0.92619\\n807 62 0.92619\\n807 362 0.2\\n808 805 0.25\\n808 806 0.25\\n808 807 0.25\\n808 62 0.25\\n810 809 1\\n813 812 1\\n815 814 0.5\\n816 814 0.5\\n816 815 0.5\\n818 817 1\\n820 819 1\\n822 821 0.333333\\n823 821 0.333333\\n823 822 0.333333\\n824 821 0.333333\\n824 822 0.333333\\n824 823 0.333333\\n826 825 0.111111\\n827 825 0.111111\\n827 826 0.111111\\n828 825 0.111111\\n828 826 0.111111\\n828 827 0.111111\\n829 825 0.111111\\n829 826 0.111111\\n829 827 0.111111\\n829 828 0.111111\\n830 825 0.111111\\n830 826 0.111111\\n830 827 0.111111\\n830 828 0.111111\\n830 829 0.111111\\n831 825 0.111111\\n831 826 0.111111\\n831 827 0.111111\\n831 828 0.111111\\n831 829 0.111111\\n831 830 0.111111\\n832 825 0.111111\\n832 826 0.111111\\n832 827 0.111111\\n832 828 0.111111\\n832 829 0.111111\\n832 830 0.111111\\n832 831 0.111111\\n833 825 0.111111\\n833 826 0.111111\\n833 827 0.111111\\n833 828 0.111111\\n833 829 0.111111\\n833 830 0.111111\\n833 831 0.111111\\n833 832 0.111111\\n834 825 0.111111\\n834 826 0.111111\\n834 827 0.111111\\n834 828 0.111111\\n834 829 0.111111\\n834 830 0.111111\\n834 831 0.111111\\n834 832 0.111111\\n834 833 0.111111\\n836 835 0.5\\n837 835 0.5\\n837 836 0.5\\n839 34 0.333333\\n839 33 0.333333\\n839 54 0.333333\\n840 34 0.45\\n840 30 0.25\\n840 54 0.45\\n840 33 0.45\\n842 841 1.5\\n843 841 0.5\\n843 842 0.5\\n845 844 0.333333\\n846 844 0.333333\\n846 845 0.333333\\n847 844 0.333333\\n847 845 0.333333\\n847 846 0.333333\\n849 848 1\\n851 850 0.5\\n852 850 0.5\\n852 851 0.5\\n853 646 0.5\\n853 78 0.5\\n856 855 0.5\\n857 855 0.5\\n857 856 0.5\\n859 106 1\\n860 294 0.2\\n861 860 0.5\\n862 860 0.5\\n862 861 0.5\\n863 654 0.5\\n864 863 0.5\\n864 654 0.5\\n865 654 0.5\\n865 34 0.5\\n866 371 0.5\\n867 866 0.5\\n867 371 0.5\\n871 870 0.25\\n872 870 0.25\\n872 871 0.25\\n873 870 0.25\\n873 871 0.25\\n873 872 0.25\\n874 870 0.25\\n874 871 0.25\\n874 872 0.25\\n874 873 0.25\\n878 877 0.25\\n879 877 0.25\\n879 878 0.25\\n880 877 0.25\\n880 878 0.25\\n880 879 0.25\\n881 877 0.25\\n881 878 0.25\\n881 879 0.25\\n881 880 0.25\\n884 883 0.5\\n885 883 0.5\\n885 884 0.5\\n887 886 1\\n889 888 0.5\\n890 888 0.5\\n890 889 0.5\\n892 761 0.2\\n892 764 0.2\\n892 756 0.2\\n892 765 0.2\\n892 775 0.2\\n893 652 0.333333\\n893 654 0.666667\\n893 655 0.333333\\n893 55 0.333333\\n893 56 0.333333\\n894 402 0.333333\\n894 30 0.333333\\n894 327 0.333333\\n896 895 0.25\\n897 895 0.25\\n897 896 0.25\\n898 895 0.25\\n898 896 0.25\\n898 897 0.25\\n899 895 0.25\\n899 896 0.25\\n899 897 0.25\\n899 898 0.25\\n901 900 0.5\\n902 900 0.5\\n902 901 0.5\\n904 903 0.5\\n905 903 0.5\\n905 904 0.5\\n907 906 1\\n908 307 0.25\\n908 265 0.25\\n908 266 0.25\\n908 268 0.25\\n910 909 0.5\\n911 909 0.5\\n911 910 0.5\\n913 912 0.2\\n914 912 0.2\\n914 913 0.342857\\n915 912 0.2\\n915 913 0.342857\\n915 914 0.342857\\n916 912 0.2\\n916 913 0.985714\\n916 914 0.342857\\n916 915 0.342857\\n917 912 0.2\\n917 913 0.2\\n917 914 0.2\\n917 915 0.2\\n917 916 0.2\\n918 171 1\\n921 920 1\\n922 415 1\\n924 923 0.5\\n925 923 0.5\\n925 924 0.5\\n926 177 1\\n927 243 1.25\\n930 929 1\\n931 742 0.7\\n931 293 0.4\\n931 743 0.2\\n931 294 0.4\\n932 931 1.9\\n932 742 0.7\\n932 293 0.4\\n932 743 0.2\\n932 294 0.4\\n933 931 1\\n934 55 0.5\\n934 56 0.5\\n935 117 0.25\\n936 935 0.25\\n936 117 0.25\\n937 935 0.25\\n937 936 0.25\\n937 117 0.25\\n938 935 0.25\\n938 936 0.25\\n938 937 0.25\\n938 117 0.25\\n940 478 1\\n942 941 0.5\\n943 941 0.5\\n943 942 0.5\\n944 263 0.2\\n944 265 0.2\\n944 266 0.2\\n944 268 0.2\\n945 263 0.2\\n945 265 0.2\\n945 266 0.2\\n945 944 0.2\\n945 268 0.2\\n946 1 1\\n948 947 1\\n950 949 1\\n952 951 1.16667\\n953 951 1.16667\\n953 952 1.16667\\n954 951 0.666667\\n954 953 0.666667\\n954 952 0.666667\\n955 194 0.5\\n956 955 0.5\\n956 194 1.08333\\n958 957 0.5\\n959 957 0.5\\n959 958 0.5\\n961 960 0.5\\n962 960 0.5\\n962 961 0.5\\n963 517 0.333333\\n963 151 0.333333\\n964 963 0.333333\\n964 517 0.333333\\n964 151 0.333333\\n966 965 0.2\\n967 965 0.2\\n967 966 0.2\\n968 965 0.2\\n968 966 0.2\\n968 967 0.2\\n969 965 0.2\\n969 966 0.2\\n969 967 0.2\\n969 968 0.2\\n970 965 0.2\\n970 966 0.2\\n970 967 0.2\\n970 968 0.2\\n970 969 0.2\\n973 972 1\\n973 300 1\\n975 974 0.5\\n976 974 0.5\\n976 975 0.5\\n976 88 1\\n977 758 0.25\\n977 757 0.25\\n977 69 0.25\\n977 72 0.25\\n979 978 1\\n981 980 0.5\\n982 980 0.5\\n982 981 0.5\\n984 983 1\\n984 473 2.16667\\n984 472 0.333333\\n985 983 0.5\\n985 984 0.833333\\n985 473 0.333333\\n986 983 0.5\\n986 984 0.5\\n988 987 1\\n989 973 1\\n991 88 2\\n993 992 1\\n995 994 0.25\\n996 994 0.25\\n996 995 0.25\\n997 994 0.25\\n997 995 0.25\\n997 996 0.25\\n998 994 0.25\\n998 995 0.25\\n998 996 0.25\\n998 997 0.25\\n1000 999 1\\n1000 913 0.142857\\n1000 916 0.142857\\n1000 255 0.5\\n1000 254 0.5\\n1002 973 0.833333\\n1003 1002 0.833333\\n1003 973 0.833333\\n1004 1002 0.333333\\n1004 1003 0.333333\\n1004 973 0.333333\\n1005 78 1\\n1007 1006 1\\n1008 51 0.5\\n1008 33 0.5\\n1010 1009 1\\n1012 1011 1\\n1014 1013 1\\n1016 62 1.33333\\n1016 806 0.333333\\n1018 1017 1.2\\n1021 127 0.25\\n1021 128 0.75\\n1022 127 0.25\\n1022 128 0.25\\n1022 1021 0.25\\n1023 127 0.25\\n1023 128 1.75\\n1023 1021 0.75\\n1023 1022 0.25\\n1024 53 0.5\\n1025 1024 0.5\\n1025 53 0.5\\n1026 303 0.333333\\n1027 1026 1\\n1028 746 0.333333\\n1028 294 0.333333\\n1029 1028 0.333333\\n1029 746 0.333333\\n1029 294 0.333333\\n1030 550 0.5\\n1030 121 0.5\\n1032 1031 1\\n1034 1033 1\\n1036 1035 1\\n1037 1035 0.5\\n1038 1035 0.5\\n1038 1037 0.5\\n1039 308 0.5\\n1040 1039 0.5\\n1040 308 1.5\\n1041 224 0.333333\\n1041 218 0.333333\\n1041 216 0.333333\\n1043 1042 0.5\\n1044 1042 0.5\\n1044 1043 0.5\\n1045 1010 1\\n1046 482 1\\n1047 12 0.25\\n1048 1047 0.25\\n1048 12 0.25\\n1049 1047 0.25\\n1049 1048 0.25\\n1049 12 0.25\\n1050 1047 0.25\\n1050 1048 0.25\\n1050 1049 0.25\\n1050 12 0.25\\n1053 1052 1\\n1055 1054 1\\n1056 1054 0.333333\\n1057 1054 0.333333\\n1057 1056 0.333333\\n1058 1054 0.333333\\n1058 1056 0.333333\\n1058 1057 0.333333\\n1061 1060 0.111111\\n1062 1060 0.111111\\n1062 1061 0.111111\\n1063 1060 0.111111\\n1063 1061 0.111111\\n1063 1062 0.111111\\n1064 1060 0.111111\\n1064 1061 0.111111\\n1064 1062 0.111111\\n1064 1063 0.111111\\n1065 1060 0.111111\\n1065 1061 0.111111\\n1065 1062 0.111111\\n1065 1063 0.111111\\n1065 1064 0.111111\\n1066 1060 0.111111\\n1066 1061 0.111111\\n1066 1062 0.111111\\n1066 1063 0.111111\\n1066 1064 0.111111\\n1066 1065 0.111111\\n1067 1060 0.111111\\n1067 1061 0.111111\\n1067 1062 0.111111\\n1067 1063 0.111111\\n1067 1064 0.111111\\n1067 1065 0.111111\\n1067 1066 0.111111\\n1068 1060 0.111111\\n1068 1061 0.111111\\n1068 1062 0.111111\\n1068 1063 0.111111\\n1068 1064 0.111111\\n1068 1065 0.111111\\n1068 1066 0.111111\\n1068 1067 0.111111\\n1069 1060 0.111111\\n1069 1061 0.111111\\n1069 1062 0.111111\\n1069 1063 0.111111\\n1069 1064 0.111111\\n1069 1065 0.111111\\n1069 1066 0.111111\\n1069 1067 0.111111\\n1069 1068 0.111111\\n1070 806 0.142857\\n1070 805 0.142857\\n1070 807 0.142857\\n1070 62 0.142857\\n1071 806 0.67619\\n1071 805 0.342857\\n1071 807 0.342857\\n1071 1070 0.142857\\n1071 62 0.67619\\n1071 362 0.2\\n1071 1016 0.333333\\n1072 806 0.142857\\n1072 805 0.142857\\n1072 807 0.142857\\n1072 1070 0.142857\\n1072 1071 0.142857\\n1072 62 0.142857\\n1073 806 0.142857\\n1073 805 0.142857\\n1073 807 0.142857\\n1073 1070 0.142857\\n1073 1071 0.142857\\n1073 1072 0.142857\\n1073 62 0.142857\\n1074 227 1\\n1079 1078 1\\n1081 281 2\\n1082 69 0.5\\n1083 1082 0.5\\n1083 69 0.5\\n1084 0 0.5\\n1084 1 0.5\\n1086 516 0.5\\n1087 516 2.5\\n1087 1086 0.5\\n1088 516 1\\n1088 1087 0.5\\n1088 151 0.5\\n1089 516 0.5\\n1089 1087 0.5\\n1091 473 0.333333\\n1091 472 0.333333\\n1091 984 0.333333\\n1092 473 0.833333\\n1092 984 0.833333\\n1092 985 0.333333\\n1094 1093 0.333333\\n1095 1093 0.333333\\n1095 1094 0.333333\\n1096 1093 0.333333\\n1096 1094 0.333333\\n1096 1095 0.333333\\n1098 1097 0.5\\n1099 1097 0.5\\n1099 1098 0.5\\n1102 1101 0.5\\n1103 1101 0.5\\n1103 1102 0.5\\n1106 1105 0.125\\n1107 1105 0.125\\n1107 1106 0.125\\n1108 1105 0.125\\n1108 1106 0.125\\n1108 1107 0.125\\n1109 1105 0.125\\n1109 1106 0.125\\n1109 1107 0.125\\n1109 1108 0.125\\n1110 1105 0.125\\n1110 1106 0.125\\n1110 1107 0.125\\n1110 1108 0.125\\n1110 1109 0.125\\n1111 1105 0.125\\n1111 1106 0.125\\n1111 1107 0.125\\n1111 1108 0.125\\n1111 1109 0.125\\n1111 1110 0.125\\n1112 1105 0.125\\n1112 1106 0.125\\n1112 1107 0.125\\n1112 1108 0.125\\n1112 1109 0.125\\n1112 1110 0.125\\n1112 1111 0.125\\n1113 1105 0.125\\n1113 1106 0.125\\n1113 1107 0.125\\n1113 1108 0.125\\n1113 1109 0.125\\n1113 1110 0.125\\n1113 1111 0.125\\n1113 1112 0.125\\n1115 1114 1\\n1117 1116 0.25\\n1118 1116 0.25\\n1118 1117 0.25\\n1119 1116 0.25\\n1119 1117 0.25\\n1119 1118 0.25\\n1120 1116 0.25\\n1120 1117 0.25\\n1120 1118 0.25\\n1120 1119 0.25\\n1121 78 0.5\\n1122 78 0.5\\n1122 1121 0.5\\n1123 78 0.5\\n1123 756 0.5\\n1124 247 0.333333\\n1124 415 0.333333\\n1125 1124 0.333333\\n1125 247 0.333333\\n1125 415 0.333333\\n1128 1127 1\\n1129 976 1\\n1130 657 0.333333\\n1130 774 0.333333\\n1130 654 0.833333\\n1130 34 0.5\\n1132 1131 1\\n1134 1133 1\\n1135 956 0.583333\\n1135 194 0.583333\\n1136 1135 0.25\\n1136 956 0.25\\n1136 194 0.25\\n1137 1135 0.25\\n1137 1136 0.25\\n1137 956 0.25\\n1137 194 0.25\\n1138 1135 0.333333\\n1138 194 0.333333\\n1138 956 0.333333\\n1140 1139 1\\n1142 1141 1\\n1145 221 0.333333\\n1145 343 1.47619\\n1145 219 2.14286\\n1145 697 0.142857\\n1147 1146 0.25\\n1148 1146 0.25\\n1148 1147 0.25\\n1149 1146 0.25\\n1149 1147 0.25\\n1149 1148 0.25\\n1150 1146 0.25\\n1150 1147 0.25\\n1150 1148 0.25\\n1150 1149 0.25\\n1153 1152 0.125\\n1154 1152 0.125\\n1154 1153 0.125\\n1155 1152 0.125\\n1155 1153 0.125\\n1155 1154 0.125\\n1156 1152 0.125\\n1156 1153 0.125\\n1156 1154 0.125\\n1156 1155 0.125\\n1157 1152 0.125\\n1157 1153 0.125\\n1157 1154 0.125\\n1157 1155 0.125\\n1157 1156 0.125\\n1158 1152 0.125\\n1158 1153 0.125\\n1158 1154 0.125\\n1158 1155 0.125\\n1158 1156 0.125\\n1158 1157 0.125\\n1159 1152 0.125\\n1159 1153 0.125\\n1159 1154 0.125\\n1159 1155 0.125\\n1159 1156 0.125\\n1159 1157 0.125\\n1159 1158 0.125\\n1160 1152 0.125\\n1160 1153 0.125\\n1160 1154 0.125\\n1160 1155 0.125\\n1160 1156 0.125\\n1160 1157 0.125\\n1160 1158 0.125\\n1160 1159 0.125\\n1162 114 0.5\\n1162 186 1.25\\n1163 114 0.5\\n1163 1162 0.5\\n1165 1164 1\\n1166 259 0.333333\\n1166 258 0.333333\\n1167 259 0.333333\\n1167 258 0.333333\\n1167 1166 0.333333\\n1169 1168 1\\n1170 820 1\\n1172 78 1\\n1175 931 0.5\\n1176 1175 0.5\\n1176 931 0.5\\n1177 150 0.5\\n1177 96 0.5\\n1178 150 0.833333\\n1178 281 0.833333\\n1180 589 0.25\\n1180 590 0.25\\n1180 591 0.25\\n1181 1180 0.25\\n1181 589 0.25\\n1181 590 0.25\\n1181 591 0.25\\n1182 302 1\\n1185 1184 0.5\\n1186 1184 0.5\\n1186 1185 0.5\\n1189 327 0.5\\n1189 328 0.5\\n1190 54 0.2\\n1190 34 0.2\\n1190 840 0.2\\n1190 33 0.2\\n1191 1190 0.2\\n1191 54 0.2\\n1191 34 0.2\\n1191 840 0.2\\n1191 33 0.2\\n1194 1193 1\\n1195 78 0.333333\\n1196 1195 0.333333\\n1196 78 0.333333\\n1197 1195 0.333333\\n1197 1196 0.333333\\n1197 78 0.333333\\n1199 1198 0.5\\n1200 1198 0.5\\n1200 1199 0.5\\n1201 913 0.785714\\n1201 916 1.11905\\n1201 1000 0.142857\\n1201 914 0.142857\\n1201 915 0.142857\\n1202 913 0.142857\\n1202 916 0.142857\\n1202 1201 0.142857\\n1202 1000 0.142857\\n1203 913 0.142857\\n1203 916 0.142857\\n1203 1201 0.142857\\n1203 1202 0.142857\\n1203 1000 0.142857\\n1204 913 0.142857\\n1204 916 0.142857\\n1204 1201 0.142857\\n1204 1202 0.142857\\n1204 1203 0.142857\\n1204 1000 0.142857\\n1205 913 0.142857\\n1205 916 0.142857\\n1205 1201 0.142857\\n1205 1202 0.142857\\n1205 1203 0.142857\\n1205 1204 0.142857\\n1205 1000 0.142857\\n1206 913 0.142857\\n1206 916 0.142857\\n1206 1201 0.142857\\n1206 914 0.142857\\n1206 915 0.142857\\n1207 913 0.142857\\n1207 1206 0.142857\\n1207 916 0.142857\\n1207 1201 0.142857\\n1207 914 0.142857\\n1207 915 0.142857\\n1208 913 0.142857\\n1208 1206 0.142857\\n1208 916 0.142857\\n1208 1201 0.142857\\n1208 914 0.142857\\n1208 1207 0.142857\\n1208 915 0.142857\\n1210 1209 0.333333\\n1211 1209 0.333333\\n1211 1210 0.333333\\n1212 1209 0.333333\\n1212 1210 0.333333\\n1212 1211 0.333333\\n1214 330 0.25\\n1215 1214 0.25\\n1215 330 0.25\\n1216 1214 0.25\\n1216 330 0.25\\n1216 1215 0.25\\n1217 1214 0.25\\n1217 330 0.25\\n1217 1215 0.25\\n1217 1216 0.25\\n1219 1218 1\\n1221 500 0.5\\n1221 150 0.5\\n1223 1222 0.5\\n1224 1222 0.5\\n1224 1223 0.5\\n1226 1225 1\\n1227 1225 1\\n1228 132 0.25\\n1228 54 0.25\\n1228 33 0.25\\n1229 132 0.25\\n1229 1228 0.25\\n1229 54 0.25\\n1229 33 0.25\\n1230 244 1\\n1232 1231 1\\n1233 415 0.5\\n1234 1233 0.5\\n1234 415 0.5\\n1235 481 0.5\\n1236 1235 0.5\\n1236 481 0.5\\n1238 1237 1\\n1239 547 1\\n1241 1240 1\\n1243 1242 1\\n1244 482 0.25\\n1245 1244 0.25\\n1245 482 0.25\\n1246 1244 0.25\\n1246 1245 0.25\\n1246 482 0.25\\n1247 1244 0.25\\n1247 1245 0.25\\n1247 1246 0.25\\n1247 482 0.25\\n1249 1248 1\\n1250 481 0.5\\n1251 1250 0.5\\n1251 481 0.5\\n1253 1252 0.5\\n1254 1252 1.5\\n1254 1253 0.5\\n1255 764 0.833333\\n1255 765 0.333333\\n1255 121 0.833333\\n1256 1201 0.333333\\n1256 916 0.333333\\n1257 1201 0.333333\\n1257 1256 0.333333\\n1257 916 0.333333\\n1259 1258 1\\n1261 1260 0.5\\n1262 1260 0.5\\n1262 1261 0.5\\n1263 375 0.333333\\n1263 376 0.333333\\n1263 377 0.333333\\n1265 1264 0.333333\\n1266 1264 0.333333\\n1266 1265 0.333333\\n1267 1264 0.333333\\n1267 1265 0.333333\\n1267 1266 0.333333\\n1268 872 1\\n1270 320 0.5\\n1270 321 0.5\\n1271 947 0.5\\n1272 1271 0.5\\n1272 947 0.5\\n1273 843 0.75\\n1274 1273 0.75\\n1274 843 0.75\\n1275 1273 0.25\\n1275 1274 0.25\\n1275 843 0.25\\n1276 1273 0.25\\n1276 1274 0.25\\n1276 843 0.25\\n1276 1275 0.25\\n1278 744 0.7\\n1278 294 0.7\\n1278 743 0.2\\n1278 742 0.2\\n1278 293 0.2\\n1279 744 0.333333\\n1280 744 0.333333\\n1280 1279 0.333333\\n1281 744 0.333333\\n1281 1279 0.333333\\n1281 1280 0.333333\\n1282 1145 0.333333\\n1282 219 0.333333\\n1283 1282 0.333333\\n1283 1145 0.333333\\n1283 219 0.333333\\n1287 1286 0.25\\n1288 1286 0.25\\n1288 1287 0.25\\n1289 1286 0.25\\n1289 1287 0.25\\n1289 1288 0.25\\n1290 1286 0.25\\n1290 1287 0.25\\n1290 1288 0.25\\n1290 1289 0.25\\n1293 1292 0.5\\n1294 1292 0.5\\n1294 1293 0.5\\n1295 375 0.25\\n1295 376 0.25\\n1295 33 0.25\\n1295 377 0.25\\n1299 1298 1\\n1303 1018 0.5\\n1304 1018 0.5\\n1304 1303 0.5\\n1305 1018 1\\n1306 1018 0.2\\n1306 1017 0.2\\n1307 1018 0.2\\n1307 1306 0.2\\n1307 1017 0.2\\n1308 1018 0.2\\n1308 1306 0.2\\n1308 1307 0.2\\n1308 1017 0.2\\n1309 1018 0.2\\n1309 1306 0.2\\n1309 1307 0.2\\n1309 1308 0.2\\n1309 1017 0.2\\n1311 1310 1\\n1313 1312 0.25\\n1314 1312 0.25\\n1314 1313 0.25\\n1315 1312 0.25\\n1315 1313 0.25\\n1315 1314 0.25\\n1315 53 0.25\\n1316 1312 0.25\\n1316 1313 0.25\\n1316 1314 0.25\\n1316 1315 0.25\\n1318 900 1\\n1321 1320 1\\n1322 524 1\\n1324 1323 0.5\\n1325 1323 0.5\\n1325 1324 0.5\\n1327 1326 1\\n1329 1328 1\\n1332 1331 0.5\\n1333 1331 0.5\\n1333 1332 0.5\\n1336 1335 0.333333\\n1337 1335 0.333333\\n1337 1336 0.333333\\n1338 1335 0.333333\\n1338 1336 0.333333\\n1338 1337 0.333333\\n1339 882 1\\n1341 517 1\\n1342 281 0.333333\\n1342 150 0.333333\\n1342 1178 0.333333\\n1343 281 0.5\\n1344 281 0.5\\n1344 1343 0.5\\n1345 1225 1\\n1346 721 1\\n1347 377 0.5\\n1348 1347 0.5\\n1348 377 0.5\\n1349 362 0.25\\n1350 1349 0.25\\n1350 362 0.25\\n1351 1349 0.25\\n1351 1350 0.25\\n1351 362 0.25\\n1352 1349 0.25\\n1352 1350 0.25\\n1352 1351 0.25\\n1352 362 0.25\\n1355 1354 1\\n1356 523 0.333333\\n1356 746 0.333333\\n1356 742 0.333333\\n1356 931 1\\n1357 1356 1\\n1357 1107 0.333333\\n1358 1356 1\\n1358 1357 2.33333\\n1358 1107 0.333333\\n1359 1356 1\\n1361 46 1.33333\\n1361 428 0.333333\\n1362 46 0.333333\\n1362 1361 0.333333\\n1362 428 0.333333\\n1363 46 1\\n1364 1286 0.25\\n1365 1364 0.25\\n1365 1286 0.25\\n1366 1364 0.25\\n1366 1365 0.25\\n1366 1286 0.25\\n1367 1364 0.25\\n1367 1365 0.25\\n1367 1366 0.25\\n1367 1286 0.25\\n1368 932 0.2\\n1368 293 0.2\\n1368 294 0.2\\n1368 931 0.2\\n1369 932 0.2\\n1369 1368 0.2\\n1369 293 0.2\\n1369 294 0.2\\n1369 931 0.2\\n1371 1370 1\\n1373 1372 1\\n1375 1374 0.5\\n1376 1374 0.5\\n1376 1375 0.5\\n1377 1294 0.5\\n1378 1377 0.5\\n1378 1294 0.5\\n1381 522 0.5\\n1381 76 0.5\\n1384 194 0.5\\n1385 1384 0.5\\n1385 194 0.5\\n1387 1386 1\\n1389 329 1.5\\n1389 547 0.5\\n1391 1390 0.5\\n1392 1390 0.5\\n1392 1391 0.5\\n1394 1145 0.142857\\n1394 219 0.142857\\n1394 343 0.142857\\n1394 697 0.142857\\n1395 1394 0.142857\\n1395 1145 0.142857\\n1395 219 0.142857\\n1395 343 0.142857\\n1395 697 0.142857\\n1396 1394 0.142857\\n1396 1145 0.142857\\n1396 1395 0.142857\\n1396 219 0.142857\\n1396 343 0.142857\\n1396 697 0.142857\\n1397 1394 0.142857\\n1397 1145 0.142857\\n1397 1395 0.142857\\n1397 219 0.142857\\n1397 343 0.142857\\n1397 1396 0.142857\\n1397 697 0.142857\\n1398 314 1\\n1400 1399 0.25\\n1401 1399 0.25\\n1401 1400 0.25\\n1402 1399 0.25\\n1402 1400 0.25\\n1402 1401 0.25\\n1403 1399 0.25\\n1403 1400 0.25\\n1403 1401 0.25\\n1403 1402 0.25\\n1404 327 0.166667\\n1404 416 0.166667\\n1405 1404 0.166667\\n1405 327 0.166667\\n1405 416 0.166667\\n1406 1404 0.166667\\n1406 1405 0.166667\\n1406 327 0.166667\\n1406 416 0.166667\\n1407 1404 0.166667\\n1407 1405 0.166667\\n1407 327 0.166667\\n1407 1406 0.166667\\n1407 416 0.166667\\n1408 1404 0.166667\\n1408 1405 0.166667\\n1408 327 0.166667\\n1408 1406 0.166667\\n1408 416 0.166667\\n1408 1407 0.166667\\n1409 496 0.5\\n1410 1409 0.5\\n1410 496 0.5\\n1411 1357 0.333333\\n1411 1107 0.333333\\n1411 1358 0.333333\\n1412 1060 1\\n1413 186 0.25\\n1413 1162 0.25\\n1414 186 0.25\\n1414 1413 0.25\\n1414 1162 0.25\\n1415 186 0.25\\n1415 1413 0.25\\n1415 1162 0.25\\n1415 1414 0.25\\n1416 303 0.333333\\n1416 1026 0.333333\\n1417 1416 0.333333\\n1417 303 0.333333\\n1417 1026 0.333333\\n1418 930 1\\n1419 1336 1\\n1421 1420 0.333333\\n1422 1420 0.333333\\n1422 1421 0.333333\\n1423 1420 0.333333\\n1423 1421 0.333333\\n1423 1422 0.333333\\n1424 9 0.5\\n1425 1424 0.5\\n1425 9 1.5\\n1427 1426 0.5\\n1428 1426 0.5\\n1428 1427 0.5\\n1429 645 0.0526316\\n1430 1429 0.385965\\n1430 645 0.0526316\\n1431 1429 0.385965\\n1431 645 0.0526316\\n1431 1430 0.385965\\n1432 1429 0.0526316\\n1432 645 0.0526316\\n1432 1430 0.0526316\\n1432 1431 0.0526316\\n1433 1429 0.0526316\\n1433 645 0.0526316\\n1433 1430 0.0526316\\n1433 1431 0.0526316\\n1433 1432 0.0526316\\n1434 1429 0.0526316\\n1434 645 0.0526316\\n1434 1430 0.0526316\\n1434 1431 0.0526316\\n1434 1432 0.0526316\\n1434 1433 0.0526316\\n1435 1429 0.0526316\\n1435 645 0.0526316\\n1435 1430 0.0526316\\n1435 1431 0.0526316\\n1435 1432 0.0526316\\n1435 1433 0.0526316\\n1435 1434 0.0526316\\n1436 1429 0.0526316\\n1436 645 0.0526316\\n1436 1430 0.0526316\\n1436 1431 0.0526316\\n1436 1432 0.0526316\\n1436 1433 0.0526316\\n1436 1434 0.0526316\\n1436 1435 0.0526316\\n1437 1429 0.0526316\\n1437 645 0.0526316\\n1437 1430 0.0526316\\n1437 1431 0.0526316\\n1437 1432 0.0526316\\n1437 1433 0.0526316\\n1437 1434 0.0526316\\n1437 1435 0.0526316\\n1437 1436 0.0526316\\n1438 1429 0.0526316\\n1438 645 0.0526316\\n1438 1430 0.0526316\\n1438 1431 0.0526316\\n1438 1432 0.0526316\\n1438 1433 0.0526316\\n1438 1434 0.0526316\\n1438 1435 0.0526316\\n1438 1436 0.0526316\\n1438 1437 0.0526316\\n1439 1429 0.0526316\\n1439 645 0.0526316\\n1439 1430 0.0526316\\n1439 1431 0.0526316\\n1439 1432 0.0526316\\n1439 1433 0.0526316\\n1439 1434 0.0526316\\n1439 1435 0.0526316\\n1439 1436 0.0526316\\n1439 1437 0.0526316\\n1439 1438 0.0526316\\n1440 1429 0.0526316\\n1440 645 0.0526316\\n1440 1430 0.0526316\\n1440 1431 0.0526316\\n1440 1432 0.0526316\\n1440 1433 0.0526316\\n1440 1434 0.0526316\\n1440 1435 0.0526316\\n1440 1436 0.0526316\\n1440 1437 0.0526316\\n1440 1438 0.0526316\\n1440 1439 0.0526316\\n1441 1429 0.0526316\\n1441 645 0.0526316\\n1441 1430 0.0526316\\n1441 1431 0.0526316\\n1441 1432 0.0526316\\n1441 1433 0.0526316\\n1441 1434 0.0526316\\n1441 1435 0.0526316\\n1441 1436 0.0526316\\n1441 1437 0.0526316\\n1441 1438 0.0526316\\n1441 1439 0.0526316\\n1441 1440 0.0526316\\n1442 1429 0.0526316\\n1442 645 0.0526316\\n1442 1430 0.0526316\\n1442 1431 0.0526316\\n1442 1432 0.0526316\\n1442 1433 0.0526316\\n1442 1434 0.0526316\\n1442 1435 0.0526316\\n1442 1436 0.0526316\\n1442 1437 0.0526316\\n1442 1438 0.0526316\\n1442 1439 0.0526316\\n1442 1440 0.0526316\\n1442 1441 0.0526316\\n1443 1429 0.0526316\\n1443 645 0.0526316\\n1443 1430 0.0526316\\n1443 1431 0.0526316\\n1443 1432 0.0526316\\n1443 1433 0.0526316\\n1443 1434 0.0526316\\n1443 1435 0.0526316\\n1443 1436 0.0526316\\n1443 1437 0.0526316\\n1443 1438 0.0526316\\n1443 1439 0.0526316\\n1443 1440 0.0526316\\n1443 1441 0.0526316\\n1443 1442 0.0526316\\n1444 1429 0.0526316\\n1444 645 0.0526316\\n1444 1430 0.0526316\\n1444 1431 0.0526316\\n1444 1432 0.0526316\\n1444 1433 0.0526316\\n1444 1434 0.0526316\\n1444 1435 0.0526316\\n1444 1436 0.0526316\\n1444 1437 0.0526316\\n1444 1438 0.0526316\\n1444 1439 0.0526316\\n1444 1440 0.0526316\\n1444 1441 0.0526316\\n1444 1442 0.0526316\\n1444 1443 0.0526316\\n1445 1429 0.0526316\\n1445 645 0.0526316\\n1445 1430 0.0526316\\n1445 1431 0.0526316\\n1445 1432 0.0526316\\n1445 1433 0.0526316\\n1445 1434 0.0526316\\n1445 1435 0.0526316\\n1445 1436 0.0526316\\n1445 1437 0.0526316\\n1445 1438 0.0526316\\n1445 1439 0.0526316\\n1445 1440 0.0526316\\n1445 1441 0.0526316\\n1445 1442 0.0526316\\n1445 1443 0.0526316\\n1445 1444 0.0526316\\n1446 1429 0.0526316\\n1446 645 0.0526316\\n1446 1430 0.0526316\\n1446 1431 0.0526316\\n1446 1432 0.0526316\\n1446 1433 0.0526316\\n1446 1434 0.0526316\\n1446 1435 0.0526316\\n1446 1436 0.0526316\\n1446 1437 0.0526316\\n1446 1438 0.0526316\\n1446 1439 0.0526316\\n1446 1440 0.0526316\\n1446 1441 0.0526316\\n1446 1442 0.0526316\\n1446 1443 0.0526316\\n1446 1444 0.0526316\\n1446 1445 0.0526316\\n1447 1429 0.0526316\\n1447 645 0.0526316\\n1447 1430 0.0526316\\n1447 1431 0.0526316\\n1447 1432 0.0526316\\n1447 1433 0.0526316\\n1447 1434 0.0526316\\n1447 1435 0.0526316\\n1447 1436 0.0526316\\n1447 1437 0.0526316\\n1447 1438 0.0526316\\n1447 1439 0.0526316\\n1447 1440 0.0526316\\n1447 1441 0.0526316\\n1447 1442 0.0526316\\n1447 1443 0.0526316\\n1447 1444 0.0526316\\n1447 1445 0.0526316\\n1447 1446 0.0526316\\n1448 1429 0.333333\\n1448 1430 0.333333\\n1448 1431 0.333333\\n1450 1449 1\\n1451 283 0.5\\n1451 281 0.5\\n1452 216 1\\n1453 1360 1\\n1454 721 1\\n1455 482 1\\n1457 1456 0.333333\\n1458 1456 0.333333\\n1458 1457 0.333333\\n1459 1456 0.333333\\n1459 1457 0.333333\\n1459 1458 0.333333\\n1460 517 0.333333\\n1460 127 0.333333\\n1460 151 0.333333\\n1461 55 0.5\\n1461 56 0.5\\n1464 860 0.2\\n1464 294 0.2\\n1465 1464 0.2\\n1465 860 0.2\\n1465 294 0.2\\n1466 1464 0.2\\n1466 1465 0.2\\n1466 860 0.2\\n1466 294 0.2\\n1467 1464 0.2\\n1467 1465 0.2\\n1467 860 0.2\\n1467 1466 0.2\\n1467 294 0.2\\n1468 53 0.25\\n1468 1315 0.25\\n1469 53 0.25\\n1469 1468 0.25\\n1469 1315 0.25\\n1470 53 0.25\\n1470 1468 0.25\\n1470 1315 0.25\\n1470 1469 0.25\\n1472 1471 0.5\\n1473 1471 0.5\\n1473 1472 0.5\\n1475 1474 0.5\\n1476 1474 0.5\\n1476 1475 0.5\\n1477 207 0.5\\n1478 1477 0.5\\n1478 207 0.5\\n1480 1479 1\\n1481 96 0.5\\n1482 1481 0.5\\n1482 96 0.5\\n1484 1483 0.5\\n1485 1483 0.5\\n1485 1484 0.5\\n1487 1486 1\\n1488 1142 0.5\\n1489 1488 0.5\\n1489 1142 0.5\\n1492 1491 1\\n1493 1491 0.25\\n1494 1493 1\\n1496 1495 1\\n1497 300 1\\n1498 82 1\\n1500 239 0.25\\n1501 1500 0.25\\n1501 239 0.25\\n1502 1500 0.25\\n1502 1501 0.25\\n1502 239 0.25\\n1503 1500 0.25\\n1503 1501 0.25\\n1503 239 0.25\\n1503 1502 0.25\\n1504 1000 0.5\\n1505 1504 0.2\\n1506 1504 0.2\\n1506 1505 0.2\\n1507 1504 0.2\\n1507 1505 0.2\\n1507 1506 0.2\\n1508 1504 0.2\\n1508 1505 0.2\\n1508 1506 0.2\\n1508 1507 0.2\\n1509 1504 0.2\\n1509 1505 0.2\\n1509 1506 0.2\\n1509 1507 0.2\\n1509 1508 0.2\\n1512 1511 0.5\\n1513 1511 0.5\\n1513 1512 0.5\\n1514 1000 0.5\\n1514 1504 0.5\\n1515 1120 0.333333\\n1516 1120 0.333333\\n1516 1515 0.333333\\n1517 1120 0.333333\\n1517 1515 0.333333\\n1517 1516 0.333333\\n1518 243 0.25\\n1518 927 0.25\\n1519 1518 0.25\\n1519 243 0.25\\n1519 927 0.25\\n1520 1518 0.25\\n1520 1519 0.25\\n1520 243 0.25\\n1520 927 0.25\\n1523 1522 1\\n1526 1525 1\\n1529 54 0.5\\n1529 33 0.5\\n1531 1530 1\\n1532 9 1\\n1533 532 0.2\\n1533 531 0.2\\n1533 530 0.2\\n1534 532 0.2\\n1534 1533 0.2\\n1534 531 0.2\\n1534 530 0.2\\n1535 532 0.2\\n1535 1533 0.2\\n1535 1534 0.2\\n1535 531 0.2\\n1535 530 0.2\\n1536 843 1\\n1538 1537 0.5\\n1539 1537 0.5\\n1539 1538 0.5\\n1540 1493 0.25\\n1540 1491 0.25\\n1541 1540 0.25\\n1541 1493 0.25\\n1541 1491 0.25\\n1542 1540 0.25\\n1542 1541 0.25\\n1542 1493 0.25\\n1542 1491 0.25\\n1544 1543 1\\n1546 1545 0.333333\\n1547 1545 0.333333\\n1547 1546 0.333333\\n1548 1545 0.333333\\n1548 1546 0.333333\\n1548 1547 0.333333\\n1549 308 1\\n1550 34 0.833333\\n1550 33 1.33333\\n1550 54 0.5\\n1551 1550 0.333333\\n1551 34 0.333333\\n1551 33 0.333333\\n1553 294 0.333333\\n1554 294 0.333333\\n1554 1553 0.333333\\n1555 294 0.333333\\n1555 1553 0.333333\\n1555 1554 0.333333\\n1556 676 0.333333\\n1557 1556 0.333333\\n1557 676 0.333333\\n1558 1556 0.333333\\n1558 676 0.333333\\n1558 1557 0.333333\\n1560 1145 0.333333\\n1560 219 0.333333\\n1561 1560 0.333333\\n1561 1145 0.333333\\n1561 219 0.333333\\n1562 63 0.142857\\n1562 62 0.142857\\n1563 1562 0.142857\\n1563 63 0.142857\\n1563 62 0.142857\\n1564 1562 0.142857\\n1564 1563 0.142857\\n1564 63 0.142857\\n1564 62 0.142857\\n1565 1562 0.142857\\n1565 1563 0.142857\\n1565 1564 0.142857\\n1565 63 0.142857\\n1565 62 0.142857\\n1566 1562 0.142857\\n1566 1563 0.142857\\n1566 1564 0.142857\\n1566 1565 0.142857\\n1566 63 0.142857\\n1566 62 0.142857\\n1567 1562 0.142857\\n1567 1563 0.142857\\n1567 1564 0.142857\\n1567 1565 0.142857\\n1567 1566 0.142857\\n1567 63 0.142857\\n1567 62 0.142857\\n1569 1568 1\\n1570 337 0.2\\n1570 631 0.2\\n1571 337 0.2\\n1571 631 0.2\\n1571 1570 0.2\\n1572 337 0.2\\n1572 631 0.2\\n1572 1570 0.2\\n1572 1571 0.2\\n1573 337 0.2\\n1573 631 0.2\\n1573 1570 0.2\\n1573 1571 0.2\\n1573 1572 0.2\\n1574 631 0.5\\n1574 783 0.5\\n1576 1575 0.333333\\n1577 1575 0.333333\\n1577 1576 0.333333\\n1578 1575 0.333333\\n1578 1576 0.333333\\n1578 1577 0.333333\\n1579 631 0.5\\n1579 630 0.5\\n1581 1580 1\\n1584 1583 1\\n1586 1585 1\\n1587 1585 1\\n1588 522 0.5\\n1588 76 0.5\";\n  var nodes = new Set();\n  var edges = [];\n  rawData.split('\\n').forEach(function (line) {\n    var d = line.split(' ');\n    var u = d[0];\n    var v = d[1];\n    var weight = parseFloat(d[2]);\n    nodes.add(u);\n    nodes.add(v);\n    edges.push({\n      source: \"\".concat(u),\n      target: \"\".concat(v),\n      value: weight\n    });\n  });\n  var data = {\n    nodes: Array.from(nodes).map(function (u) {\n      return {\n        id: \"\".concat(u),\n        label: \"\".concat(u)\n      };\n    }),\n    edges: edges\n  };\n  var kernel;\n\n  var App = /*#__PURE__*/_react.default.memo(function BellmanFord() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeElapsed = _useState2[0],\n        setTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        datasource = _useState4[0],\n        setDatasource = _useState4[1]; // @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\n\n\n    var buildTextureData = function buildTextureData(nodes, edges, sourceNodeIdx) {\n      var dataArray = [];\n      var nodeDict = [];\n      var mapIdPos = {};\n      var i = 0;\n\n      for (i = 0; i < nodes.length; i++) {\n        var n = nodes[i];\n        mapIdPos[n.id] = i;\n\n        if (i === sourceNodeIdx) {\n          dataArray.push(0); // distance\n        } else {\n          dataArray.push(10000); // Infinity\n        }\n\n        dataArray.push(-1); // predecessor\n\n        dataArray.push(0); // offset\n\n        dataArray.push(0); // outputing edge length\n\n        nodeDict.push([]);\n      }\n\n      for (i = 0; i < edges.length; i++) {\n        var e = edges[i];\n        nodeDict[mapIdPos[e.source]].push({\n          target: mapIdPos[e.target],\n          weight: e.value\n        }); // lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n      }\n\n      var maxEdgePerVetex = 0;\n\n      for (i = 0; i < nodes.length; i++) {\n        var offset = dataArray.length;\n        var dests = nodeDict[i];\n        var len = dests.length;\n        dataArray[i * 4 + 2] = offset;\n        dataArray[i * 4 + 3] = dests.length;\n        maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n\n        for (var j = 0; j < len; ++j) {\n          var _dests$j = dests[j],\n              target = _dests$j.target,\n              weight = _dests$j.weight;\n          dataArray.push(+target); // dest vertex index\n\n          dataArray.push(+weight); // edge weight\n        }\n      }\n\n      while (dataArray.length % 4 !== 0) {\n        dataArray.push(0);\n      }\n\n      return [new Float32Array(dataArray), maxEdgePerVetex];\n    };\n\n    var calcShortestPath = async function calcShortestPath(source) {\n      var _buildTextureData = buildTextureData(data.nodes, data.edges, data.nodes.findIndex(function (n) {\n        return n.id === source;\n      })),\n          _buildTextureData2 = _slicedToArray(_buildTextureData, 2),\n          nodesEdgesArray = _buildTextureData2[0],\n          maxEdgePerVetex = _buildTextureData2[1];\n\n      var vertexNum = data.nodes.length;\n\n      if (kernel) {\n        var timeStart = window.performance.now();\n        kernel.setBinding({\n          gData: nodesEdgesArray,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: data.nodes.length,\n          MAX_DISTANCE: 10000\n        }); // relax all edges |V|-1 times\n\n        await kernel.execute(vertexNum - 1);\n        var output = await kernel.getOutput();\n        setTimeElapsed(window.performance.now() - timeStart);\n        setDatasource(new Array(data.nodes.length).fill(0).map(function (_, i) {\n          var prevPoint = data.nodes[output[i * 4 + 1]];\n          var weight = output[i * 4];\n          return {\n            destination: data.nodes[i].id,\n            weight: weight === 10000 ? 'MAX' : weight,\n            prevPoint: prevPoint && prevPoint.id || '-'\n          };\n        }).filter(function (_ref) {\n          var weight = _ref.weight;\n          return weight !== 'MAX';\n        }));\n      }\n    };\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        // compile our kernel code\n        var compiler = new _gWebgpuCompiler.Compiler();\n        var precompiledBundle = compiler.compileBundle(gCode); // create world\n\n        var world = _gWebgpu.World.create({\n          engineOptions: {\n            supportCompute: true\n          }\n        });\n\n        var vertexNum = data.nodes.length;\n        kernel = world.createKernel(precompiledBundle).setDispatch([Math.ceil(vertexNum / 16), 1, 1]);\n        await calcShortestPath('1');\n      })();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      id: \"container\"\n    }), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Directed Graph: \", nodes.size, \" nodes, \", edges.length, \" edges\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Elapsed time: \", timeElapsed, \" ms\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Shortest path from\", /*#__PURE__*/_react.default.createElement(_antd.Select, {\n      defaultValue: \"1\",\n      options: data.nodes.map(function (node) {\n        return {\n          value: node.id,\n          label: node.label\n        };\n      }),\n      onChange: calcShortestPath\n    })), /*#__PURE__*/_react.default.createElement(_antd.Table, {\n      rowKey: \"destination\",\n      columns: [{\n        dataIndex: 'destination',\n        title: 'destination'\n      }, {\n        dataIndex: 'weight',\n        title: 'weight'\n      }, {\n        dataIndex: 'prevPoint',\n        title: 'previous point'\n      }],\n      dataSource: datasource,\n      pagination: false\n    }));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/graph/fruchterman/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/graph/fruchterman/demo/index.tsx","order":0,"filename":"index.tsx","title":"Fruchterman 布局算法","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Canvas } from '@antv/g-canvas';\nimport { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\nconst MAX_EDGE_PER_VERTEX;\nconst VERTEX_COUNT;\n\n@numthreads(1, 1, 1)\nclass Fruchterman {\n  @in @out\n  u_Data: vec4[];\n\n  @in\n  u_K: float;\n\n  @in\n  u_K2: float;\n\n  @in\n  u_Gravity: float;\n\n  @in\n  u_Center: vec2;\n\n  @in\n  u_Speed: float;\n\n  @in\n  u_MaxDisplace: float;\n\n\n  calcRepulsive(i: int, currentNode: vec4): vec2 {\n    let dx = 0, dy = 0;\n    for (let j = 0; j < VERTEX_COUNT; j++) {\n      if (i != j) {\n        const nextNode = this.u_Data[j];\n        const xDist = currentNode[0] - nextNode[0];\n        const yDist = currentNode[1] - nextNode[1];\n        const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\n        if (dist > 0.0) {\n          const repulsiveF = this.u_K2 / dist;\n          dx += xDist / dist * repulsiveF;\n          dy += yDist / dist * repulsiveF;\n        }\n      }\n    }\n    return [dx, dy];\n  }\n\n  calcGravity(currentNode: vec4): vec2 {\n    let dx = 0, dy = 0;\n    const vx = currentNode[0] - this.u_Center[0];\n    const vy = currentNode[1] - this.u_Center[1];\n    const gf = 0.01 * this.u_K * this.u_Gravity;\n    dx = gf * vx;\n    dy = gf * vy;\n\n    return [dx, dy];\n  }\n\n  calcAttractive(currentNode: vec4): vec2 {\n    let dx = 0, dy = 0;\n    const arr_offset = int(floor(currentNode[2] + 0.5));\n    const length = int(floor(currentNode[3] + 0.5));\n    const node_buffer: vec4;\n    for (let p = 0; p < MAX_EDGE_PER_VERTEX; p++) {\n      if (p >= length) break;\n      const arr_idx = arr_offset + p;\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\n      if (p == 0 || buf_offset == 0) {\n        node_buffer = this.u_Data[int(arr_idx / 4)];\n      }\n      const float_j = buf_offset == 0 ? node_buffer[0] :\n                      buf_offset == 1 ? node_buffer[1] :\n                      buf_offset == 2 ? node_buffer[2] :\n                                        node_buffer[3];\n      const nextNode = this.u_Data[int(float_j)];\n      const xDist = currentNode[0] - nextNode[0];\n      const yDist = currentNode[1] - nextNode[1];\n      const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\n      const attractiveF = dist * dist / this.u_K;\n      if (dist > 0.0) {\n        dx -= xDist / dist * attractiveF;\n        dy -= yDist / dist * attractiveF;\n      }\n    }\n    return [dx, dy];\n  }\n\n  @main\n  compute() {\n    const i = globalInvocationID.x;\n    const currentNode = this.u_Data[i];\n\n    let dx = 0, dy = 0;\n\n    if (i >= VERTEX_COUNT) {\n      this.u_Data[i] = currentNode;\n      return;\n    }\n\n    // repulsive\n    const repulsive = this.calcRepulsive(i, currentNode);\n    dx += repulsive[0];\n    dy += repulsive[1];\n\n    // attractive\n    const attractive = this.calcAttractive(currentNode);\n    dx += attractive[0];\n    dy += attractive[1];\n\n    // gravity\n    const gravity = this.calcGravity(currentNode);\n    dx -= gravity[0];\n    dy -= gravity[1];\n\n    // speed\n    dx *= this.u_Speed;\n    dy *= this.u_Speed;\n\n    // move\n    const distLength = sqrt(dx * dx + dy * dy);\n    if (distLength > 0.0) {\n      const limitedDist = min(this.u_MaxDisplace * this.u_Speed, distLength);\n\n      this.u_Data[i] = [\n        currentNode[0] + dx / distLength * limitedDist,\n        currentNode[1] + dy / distLength * limitedDist,\n        currentNode[2],\n        currentNode[3]\n      ];\n    }\n  }\n}\n`;\n\nconst MAX_ITERATION = 1000;\n\nconst App = React.memo(function Fruchterman() {\n  const [timeElapsed, setTimeElapsed] = useState(0);\n  useEffect(() => {\n    (async () => {\n      // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n      const data = await (\n        await fetch(\n          'https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json',\n        )\n      ).json();\n\n      const center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n      const nodes = data.nodes.map((n) => ({\n        x: Math.random() * CANVAS_WIDTH,\n        y: Math.random() * CANVAS_HEIGHT,\n        id: n.id,\n      }));\n      const edges = data.edges;\n      const numParticles = nodes.length;\n      const nodesEdgesArray = buildTextureData(nodes, edges);\n\n      // compile our kernel code\n      const compiler = new Compiler();\n      const precompiledBundle = compiler.compileBundle(gCode);\n\n      // console.log(precompiledBundle.toString());\n\n      // create world\n      const world = World.create({\n        engineOptions: {\n          supportCompute: true,\n        },\n      });\n\n      const timeStart = window.performance.now();\n      const area = CANVAS_HEIGHT * CANVAS_WIDTH;\n      let maxDisplace = Math.sqrt(area) / 10;\n      const k2 = area / (nodes.length + 1);\n      const k = Math.sqrt(k2);\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([numParticles, 1, 1])\n        .setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Center: center,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles,\n        });\n\n      for (let i = 0; i < MAX_ITERATION; i++) {\n        await kernel.execute();\n        kernel.setBinding({\n          u_MaxDisplace: maxDisplace *= 0.99,\n        });\n      }\n      // or use batch:\n      // await kernel.execute(MAX_ITERATION);\n\n      const finalParticleData = await kernel.getOutput();\n\n      setTimeElapsed(window.performance.now() - timeStart);\n      // draw with G\n      renderCircles(finalParticleData, numParticles);\n\n      window.gwebgpuClean = () => {\n        world.destroy();\n      };\n    })();\n  }, []);\n\n  return (\n    <>\n      <div>Elapsed time: {timeElapsed / 1000}s</div>\n      <div>\n        Ported from the same{' '}\n        <a href=\"https://g6.antv.vision/en/examples/net/furchtermanLayout#fruchtermanWebWorker\">\n          example\n        </a>{' '}\n        in G6\n      </div>\n      <div id=\"container\" />\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n\nconst CANVAS_HEIGHT = 600;\nconst CANVAS_WIDTH = 600;\nfunction renderCircles(finalParticleData, numParticles) {\n  const canvas = new Canvas({\n    container: 'container',\n    width: CANVAS_WIDTH,\n    height: CANVAS_HEIGHT,\n  });\n\n  // draw edges\n  for (let i = 0; i < lineIndexBufferData.length; i += 2) {\n    const x1 = finalParticleData[lineIndexBufferData[i] * 4];\n    const y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n    const x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n    const y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n    const group = canvas.addGroup();\n    group.addShape('line', {\n      attrs: {\n        x1,\n        y1,\n        x2,\n        y2,\n        stroke: '#1890FF',\n        lineWidth: 1,\n      },\n    });\n  }\n\n  // draw nodes\n  for (let i = 0; i < numParticles * 4; i += 4) {\n    const x = finalParticleData[i];\n    const y = finalParticleData[i + 1];\n    const group = canvas.addGroup();\n    group.addShape('circle', {\n      attrs: {\n        x,\n        y,\n        r: 5,\n        fill: 'red',\n        stroke: 'blue',\n        lineWidth: 2,\n      },\n    });\n  }\n}\n\nconst lineIndexBufferData = [];\nlet maxEdgePerVetex;\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\nfunction buildTextureData(nodes, edges) {\n  const dataArray = [];\n  const nodeDict = [];\n  const mapIdPos = {};\n  let i = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const n = nodes[i];\n    mapIdPos[n.id] = i;\n    dataArray.push(n.x);\n    dataArray.push(n.y);\n    dataArray.push(0);\n    dataArray.push(0);\n    nodeDict.push([]);\n  }\n  for (i = 0; i < edges.length; i++) {\n    const e = edges[i];\n    nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n    nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n    lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n  }\n\n  maxEdgePerVetex = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const offset = dataArray.length;\n    const dests = nodeDict[i];\n    const len = dests.length;\n    dataArray[i * 4 + 2] = offset;\n    dataArray[i * 4 + 3] = dests.length;\n    maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n    for (let j = 0; j < len; ++j) {\n      const dest = dests[j];\n      dataArray.push(+dest);\n    }\n  }\n\n  while (dataArray.length % 4 !== 0) {\n    dataArray.push(0);\n  }\n  return new Float32Array(dataArray);\n}\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-canvas\", \"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-canvas\"), require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gCanvas, global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gCanvas, _gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\nconst MAX_EDGE_PER_VERTEX;\\nconst VERTEX_COUNT;\\n\\n@numthreads(1, 1, 1)\\nclass Fruchterman {\\n  @in @out\\n  u_Data: vec4[];\\n\\n  @in\\n  u_K: float;\\n\\n  @in\\n  u_K2: float;\\n\\n  @in\\n  u_Gravity: float;\\n\\n  @in\\n  u_Center: vec2;\\n\\n  @in\\n  u_Speed: float;\\n\\n  @in\\n  u_MaxDisplace: float;\\n\\n\\n  calcRepulsive(i: int, currentNode: vec4): vec2 {\\n    let dx = 0, dy = 0;\\n    for (let j = 0; j < VERTEX_COUNT; j++) {\\n      if (i != j) {\\n        const nextNode = this.u_Data[j];\\n        const xDist = currentNode[0] - nextNode[0];\\n        const yDist = currentNode[1] - nextNode[1];\\n        const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\\n        if (dist > 0.0) {\\n          const repulsiveF = this.u_K2 / dist;\\n          dx += xDist / dist * repulsiveF;\\n          dy += yDist / dist * repulsiveF;\\n        }\\n      }\\n    }\\n    return [dx, dy];\\n  }\\n\\n  calcGravity(currentNode: vec4): vec2 {\\n    let dx = 0, dy = 0;\\n    const vx = currentNode[0] - this.u_Center[0];\\n    const vy = currentNode[1] - this.u_Center[1];\\n    const gf = 0.01 * this.u_K * this.u_Gravity;\\n    dx = gf * vx;\\n    dy = gf * vy;\\n\\n    return [dx, dy];\\n  }\\n\\n  calcAttractive(currentNode: vec4): vec2 {\\n    let dx = 0, dy = 0;\\n    const arr_offset = int(floor(currentNode[2] + 0.5));\\n    const length = int(floor(currentNode[3] + 0.5));\\n    const node_buffer: vec4;\\n    for (let p = 0; p < MAX_EDGE_PER_VERTEX; p++) {\\n      if (p >= length) break;\\n      const arr_idx = arr_offset + p;\\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\\n      if (p == 0 || buf_offset == 0) {\\n        node_buffer = this.u_Data[int(arr_idx / 4)];\\n      }\\n      const float_j = buf_offset == 0 ? node_buffer[0] :\\n                      buf_offset == 1 ? node_buffer[1] :\\n                      buf_offset == 2 ? node_buffer[2] :\\n                                        node_buffer[3];\\n      const nextNode = this.u_Data[int(float_j)];\\n      const xDist = currentNode[0] - nextNode[0];\\n      const yDist = currentNode[1] - nextNode[1];\\n      const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\\n      const attractiveF = dist * dist / this.u_K;\\n      if (dist > 0.0) {\\n        dx -= xDist / dist * attractiveF;\\n        dy -= yDist / dist * attractiveF;\\n      }\\n    }\\n    return [dx, dy];\\n  }\\n\\n  @main\\n  compute() {\\n    const i = globalInvocationID.x;\\n    const currentNode = this.u_Data[i];\\n\\n    let dx = 0, dy = 0;\\n\\n    if (i >= VERTEX_COUNT) {\\n      this.u_Data[i] = currentNode;\\n      return;\\n    }\\n\\n    // repulsive\\n    const repulsive = this.calcRepulsive(i, currentNode);\\n    dx += repulsive[0];\\n    dy += repulsive[1];\\n\\n    // attractive\\n    const attractive = this.calcAttractive(currentNode);\\n    dx += attractive[0];\\n    dy += attractive[1];\\n\\n    // gravity\\n    const gravity = this.calcGravity(currentNode);\\n    dx -= gravity[0];\\n    dy -= gravity[1];\\n\\n    // speed\\n    dx *= this.u_Speed;\\n    dy *= this.u_Speed;\\n\\n    // move\\n    const distLength = sqrt(dx * dx + dy * dy);\\n    if (distLength > 0.0) {\\n      const limitedDist = min(this.u_MaxDisplace * this.u_Speed, distLength);\\n\\n      this.u_Data[i] = [\\n        currentNode[0] + dx / distLength * limitedDist,\\n        currentNode[1] + dy / distLength * limitedDist,\\n        currentNode[2],\\n        currentNode[3]\\n      ];\\n    }\\n  }\\n}\\n\";\n  var MAX_ITERATION = 1000;\n\n  var App = /*#__PURE__*/_react.default.memo(function Fruchterman() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeElapsed = _useState2[0],\n        setTimeElapsed = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n        var data = await (await fetch('https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json')).json();\n        var center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n        var nodes = data.nodes.map(function (n) {\n          return {\n            x: Math.random() * CANVAS_WIDTH,\n            y: Math.random() * CANVAS_HEIGHT,\n            id: n.id\n          };\n        });\n        var edges = data.edges;\n        var numParticles = nodes.length;\n        var nodesEdgesArray = buildTextureData(nodes, edges); // compile our kernel code\n\n        var compiler = new _gWebgpuCompiler.Compiler();\n        var precompiledBundle = compiler.compileBundle(gCode); // console.log(precompiledBundle.toString());\n        // create world\n\n        var world = _gWebgpu.World.create({\n          engineOptions: {\n            supportCompute: true\n          }\n        });\n\n        var timeStart = window.performance.now();\n        var area = CANVAS_HEIGHT * CANVAS_WIDTH;\n        var maxDisplace = Math.sqrt(area) / 10;\n        var k2 = area / (nodes.length + 1);\n        var k = Math.sqrt(k2);\n        var kernel = world.createKernel(precompiledBundle).setDispatch([numParticles, 1, 1]).setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Center: center,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles\n        });\n\n        for (var i = 0; i < MAX_ITERATION; i++) {\n          await kernel.execute();\n          kernel.setBinding({\n            u_MaxDisplace: maxDisplace *= 0.99\n          });\n        } // or use batch:\n        // await kernel.execute(MAX_ITERATION);\n\n\n        var finalParticleData = await kernel.getOutput();\n        setTimeElapsed(window.performance.now() - timeStart); // draw with G\n\n        renderCircles(finalParticleData, numParticles);\n\n        window.gwebgpuClean = function () {\n          world.destroy();\n        };\n      })();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", null, \"Elapsed time: \", timeElapsed / 1000, \"s\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Ported from the same\", ' ', /*#__PURE__*/_react.default.createElement(\"a\", {\n      href: \"https://g6.antv.vision/en/examples/net/furchtermanLayout#fruchtermanWebWorker\"\n    }, \"example\"), ' ', \"in G6\"), /*#__PURE__*/_react.default.createElement(\"div\", {\n      id: \"container\"\n    }));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n\n  var CANVAS_HEIGHT = 600;\n  var CANVAS_WIDTH = 600;\n\n  function renderCircles(finalParticleData, numParticles) {\n    var canvas = new _gCanvas.Canvas({\n      container: 'container',\n      width: CANVAS_WIDTH,\n      height: CANVAS_HEIGHT\n    }); // draw edges\n\n    for (var i = 0; i < lineIndexBufferData.length; i += 2) {\n      var x1 = finalParticleData[lineIndexBufferData[i] * 4];\n      var y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n      var x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n      var y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n      var group = canvas.addGroup();\n      group.addShape('line', {\n        attrs: {\n          x1: x1,\n          y1: y1,\n          x2: x2,\n          y2: y2,\n          stroke: '#1890FF',\n          lineWidth: 1\n        }\n      });\n    } // draw nodes\n\n\n    for (var _i2 = 0; _i2 < numParticles * 4; _i2 += 4) {\n      var x = finalParticleData[_i2];\n      var y = finalParticleData[_i2 + 1];\n\n      var _group = canvas.addGroup();\n\n      _group.addShape('circle', {\n        attrs: {\n          x: x,\n          y: y,\n          r: 5,\n          fill: 'red',\n          stroke: 'blue',\n          lineWidth: 2\n        }\n      });\n    }\n  }\n\n  var lineIndexBufferData = [];\n  var maxEdgePerVetex; // @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\n\n  function buildTextureData(nodes, edges) {\n    var dataArray = [];\n    var nodeDict = [];\n    var mapIdPos = {};\n    var i = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var n = nodes[i];\n      mapIdPos[n.id] = i;\n      dataArray.push(n.x);\n      dataArray.push(n.y);\n      dataArray.push(0);\n      dataArray.push(0);\n      nodeDict.push([]);\n    }\n\n    for (i = 0; i < edges.length; i++) {\n      var e = edges[i];\n      nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n      nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n      lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n    }\n\n    maxEdgePerVetex = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var offset = dataArray.length;\n      var dests = nodeDict[i];\n      var len = dests.length;\n      dataArray[i * 4 + 2] = offset;\n      dataArray[i * 4 + 3] = dests.length;\n      maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n\n      for (var j = 0; j < len; ++j) {\n        var dest = dests[j];\n        dataArray.push(+dest);\n      }\n    }\n\n    while (dataArray.length % 4 !== 0) {\n      dataArray.push(0);\n    }\n\n    return new Float32Array(dataArray);\n  }\n});"},{"relativePath":"gpgpu/graph/fruchterman/demo/precompiled.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/graph/fruchterman/demo/precompiled.tsx","order":1,"filename":"precompiled.tsx","title":"Fruchterman 布局算法(预编译)","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Canvas } from '@antv/g-canvas';\nimport { World } from '@antv/g-webgpu';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst MAX_ITERATION = 1000;\nconst CANVAS_HEIGHT = 600;\nconst CANVAS_WIDTH = 600;\nconst App = React.memo(function Fruchterman() {\n  const [timeElapsed, setTimeElapsed] = useState(0);\n  useEffect(() => {\n    (async () => {\n      // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n      const data = await (\n        await fetch(\n          'https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json',\n        )\n      ).json();\n\n      const center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n      const nodes = data.nodes.map((n) => ({\n        x: Math.random() * CANVAS_WIDTH,\n        y: Math.random() * CANVAS_HEIGHT,\n        id: n.id,\n      }));\n      const edges = data.edges;\n      const numParticles = nodes.length;\n      const nodesEdgesArray = buildTextureData(nodes, edges);\n\n      const precompiledBundle = `{\"shaders\":{\"WGSL\":\"import \\\\\"GLSL.std.450\\\\\" as std;\\\\n\\\\n\\\\n# var gWebGPUDebug : bool = false;\\\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\\\n\\\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\\\n\\\\ntype GWebGPUParams = [[block]] struct {\\\\n  [[offset 0]] u_K : f32;\\\\n  [[offset 4]] u_K2 : f32;\\\\n  [[offset 8]] u_Gravity : f32;\\\\n  [[offset 12]] u_Center : vec2<f32>;\\\\n  [[offset 20]] u_Speed : f32;\\\\n  [[offset 24]] u_MaxDisplace : f32;\\\\n};\\\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\\\ntype GWebGPUBuffer0 = [[block]] struct {\\\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\\\n};\\\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\\\nvar xDist : f32 = currentNode.x - nextNode.x;\\\\nvar yDist : f32 = currentNode.y - nextNode.y;\\\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {var repulsiveF : f32 = gWebGPUUniformParams.u_K2 / dist;\\\\ndx = dx + (xDist / dist) * repulsiveF;\\\\ndy = dy + (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn calcGravity(currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nvar vx : f32 = currentNode.x - gWebGPUUniformParams.u_Center.x;\\\\nvar vy : f32 = currentNode.y - gWebGPUUniformParams.u_Center.y;\\\\nvar gf : f32 = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn calcAttractive(currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nvar arr_offset : i32 = i32(std::floor(currentNode.z + 0.5));\\\\nvar length : i32 = i32(std::floor(currentNode.w + 0.5));\\\\nvar node_buffer : vec4<f32>;\\\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\\\nvar arr_idx : i32 = arr_offset + i32(p);\\\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\\\nvar float_j : f32 = select(node_buffer.x, select(node_buffer.y, select(node_buffer.z, node_buffer.w, buf_offset == 2), buf_offset == 1), buf_offset == 0);\\\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\\\nvar xDist : f32 = currentNode.x - nextNode.x;\\\\nvar yDist : f32 = currentNode.y - nextNode.y;\\\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nvar attractiveF : f32 = (dist * dist) / gWebGPUUniformParams.u_K;\\\\nif (dist > 0.0) {dx = dx - (xDist / dist) * attractiveF;\\\\ndy = dy - (yDist / dist) * attractiveF;}}\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\\\nvar dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nif (i >= __DefineValuePlaceholder__VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\\\nreturn ;}\\\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\\\ndx = dx + repulsive.x;\\\\ndy = dy + repulsive.y;\\\\nvar attractive : vec2<f32> = calcAttractive(currentNode);\\\\ndx = dx + attractive.x;\\\\ndy = dy + attractive.y;\\\\nvar gravity : vec2<f32> = calcGravity(currentNode);\\\\ndx = dx - gravity.x;\\\\ndy = dy - gravity.y;\\\\ndx = dx * gWebGPUUniformParams.u_Speed;\\\\ndy = dy * gWebGPUUniformParams.u_Speed;\\\\nvar distLength : f32 = std::sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {var limitedDist : f32 = std::min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}\\\\nreturn;}\\\\n\\\\nentry_point compute as \\\\\"main\\\\\" = main;\\\\n\",\"GLSL450\":\"\\\\n\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\\\nivec3 workGroupSize = ivec3(1,1,1);\\\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\\\n\\\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\\\n  float u_K;\\\\n  float u_K2;\\\\n  float u_Gravity;\\\\n  vec2 u_Center;\\\\n  float u_Speed;\\\\n  float u_MaxDisplace;\\\\n} gWebGPUUniformParams;\\\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\\\n  vec4 u_Data[];\\\\n} gWebGPUBuffer0;\\\\n\\\\n\\\\n\\\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\\\nlayout (\\\\n  local_size_x = 1,\\\\n  local_size_y = 1,\\\\n  local_size_z = 1\\\\n) in;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nvec2 calcRepulsive(int i, vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {float repulsiveF = gWebGPUUniformParams.u_K2 / dist;\\\\ndx += (xDist / dist) * repulsiveF;\\\\ndy += (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcGravity(vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfloat vx = currentNode.x - gWebGPUUniformParams.u_Center.x;\\\\nfloat vy = currentNode.y - gWebGPUUniformParams.u_Center.y;\\\\nfloat gf = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcAttractive(vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nint arr_offset = int(floor(currentNode.z + 0.5));\\\\nint length = int(floor(currentNode.w + 0.5));\\\\nvec4 node_buffer;\\\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\\\nint arr_idx = arr_offset + int(p);\\\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nfloat attractiveF = (dist * dist) / gWebGPUUniformParams.u_K;\\\\nif (dist > 0.0) {dx -= (xDist / dist) * attractiveF;\\\\ndy -= (yDist / dist) * attractiveF;}}\\\\nreturn vec2(dx, dy);}\\\\nvoid main() {int i = globalInvocationID.x;\\\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nif (i >= VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\\\nreturn ;}\\\\nvec2 repulsive = calcRepulsive(i, currentNode);\\\\ndx += repulsive.x;\\\\ndy += repulsive.y;\\\\nvec2 attractive = calcAttractive(currentNode);\\\\ndx += attractive.x;\\\\ndy += attractive.y;\\\\nvec2 gravity = calcGravity(currentNode);\\\\ndx -= gravity.x;\\\\ndy -= gravity.y;\\\\ndx *= gWebGPUUniformParams.u_Speed;\\\\ndy *= gWebGPUUniformParams.u_Speed;\\\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {float limitedDist = min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}}\\\\n\",\"GLSL100\":\"\\\\n\\\\nfloat epsilon = 0.00001;\\\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\\\n  vec2 normAddr2D = float(address1D) * conv_const;\\\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\\\n}\\\\n\\\\nvoid barrier() {}\\\\n  \\\\n\\\\nuniform vec2 u_OutputTextureSize;\\\\nuniform int u_OutputTexelCount;\\\\nvarying vec2 v_TexCoord;\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\\\n\\\\nuniform sampler2D u_Data;\\\\nuniform vec2 u_DataSize;\\\\nvec4 getDatau_Data(vec2 address2D) {\\\\n  return vec4(texture2D(u_Data, address2D).rgba);\\\\n}\\\\nvec4 getDatau_Data(float address1D) {\\\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\\\n}\\\\nvec4 getDatau_Data(int address1D) {\\\\n  return getDatau_Data(float(address1D));\\\\n}\\\\nuniform float u_K;\\\\nuniform float u_K2;\\\\nuniform float u_Gravity;\\\\nuniform vec2 u_Center;\\\\nuniform float u_Speed;\\\\nuniform float u_MaxDisplace;\\\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {float repulsiveF = u_K2 / dist;\\\\ndx += (xDist / dist) * repulsiveF;\\\\ndy += (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcGravity(vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfloat vx = currentNode.x - u_Center.x;\\\\nfloat vy = currentNode.y - u_Center.y;\\\\nfloat gf = (0.01 * u_K) * u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcAttractive(vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nint arr_offset = int(floor(currentNode.z + 0.5));\\\\nint length = int(floor(currentNode.w + 0.5));\\\\nvec4 node_buffer;\\\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\\\nint arr_idx = arr_offset + int(p);\\\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\\\nvec4 nextNode = getDatau_Data(int(float_j));\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nfloat attractiveF = (dist * dist) / u_K;\\\\nif (dist > 0.0) {dx -= (xDist / dist) * attractiveF;\\\\ndy -= (yDist / dist) * attractiveF;}}\\\\nreturn vec2(dx, dy);}\\\\nvoid main() {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nint i = globalInvocationID.x;\\\\nvec4 currentNode = getDatau_Data(i);\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nif (i >= VERTEX_COUNT) {gl_FragColor = vec4(currentNode);\\\\nreturn ;}\\\\nvec2 repulsive = calcRepulsive(i, currentNode);\\\\ndx += repulsive.x;\\\\ndy += repulsive.y;\\\\nvec2 attractive = calcAttractive(currentNode);\\\\ndx += attractive.x;\\\\ndy += attractive.y;\\\\nvec2 gravity = calcGravity(currentNode);\\\\ndx -= gravity.x;\\\\ndy -= gravity.y;\\\\ndx *= u_Speed;\\\\ndy *= u_Speed;\\\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\\\\ngl_FragColor = vec4(vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w));}if (gWebGPUDebug) {\\\\n  gl_FragColor = gWebGPUDebugOutput;\\\\n}}\\\\n\"},\"context\":{\"name\":\"\",\"dispatch\":[1,1,1],\"threadGroupSize\":[1,1,1],\"maxIteration\":1,\"defines\":[{\"name\":\"MAX_EDGE_PER_VERTEX\",\"type\":\"Float\",\"runtime\":true},{\"name\":\"VERTEX_COUNT\",\"type\":\"Float\",\"runtime\":true}],\"uniforms\":[{\"name\":\"u_Data\",\"type\":\"vec4<f32>[]\",\"storageClass\":\"StorageBuffer\",\"readonly\":false,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_K\",\"type\":\"Float\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_K2\",\"type\":\"Float\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_Gravity\",\"type\":\"Float\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_Center\",\"type\":\"vec2<f32>\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_Speed\",\"type\":\"Float\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"u_MaxDisplace\",\"type\":\"Float\",\"storageClass\":\"Uniform\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]}],\"globalDeclarations\":[],\"output\":{\"name\":\"u_Data\",\"size\":[1,1],\"length\":1},\"needPingpong\":true}}`\n\n      // create world\n      const world = World.create({\n        engineOptions: {\n          supportCompute: true,\n        },\n      });\n\n      const timeStart = window.performance.now();\n\n      const area = CANVAS_HEIGHT * CANVAS_WIDTH;\n      let maxDisplace = Math.sqrt(area) / 10;\n      const k2 = area / (nodes.length + 1);\n      const k = Math.sqrt(k2);\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([numParticles, 1, 1])\n        .setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Center: center,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles,\n        });\n\n      for (let i = 0; i < MAX_ITERATION; i++) {\n        await kernel.execute();\n        kernel.setBinding({\n          u_MaxDisplace: maxDisplace *= 0.99,\n        });\n      }\n      // or use batch:\n      // await kernel.execute(MAX_ITERATION);\n\n      const finalParticleData = await kernel.getOutput();\n\n      setTimeElapsed(window.performance.now() - timeStart);\n      // draw with G\n      renderCircles(finalParticleData, numParticles);\n\n      window.gwebgpuClean = () => {\n        world.destroy();\n      };\n    })();\n  }, []);\n\n  return (\n    <>\n      <div>Elapsed time: {timeElapsed / 1000}s</div>\n      <div>\n        Ported from the same{' '}\n        <a href=\"https://g6.antv.vision/en/examples/net/furchtermanLayout#fruchtermanWebWorker\">\n          example\n        </a>{' '}\n        in G6\n      </div>\n      <div id=\"container\" />\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n\nfunction renderCircles(finalParticleData, numParticles) {\n  const canvas = new Canvas({\n    container: 'container',\n    center: [],\n    width: CANVAS_WIDTH,\n    height: CANVAS_HEIGHT,\n  });\n\n  // draw edges\n  for (let i = 0; i < lineIndexBufferData.length; i += 2) {\n    const x1 = finalParticleData[lineIndexBufferData[i] * 4];\n    const y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n    const x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n    const y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n    const group = canvas.addGroup();\n    group.addShape('line', {\n      attrs: {\n        x1,\n        y1,\n        x2,\n        y2,\n        stroke: '#1890FF',\n        lineWidth: 1,\n      },\n    });\n  }\n\n  // draw nodes\n  for (let i = 0; i < numParticles * 4; i += 4) {\n    const x = finalParticleData[i];\n    const y = finalParticleData[i + 1];\n    const group = canvas.addGroup();\n    group.addShape('circle', {\n      attrs: {\n        x,\n        y,\n        r: 5,\n        fill: 'red',\n        stroke: 'blue',\n        lineWidth: 2,\n      },\n    });\n  }\n}\n\nconst lineIndexBufferData = [];\nlet maxEdgePerVetex;\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\nfunction buildTextureData(nodes, edges) {\n  const dataArray = [];\n  const nodeDict = [];\n  const mapIdPos = {};\n  let i = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const n = nodes[i];\n    mapIdPos[n.id] = i;\n    dataArray.push(n.x);\n    dataArray.push(n.y);\n    dataArray.push(0);\n    dataArray.push(0);\n    nodeDict.push([]);\n  }\n  for (i = 0; i < edges.length; i++) {\n    const e = edges[i];\n    nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n    nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n    lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n  }\n\n  maxEdgePerVetex = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const offset = dataArray.length;\n    const dests = nodeDict[i];\n    const len = dests.length;\n    dataArray[i * 4 + 2] = offset;\n    dataArray[i * 4 + 3] = dests.length;\n    maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n    for (let j = 0; j < len; ++j) {\n      const dest = dests[j];\n      dataArray.push(+dest);\n    }\n  }\n\n  while (dataArray.length % 4 !== 0) {\n    dataArray.push(0);\n  }\n  return new Float32Array(dataArray);\n}\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-canvas\", \"@antv/g-webgpu\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-canvas\"), require(\"@antv/g-webgpu\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gCanvas, global.gWebgpu, global.react, global.reactDom);\n    global.precompiled = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gCanvas, _gWebgpu, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var MAX_ITERATION = 1000;\n  var CANVAS_HEIGHT = 600;\n  var CANVAS_WIDTH = 600;\n\n  var App = /*#__PURE__*/_react.default.memo(function Fruchterman() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeElapsed = _useState2[0],\n        setTimeElapsed = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n        var data = await (await fetch('https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json')).json();\n        var center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n        var nodes = data.nodes.map(function (n) {\n          return {\n            x: Math.random() * CANVAS_WIDTH,\n            y: Math.random() * CANVAS_HEIGHT,\n            id: n.id\n          };\n        });\n        var edges = data.edges;\n        var numParticles = nodes.length;\n        var nodesEdgesArray = buildTextureData(nodes, edges);\n        var precompiledBundle = \"{\\\"shaders\\\":{\\\"WGSL\\\":\\\"import \\\\\\\"GLSL.std.450\\\\\\\" as std;\\\\n\\\\n\\\\n# var gWebGPUDebug : bool = false;\\\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\\\n\\\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\\\n\\\\ntype GWebGPUParams = [[block]] struct {\\\\n  [[offset 0]] u_K : f32;\\\\n  [[offset 4]] u_K2 : f32;\\\\n  [[offset 8]] u_Gravity : f32;\\\\n  [[offset 12]] u_Center : vec2<f32>;\\\\n  [[offset 20]] u_Speed : f32;\\\\n  [[offset 24]] u_MaxDisplace : f32;\\\\n};\\\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\\\ntype GWebGPUBuffer0 = [[block]] struct {\\\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\\\n};\\\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\\\nvar xDist : f32 = currentNode.x - nextNode.x;\\\\nvar yDist : f32 = currentNode.y - nextNode.y;\\\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {var repulsiveF : f32 = gWebGPUUniformParams.u_K2 / dist;\\\\ndx = dx + (xDist / dist) * repulsiveF;\\\\ndy = dy + (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn calcGravity(currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nvar vx : f32 = currentNode.x - gWebGPUUniformParams.u_Center.x;\\\\nvar vy : f32 = currentNode.y - gWebGPUUniformParams.u_Center.y;\\\\nvar gf : f32 = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn calcAttractive(currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nvar arr_offset : i32 = i32(std::floor(currentNode.z + 0.5));\\\\nvar length : i32 = i32(std::floor(currentNode.w + 0.5));\\\\nvar node_buffer : vec4<f32>;\\\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\\\nvar arr_idx : i32 = arr_offset + i32(p);\\\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\\\nvar float_j : f32 = select(node_buffer.x, select(node_buffer.y, select(node_buffer.z, node_buffer.w, buf_offset == 2), buf_offset == 1), buf_offset == 0);\\\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\\\nvar xDist : f32 = currentNode.x - nextNode.x;\\\\nvar yDist : f32 = currentNode.y - nextNode.y;\\\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nvar attractiveF : f32 = (dist * dist) / gWebGPUUniformParams.u_K;\\\\nif (dist > 0.0) {dx = dx - (xDist / dist) * attractiveF;\\\\ndy = dy - (yDist / dist) * attractiveF;}}\\\\nreturn vec2<f32>(dx, dy);}\\\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\\\nvar dx : f32 = 0.0;\\\\nvar dy : f32 = 0.0;\\\\nif (i >= __DefineValuePlaceholder__VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\\\nreturn ;}\\\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\\\ndx = dx + repulsive.x;\\\\ndy = dy + repulsive.y;\\\\nvar attractive : vec2<f32> = calcAttractive(currentNode);\\\\ndx = dx + attractive.x;\\\\ndy = dy + attractive.y;\\\\nvar gravity : vec2<f32> = calcGravity(currentNode);\\\\ndx = dx - gravity.x;\\\\ndy = dy - gravity.y;\\\\ndx = dx * gWebGPUUniformParams.u_Speed;\\\\ndy = dy * gWebGPUUniformParams.u_Speed;\\\\nvar distLength : f32 = std::sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {var limitedDist : f32 = std::min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}\\\\nreturn;}\\\\n\\\\nentry_point compute as \\\\\\\"main\\\\\\\" = main;\\\\n\\\",\\\"GLSL450\\\":\\\"\\\\n\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\\\nivec3 workGroupSize = ivec3(1,1,1);\\\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\\\n\\\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\\\n  float u_K;\\\\n  float u_K2;\\\\n  float u_Gravity;\\\\n  vec2 u_Center;\\\\n  float u_Speed;\\\\n  float u_MaxDisplace;\\\\n} gWebGPUUniformParams;\\\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\\\n  vec4 u_Data[];\\\\n} gWebGPUBuffer0;\\\\n\\\\n\\\\n\\\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\\\nlayout (\\\\n  local_size_x = 1,\\\\n  local_size_y = 1,\\\\n  local_size_z = 1\\\\n) in;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nvec2 calcRepulsive(int i, vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {float repulsiveF = gWebGPUUniformParams.u_K2 / dist;\\\\ndx += (xDist / dist) * repulsiveF;\\\\ndy += (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcGravity(vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfloat vx = currentNode.x - gWebGPUUniformParams.u_Center.x;\\\\nfloat vy = currentNode.y - gWebGPUUniformParams.u_Center.y;\\\\nfloat gf = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcAttractive(vec4 currentNode) {float dx = 0.0;\\\\nfloat dy = 0.0;\\\\nint arr_offset = int(floor(currentNode.z + 0.5));\\\\nint length = int(floor(currentNode.w + 0.5));\\\\nvec4 node_buffer;\\\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\\\nint arr_idx = arr_offset + int(p);\\\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nfloat attractiveF = (dist * dist) / gWebGPUUniformParams.u_K;\\\\nif (dist > 0.0) {dx -= (xDist / dist) * attractiveF;\\\\ndy -= (yDist / dist) * attractiveF;}}\\\\nreturn vec2(dx, dy);}\\\\nvoid main() {int i = globalInvocationID.x;\\\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nif (i >= VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\\\nreturn ;}\\\\nvec2 repulsive = calcRepulsive(i, currentNode);\\\\ndx += repulsive.x;\\\\ndy += repulsive.y;\\\\nvec2 attractive = calcAttractive(currentNode);\\\\ndx += attractive.x;\\\\ndy += attractive.y;\\\\nvec2 gravity = calcGravity(currentNode);\\\\ndx -= gravity.x;\\\\ndy -= gravity.y;\\\\ndx *= gWebGPUUniformParams.u_Speed;\\\\ndy *= gWebGPUUniformParams.u_Speed;\\\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {float limitedDist = min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}}\\\\n\\\",\\\"GLSL100\\\":\\\"\\\\n\\\\nfloat epsilon = 0.00001;\\\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\\\n  vec2 normAddr2D = float(address1D) * conv_const;\\\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\\\n}\\\\n\\\\nvoid barrier() {}\\\\n  \\\\n\\\\nuniform vec2 u_OutputTextureSize;\\\\nuniform int u_OutputTexelCount;\\\\nvarying vec2 v_TexCoord;\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\\\n\\\\nuniform sampler2D u_Data;\\\\nuniform vec2 u_DataSize;\\\\nvec4 getDatau_Data(vec2 address2D) {\\\\n  return vec4(texture2D(u_Data, address2D).rgba);\\\\n}\\\\nvec4 getDatau_Data(float address1D) {\\\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\\\n}\\\\nvec4 getDatau_Data(int address1D) {\\\\n  return getDatau_Data(float(address1D));\\\\n}\\\\nuniform float u_K;\\\\nuniform float u_K2;\\\\nuniform float u_Gravity;\\\\nuniform vec2 u_Center;\\\\nuniform float u_Speed;\\\\nuniform float u_MaxDisplace;\\\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nif (dist > 0.0) {float repulsiveF = u_K2 / dist;\\\\ndx += (xDist / dist) * repulsiveF;\\\\ndy += (yDist / dist) * repulsiveF;}}}\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcGravity(vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nfloat vx = currentNode.x - u_Center.x;\\\\nfloat vy = currentNode.y - u_Center.y;\\\\nfloat gf = (0.01 * u_K) * u_Gravity;\\\\ndx = gf * vx;\\\\ndy = gf * vy;\\\\nreturn vec2(dx, dy);}\\\\nvec2 calcAttractive(vec4 currentNode) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nint arr_offset = int(floor(currentNode.z + 0.5));\\\\nint length = int(floor(currentNode.w + 0.5));\\\\nvec4 node_buffer;\\\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\\\nint arr_idx = arr_offset + int(p);\\\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\\\nvec4 nextNode = getDatau_Data(int(float_j));\\\\nfloat xDist = currentNode.x - nextNode.x;\\\\nfloat yDist = currentNode.y - nextNode.y;\\\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\\\nfloat attractiveF = (dist * dist) / u_K;\\\\nif (dist > 0.0) {dx -= (xDist / dist) * attractiveF;\\\\ndy -= (yDist / dist) * attractiveF;}}\\\\nreturn vec2(dx, dy);}\\\\nvoid main() {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nint i = globalInvocationID.x;\\\\nvec4 currentNode = getDatau_Data(i);\\\\nfloat dx = 0.0;\\\\nfloat dy = 0.0;\\\\nif (i >= VERTEX_COUNT) {gl_FragColor = vec4(currentNode);\\\\nreturn ;}\\\\nvec2 repulsive = calcRepulsive(i, currentNode);\\\\ndx += repulsive.x;\\\\ndy += repulsive.y;\\\\nvec2 attractive = calcAttractive(currentNode);\\\\ndx += attractive.x;\\\\ndy += attractive.y;\\\\nvec2 gravity = calcGravity(currentNode);\\\\ndx -= gravity.x;\\\\ndy -= gravity.y;\\\\ndx *= u_Speed;\\\\ndy *= u_Speed;\\\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\\\nif (distLength > 0.0) {float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\\\\ngl_FragColor = vec4(vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w));}if (gWebGPUDebug) {\\\\n  gl_FragColor = gWebGPUDebugOutput;\\\\n}}\\\\n\\\"},\\\"context\\\":{\\\"name\\\":\\\"\\\",\\\"dispatch\\\":[1,1,1],\\\"threadGroupSize\\\":[1,1,1],\\\"maxIteration\\\":1,\\\"defines\\\":[{\\\"name\\\":\\\"MAX_EDGE_PER_VERTEX\\\",\\\"type\\\":\\\"Float\\\",\\\"runtime\\\":true},{\\\"name\\\":\\\"VERTEX_COUNT\\\",\\\"type\\\":\\\"Float\\\",\\\"runtime\\\":true}],\\\"uniforms\\\":[{\\\"name\\\":\\\"u_Data\\\",\\\"type\\\":\\\"vec4<f32>[]\\\",\\\"storageClass\\\":\\\"StorageBuffer\\\",\\\"readonly\\\":false,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_K\\\",\\\"type\\\":\\\"Float\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_K2\\\",\\\"type\\\":\\\"Float\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_Gravity\\\",\\\"type\\\":\\\"Float\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_Center\\\",\\\"type\\\":\\\"vec2<f32>\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_Speed\\\",\\\"type\\\":\\\"Float\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]},{\\\"name\\\":\\\"u_MaxDisplace\\\",\\\"type\\\":\\\"Float\\\",\\\"storageClass\\\":\\\"Uniform\\\",\\\"readonly\\\":true,\\\"writeonly\\\":false,\\\"size\\\":[1,1]}],\\\"globalDeclarations\\\":[],\\\"output\\\":{\\\"name\\\":\\\"u_Data\\\",\\\"size\\\":[1,1],\\\"length\\\":1},\\\"needPingpong\\\":true}}\"; // create world\n\n        var world = _gWebgpu.World.create({\n          engineOptions: {\n            supportCompute: true\n          }\n        });\n\n        var timeStart = window.performance.now();\n        var area = CANVAS_HEIGHT * CANVAS_WIDTH;\n        var maxDisplace = Math.sqrt(area) / 10;\n        var k2 = area / (nodes.length + 1);\n        var k = Math.sqrt(k2);\n        var kernel = world.createKernel(precompiledBundle).setDispatch([numParticles, 1, 1]).setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Center: center,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles\n        });\n\n        for (var i = 0; i < MAX_ITERATION; i++) {\n          await kernel.execute();\n          kernel.setBinding({\n            u_MaxDisplace: maxDisplace *= 0.99\n          });\n        } // or use batch:\n        // await kernel.execute(MAX_ITERATION);\n\n\n        var finalParticleData = await kernel.getOutput();\n        setTimeElapsed(window.performance.now() - timeStart); // draw with G\n\n        renderCircles(finalParticleData, numParticles);\n\n        window.gwebgpuClean = function () {\n          world.destroy();\n        };\n      })();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", null, \"Elapsed time: \", timeElapsed / 1000, \"s\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"Ported from the same\", ' ', /*#__PURE__*/_react.default.createElement(\"a\", {\n      href: \"https://g6.antv.vision/en/examples/net/furchtermanLayout#fruchtermanWebWorker\"\n    }, \"example\"), ' ', \"in G6\"), /*#__PURE__*/_react.default.createElement(\"div\", {\n      id: \"container\"\n    }));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n\n  function renderCircles(finalParticleData, numParticles) {\n    var canvas = new _gCanvas.Canvas({\n      container: 'container',\n      center: [],\n      width: CANVAS_WIDTH,\n      height: CANVAS_HEIGHT\n    }); // draw edges\n\n    for (var i = 0; i < lineIndexBufferData.length; i += 2) {\n      var x1 = finalParticleData[lineIndexBufferData[i] * 4];\n      var y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n      var x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n      var y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n      var group = canvas.addGroup();\n      group.addShape('line', {\n        attrs: {\n          x1: x1,\n          y1: y1,\n          x2: x2,\n          y2: y2,\n          stroke: '#1890FF',\n          lineWidth: 1\n        }\n      });\n    } // draw nodes\n\n\n    for (var _i2 = 0; _i2 < numParticles * 4; _i2 += 4) {\n      var x = finalParticleData[_i2];\n      var y = finalParticleData[_i2 + 1];\n\n      var _group = canvas.addGroup();\n\n      _group.addShape('circle', {\n        attrs: {\n          x: x,\n          y: y,\n          r: 5,\n          fill: 'red',\n          stroke: 'blue',\n          lineWidth: 2\n        }\n      });\n    }\n  }\n\n  var lineIndexBufferData = [];\n  var maxEdgePerVetex; // @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\n\n  function buildTextureData(nodes, edges) {\n    var dataArray = [];\n    var nodeDict = [];\n    var mapIdPos = {};\n    var i = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var n = nodes[i];\n      mapIdPos[n.id] = i;\n      dataArray.push(n.x);\n      dataArray.push(n.y);\n      dataArray.push(0);\n      dataArray.push(0);\n      nodeDict.push([]);\n    }\n\n    for (i = 0; i < edges.length; i++) {\n      var e = edges[i];\n      nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n      nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n      lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n    }\n\n    maxEdgePerVetex = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var offset = dataArray.length;\n      var dests = nodeDict[i];\n      var len = dests.length;\n      dataArray[i * 4 + 2] = offset;\n      dataArray[i * 4 + 3] = dests.length;\n      maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n\n      for (var j = 0; j < len; ++j) {\n        var dest = dests[j];\n        dataArray.push(+dest);\n      }\n    }\n\n    while (dataArray.length % 4 !== 0) {\n      dataArray.push(0);\n    }\n\n    return new Float32Array(dataArray);\n  }\n});"},{"relativePath":"gpgpu/graph/fruchterman/demo/cluster.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/graph/fruchterman/demo/cluster.tsx","order":2,"filename":"cluster.tsx","title":"Cluster","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Canvas } from '@antv/g-canvas';\nimport { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\nconst MAX_EDGE_PER_VERTEX;\nconst VERTEX_COUNT;\n\n@numthreads(1, 1, 1)\nclass Fruchterman {\n  @in @out\n  u_Data: vec4[];\n\n  @in\n  u_K: float;\n\n  @in\n  u_K2: float;\n  \n  @in\n  u_Center: vec2;\n\n  @in\n  u_Gravity: float;\n\n  @in\n  u_ClusterGravity: float;\n\n  @in\n  u_Speed: float;\n\n  @in\n  u_MaxDisplace: float;\n\n  @in\n  u_Clustering: float;\n\n  @in\n  u_AttributeArray: vec4[];\n\n  @in\n  u_ClusterCenters: vec4[];\n\n  calcRepulsive(i: int, currentNode: vec4): vec2 {\n    let dx = 0, dy = 0;\n    for (let j = 0; j < VERTEX_COUNT; j++) {\n      if (i != j) {\n        const nextNode = this.u_Data[j];\n        const xDist = currentNode[0] - nextNode[0];\n        const yDist = currentNode[1] - nextNode[1];\n        const dist = (xDist * xDist + yDist * yDist) + 0.01;\n\n        let param = this.u_K2 / dist;\n        \n        if (dist > 0.0) {\n          dx += param * xDist ;\n          dy += param * yDist ;\n        }\n      }\n    }\n    return [dx, dy];\n  }\n\n  calcGravity(currentNode: vec4, nodeAttributes: vec4): vec2 { // \n    let dx = 0, dy = 0;\n    const vx = currentNode[0] - this.u_Center[0];\n    const vy = currentNode[1] - this.u_Center[1];\n    const gf = 0.01 * this.u_K * this.u_Gravity;\n    dx = gf * vx;\n    dy = gf * vy;\n\n    if (this.u_Clustering == 1) {\n      const clusterIdx = int(nodeAttributes[0]);\n      const center = this.u_ClusterCenters[clusterIdx];\n      const cvx = currentNode[0] - center[0];\n      const cvy = currentNode[1] - center[1];\n      const dist = sqrt(cvx * cvx + cvy * cvy) + 0.001;\n      const parma = this.u_K * this.u_ClusterGravity / dist;\n      dx += parma * cvx;\n      dy += parma * cvy;\n    }\n\n    return [dx, dy];\n  }\n\n  calcAttractive(i: int, currentNode: vec4): vec2 {\n    let dx = 0, dy = 0;\n    const arr_offset = int(floor(currentNode[2] + 0.5));\n    const length = int(floor(currentNode[3] + 0.5));\n    const node_buffer: vec4;\n    for (let p = 0; p < MAX_EDGE_PER_VERTEX; p++) {\n      if (p >= length) break;\n      const arr_idx = arr_offset + p;\n      // when arr_idx % 4 == 0 update currentNodedx_buffer\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\n      if (p == 0 || buf_offset == 0) {\n        node_buffer = this.u_Data[int(arr_idx / 4)];\n      }\n      const float_j = buf_offset == 0 ? node_buffer[0] :\n                      buf_offset == 1 ? node_buffer[1] :\n                      buf_offset == 2 ? node_buffer[2] :\n                                        node_buffer[3];\n      const nextNode = this.u_Data[int(float_j)];\n      const xDist = currentNode[0] - nextNode[0];\n      const yDist = currentNode[1] - nextNode[1];\n      const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\n      let attractiveF = dist / this.u_K;\n    \n      if (dist > 0.0) {\n        dx -= xDist * attractiveF;\n        dy -= yDist * attractiveF;\n      }\n    }\n    return [dx, dy];\n  }\n\n  @main\n  compute() {\n    const i = globalInvocationID.x;\n    const currentNode = this.u_Data[i];\n\n    let dx = 0, dy = 0;\n\n    if (i >= VERTEX_COUNT) {\n      this.u_Data[i] = currentNode;\n      return;\n    }\n\n    // repulsive\n    const repulsive = this.calcRepulsive(i, currentNode);\n    dx += repulsive[0];\n    dy += repulsive[1];\n\n    // attractive\n    const attractive = this.calcAttractive(i, currentNode);\n    dx += attractive[0];\n    dy += attractive[1];\n\n    // gravity\n    const nodeAttributes = this.u_AttributeArray[i];\n    const gravity = this.calcGravity(currentNode, nodeAttributes);\n    dx -= gravity[0];\n    dy -= gravity[1];\n\n    // speed\n    dx *= this.u_Speed;\n    dy *= this.u_Speed;\n\n    // move\n    const distLength = sqrt(dx * dx + dy * dy);\n    if (distLength > 0.0) {\n      const limitedDist = min(this.u_MaxDisplace * this.u_Speed, distLength);\n\n      this.u_Data[i] = [\n        currentNode[0] + dx / distLength * limitedDist,\n        currentNode[1] + dy / distLength * limitedDist,\n        currentNode[2],\n        currentNode[3]\n      ];\n    }\n  }\n}\n`;\n\nconst gCode2 = `\nimport { globalInvocationID } from 'g-webgpu';\n\nconst VERTEX_COUNT;\nconst CLUSTER_COUNT;\n\n@numthreads(1, 1, 1)\nclass CalcCenter {\n  @in\n  u_Data: vec4[];\n\n  @in\n  u_NodeAttributes: vec4[]; // [[clusterIdx, 0, 0, 0], ...]\n\n  @in @out\n  u_ClusterCenters: vec4[]; // [[cx, cy, nodeCount, clusterIdx], ...]\n\n  @main\n  compute() {\n    const i = globalInvocationID.x;\n    const center = this.u_ClusterCenters[i];\n\n    let sumx = 0;\n    let sumy = 0;\n    let count = 0;\n    for (let j = 0; j < VERTEX_COUNT; j++) {\n      const attributes = this.u_NodeAttributes[j];\n      const clusterIdx = int(attributes[0]);\n      const vertex = this.u_Data[j];\n\n      if (clusterIdx == i) {\n        sumx += vertex.x;\n        sumy += vertex.y;\n        count += 1;\n      }\n    }\n\n    this.u_ClusterCenters[i] = [\n      sumx / count,\n      sumy / count,\n      count,\n      i\n    ];\n  }\n}\n`;\n\nconst MAX_ITERATION = 1000;\nconst CANVAS_HEIGHT = 600;\nconst CANVAS_WIDTH = 600;\nconst App = React.memo(function Fruchterman() {\n  const [timeElapsed, setTimeElapsed] = useState(0);\n  useEffect(() => {\n    (async () => {\n      // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n      const data = {\n        nodes: [\n          {\n            id: '0',\n            label: '0',\n            cluster: 'a',\n          },\n          {\n            id: '1',\n            label: '1',\n            cluster: 'a',\n          },\n          {\n            id: '2',\n            label: '2',\n            cluster: 'a',\n          },\n          {\n            id: '3',\n            label: '3',\n            cluster: 'a',\n          },\n          {\n            id: '4',\n            label: '4',\n            cluster: 'a',\n          },\n          {\n            id: '5',\n            label: '5',\n            cluster: 'a',\n          },\n          {\n            id: '6',\n            label: '6',\n            cluster: 'a',\n          },\n          {\n            id: '7',\n            label: '7',\n            cluster: 'a',\n          },\n          {\n            id: '8',\n            label: '8',\n            cluster: 'a',\n          },\n          {\n            id: '9',\n            label: '9',\n            cluster: 'a',\n          },\n          {\n            id: '10',\n            label: '10',\n            cluster: 'a',\n          },\n          {\n            id: '11',\n            label: '11',\n            cluster: 'a',\n          },\n          {\n            id: '12',\n            label: '12',\n            cluster: 'a',\n          },\n          {\n            id: '13',\n            label: '13',\n            cluster: 'b',\n          },\n          {\n            id: '14',\n            label: '14',\n            cluster: 'b',\n          },\n          {\n            id: '15',\n            label: '15',\n            cluster: 'b',\n          },\n          {\n            id: '16',\n            label: '16',\n            cluster: 'b',\n          },\n          {\n            id: '17',\n            label: '17',\n            cluster: 'b',\n          },\n          {\n            id: '18',\n            label: '18',\n            cluster: 'c',\n          },\n          {\n            id: '19',\n            label: '19',\n            cluster: 'c',\n          },\n          {\n            id: '20',\n            label: '20',\n            cluster: 'c',\n          },\n          {\n            id: '21',\n            label: '21',\n            cluster: 'c',\n          },\n          {\n            id: '22',\n            label: '22',\n            cluster: 'c',\n          },\n          {\n            id: '23',\n            label: '23',\n            cluster: 'c',\n          },\n          {\n            id: '24',\n            label: '24',\n            cluster: 'c',\n          },\n          {\n            id: '25',\n            label: '25',\n            cluster: 'c',\n          },\n          {\n            id: '26',\n            label: '26',\n            cluster: 'c',\n          },\n          {\n            id: '27',\n            label: '27',\n            cluster: 'c',\n          },\n          {\n            id: '28',\n            label: '28',\n            cluster: 'c',\n          },\n          {\n            id: '29',\n            label: '29',\n            cluster: 'c',\n          },\n          {\n            id: '30',\n            label: '30',\n            cluster: 'c',\n          },\n          {\n            id: '31',\n            label: '31',\n            cluster: 'd',\n          },\n          {\n            id: '32',\n            label: '32',\n            cluster: 'd',\n          },\n          {\n            id: '33',\n            label: '33',\n            cluster: 'd',\n          },\n        ],\n        edges: [\n          {\n            source: '0',\n            target: '1',\n          },\n          {\n            source: '0',\n            target: '2',\n          },\n          {\n            source: '0',\n            target: '3',\n          },\n          {\n            source: '0',\n            target: '4',\n          },\n          {\n            source: '0',\n            target: '5',\n          },\n          {\n            source: '0',\n            target: '7',\n          },\n          {\n            source: '0',\n            target: '8',\n          },\n          {\n            source: '0',\n            target: '9',\n          },\n          {\n            source: '0',\n            target: '10',\n          },\n          {\n            source: '0',\n            target: '11',\n          },\n          {\n            source: '0',\n            target: '13',\n          },\n          {\n            source: '0',\n            target: '14',\n          },\n          {\n            source: '0',\n            target: '15',\n          },\n          {\n            source: '0',\n            target: '16',\n          },\n          {\n            source: '2',\n            target: '3',\n          },\n          {\n            source: '4',\n            target: '5',\n          },\n          {\n            source: '4',\n            target: '6',\n          },\n          {\n            source: '5',\n            target: '6',\n          },\n          {\n            source: '7',\n            target: '13',\n          },\n          {\n            source: '8',\n            target: '14',\n          },\n          {\n            source: '9',\n            target: '10',\n          },\n          {\n            source: '10',\n            target: '22',\n          },\n          {\n            source: '10',\n            target: '14',\n          },\n          {\n            source: '10',\n            target: '12',\n          },\n          {\n            source: '10',\n            target: '24',\n          },\n          {\n            source: '10',\n            target: '21',\n          },\n          {\n            source: '10',\n            target: '20',\n          },\n          {\n            source: '11',\n            target: '24',\n          },\n          {\n            source: '11',\n            target: '22',\n          },\n          {\n            source: '11',\n            target: '14',\n          },\n          {\n            source: '12',\n            target: '13',\n          },\n          {\n            source: '16',\n            target: '17',\n          },\n          {\n            source: '16',\n            target: '18',\n          },\n          {\n            source: '16',\n            target: '21',\n          },\n          {\n            source: '16',\n            target: '22',\n          },\n          {\n            source: '17',\n            target: '18',\n          },\n          {\n            source: '17',\n            target: '20',\n          },\n          {\n            source: '18',\n            target: '19',\n          },\n          {\n            source: '19',\n            target: '20',\n          },\n          {\n            source: '19',\n            target: '33',\n          },\n          {\n            source: '19',\n            target: '22',\n          },\n          {\n            source: '19',\n            target: '23',\n          },\n          {\n            source: '20',\n            target: '21',\n          },\n          {\n            source: '21',\n            target: '22',\n          },\n          {\n            source: '22',\n            target: '24',\n          },\n          {\n            source: '22',\n            target: '25',\n          },\n          {\n            source: '22',\n            target: '26',\n          },\n          {\n            source: '22',\n            target: '23',\n          },\n          {\n            source: '22',\n            target: '28',\n          },\n          {\n            source: '22',\n            target: '30',\n          },\n          {\n            source: '22',\n            target: '31',\n          },\n          {\n            source: '22',\n            target: '32',\n          },\n          {\n            source: '22',\n            target: '33',\n          },\n          {\n            source: '23',\n            target: '28',\n          },\n          {\n            source: '23',\n            target: '27',\n          },\n          {\n            source: '23',\n            target: '29',\n          },\n          {\n            source: '23',\n            target: '30',\n          },\n          {\n            source: '23',\n            target: '31',\n          },\n          {\n            source: '23',\n            target: '33',\n          },\n          {\n            source: '32',\n            target: '33',\n          },\n        ],\n      };\n\n      const center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n      const nodes = data.nodes.map((n) => ({\n        x: Math.random() * CANVAS_WIDTH,\n        y: Math.random() * CANVAS_HEIGHT,\n        id: n.id,\n      }));\n      const edges = data.edges;\n      const numParticles = nodes.length;\n      const nodesEdgesArray = buildTextureData(nodes, edges);\n      const {\n        array: attributeArray,\n        count: clusterCount,\n      } = attributesToTextureData('cluster', data.nodes);\n\n      // compile our kernel code\n      const compiler = new Compiler();\n      const precompiledBundle = compiler.compileBundle(gCode);\n      const precompiledBundle2 = compiler.compileBundle(gCode2);\n\n      // create world\n      const world = World.create({\n        engineOptions: {\n          supportCompute: true,\n        },\n      });\n\n      const timeStart = window.performance.now();\n\n      const area = CANVAS_HEIGHT * CANVAS_WIDTH;\n      let maxDisplace = Math.sqrt(area) / 10;\n      const k2 = area / (nodes.length + 1);\n      const k = Math.sqrt(k2);\n\n      const clusterCenters = [];\n      for (let i = 0; i < clusterCount; i++) {\n        clusterCenters.push(0, 0, 0, 0);\n      }\n\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([numParticles, 1, 1])\n        .setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_ClusterGravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Clustering: 1,\n          u_Center: center,\n          u_AttributeArray: attributeArray,\n          u_ClusterCenters: clusterCenters,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles,\n        });\n\n      const kernel2 = world\n        .createKernel(precompiledBundle2)\n        .setDispatch([clusterCount, 1, 1])\n        .setBinding({\n          u_Data: nodesEdgesArray,\n          u_NodeAttributes: attributeArray,\n          u_ClusterCenters: clusterCenters,\n          VERTEX_COUNT: numParticles,\n          CLUSTER_COUNT: clusterCount,\n        });\n\n      for (let i = 0; i < MAX_ITERATION; i++) {\n        await kernel.execute();\n        kernel2.setBinding({\n          u_Data: kernel,\n        });\n        await kernel2.execute();\n        kernel.setBinding({\n          u_MaxDisplace: maxDisplace *= 0.99,\n          u_ClusterCenters: kernel2,\n        });\n      }\n\n      const finalParticleData = await kernel.getOutput();\n\n      setTimeElapsed(window.performance.now() - timeStart);\n      // draw with G\n      renderCircles(finalParticleData, numParticles);\n\n      window.gwebgpuClean = () => {\n        world.destroy();\n      };\n    })();\n  }, []);\n\n  return (\n    <>\n      <div>Elapsed time: {timeElapsed / 1000}s</div>\n      <div>4 clusters</div>\n      <div id=\"container\" />\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n\nfunction renderCircles(finalParticleData, numParticles) {\n  const canvas = new Canvas({\n    container: 'container',\n    center: [],\n    width: CANVAS_WIDTH,\n    height: CANVAS_HEIGHT,\n  });\n\n  // draw edges\n  for (let i = 0; i < lineIndexBufferData.length; i += 2) {\n    const x1 = finalParticleData[lineIndexBufferData[i] * 4];\n    const y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n    const x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n    const y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n    const group = canvas.addGroup();\n    group.addShape('line', {\n      attrs: {\n        x1,\n        y1,\n        x2,\n        y2,\n        stroke: '#1890FF',\n        lineWidth: 1,\n      },\n    });\n  }\n\n  // draw nodes\n  for (let i = 0; i < numParticles * 4; i += 4) {\n    const x = finalParticleData[i];\n    const y = finalParticleData[i + 1];\n    const group = canvas.addGroup();\n    group.addShape('circle', {\n      attrs: {\n        x,\n        y,\n        r: 5,\n        fill: 'red',\n        stroke: 'blue',\n        lineWidth: 2,\n      },\n    });\n  }\n}\n\nconst lineIndexBufferData = [];\nlet maxEdgePerVetex;\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\nfunction buildTextureData(nodes, edges) {\n  const dataArray = [];\n  const nodeDict = [];\n  const mapIdPos = {};\n  let i = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const n = nodes[i];\n    mapIdPos[n.id] = i;\n    dataArray.push(n.x);\n    dataArray.push(n.y);\n    dataArray.push(0);\n    dataArray.push(0);\n    nodeDict.push([]);\n  }\n  for (i = 0; i < edges.length; i++) {\n    const e = edges[i];\n    nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n    nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n    lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n  }\n\n  maxEdgePerVetex = 0;\n  for (i = 0; i < nodes.length; i++) {\n    const offset = dataArray.length;\n    const dests = nodeDict[i];\n    const len = dests.length;\n    dataArray[i * 4 + 2] = offset;\n    dataArray[i * 4 + 3] = dests.length;\n    maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n    for (let j = 0; j < len; ++j) {\n      const dest = dests[j];\n      dataArray.push(+dest);\n    }\n  }\n\n  while (dataArray.length % 4 !== 0) {\n    dataArray.push(0);\n  }\n  return new Float32Array(dataArray);\n}\n\nfunction attributesToTextureData(clusterKey: string, nodes) {\n  const dataArray = [];\n  const clusterNames = [];\n  nodes.forEach((node) => {\n    const clusterName = node[clusterKey];\n    let index = clusterNames.indexOf(clusterName);\n    if (index === -1) {\n      clusterNames.push(clusterName);\n      index = clusterNames.length - 1;\n    }\n    dataArray.push(index, 0, 0, 0);\n  });\n\n  return {\n    array: new Float32Array(dataArray),\n    count: clusterNames.length,\n  };\n}\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-canvas\", \"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-canvas\"), require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gCanvas, global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.cluster = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gCanvas, _gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\nconst MAX_EDGE_PER_VERTEX;\\nconst VERTEX_COUNT;\\n\\n@numthreads(1, 1, 1)\\nclass Fruchterman {\\n  @in @out\\n  u_Data: vec4[];\\n\\n  @in\\n  u_K: float;\\n\\n  @in\\n  u_K2: float;\\n  \\n  @in\\n  u_Center: vec2;\\n\\n  @in\\n  u_Gravity: float;\\n\\n  @in\\n  u_ClusterGravity: float;\\n\\n  @in\\n  u_Speed: float;\\n\\n  @in\\n  u_MaxDisplace: float;\\n\\n  @in\\n  u_Clustering: float;\\n\\n  @in\\n  u_AttributeArray: vec4[];\\n\\n  @in\\n  u_ClusterCenters: vec4[];\\n\\n  calcRepulsive(i: int, currentNode: vec4): vec2 {\\n    let dx = 0, dy = 0;\\n    for (let j = 0; j < VERTEX_COUNT; j++) {\\n      if (i != j) {\\n        const nextNode = this.u_Data[j];\\n        const xDist = currentNode[0] - nextNode[0];\\n        const yDist = currentNode[1] - nextNode[1];\\n        const dist = (xDist * xDist + yDist * yDist) + 0.01;\\n\\n        let param = this.u_K2 / dist;\\n        \\n        if (dist > 0.0) {\\n          dx += param * xDist ;\\n          dy += param * yDist ;\\n        }\\n      }\\n    }\\n    return [dx, dy];\\n  }\\n\\n  calcGravity(currentNode: vec4, nodeAttributes: vec4): vec2 { // \\n    let dx = 0, dy = 0;\\n    const vx = currentNode[0] - this.u_Center[0];\\n    const vy = currentNode[1] - this.u_Center[1];\\n    const gf = 0.01 * this.u_K * this.u_Gravity;\\n    dx = gf * vx;\\n    dy = gf * vy;\\n\\n    if (this.u_Clustering == 1) {\\n      const clusterIdx = int(nodeAttributes[0]);\\n      const center = this.u_ClusterCenters[clusterIdx];\\n      const cvx = currentNode[0] - center[0];\\n      const cvy = currentNode[1] - center[1];\\n      const dist = sqrt(cvx * cvx + cvy * cvy) + 0.001;\\n      const parma = this.u_K * this.u_ClusterGravity / dist;\\n      dx += parma * cvx;\\n      dy += parma * cvy;\\n    }\\n\\n    return [dx, dy];\\n  }\\n\\n  calcAttractive(i: int, currentNode: vec4): vec2 {\\n    let dx = 0, dy = 0;\\n    const arr_offset = int(floor(currentNode[2] + 0.5));\\n    const length = int(floor(currentNode[3] + 0.5));\\n    const node_buffer: vec4;\\n    for (let p = 0; p < MAX_EDGE_PER_VERTEX; p++) {\\n      if (p >= length) break;\\n      const arr_idx = arr_offset + p;\\n      // when arr_idx % 4 == 0 update currentNodedx_buffer\\n      const buf_offset = arr_idx - arr_idx / 4 * 4;\\n      if (p == 0 || buf_offset == 0) {\\n        node_buffer = this.u_Data[int(arr_idx / 4)];\\n      }\\n      const float_j = buf_offset == 0 ? node_buffer[0] :\\n                      buf_offset == 1 ? node_buffer[1] :\\n                      buf_offset == 2 ? node_buffer[2] :\\n                                        node_buffer[3];\\n      const nextNode = this.u_Data[int(float_j)];\\n      const xDist = currentNode[0] - nextNode[0];\\n      const yDist = currentNode[1] - nextNode[1];\\n      const dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\\n      let attractiveF = dist / this.u_K;\\n    \\n      if (dist > 0.0) {\\n        dx -= xDist * attractiveF;\\n        dy -= yDist * attractiveF;\\n      }\\n    }\\n    return [dx, dy];\\n  }\\n\\n  @main\\n  compute() {\\n    const i = globalInvocationID.x;\\n    const currentNode = this.u_Data[i];\\n\\n    let dx = 0, dy = 0;\\n\\n    if (i >= VERTEX_COUNT) {\\n      this.u_Data[i] = currentNode;\\n      return;\\n    }\\n\\n    // repulsive\\n    const repulsive = this.calcRepulsive(i, currentNode);\\n    dx += repulsive[0];\\n    dy += repulsive[1];\\n\\n    // attractive\\n    const attractive = this.calcAttractive(i, currentNode);\\n    dx += attractive[0];\\n    dy += attractive[1];\\n\\n    // gravity\\n    const nodeAttributes = this.u_AttributeArray[i];\\n    const gravity = this.calcGravity(currentNode, nodeAttributes);\\n    dx -= gravity[0];\\n    dy -= gravity[1];\\n\\n    // speed\\n    dx *= this.u_Speed;\\n    dy *= this.u_Speed;\\n\\n    // move\\n    const distLength = sqrt(dx * dx + dy * dy);\\n    if (distLength > 0.0) {\\n      const limitedDist = min(this.u_MaxDisplace * this.u_Speed, distLength);\\n\\n      this.u_Data[i] = [\\n        currentNode[0] + dx / distLength * limitedDist,\\n        currentNode[1] + dy / distLength * limitedDist,\\n        currentNode[2],\\n        currentNode[3]\\n      ];\\n    }\\n  }\\n}\\n\";\n  var gCode2 = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\nconst VERTEX_COUNT;\\nconst CLUSTER_COUNT;\\n\\n@numthreads(1, 1, 1)\\nclass CalcCenter {\\n  @in\\n  u_Data: vec4[];\\n\\n  @in\\n  u_NodeAttributes: vec4[]; // [[clusterIdx, 0, 0, 0], ...]\\n\\n  @in @out\\n  u_ClusterCenters: vec4[]; // [[cx, cy, nodeCount, clusterIdx], ...]\\n\\n  @main\\n  compute() {\\n    const i = globalInvocationID.x;\\n    const center = this.u_ClusterCenters[i];\\n\\n    let sumx = 0;\\n    let sumy = 0;\\n    let count = 0;\\n    for (let j = 0; j < VERTEX_COUNT; j++) {\\n      const attributes = this.u_NodeAttributes[j];\\n      const clusterIdx = int(attributes[0]);\\n      const vertex = this.u_Data[j];\\n\\n      if (clusterIdx == i) {\\n        sumx += vertex.x;\\n        sumy += vertex.y;\\n        count += 1;\\n      }\\n    }\\n\\n    this.u_ClusterCenters[i] = [\\n      sumx / count,\\n      sumy / count,\\n      count,\\n      i\\n    ];\\n  }\\n}\\n\";\n  var MAX_ITERATION = 1000;\n  var CANVAS_HEIGHT = 600;\n  var CANVAS_WIDTH = 600;\n\n  var App = /*#__PURE__*/_react.default.memo(function Fruchterman() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        timeElapsed = _useState2[0],\n        setTimeElapsed = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        // @see https://g6.antv.vision/en/examples/net/forceDirected/#basicForceDirected\n        var data = {\n          nodes: [{\n            id: '0',\n            label: '0',\n            cluster: 'a'\n          }, {\n            id: '1',\n            label: '1',\n            cluster: 'a'\n          }, {\n            id: '2',\n            label: '2',\n            cluster: 'a'\n          }, {\n            id: '3',\n            label: '3',\n            cluster: 'a'\n          }, {\n            id: '4',\n            label: '4',\n            cluster: 'a'\n          }, {\n            id: '5',\n            label: '5',\n            cluster: 'a'\n          }, {\n            id: '6',\n            label: '6',\n            cluster: 'a'\n          }, {\n            id: '7',\n            label: '7',\n            cluster: 'a'\n          }, {\n            id: '8',\n            label: '8',\n            cluster: 'a'\n          }, {\n            id: '9',\n            label: '9',\n            cluster: 'a'\n          }, {\n            id: '10',\n            label: '10',\n            cluster: 'a'\n          }, {\n            id: '11',\n            label: '11',\n            cluster: 'a'\n          }, {\n            id: '12',\n            label: '12',\n            cluster: 'a'\n          }, {\n            id: '13',\n            label: '13',\n            cluster: 'b'\n          }, {\n            id: '14',\n            label: '14',\n            cluster: 'b'\n          }, {\n            id: '15',\n            label: '15',\n            cluster: 'b'\n          }, {\n            id: '16',\n            label: '16',\n            cluster: 'b'\n          }, {\n            id: '17',\n            label: '17',\n            cluster: 'b'\n          }, {\n            id: '18',\n            label: '18',\n            cluster: 'c'\n          }, {\n            id: '19',\n            label: '19',\n            cluster: 'c'\n          }, {\n            id: '20',\n            label: '20',\n            cluster: 'c'\n          }, {\n            id: '21',\n            label: '21',\n            cluster: 'c'\n          }, {\n            id: '22',\n            label: '22',\n            cluster: 'c'\n          }, {\n            id: '23',\n            label: '23',\n            cluster: 'c'\n          }, {\n            id: '24',\n            label: '24',\n            cluster: 'c'\n          }, {\n            id: '25',\n            label: '25',\n            cluster: 'c'\n          }, {\n            id: '26',\n            label: '26',\n            cluster: 'c'\n          }, {\n            id: '27',\n            label: '27',\n            cluster: 'c'\n          }, {\n            id: '28',\n            label: '28',\n            cluster: 'c'\n          }, {\n            id: '29',\n            label: '29',\n            cluster: 'c'\n          }, {\n            id: '30',\n            label: '30',\n            cluster: 'c'\n          }, {\n            id: '31',\n            label: '31',\n            cluster: 'd'\n          }, {\n            id: '32',\n            label: '32',\n            cluster: 'd'\n          }, {\n            id: '33',\n            label: '33',\n            cluster: 'd'\n          }],\n          edges: [{\n            source: '0',\n            target: '1'\n          }, {\n            source: '0',\n            target: '2'\n          }, {\n            source: '0',\n            target: '3'\n          }, {\n            source: '0',\n            target: '4'\n          }, {\n            source: '0',\n            target: '5'\n          }, {\n            source: '0',\n            target: '7'\n          }, {\n            source: '0',\n            target: '8'\n          }, {\n            source: '0',\n            target: '9'\n          }, {\n            source: '0',\n            target: '10'\n          }, {\n            source: '0',\n            target: '11'\n          }, {\n            source: '0',\n            target: '13'\n          }, {\n            source: '0',\n            target: '14'\n          }, {\n            source: '0',\n            target: '15'\n          }, {\n            source: '0',\n            target: '16'\n          }, {\n            source: '2',\n            target: '3'\n          }, {\n            source: '4',\n            target: '5'\n          }, {\n            source: '4',\n            target: '6'\n          }, {\n            source: '5',\n            target: '6'\n          }, {\n            source: '7',\n            target: '13'\n          }, {\n            source: '8',\n            target: '14'\n          }, {\n            source: '9',\n            target: '10'\n          }, {\n            source: '10',\n            target: '22'\n          }, {\n            source: '10',\n            target: '14'\n          }, {\n            source: '10',\n            target: '12'\n          }, {\n            source: '10',\n            target: '24'\n          }, {\n            source: '10',\n            target: '21'\n          }, {\n            source: '10',\n            target: '20'\n          }, {\n            source: '11',\n            target: '24'\n          }, {\n            source: '11',\n            target: '22'\n          }, {\n            source: '11',\n            target: '14'\n          }, {\n            source: '12',\n            target: '13'\n          }, {\n            source: '16',\n            target: '17'\n          }, {\n            source: '16',\n            target: '18'\n          }, {\n            source: '16',\n            target: '21'\n          }, {\n            source: '16',\n            target: '22'\n          }, {\n            source: '17',\n            target: '18'\n          }, {\n            source: '17',\n            target: '20'\n          }, {\n            source: '18',\n            target: '19'\n          }, {\n            source: '19',\n            target: '20'\n          }, {\n            source: '19',\n            target: '33'\n          }, {\n            source: '19',\n            target: '22'\n          }, {\n            source: '19',\n            target: '23'\n          }, {\n            source: '20',\n            target: '21'\n          }, {\n            source: '21',\n            target: '22'\n          }, {\n            source: '22',\n            target: '24'\n          }, {\n            source: '22',\n            target: '25'\n          }, {\n            source: '22',\n            target: '26'\n          }, {\n            source: '22',\n            target: '23'\n          }, {\n            source: '22',\n            target: '28'\n          }, {\n            source: '22',\n            target: '30'\n          }, {\n            source: '22',\n            target: '31'\n          }, {\n            source: '22',\n            target: '32'\n          }, {\n            source: '22',\n            target: '33'\n          }, {\n            source: '23',\n            target: '28'\n          }, {\n            source: '23',\n            target: '27'\n          }, {\n            source: '23',\n            target: '29'\n          }, {\n            source: '23',\n            target: '30'\n          }, {\n            source: '23',\n            target: '31'\n          }, {\n            source: '23',\n            target: '33'\n          }, {\n            source: '32',\n            target: '33'\n          }]\n        };\n        var center = [CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2];\n        var nodes = data.nodes.map(function (n) {\n          return {\n            x: Math.random() * CANVAS_WIDTH,\n            y: Math.random() * CANVAS_HEIGHT,\n            id: n.id\n          };\n        });\n        var edges = data.edges;\n        var numParticles = nodes.length;\n        var nodesEdgesArray = buildTextureData(nodes, edges);\n\n        var _attributesToTextureD = attributesToTextureData('cluster', data.nodes),\n            attributeArray = _attributesToTextureD.array,\n            clusterCount = _attributesToTextureD.count; // compile our kernel code\n\n\n        var compiler = new _gWebgpuCompiler.Compiler();\n        var precompiledBundle = compiler.compileBundle(gCode);\n        var precompiledBundle2 = compiler.compileBundle(gCode2); // create world\n\n        var world = _gWebgpu.World.create({\n          engineOptions: {\n            supportCompute: true\n          }\n        });\n\n        var timeStart = window.performance.now();\n        var area = CANVAS_HEIGHT * CANVAS_WIDTH;\n        var maxDisplace = Math.sqrt(area) / 10;\n        var k2 = area / (nodes.length + 1);\n        var k = Math.sqrt(k2);\n        var clusterCenters = [];\n\n        for (var i = 0; i < clusterCount; i++) {\n          clusterCenters.push(0, 0, 0, 0);\n        }\n\n        var kernel = world.createKernel(precompiledBundle).setDispatch([numParticles, 1, 1]).setBinding({\n          u_Data: nodesEdgesArray,\n          u_K: k,\n          u_K2: k2,\n          u_Gravity: 10,\n          u_ClusterGravity: 10,\n          u_Speed: 0.1,\n          u_MaxDisplace: maxDisplace,\n          u_Clustering: 1,\n          u_Center: center,\n          u_AttributeArray: attributeArray,\n          u_ClusterCenters: clusterCenters,\n          MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n          VERTEX_COUNT: numParticles\n        });\n        var kernel2 = world.createKernel(precompiledBundle2).setDispatch([clusterCount, 1, 1]).setBinding({\n          u_Data: nodesEdgesArray,\n          u_NodeAttributes: attributeArray,\n          u_ClusterCenters: clusterCenters,\n          VERTEX_COUNT: numParticles,\n          CLUSTER_COUNT: clusterCount\n        });\n\n        for (var _i2 = 0; _i2 < MAX_ITERATION; _i2++) {\n          await kernel.execute();\n          kernel2.setBinding({\n            u_Data: kernel\n          });\n          await kernel2.execute();\n          kernel.setBinding({\n            u_MaxDisplace: maxDisplace *= 0.99,\n            u_ClusterCenters: kernel2\n          });\n        }\n\n        var finalParticleData = await kernel.getOutput();\n        setTimeElapsed(window.performance.now() - timeStart); // draw with G\n\n        renderCircles(finalParticleData, numParticles);\n\n        window.gwebgpuClean = function () {\n          world.destroy();\n        };\n      })();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", null, \"Elapsed time: \", timeElapsed / 1000, \"s\"), /*#__PURE__*/_react.default.createElement(\"div\", null, \"4 clusters\"), /*#__PURE__*/_react.default.createElement(\"div\", {\n      id: \"container\"\n    }));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n\n  function renderCircles(finalParticleData, numParticles) {\n    var canvas = new _gCanvas.Canvas({\n      container: 'container',\n      center: [],\n      width: CANVAS_WIDTH,\n      height: CANVAS_HEIGHT\n    }); // draw edges\n\n    for (var i = 0; i < lineIndexBufferData.length; i += 2) {\n      var x1 = finalParticleData[lineIndexBufferData[i] * 4];\n      var y1 = finalParticleData[lineIndexBufferData[i] * 4 + 1];\n      var x2 = finalParticleData[lineIndexBufferData[i + 1] * 4];\n      var y2 = finalParticleData[lineIndexBufferData[i + 1] * 4 + 1];\n      var group = canvas.addGroup();\n      group.addShape('line', {\n        attrs: {\n          x1: x1,\n          y1: y1,\n          x2: x2,\n          y2: y2,\n          stroke: '#1890FF',\n          lineWidth: 1\n        }\n      });\n    } // draw nodes\n\n\n    for (var _i3 = 0; _i3 < numParticles * 4; _i3 += 4) {\n      var x = finalParticleData[_i3];\n      var y = finalParticleData[_i3 + 1];\n\n      var _group = canvas.addGroup();\n\n      _group.addShape('circle', {\n        attrs: {\n          x: x,\n          y: y,\n          r: 5,\n          fill: 'red',\n          stroke: 'blue',\n          lineWidth: 2\n        }\n      });\n    }\n  }\n\n  var lineIndexBufferData = [];\n  var maxEdgePerVetex; // @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js#L192-L229\n\n  function buildTextureData(nodes, edges) {\n    var dataArray = [];\n    var nodeDict = [];\n    var mapIdPos = {};\n    var i = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var n = nodes[i];\n      mapIdPos[n.id] = i;\n      dataArray.push(n.x);\n      dataArray.push(n.y);\n      dataArray.push(0);\n      dataArray.push(0);\n      nodeDict.push([]);\n    }\n\n    for (i = 0; i < edges.length; i++) {\n      var e = edges[i];\n      nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]);\n      nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]);\n      lineIndexBufferData.push(mapIdPos[e.source], mapIdPos[e.target]);\n    }\n\n    maxEdgePerVetex = 0;\n\n    for (i = 0; i < nodes.length; i++) {\n      var offset = dataArray.length;\n      var dests = nodeDict[i];\n      var len = dests.length;\n      dataArray[i * 4 + 2] = offset;\n      dataArray[i * 4 + 3] = dests.length;\n      maxEdgePerVetex = Math.max(maxEdgePerVetex, dests.length);\n\n      for (var j = 0; j < len; ++j) {\n        var dest = dests[j];\n        dataArray.push(+dest);\n      }\n    }\n\n    while (dataArray.length % 4 !== 0) {\n      dataArray.push(0);\n    }\n\n    return new Float32Array(dataArray);\n  }\n\n  function attributesToTextureData(clusterKey, nodes) {\n    var dataArray = [];\n    var clusterNames = [];\n    nodes.forEach(function (node) {\n      var clusterName = node[clusterKey];\n      var index = clusterNames.indexOf(clusterName);\n\n      if (index === -1) {\n        clusterNames.push(clusterName);\n        index = clusterNames.length - 1;\n      }\n\n      dataArray.push(index, 0, 0, 0);\n    });\n    return {\n      array: new Float32Array(dataArray),\n      count: clusterNames.length\n    };\n  }\n});"},{"relativePath":"gpgpu/basic/reduce/demo/reduce1.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/reduce/demo/reduce1.tsx","order":0,"filename":"reduce1.tsx","title":"Reduce 基础版本","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass Reduce {\n  @in\n  gData: float[]; // 输入\n\n  @out(10)\n  oData: float[]; // 输出\n\n  @shared(1024)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    this.sData[tid] = this.gData[i]; // 1\n    barrier(); // 2\n\n    for (let s: int = 1; s < workGroupSize.x; s*=2) {\n      if (tid % (s * 2) == 0) {\n        this.sData[tid] += this.sData[tid + s]; // 3\n      }\n      barrier();\n    }\n    if (tid == 0) {\n      this.oData[workGroupID.x] = this.sData[0]; // 4\n    }\n  }\n}\n`;\n\nconst App = React.memo(function ReduceSum1() {\n  const [CPUTimeElapsed, setCPUTimeElapsed] = useState(0);\n  const [GPUTimeElapsed, setGPUTimeElapsed] = useState(0);\n  const [CPUResult, setCPUResult] = useState(0);\n  const [GPUResult, setGPUResult] = useState(0);\n  useEffect(() => {\n    const data = new Array(1024 * 10).fill(undefined).map((_, i) => 1);\n    let timeStart = window.performance.now();\n    const sum = data.reduce((cur, prev) => prev + cur, 0);\n    setCPUTimeElapsed(window.performance.now() - timeStart);\n    setCPUResult(sum);\n\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([10, 1, 1])\n        .setBinding('gData', data);\n\n      timeStart = window.performance.now();\n      await kernel.execute();\n      const result = await kernel.getOutput();\n\n      setGPUTimeElapsed(window.performance.now() - timeStart);\n      setGPUResult(result.reduce((cur, prev) => prev + cur, 0));\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2>Reduce Sum (1024 * 10 elements)</h2>\n      <ul>\n        <li>CPU time elapsed: {CPUTimeElapsed}</li>\n        <li>GPU time elapsed: {GPUTimeElapsed}</li>\n        <li>CPUResult: {CPUResult}</li>\n        <li>GPUResult: {GPUResult}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.reduce1 = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass Reduce {\\n  @in\\n  gData: float[]; // \\u8F93\\u5165\\n\\n  @out(10)\\n  oData: float[]; // \\u8F93\\u51FA\\n\\n  @shared(1024)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    this.sData[tid] = this.gData[i]; // 1\\n    barrier(); // 2\\n\\n    for (let s: int = 1; s < workGroupSize.x; s*=2) {\\n      if (tid % (s * 2) == 0) {\\n        this.sData[tid] += this.sData[tid + s]; // 3\\n      }\\n      barrier();\\n    }\\n    if (tid == 0) {\\n      this.oData[workGroupID.x] = this.sData[0]; // 4\\n    }\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function ReduceSum1() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        CPUTimeElapsed = _useState2[0],\n        setCPUTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        GPUTimeElapsed = _useState4[0],\n        setGPUTimeElapsed = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        CPUResult = _useState6[0],\n        setCPUResult = _useState6[1];\n\n    var _useState7 = (0, _react.useState)(0),\n        _useState8 = _slicedToArray(_useState7, 2),\n        GPUResult = _useState8[0],\n        setGPUResult = _useState8[1];\n\n    (0, _react.useEffect)(function () {\n      var data = new Array(1024 * 10).fill(undefined).map(function (_, i) {\n        return 1;\n      });\n      var timeStart = window.performance.now();\n      var sum = data.reduce(function (cur, prev) {\n        return prev + cur;\n      }, 0);\n      setCPUTimeElapsed(window.performance.now() - timeStart);\n      setCPUResult(sum); // compile our kernel code\n\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode);\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([10, 1, 1]).setBinding('gData', data);\n        timeStart = window.performance.now();\n        await kernel.execute();\n        var result = await kernel.getOutput();\n        setGPUTimeElapsed(window.performance.now() - timeStart);\n        setGPUResult(result.reduce(function (cur, prev) {\n          return prev + cur;\n        }, 0));\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \"Reduce Sum (1024 * 10 elements)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU time elapsed: \", CPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU time elapsed: \", GPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPUResult: \", CPUResult), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPUResult: \", GPUResult)));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/reduce/demo/reduce2.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/reduce/demo/reduce2.tsx","order":1,"filename":"reduce2.tsx","title":"Reduce 改进 2.0","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass Reduce {\n  @in\n  gData: float[]; // 输入\n\n  @out(10)\n  oData: float[]; // 输出\n\n  @shared(1024)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    this.sData[tid] = this.gData[i]; // 1\n    barrier(); // 2\n\n    for (let s: int = 1; s < workGroupSize.x; s*=2) {\n      const index = 2 * s * tid;\n      if (index < workGroupSize.x) {\n        this.sData[index] += this.sData[index + s];\n      }\n      barrier();\n    }\n    if (tid == 0) {\n      this.oData[workGroupID.x] = this.sData[0]; // 4\n    }\n  }\n}\n`;\n\nconst App = React.memo(function ReduceSum2() {\n  const [CPUTimeElapsed, setCPUTimeElapsed] = useState(0);\n  const [GPUTimeElapsed, setGPUTimeElapsed] = useState(0);\n  const [CPUResult, setCPUResult] = useState(0);\n  const [GPUResult, setGPUResult] = useState(0);\n  useEffect(() => {\n    const data = new Array(1024 * 10).fill(undefined).map((_, i) => 1);\n    let timeStart = window.performance.now();\n    const sum = data.reduce((cur, prev) => prev + cur, 0);\n    setCPUTimeElapsed(window.performance.now() - timeStart);\n    setCPUResult(sum);\n\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([10, 1, 1])\n        .setBinding('gData', data);\n\n      timeStart = window.performance.now();\n      await kernel.execute();\n      const result = await kernel.getOutput();\n\n      setGPUTimeElapsed(window.performance.now() - timeStart);\n      setGPUResult(result.reduce((cur, prev) => prev + cur, 0));\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2>Reduce Sum (1024 * 10 elements)</h2>\n      <ul>\n        <li>CPU time elapsed: {CPUTimeElapsed}</li>\n        <li>GPU time elapsed: {GPUTimeElapsed}</li>\n        <li>CPUResult: {CPUResult}</li>\n        <li>GPUResult: {GPUResult}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.reduce2 = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass Reduce {\\n  @in\\n  gData: float[]; // \\u8F93\\u5165\\n\\n  @out(10)\\n  oData: float[]; // \\u8F93\\u51FA\\n\\n  @shared(1024)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    this.sData[tid] = this.gData[i]; // 1\\n    barrier(); // 2\\n\\n    for (let s: int = 1; s < workGroupSize.x; s*=2) {\\n      const index = 2 * s * tid;\\n      if (index < workGroupSize.x) {\\n        this.sData[index] += this.sData[index + s];\\n      }\\n      barrier();\\n    }\\n    if (tid == 0) {\\n      this.oData[workGroupID.x] = this.sData[0]; // 4\\n    }\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function ReduceSum2() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        CPUTimeElapsed = _useState2[0],\n        setCPUTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        GPUTimeElapsed = _useState4[0],\n        setGPUTimeElapsed = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        CPUResult = _useState6[0],\n        setCPUResult = _useState6[1];\n\n    var _useState7 = (0, _react.useState)(0),\n        _useState8 = _slicedToArray(_useState7, 2),\n        GPUResult = _useState8[0],\n        setGPUResult = _useState8[1];\n\n    (0, _react.useEffect)(function () {\n      var data = new Array(1024 * 10).fill(undefined).map(function (_, i) {\n        return 1;\n      });\n      var timeStart = window.performance.now();\n      var sum = data.reduce(function (cur, prev) {\n        return prev + cur;\n      }, 0);\n      setCPUTimeElapsed(window.performance.now() - timeStart);\n      setCPUResult(sum); // compile our kernel code\n\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode);\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([10, 1, 1]).setBinding('gData', data);\n        timeStart = window.performance.now();\n        await kernel.execute();\n        var result = await kernel.getOutput();\n        setGPUTimeElapsed(window.performance.now() - timeStart);\n        setGPUResult(result.reduce(function (cur, prev) {\n          return prev + cur;\n        }, 0));\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \"Reduce Sum (1024 * 10 elements)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU time elapsed: \", CPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU time elapsed: \", GPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPUResult: \", CPUResult), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPUResult: \", GPUResult)));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/reduce/demo/reduce3.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/reduce/demo/reduce3.tsx","order":2,"filename":"reduce3.tsx","title":"Reduce 改进 3.0","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass Reduce {\n  @in\n  gData: float[]; // 输入\n\n  @out(10)\n  oData: float[]; // 输出\n\n  @shared(1024)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    this.sData[tid] = this.gData[i]; // 1\n    barrier(); // 2\n\n    for (let s = workGroupSize.x / 2; s > 0; s >>= 1) {\n      if (tid < s) {\n        this.sData[tid] += this.sData[tid + s];\n      }\n      barrier();\n    }\n    if (tid == 0) {\n      this.oData[workGroupID.x] = this.sData[0]; // 4\n    }\n  }\n}\n`;\n\nconst App = React.memo(function ReduceSum3() {\n  const [CPUTimeElapsed, setCPUTimeElapsed] = useState(0);\n  const [GPUTimeElapsed, setGPUTimeElapsed] = useState(0);\n  const [CPUResult, setCPUResult] = useState(0);\n  const [GPUResult, setGPUResult] = useState(0);\n  useEffect(() => {\n    const data = new Array(1024 * 10).fill(undefined).map((_, i) => 1);\n    let timeStart = window.performance.now();\n    const sum = data.reduce((cur, prev) => prev + cur, 0);\n    setCPUTimeElapsed(window.performance.now() - timeStart);\n    setCPUResult(sum);\n\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([10, 1, 1])\n        .setBinding('gData', data);\n\n      timeStart = window.performance.now();\n      await kernel.execute();\n      const result = await kernel.getOutput();\n\n      setGPUTimeElapsed(window.performance.now() - timeStart);\n      setGPUResult(result.reduce((cur, prev) => prev + cur, 0));\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2>Reduce Sum (1024 * 10 elements)</h2>\n      <ul>\n        <li>CPU time elapsed: {CPUTimeElapsed}</li>\n        <li>GPU time elapsed: {GPUTimeElapsed}</li>\n        <li>CPUResult: {CPUResult}</li>\n        <li>GPUResult: {GPUResult}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.reduce3 = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass Reduce {\\n  @in\\n  gData: float[]; // \\u8F93\\u5165\\n\\n  @out(10)\\n  oData: float[]; // \\u8F93\\u51FA\\n\\n  @shared(1024)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    this.sData[tid] = this.gData[i]; // 1\\n    barrier(); // 2\\n\\n    for (let s = workGroupSize.x / 2; s > 0; s >>= 1) {\\n      if (tid < s) {\\n        this.sData[tid] += this.sData[tid + s];\\n      }\\n      barrier();\\n    }\\n    if (tid == 0) {\\n      this.oData[workGroupID.x] = this.sData[0]; // 4\\n    }\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function ReduceSum3() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        CPUTimeElapsed = _useState2[0],\n        setCPUTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        GPUTimeElapsed = _useState4[0],\n        setGPUTimeElapsed = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        CPUResult = _useState6[0],\n        setCPUResult = _useState6[1];\n\n    var _useState7 = (0, _react.useState)(0),\n        _useState8 = _slicedToArray(_useState7, 2),\n        GPUResult = _useState8[0],\n        setGPUResult = _useState8[1];\n\n    (0, _react.useEffect)(function () {\n      var data = new Array(1024 * 10).fill(undefined).map(function (_, i) {\n        return 1;\n      });\n      var timeStart = window.performance.now();\n      var sum = data.reduce(function (cur, prev) {\n        return prev + cur;\n      }, 0);\n      setCPUTimeElapsed(window.performance.now() - timeStart);\n      setCPUResult(sum); // compile our kernel code\n\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode);\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([10, 1, 1]).setBinding('gData', data);\n        timeStart = window.performance.now();\n        await kernel.execute();\n        var result = await kernel.getOutput();\n        setGPUTimeElapsed(window.performance.now() - timeStart);\n        setGPUResult(result.reduce(function (cur, prev) {\n          return prev + cur;\n        }, 0));\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \"Reduce Sum (1024 * 10 elements)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU time elapsed: \", CPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU time elapsed: \", GPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPUResult: \", CPUResult), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPUResult: \", GPUResult)));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/reduce/demo/reduce4.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/reduce/demo/reduce4.tsx","order":3,"filename":"reduce4.tsx","title":"Reduce 改进 4.0","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass Reduce {\n  @in\n  gData: float[]; // 输入\n\n  @out(5)\n  oData: float[]; // 输出\n\n  @shared(1024)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    this.sData[tid] = this.gData[i] + this.gData[i + workGroupSize.x];\n    barrier();\n\n    for (let s = workGroupSize.x / 2; s > 0; s >>= 1) {\n      if (tid < s) {\n        this.sData[tid] += this.sData[tid + s];\n      }\n      barrier();\n    }\n    if (tid == 0) {\n      this.oData[workGroupID.x] = this.sData[0];\n    }\n  }\n}\n`;\n\nconst App = React.memo(function ReduceSum4() {\n  const [CPUTimeElapsed, setCPUTimeElapsed] = useState(0);\n  const [GPUTimeElapsed, setGPUTimeElapsed] = useState(0);\n  const [CPUResult, setCPUResult] = useState(0);\n  const [GPUResult, setGPUResult] = useState(0);\n  useEffect(() => {\n    const data = new Array(1024 * 10).fill(undefined).map((_, i) => 1);\n    let timeStart = window.performance.now();\n    const sum = data.reduce((cur, prev) => prev + cur, 0);\n    setCPUTimeElapsed(window.performance.now() - timeStart);\n    setCPUResult(sum);\n\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([10, 1, 1])\n        .setBinding('gData', data);\n\n      timeStart = window.performance.now();\n      await kernel.execute();\n      const result = await kernel.getOutput();\n\n      setGPUTimeElapsed(window.performance.now() - timeStart);\n      setGPUResult(result.reduce((cur, prev) => prev + cur, 0));\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2>Reduce Sum (1024 * 10 elements)</h2>\n      <ul>\n        <li>CPU time elapsed: {CPUTimeElapsed}</li>\n        <li>GPU time elapsed: {GPUTimeElapsed}</li>\n        <li>CPUResult: {CPUResult}</li>\n        <li>GPUResult: {GPUResult}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.reduce4 = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass Reduce {\\n  @in\\n  gData: float[]; // \\u8F93\\u5165\\n\\n  @out(5)\\n  oData: float[]; // \\u8F93\\u51FA\\n\\n  @shared(1024)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    this.sData[tid] = this.gData[i] + this.gData[i + workGroupSize.x];\\n    barrier();\\n\\n    for (let s = workGroupSize.x / 2; s > 0; s >>= 1) {\\n      if (tid < s) {\\n        this.sData[tid] += this.sData[tid + s];\\n      }\\n      barrier();\\n    }\\n    if (tid == 0) {\\n      this.oData[workGroupID.x] = this.sData[0];\\n    }\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function ReduceSum4() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        CPUTimeElapsed = _useState2[0],\n        setCPUTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        GPUTimeElapsed = _useState4[0],\n        setGPUTimeElapsed = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        CPUResult = _useState6[0],\n        setCPUResult = _useState6[1];\n\n    var _useState7 = (0, _react.useState)(0),\n        _useState8 = _slicedToArray(_useState7, 2),\n        GPUResult = _useState8[0],\n        setGPUResult = _useState8[1];\n\n    (0, _react.useEffect)(function () {\n      var data = new Array(1024 * 10).fill(undefined).map(function (_, i) {\n        return 1;\n      });\n      var timeStart = window.performance.now();\n      var sum = data.reduce(function (cur, prev) {\n        return prev + cur;\n      }, 0);\n      setCPUTimeElapsed(window.performance.now() - timeStart);\n      setCPUResult(sum); // compile our kernel code\n\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode);\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([10, 1, 1]).setBinding('gData', data);\n        timeStart = window.performance.now();\n        await kernel.execute();\n        var result = await kernel.getOutput();\n        setGPUTimeElapsed(window.performance.now() - timeStart);\n        setGPUResult(result.reduce(function (cur, prev) {\n          return prev + cur;\n        }, 0));\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \"Reduce Sum (1024 * 10 elements)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU time elapsed: \", CPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU time elapsed: \", GPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPUResult: \", CPUResult), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPUResult: \", GPUResult)));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/reduce/demo/reduce5.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/reduce/demo/reduce5.tsx","order":4,"filename":"reduce5.tsx","title":"Reduce 改进 5.0","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass Reduce {\n  @in\n  gData: float[]; // 输入\n\n  @out(5)\n  oData: float[]; // 输出\n\n  @shared(1024)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\n\n    this.sData[tid] = this.gData[i] + this.gData[i + workGroupSize.x];\n    barrier();\n\n    for (let s = workGroupSize.x / 2; s > 32; s >>= 1) {\n      if (tid < s) {\n        this.sData[tid] += this.sData[tid + s];\n      }\n      barrier();\n    }\n    if (tid < 32) {\n      this.sData[tid] += this.sData[tid + 32];\n      this.sData[tid] += this.sData[tid + 16];\n      this.sData[tid] += this.sData[tid + 8];\n      this.sData[tid] += this.sData[tid + 4];\n      this.sData[tid] += this.sData[tid + 2];\n      this.sData[tid] += this.sData[tid + 1];\n    }\n    if (tid == 0) {\n      this.oData[workGroupID.x] = this.sData[0];\n    }\n  }\n}\n`;\n\nconst App = React.memo(function ReduceSum5() {\n  const [CPUTimeElapsed, setCPUTimeElapsed] = useState(0);\n  const [GPUTimeElapsed, setGPUTimeElapsed] = useState(0);\n  const [CPUResult, setCPUResult] = useState(0);\n  const [GPUResult, setGPUResult] = useState(0);\n  useEffect(() => {\n    const data = new Array(1024 * 10).fill(undefined).map((_, i) => 1);\n    let timeStart = window.performance.now();\n    const sum = data.reduce((cur, prev) => prev + cur, 0);\n    setCPUTimeElapsed(window.performance.now() - timeStart);\n    setCPUResult(sum);\n\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([10, 1, 1])\n        .setBinding('gData', data);\n\n      timeStart = window.performance.now();\n      await kernel.execute();\n      const result = await kernel.getOutput();\n\n      setGPUTimeElapsed(window.performance.now() - timeStart);\n      setGPUResult(result.reduce((cur, prev) => prev + cur, 0));\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2>Reduce Sum (1024 * 10 elements)</h2>\n      <ul>\n        <li>CPU time elapsed: {CPUTimeElapsed}</li>\n        <li>GPU time elapsed: {GPUTimeElapsed}</li>\n        <li>CPUResult: {CPUResult}</li>\n        <li>GPUResult: {GPUResult}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.reduce5 = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { workGroupSize, workGroupID, localInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass Reduce {\\n  @in\\n  gData: float[]; // \\u8F93\\u5165\\n\\n  @out(5)\\n  oData: float[]; // \\u8F93\\u51FA\\n\\n  @shared(1024)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const i = workGroupID.x * workGroupSize.x + localInvocationID.x;\\n\\n    this.sData[tid] = this.gData[i] + this.gData[i + workGroupSize.x];\\n    barrier();\\n\\n    for (let s = workGroupSize.x / 2; s > 32; s >>= 1) {\\n      if (tid < s) {\\n        this.sData[tid] += this.sData[tid + s];\\n      }\\n      barrier();\\n    }\\n    if (tid < 32) {\\n      this.sData[tid] += this.sData[tid + 32];\\n      this.sData[tid] += this.sData[tid + 16];\\n      this.sData[tid] += this.sData[tid + 8];\\n      this.sData[tid] += this.sData[tid + 4];\\n      this.sData[tid] += this.sData[tid + 2];\\n      this.sData[tid] += this.sData[tid + 1];\\n    }\\n    if (tid == 0) {\\n      this.oData[workGroupID.x] = this.sData[0];\\n    }\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function ReduceSum5() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        CPUTimeElapsed = _useState2[0],\n        setCPUTimeElapsed = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        GPUTimeElapsed = _useState4[0],\n        setGPUTimeElapsed = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        CPUResult = _useState6[0],\n        setCPUResult = _useState6[1];\n\n    var _useState7 = (0, _react.useState)(0),\n        _useState8 = _slicedToArray(_useState7, 2),\n        GPUResult = _useState8[0],\n        setGPUResult = _useState8[1];\n\n    (0, _react.useEffect)(function () {\n      var data = new Array(1024 * 10).fill(undefined).map(function (_, i) {\n        return 1;\n      });\n      var timeStart = window.performance.now();\n      var sum = data.reduce(function (cur, prev) {\n        return prev + cur;\n      }, 0);\n      setCPUTimeElapsed(window.performance.now() - timeStart);\n      setCPUResult(sum); // compile our kernel code\n\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode);\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([10, 1, 1]).setBinding('gData', data);\n        timeStart = window.performance.now();\n        await kernel.execute();\n        var result = await kernel.getOutput();\n        setGPUTimeElapsed(window.performance.now() - timeStart);\n        setGPUResult(result.reduce(function (cur, prev) {\n          return prev + cur;\n        }, 0));\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \"Reduce Sum (1024 * 10 elements)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU time elapsed: \", CPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU time elapsed: \", GPUTimeElapsed), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPUResult: \", CPUResult), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPUResult: \", GPUResult)));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/mergeSort/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/mergeSort/demo/index.tsx","order":0,"filename":"index.tsx","title":"归并排序","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\n// ported from https://bl.ocks.org/zz85/cafa1b8b3098b5a40e918487422d47f6\nconst gCode = `\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\n\n@numthreads(1024, 1, 1)\nclass MergeSort {\n  @in @out\n  gData: float[];\n\n  @in\n  uPass: float;\n\n  @in\n  uStage2: float;\n\n  @in\n  uPassModStage: float;\n\n  @in\n  uStage2PmS1: float;\n\n  @main\n  compute() {\n    const gid = globalInvocationID.x;\n    const j = floor(mod(float(gid), this.uStage2));\n\n    const compare =\n\t\t\t(j < this.uPassModStage || j > this.uStage2PmS1) ? 0 :\n\t\t\t\tmod((j + this.uPassModStage) / this.uPass, 2) < 1 ? 1:\n\t\t\t\t -1;\n\n    const offset = int(compare * this.uPass);\n    \n    const current = this.gData[gid];\n    const reference = this.gData[gid + offset];\n\n\t\tthis.gData[gid] = (current * compare < reference * compare) ? current : reference;\n  }\n}\n`;\n\nconst resetData = (arr: Float32Array, sortLength: number) => {\n  for (let i = 0; i < sortLength; i++) {\n    arr[i] = Math.fround(Math.random() * 10);\n  }\n};\n\nconst validateSorted = (arr: Float32Array) => {\n  const length = arr.length;\n  for (let i = 0; i < length; i++) {\n    if (i !== length - 1 && arr[i] > arr[i + 1]) {\n      console.log('validation error:', i, arr[i], arr[i + 1]);\n      return false;\n    }\n  }\n  return true;\n};\n\nconst MAX_THREAD_NUM = 1024;\nconst ELEMENTS_NUM = 2048000;\nconst data = new Float32Array(ELEMENTS_NUM);\nresetData(data, ELEMENTS_NUM);\nconst threadgroupsPerGrid = Math.max(1, ELEMENTS_NUM / MAX_THREAD_NUM);\n\nlet stage = 0; // stage iterations\nlet pass = 0;\n\nconst App = React.memo(function MergeSort() {\n  const [cpuElapsedTime, setCpuElapsedTime] = useState(0);\n  const [gpuElapsedTime, setGpuElapsedTime] = useState(0);\n\n  const computeCPU = () => {\n    const now = performance.now();\n    data.sort((a, b) => a - b);\n\n    setCpuElapsedTime(Math.round(performance.now() - now));\n    console.log(`CPU sort result validation: ${validateSorted(data) ? 'success' : 'failure'}`);\n  };\n\n  const computeGPU = async () => {\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle1 = compiler.compileBundle(gCode);\n\n    // create world\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const kernel = world\n      .createKernel(precompiledBundle1)\n      .setDispatch([threadgroupsPerGrid, 1, 1])\n      .setBinding('gData', data);\n\n    const now = performance.now();\n    while (true) {\n      if (stage > Math.log2(ELEMENTS_NUM) + 1) {\n        break;\n      }\n\n      const tPass = 1 << pass;\n      const tStage = 1 << stage;\n      const uStage2 = tStage + tStage;\n      const uPassModStage = tPass % tStage;\n      const uStage2PmS1 = uStage2 - uPassModStage - 1;\n\n      kernel.setBinding({\n        uStage2,\n        uPassModStage,\n        uStage2PmS1,\n        uPass: tPass,\n      });\n\n      await kernel.execute();\n\n      pass--;\n      if (pass < 0) {\n        stage++;\n        pass = stage;\n      }\n    }\n\n    const output = await kernel.getOutput();\n\n    setGpuElapsedTime(Math.round(performance.now() - now));\n    console.log(`GPU sort result validation: ${validateSorted(output) ? 'success' : 'failure'}`);\n  };\n\n  useEffect(() => {\n    computeGPU();\n    computeCPU();\n  }, []);\n\n  return (\n    <ul>\n      <li>number of elements: {ELEMENTS_NUM}</li>\n      <li>CPU sort time: {cpuElapsedTime} ms</li>\n      <li>GPU sort time: {gpuElapsedTime} ms</li>\n    </ul>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  // ported from https://bl.ocks.org/zz85/cafa1b8b3098b5a40e918487422d47f6\n  var gCode = \"\\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(1024, 1, 1)\\nclass MergeSort {\\n  @in @out\\n  gData: float[];\\n\\n  @in\\n  uPass: float;\\n\\n  @in\\n  uStage2: float;\\n\\n  @in\\n  uPassModStage: float;\\n\\n  @in\\n  uStage2PmS1: float;\\n\\n  @main\\n  compute() {\\n    const gid = globalInvocationID.x;\\n    const j = floor(mod(float(gid), this.uStage2));\\n\\n    const compare =\\n\\t\\t\\t(j < this.uPassModStage || j > this.uStage2PmS1) ? 0 :\\n\\t\\t\\t\\tmod((j + this.uPassModStage) / this.uPass, 2) < 1 ? 1:\\n\\t\\t\\t\\t -1;\\n\\n    const offset = int(compare * this.uPass);\\n    \\n    const current = this.gData[gid];\\n    const reference = this.gData[gid + offset];\\n\\n\\t\\tthis.gData[gid] = (current * compare < reference * compare) ? current : reference;\\n  }\\n}\\n\";\n\n  var resetData = function resetData(arr, sortLength) {\n    for (var i = 0; i < sortLength; i++) {\n      arr[i] = Math.fround(Math.random() * 10);\n    }\n  };\n\n  var validateSorted = function validateSorted(arr) {\n    var length = arr.length;\n\n    for (var i = 0; i < length; i++) {\n      if (i !== length - 1 && arr[i] > arr[i + 1]) {\n        console.log('validation error:', i, arr[i], arr[i + 1]);\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var MAX_THREAD_NUM = 1024;\n  var ELEMENTS_NUM = 2048000;\n  var data = new Float32Array(ELEMENTS_NUM);\n  resetData(data, ELEMENTS_NUM);\n  var threadgroupsPerGrid = Math.max(1, ELEMENTS_NUM / MAX_THREAD_NUM);\n  var stage = 0; // stage iterations\n\n  var pass = 0;\n\n  var App = /*#__PURE__*/_react.default.memo(function MergeSort() {\n    var _useState = (0, _react.useState)(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        cpuElapsedTime = _useState2[0],\n        setCpuElapsedTime = _useState2[1];\n\n    var _useState3 = (0, _react.useState)(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        gpuElapsedTime = _useState4[0],\n        setGpuElapsedTime = _useState4[1];\n\n    var computeCPU = function computeCPU() {\n      var now = performance.now();\n      data.sort(function (a, b) {\n        return a - b;\n      });\n      setCpuElapsedTime(Math.round(performance.now() - now));\n      console.log(\"CPU sort result validation: \".concat(validateSorted(data) ? 'success' : 'failure'));\n    };\n\n    var computeGPU = async function computeGPU() {\n      // compile our kernel code\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle1 = compiler.compileBundle(gCode); // create world\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var kernel = world.createKernel(precompiledBundle1).setDispatch([threadgroupsPerGrid, 1, 1]).setBinding('gData', data);\n      var now = performance.now();\n\n      while (true) {\n        if (stage > Math.log2(ELEMENTS_NUM) + 1) {\n          break;\n        }\n\n        var tPass = 1 << pass;\n        var tStage = 1 << stage;\n        var uStage2 = tStage + tStage;\n        var uPassModStage = tPass % tStage;\n        var uStage2PmS1 = uStage2 - uPassModStage - 1;\n        kernel.setBinding({\n          uStage2: uStage2,\n          uPassModStage: uPassModStage,\n          uStage2PmS1: uStage2PmS1,\n          uPass: tPass\n        });\n        await kernel.execute();\n        pass--;\n\n        if (pass < 0) {\n          stage++;\n          pass = stage;\n        }\n      }\n\n      var output = await kernel.getOutput();\n      setGpuElapsedTime(Math.round(performance.now() - now));\n      console.log(\"GPU sort result validation: \".concat(validateSorted(output) ? 'success' : 'failure'));\n    };\n\n    (0, _react.useEffect)(function () {\n      computeGPU();\n      computeCPU();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"number of elements: \", ELEMENTS_NUM), /*#__PURE__*/_react.default.createElement(\"li\", null, \"CPU sort time: \", cpuElapsedTime, \" ms\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"GPU sort time: \", gpuElapsedTime, \" ms\"));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/bitonicSort/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/bitonicSort/demo/index.tsx","order":0,"filename":"index.tsx","title":"奇偶排序","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\n// ported from https://github.com/9ballsyndrome/WebGL_Compute_shader/blob/master/webgl-compute-bitonicSort/js/script.js\nconst gCode1 = `\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\n\n@numthreads(8, 1, 1)\nclass BitonicSort1 {\n  @in @out\n  gData: float[];\n\n  @shared(8)\n  sData: float[];\n\n  @main\n  compute() {\n    const tid = localInvocationID.x;\n    const gid = globalInvocationID.x;\n\n    this.sData[tid] = this.gData[gid];\n    barrier();\n\n    const offset = workGroupID.x * workGroupSize.x;\n\n    let tmp;\n    for (let k: int = 2; k <= workGroupSize.x; k <<= 1) {\n      for (let j: int = k >> 1; j > 0; j >>= 1) {\n        const ixj = (gid ^ j) - offset;\n        if (ixj > tid) {\n          if ((gid & k) == 0) {\n            if (this.sData[tid] > this.sData[ixj]) {\n              tmp = this.sData[tid];\n              this.sData[tid] = this.sData[ixj];\n              this.sData[ixj] = tmp;\n            }\n          } else {\n            if (this.sData[tid] < this.sData[ixj]) {\n              tmp = this.sData[tid];\n              this.sData[tid] = this.sData[ixj];\n              this.sData[ixj] = tmp;\n            }\n          }\n        }\n        barrier();\n      }\n    }\n    this.gData[gid] = this.sData[tid];\n  }\n}\n`;\n\nconst gCode2 = `\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\n\n@numthreads(8, 1, 1)\nclass BitonicSort2 {\n  @in @out\n  gData: float[];\n\n  @in\n  k: int;\n\n  @in\n  j: int;\n\n  @main\n  compute() {\n    let tmp;\n    const ixj = globalInvocationID.x ^ this.j;\n    if (ixj > globalInvocationID.x) {\n      if ((globalInvocationID.x & this.k) == 0) {\n        if (this.gData[globalInvocationID.x] > this.gData[ixj]) {\n          tmp = this.gData[globalInvocationID.x];\n          this.gData[globalInvocationID.x] = this.gData[ixj];\n          this.gData[ixj] = tmp;\n        }\n      } else {\n        if (this.gData[globalInvocationID.x] < this.gData[ixj]) {\n          tmp = this.gData[globalInvocationID.x];\n          this.gData[globalInvocationID.x] = this.gData[ixj];\n          this.gData[ixj] = tmp;\n        }\n      }\n    }\n  }\n}\n`;\n\nconst resetData = (arr: Float32Array, sortLength: number) => {\n  for (let i = 0; i < sortLength; i++) {\n    arr[i] = Math.random();\n  }\n};\n\nconst validateSorted = (arr: Float32Array) => {\n  const length = arr.length;\n  for (let i = 0; i < length; i++) {\n    if (i !== length - 1 && arr[i] > arr[i + 1]) {\n      console.log('validation error:', i, arr[i], arr[i + 1]);\n      return false;\n    }\n  }\n  return true;\n};\n\nconst MAX_THREAD_NUM = 8;\nconst ELEMENTS_NUM = 16;\nconst arr = new Float32Array([8, 6, 7, 1, 4, 3, 2, 5, 9, 10, 11, 12, 13, 14, 15, 16]);\n// resetData(arr, ELEMENTS_NUM);\nconst threadgroupsPerGrid = Math.max(1, ELEMENTS_NUM / MAX_THREAD_NUM);\n\nconst App = React.memo(function BitonicSort() {\n  const computeCPU = () => {\n    const now = performance.now();\n    arr.sort((a, b) => a - b);\n    console.log(`CPU sort time: ${Math.round(performance.now() - now)} ms`);\n    console.log(`CPU sort result validation: ${validateSorted(arr) ? 'success' : 'failure'}`);\n  };\n\n  const computeGPU = async () => {\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle1 = compiler.compileBundle(gCode1);\n    const precompiledBundle2 = compiler.compileBundle(gCode2);\n\n    // create world\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const now = performance.now();\n    const kernel1 = world.createKernel(precompiledBundle1);\n\n    await kernel1\n      .setDispatch([threadgroupsPerGrid, 1, 1])\n      .setBinding('gData', arr)\n      .execute();\n\n    const output = await kernel1.getOutput();\n\n    console.log(output);\n\n    const kernel2 = world.createKernel(precompiledBundle2);\n    kernel2\n      .setDispatch([threadgroupsPerGrid, 1, 1])\n      .setBinding('gData', output);\n\n    if (threadgroupsPerGrid > 1) {\n      for (let k = threadgroupsPerGrid; k <= ELEMENTS_NUM; k <<= 1) {\n        for (let j = k >> 1; j > 0; j >>= 1) {\n          console.log(k, j);\n          kernel2.setBinding('k', k);\n          kernel2.setBinding('j', j);\n          await kernel2.execute();\n\n          const output2 = await kernel2.getOutput();\n\n          console.log(output2);\n        }\n      }\n\n      // console.log(`GPU sort time: ${Math.round(performance.now() - now)} ms`);\n      // console.log(`GPU sort result validation: ${validateSorted(output2) ? 'success' : 'failure'}`);\n    }\n  };\n\n  useEffect(() => {\n    computeGPU();\n    // computeCPU();\n  }, []);\n\n  return (\n    <>\n      {/* <li>Result: {result.toString()}</li> */}\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  // ported from https://github.com/9ballsyndrome/WebGL_Compute_shader/blob/master/webgl-compute-bitonicSort/js/script.js\n  var gCode1 = \"\\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(8, 1, 1)\\nclass BitonicSort1 {\\n  @in @out\\n  gData: float[];\\n\\n  @shared(8)\\n  sData: float[];\\n\\n  @main\\n  compute() {\\n    const tid = localInvocationID.x;\\n    const gid = globalInvocationID.x;\\n\\n    this.sData[tid] = this.gData[gid];\\n    barrier();\\n\\n    const offset = workGroupID.x * workGroupSize.x;\\n\\n    let tmp;\\n    for (let k: int = 2; k <= workGroupSize.x; k <<= 1) {\\n      for (let j: int = k >> 1; j > 0; j >>= 1) {\\n        const ixj = (gid ^ j) - offset;\\n        if (ixj > tid) {\\n          if ((gid & k) == 0) {\\n            if (this.sData[tid] > this.sData[ixj]) {\\n              tmp = this.sData[tid];\\n              this.sData[tid] = this.sData[ixj];\\n              this.sData[ixj] = tmp;\\n            }\\n          } else {\\n            if (this.sData[tid] < this.sData[ixj]) {\\n              tmp = this.sData[tid];\\n              this.sData[tid] = this.sData[ixj];\\n              this.sData[ixj] = tmp;\\n            }\\n          }\\n        }\\n        barrier();\\n      }\\n    }\\n    this.gData[gid] = this.sData[tid];\\n  }\\n}\\n\";\n  var gCode2 = \"\\nimport { localInvocationID, globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(8, 1, 1)\\nclass BitonicSort2 {\\n  @in @out\\n  gData: float[];\\n\\n  @in\\n  k: int;\\n\\n  @in\\n  j: int;\\n\\n  @main\\n  compute() {\\n    let tmp;\\n    const ixj = globalInvocationID.x ^ this.j;\\n    if (ixj > globalInvocationID.x) {\\n      if ((globalInvocationID.x & this.k) == 0) {\\n        if (this.gData[globalInvocationID.x] > this.gData[ixj]) {\\n          tmp = this.gData[globalInvocationID.x];\\n          this.gData[globalInvocationID.x] = this.gData[ixj];\\n          this.gData[ixj] = tmp;\\n        }\\n      } else {\\n        if (this.gData[globalInvocationID.x] < this.gData[ixj]) {\\n          tmp = this.gData[globalInvocationID.x];\\n          this.gData[globalInvocationID.x] = this.gData[ixj];\\n          this.gData[ixj] = tmp;\\n        }\\n      }\\n    }\\n  }\\n}\\n\";\n\n  var resetData = function resetData(arr, sortLength) {\n    for (var i = 0; i < sortLength; i++) {\n      arr[i] = Math.random();\n    }\n  };\n\n  var validateSorted = function validateSorted(arr) {\n    var length = arr.length;\n\n    for (var i = 0; i < length; i++) {\n      if (i !== length - 1 && arr[i] > arr[i + 1]) {\n        console.log('validation error:', i, arr[i], arr[i + 1]);\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var MAX_THREAD_NUM = 8;\n  var ELEMENTS_NUM = 16;\n  var arr = new Float32Array([8, 6, 7, 1, 4, 3, 2, 5, 9, 10, 11, 12, 13, 14, 15, 16]); // resetData(arr, ELEMENTS_NUM);\n\n  var threadgroupsPerGrid = Math.max(1, ELEMENTS_NUM / MAX_THREAD_NUM);\n\n  var App = /*#__PURE__*/_react.default.memo(function BitonicSort() {\n    var computeCPU = function computeCPU() {\n      var now = performance.now();\n      arr.sort(function (a, b) {\n        return a - b;\n      });\n      console.log(\"CPU sort time: \".concat(Math.round(performance.now() - now), \" ms\"));\n      console.log(\"CPU sort result validation: \".concat(validateSorted(arr) ? 'success' : 'failure'));\n    };\n\n    var computeGPU = async function computeGPU() {\n      // compile our kernel code\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle1 = compiler.compileBundle(gCode1);\n      var precompiledBundle2 = compiler.compileBundle(gCode2); // create world\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var now = performance.now();\n      var kernel1 = world.createKernel(precompiledBundle1);\n      await kernel1.setDispatch([threadgroupsPerGrid, 1, 1]).setBinding('gData', arr).execute();\n      var output = await kernel1.getOutput();\n      console.log(output);\n      var kernel2 = world.createKernel(precompiledBundle2);\n      kernel2.setDispatch([threadgroupsPerGrid, 1, 1]).setBinding('gData', output);\n\n      if (threadgroupsPerGrid > 1) {\n        for (var k = threadgroupsPerGrid; k <= ELEMENTS_NUM; k <<= 1) {\n          for (var j = k >> 1; j > 0; j >>= 1) {\n            console.log(k, j);\n            kernel2.setBinding('k', k);\n            kernel2.setBinding('j', j);\n            await kernel2.execute();\n            var output2 = await kernel2.getOutput();\n            console.log(output2);\n          }\n        } // console.log(`GPU sort time: ${Math.round(performance.now() - now)} ms`);\n        // console.log(`GPU sort result validation: ${validateSorted(output2) ? 'success' : 'failure'}`);\n\n      }\n    };\n\n    (0, _react.useEffect)(function () {\n      computeGPU(); // computeCPU();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null);\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/add2vectors/demo/add2vectors-precompiled.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/add2vectors/demo/add2vectors-precompiled.tsx","order":-1,"filename":"add2vectors-precompiled.tsx","source":"import { World } from '@antv/g-webgpu';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst App = React.memo(function Add2Vectors() {\n  const [result, setResult] = useState([]);\n  useEffect(() => {\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n    const precompiledBundle =\n      '{\"shaders\":{\"WGSL\":\"import \\\\\"GLSL.std.450\\\\\" as std;\\\\n\\\\n\\\\n\\\\n\\\\n# var gWebGPUDebug : bool = false;\\\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\\\n\\\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\\\n# [[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\\\n# [[builtin local_invocation_index]] var<in> localInvocationIndex : u32;\\\\n\\\\n\\\\ntype GWebGPUBuffer0 = [[block]] struct {\\\\n  [[offset 0]] vectorA : [[stride 4]] array<f32>;\\\\n};\\\\n[[binding 0, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\\\ntype GWebGPUBuffer1 = [[block]] struct {\\\\n  [[offset 0]] vectorB : [[stride 4]] array<f32>;\\\\n};\\\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nfn sum(a : f32, b : f32) -> f32 {return a + b;}\\\\nfn main() -> void {var a : f32 = gWebGPUBuffer0.vectorA[globalInvocationID.x];\\\\nvar b : f32 = gWebGPUBuffer1.vectorB[globalInvocationID.x];\\\\ngWebGPUBuffer0.vectorA[globalInvocationID.x] = sum(a, b);\\\\nreturn;}\\\\n\\\\nentry_point compute as \\\\\"main\\\\\" = main;\\\\n\",\"GLSL450\":\"\\\\n\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\\\nivec3 workGroupSize = ivec3(gl_WorkGroupSize);\\\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\\\n\\\\n\\\\nlayout(std430, set = 0, binding = 0) buffer   GWebGPUBuffer0 {\\\\n  float vectorA[];\\\\n} gWebGPUBuffer0;\\\\n\\\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer1 {\\\\n  float vectorB[];\\\\n} gWebGPUBuffer1;\\\\n\\\\n\\\\n\\\\nlayout (\\\\n  local_size_x = 8,\\\\n  local_size_y = 1,\\\\n  local_size_z = 1\\\\n) in;\\\\n\\\\n\\\\nfloat sum(float a, float b) {return a + b;}\\\\nvoid main() {float a = gWebGPUBuffer0.vectorA[globalInvocationID.x];\\\\nfloat b = gWebGPUBuffer1.vectorB[globalInvocationID.x];\\\\ngWebGPUBuffer0.vectorA[globalInvocationID.x] = sum(a, b);}\\\\n\",\"GLSL100\":\"#ifdef GL_FRAGMENT_PRECISION_HIGH\\\\n  precision highp float;\\\\n#else\\\\n  precision mediump float;\\\\n#endif\\\\n\\\\n\\\\nfloat epsilon = 0.00001;\\\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\\\n  vec2 normAddr2D = float(address1D) * conv_const;\\\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\\\n}\\\\n\\\\nvoid barrier() {}\\\\n  \\\\n\\\\nuniform vec2 u_OutputTextureSize;\\\\nuniform int u_OutputTexelCount;\\\\nvarying vec2 v_TexCoord;\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\n\\\\nuniform sampler2D vectorA;\\\\nuniform vec2 vectorASize;\\\\nfloat getDatavectorA(vec2 address2D) {\\\\n  return float(texture2D(vectorA, address2D).r);\\\\n}\\\\nfloat getDatavectorA(float address1D) {\\\\n  return getDatavectorA(addrTranslation_1Dto2D(address1D, vectorASize));\\\\n}\\\\nfloat getDatavectorA(int address1D) {\\\\n  return getDatavectorA(float(address1D));\\\\n}\\\\nuniform sampler2D vectorB;\\\\nuniform vec2 vectorBSize;\\\\nfloat getDatavectorB(vec2 address2D) {\\\\n  return float(texture2D(vectorB, address2D).r);\\\\n}\\\\nfloat getDatavectorB(float address1D) {\\\\n  return getDatavectorB(addrTranslation_1Dto2D(address1D, vectorBSize));\\\\n}\\\\nfloat getDatavectorB(int address1D) {\\\\n  return getDatavectorB(float(address1D));\\\\n}\\\\nfloat sum(float a, float b) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nreturn a + b;}\\\\nvoid main() {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat a = getDatavectorA(globalInvocationID.x);\\\\nfloat b = getDatavectorB(globalInvocationID.x);\\\\ngl_FragColor = vec4(sum(a, b));if (gWebGPUDebug) {\\\\n  gl_FragColor = gWebGPUDebugOutput;\\\\n}}\\\\n\"},\"context\":{\"name\":\"\",\"dispatch\":[1,1,1],\"threadGroupSize\":[1,1,1],\"maxIteration\":1,\"defines\":[],\"uniforms\":[{\"name\":\"vectorA\",\"type\":\"Float[]\",\"storageClass\":\"StorageBuffer\",\"readonly\":false,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"vectorB\",\"type\":\"Float[]\",\"storageClass\":\"StorageBuffer\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]}],\"globalDeclarations\":[],\"output\":{\"name\":\"vectorA\",\"size\":[1,1],\"length\":1},\"needPingpong\":true}}';\n    const executeKernel = async () => {\n      const kernel = world.createKernel(precompiledBundle);\n      await kernel\n        .setDispatch([1, 1, 1])\n        .setBinding('vectorA', [1, 2, 3, 4, 5, 6, 7, 8])\n        .setBinding('vectorB', [1, 2, 3, 4, 5, 6, 7, 8])\n        .execute();\n\n      setResult(await kernel.getOutput());\n    };\n    executeKernel();\n\n    window.gwebgpuClean = () => {\n      world.destroy();\n    };\n  }, []);\n\n  return (\n    <>\n      <h2> Add 2 Vectors (with precompiled bundle)</h2>\n      <ul>\n        <li>WorkGroup: 1</li>\n        <li>Threads per WorkGroup: 8</li>\n        <li>VectorA: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>VectorB: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Result: {result.toString()}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.react, global.reactDom);\n    global.add2vectorsPrecompiled = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var App = /*#__PURE__*/_react.default.memo(function Add2Vectors() {\n    var _useState = (0, _react.useState)([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        result = _useState2[0],\n        setResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var precompiledBundle = '{\"shaders\":{\"WGSL\":\"import \\\\\"GLSL.std.450\\\\\" as std;\\\\n\\\\n\\\\n\\\\n\\\\n# var gWebGPUDebug : bool = false;\\\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\\\n\\\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\\\n# [[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\\\n# [[builtin local_invocation_index]] var<in> localInvocationIndex : u32;\\\\n\\\\n\\\\ntype GWebGPUBuffer0 = [[block]] struct {\\\\n  [[offset 0]] vectorA : [[stride 4]] array<f32>;\\\\n};\\\\n[[binding 0, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\\\ntype GWebGPUBuffer1 = [[block]] struct {\\\\n  [[offset 0]] vectorB : [[stride 4]] array<f32>;\\\\n};\\\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\\\n\\\\n\\\\n\\\\n\\\\n\\\\n\\\\nfn sum(a : f32, b : f32) -> f32 {return a + b;}\\\\nfn main() -> void {var a : f32 = gWebGPUBuffer0.vectorA[globalInvocationID.x];\\\\nvar b : f32 = gWebGPUBuffer1.vectorB[globalInvocationID.x];\\\\ngWebGPUBuffer0.vectorA[globalInvocationID.x] = sum(a, b);\\\\nreturn;}\\\\n\\\\nentry_point compute as \\\\\"main\\\\\" = main;\\\\n\",\"GLSL450\":\"\\\\n\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\\\nivec3 workGroupSize = ivec3(gl_WorkGroupSize);\\\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\\\n\\\\n\\\\nlayout(std430, set = 0, binding = 0) buffer   GWebGPUBuffer0 {\\\\n  float vectorA[];\\\\n} gWebGPUBuffer0;\\\\n\\\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer1 {\\\\n  float vectorB[];\\\\n} gWebGPUBuffer1;\\\\n\\\\n\\\\n\\\\nlayout (\\\\n  local_size_x = 8,\\\\n  local_size_y = 1,\\\\n  local_size_z = 1\\\\n) in;\\\\n\\\\n\\\\nfloat sum(float a, float b) {return a + b;}\\\\nvoid main() {float a = gWebGPUBuffer0.vectorA[globalInvocationID.x];\\\\nfloat b = gWebGPUBuffer1.vectorB[globalInvocationID.x];\\\\ngWebGPUBuffer0.vectorA[globalInvocationID.x] = sum(a, b);}\\\\n\",\"GLSL100\":\"#ifdef GL_FRAGMENT_PRECISION_HIGH\\\\n  precision highp float;\\\\n#else\\\\n  precision mediump float;\\\\n#endif\\\\n\\\\n\\\\nfloat epsilon = 0.00001;\\\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\\\n  vec2 normAddr2D = float(address1D) * conv_const;\\\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\\\n}\\\\n\\\\nvoid barrier() {}\\\\n  \\\\n\\\\nuniform vec2 u_OutputTextureSize;\\\\nuniform int u_OutputTexelCount;\\\\nvarying vec2 v_TexCoord;\\\\n\\\\nbool gWebGPUDebug = false;\\\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\\\n\\\\n\\\\nuniform sampler2D vectorA;\\\\nuniform vec2 vectorASize;\\\\nfloat getDatavectorA(vec2 address2D) {\\\\n  return float(texture2D(vectorA, address2D).r);\\\\n}\\\\nfloat getDatavectorA(float address1D) {\\\\n  return getDatavectorA(addrTranslation_1Dto2D(address1D, vectorASize));\\\\n}\\\\nfloat getDatavectorA(int address1D) {\\\\n  return getDatavectorA(float(address1D));\\\\n}\\\\nuniform sampler2D vectorB;\\\\nuniform vec2 vectorBSize;\\\\nfloat getDatavectorB(vec2 address2D) {\\\\n  return float(texture2D(vectorB, address2D).r);\\\\n}\\\\nfloat getDatavectorB(float address1D) {\\\\n  return getDatavectorB(addrTranslation_1Dto2D(address1D, vectorBSize));\\\\n}\\\\nfloat getDatavectorB(int address1D) {\\\\n  return getDatavectorB(float(address1D));\\\\n}\\\\nfloat sum(float a, float b) {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nreturn a + b;}\\\\nvoid main() {\\\\nivec3 workGroupSize = ivec3(1, 1, 1);\\\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\\\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\\\nfloat a = getDatavectorA(globalInvocationID.x);\\\\nfloat b = getDatavectorB(globalInvocationID.x);\\\\ngl_FragColor = vec4(sum(a, b));if (gWebGPUDebug) {\\\\n  gl_FragColor = gWebGPUDebugOutput;\\\\n}}\\\\n\"},\"context\":{\"name\":\"\",\"dispatch\":[1,1,1],\"threadGroupSize\":[1,1,1],\"maxIteration\":1,\"defines\":[],\"uniforms\":[{\"name\":\"vectorA\",\"type\":\"Float[]\",\"storageClass\":\"StorageBuffer\",\"readonly\":false,\"writeonly\":false,\"size\":[1,1]},{\"name\":\"vectorB\",\"type\":\"Float[]\",\"storageClass\":\"StorageBuffer\",\"readonly\":true,\"writeonly\":false,\"size\":[1,1]}],\"globalDeclarations\":[],\"output\":{\"name\":\"vectorA\",\"size\":[1,1],\"length\":1},\"needPingpong\":true}}';\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle);\n        await kernel.setDispatch([1, 1, 1]).setBinding('vectorA', [1, 2, 3, 4, 5, 6, 7, 8]).setBinding('vectorB', [1, 2, 3, 4, 5, 6, 7, 8]).execute();\n        setResult(await kernel.getOutput());\n      };\n\n      executeKernel();\n\n      window.gwebgpuClean = function () {\n        world.destroy();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \" Add 2 Vectors (with precompiled bundle)\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"WorkGroup: 1\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Threads per WorkGroup: 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"VectorA: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"VectorB: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Result: \", result.toString())));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/add2vectors/demo/add2vectors.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/add2vectors/demo/add2vectors.tsx","order":-1,"filename":"add2vectors.tsx","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\n@numthreads(8, 1, 1)\nclass Add2Vectors {\n  @in @out\n  vectorA: float[];\n\n  @in\n  vectorB: float[];\n\n  sum(a: float, b: float): float {\n    return a + b;\n  }\n\n  @main\n  compute() {\n    // 获取当前线程处理的数据\n    const a = this.vectorA[globalInvocationID.x];\n    const b = this.vectorB[globalInvocationID.x];\n  \n    // 输出当前线程处理完毕的数据，即两个向量相加后的结果\n    this.vectorA[globalInvocationID.x] = this.sum(a, b);\n  }\n}\n`;\n\nconst App = React.memo(function Add2Vectors() {\n  const [result, setResult] = useState([]);\n  useEffect(() => {\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    // console.log(precompiledBundle.toString());\n\n    // create world\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([1, 1, 1])\n        .setBinding('vectorA', [1, 2, 3, 4, 5, 6, 7, 8])\n        .setBinding('vectorB', [1, 2, 3, 4, 5, 6, 7, 8]);\n      await kernel.execute();\n\n      setResult(await kernel.getOutput());\n    };\n    executeKernel();\n\n    window.gwebgpuClean = () => {\n      world.destroy();\n    };\n  }, []);\n\n  return (\n    <>\n      <h2> Add 2 Vectors</h2>\n      <ul>\n        <li>WorkGroup: 1</li>\n        <li>Threads per WorkGroup: 8</li>\n        <li>VectorA: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>VectorB: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Result: {result.toString()}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.add2vectors = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(8, 1, 1)\\nclass Add2Vectors {\\n  @in @out\\n  vectorA: float[];\\n\\n  @in\\n  vectorB: float[];\\n\\n  sum(a: float, b: float): float {\\n    return a + b;\\n  }\\n\\n  @main\\n  compute() {\\n    // \\u83B7\\u53D6\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u7684\\u6570\\u636E\\n    const a = this.vectorA[globalInvocationID.x];\\n    const b = this.vectorB[globalInvocationID.x];\\n  \\n    // \\u8F93\\u51FA\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u5B8C\\u6BD5\\u7684\\u6570\\u636E\\uFF0C\\u5373\\u4E24\\u4E2A\\u5411\\u91CF\\u76F8\\u52A0\\u540E\\u7684\\u7ED3\\u679C\\n    this.vectorA[globalInvocationID.x] = this.sum(a, b);\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function Add2Vectors() {\n    var _useState = (0, _react.useState)([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        result = _useState2[0],\n        setResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      // compile our kernel code\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode); // console.log(precompiledBundle.toString());\n      // create world\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([1, 1, 1]).setBinding('vectorA', [1, 2, 3, 4, 5, 6, 7, 8]).setBinding('vectorB', [1, 2, 3, 4, 5, 6, 7, 8]);\n        await kernel.execute();\n        setResult(await kernel.getOutput());\n      };\n\n      executeKernel();\n\n      window.gwebgpuClean = function () {\n        world.destroy();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \" Add 2 Vectors\"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"WorkGroup: 1\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Threads per WorkGroup: 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"VectorA: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"VectorB: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Result: \", result.toString())));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/add2vectors/demo/iteration.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/add2vectors/demo/iteration.tsx","order":2,"filename":"iteration.tsx","title":"迭代多次，串联自身","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\n@numthreads(8, 1, 1)\nclass Add2Vectors {\n  @in\n  vectorA: float[];\n\n  @in\n  vectorB: float[];\n\n  @out(8)\n  result: float[];\n\n  sum(a: float, b: float): float {\n    return a + b;\n  }\n\n  @main\n  compute() {\n    // 获取当前线程处理的数据\n    const a = this.vectorA[globalInvocationID.x];\n    const b = this.vectorB[globalInvocationID.x];\n  \n    // 输出当前线程处理完毕的数据，即两个向量相加后的结果\n    this.result[globalInvocationID.x] = this.sum(a, b);\n  }\n}\n`;\n\nconst App = React.memo(function Add2Vectors() {\n  const [result, setResult] = useState([]);\n  useEffect(() => {\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    // create world\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n    const executeKernel = async () => {\n      const kernel = world\n        .createKernel(precompiledBundle)\n        .setDispatch([1, 1, 1])\n        .setBinding({\n          vectorA: [0, 0, 0, 0, 0, 0, 0, 0],\n          vectorB: [1, 1, 1, 1, 1, 1, 1, 1],\n        });\n\n      for (let i = 2; i < 11; i++) {\n        await kernel.execute();\n        kernel.setBinding({\n          vectorA: kernel,\n          vectorB: [i, i, i, i, i, i, i, i],\n        });\n      }\n      setResult(await kernel.getOutput());\n    };\n    executeKernel();\n\n    window.gwebgpuClean = () => {\n      world.destroy();\n    };\n  }, []);\n\n  return (\n    <>\n      <h2> Run the same kernel 9 times, sum 0-9 </h2>\n      <ul>\n        <li>WorkGroup: 1</li>\n        <li>Threads per WorkGroup: 8</li>\n        <li>Result: {result.toString()}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.iteration = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(8, 1, 1)\\nclass Add2Vectors {\\n  @in\\n  vectorA: float[];\\n\\n  @in\\n  vectorB: float[];\\n\\n  @out(8)\\n  result: float[];\\n\\n  sum(a: float, b: float): float {\\n    return a + b;\\n  }\\n\\n  @main\\n  compute() {\\n    // \\u83B7\\u53D6\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u7684\\u6570\\u636E\\n    const a = this.vectorA[globalInvocationID.x];\\n    const b = this.vectorB[globalInvocationID.x];\\n  \\n    // \\u8F93\\u51FA\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u5B8C\\u6BD5\\u7684\\u6570\\u636E\\uFF0C\\u5373\\u4E24\\u4E2A\\u5411\\u91CF\\u76F8\\u52A0\\u540E\\u7684\\u7ED3\\u679C\\n    this.result[globalInvocationID.x] = this.sum(a, b);\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function Add2Vectors() {\n    var _useState = (0, _react.useState)([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        result = _useState2[0],\n        setResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      // compile our kernel code\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode); // create world\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel = world.createKernel(precompiledBundle).setDispatch([1, 1, 1]).setBinding({\n          vectorA: [0, 0, 0, 0, 0, 0, 0, 0],\n          vectorB: [1, 1, 1, 1, 1, 1, 1, 1]\n        });\n\n        for (var i = 2; i < 11; i++) {\n          await kernel.execute();\n          kernel.setBinding({\n            vectorA: kernel,\n            vectorB: [i, i, i, i, i, i, i, i]\n          });\n        }\n\n        setResult(await kernel.getOutput());\n      };\n\n      executeKernel();\n\n      window.gwebgpuClean = function () {\n        world.destroy();\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \" Run the same kernel 9 times, sum 0-9 \"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"WorkGroup: 1\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Threads per WorkGroup: 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Result: \", result.toString())));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"gpgpu/basic/add2vectors/demo/pipeline.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/gpgpu/basic/add2vectors/demo/pipeline.tsx","order":3,"filename":"pipeline.tsx","title":"串联多个 Kernel","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { World } from '@antv/g-webgpu';\nimport { Compiler } from '@antv/g-webgpu-compiler';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nconst gCode = `\nimport { globalInvocationID } from 'g-webgpu';\n\n@numthreads(8, 1, 1)\nclass Add2Vectors {\n  @in\n  vectorA: float[];\n\n  @in\n  vectorB: float[];\n\n  @out(8)\n  result: float[];\n\n  sum(a: float, b: float): float {\n    return a + b;\n  }\n\n  @main\n  compute() {\n    // 获取当前线程处理的数据\n    const a = this.vectorA[globalInvocationID.x];\n    const b = this.vectorB[globalInvocationID.x];\n  \n    // 输出当前线程处理完毕的数据，即两个向量相加后的结果\n    this.result[globalInvocationID.x] = this.sum(a, b);\n  }\n}\n`;\n\nconst App = React.memo(function Add2Vectors() {\n  const [result, setResult] = useState([]);\n  useEffect(() => {\n    // compile our kernel code\n    const compiler = new Compiler();\n    const precompiledBundle = compiler.compileBundle(gCode);\n\n    // create world\n    const world = World.create({\n      engineOptions: {\n        supportCompute: true,\n      },\n    });\n    const executeKernel = async () => {\n      const kernel1 = world\n        .createKernel(precompiledBundle)\n        .setDispatch([1, 1, 1])\n        .setBinding({\n          vectorA: [1, 2, 3, 4, 5, 6, 7, 8],\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8],\n        });\n\n      const kernel2 = world\n        .createKernel(precompiledBundle)\n        .setDispatch([1, 1, 1])\n        .setBinding({\n          vectorA: kernel1,\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8],\n        });\n\n      const kernel3 = world\n        .createKernel(precompiledBundle)\n        .setDispatch([1, 1, 1])\n        .setBinding({\n          vectorA: kernel2,\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8],\n        });\n\n      await kernel1.execute();\n      await kernel2.execute();\n      await kernel3.execute();\n      setResult(await kernel3.getOutput());\n\n      window.gwebgpuClean = () => {\n        world.destroy();\n      };\n    };\n    executeKernel();\n  }, []);\n\n  return (\n    <>\n      <h2> Create a pipeline with 3 kernels </h2>\n      <ul>\n        <li>WorkGroup: 1</li>\n        <li>Threads per WorkGroup: 8</li>\n        <li>Kernel1 VectorA: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Kernel1 VectorB: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Kernel2 VectorC: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Kernel3 VectorD: 1, 2, 3, 4, 5, 6, 7, 8</li>\n        <li>Result: {result.toString()}</li>\n      </ul>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu\", \"@antv/g-webgpu-compiler\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu\"), require(\"@antv/g-webgpu-compiler\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpu, global.gWebgpuCompiler, global.react, global.reactDom);\n    global.pipeline = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpu, _gWebgpuCompiler, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var gCode = \"\\nimport { globalInvocationID } from 'g-webgpu';\\n\\n@numthreads(8, 1, 1)\\nclass Add2Vectors {\\n  @in\\n  vectorA: float[];\\n\\n  @in\\n  vectorB: float[];\\n\\n  @out(8)\\n  result: float[];\\n\\n  sum(a: float, b: float): float {\\n    return a + b;\\n  }\\n\\n  @main\\n  compute() {\\n    // \\u83B7\\u53D6\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u7684\\u6570\\u636E\\n    const a = this.vectorA[globalInvocationID.x];\\n    const b = this.vectorB[globalInvocationID.x];\\n  \\n    // \\u8F93\\u51FA\\u5F53\\u524D\\u7EBF\\u7A0B\\u5904\\u7406\\u5B8C\\u6BD5\\u7684\\u6570\\u636E\\uFF0C\\u5373\\u4E24\\u4E2A\\u5411\\u91CF\\u76F8\\u52A0\\u540E\\u7684\\u7ED3\\u679C\\n    this.result[globalInvocationID.x] = this.sum(a, b);\\n  }\\n}\\n\";\n\n  var App = /*#__PURE__*/_react.default.memo(function Add2Vectors() {\n    var _useState = (0, _react.useState)([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        result = _useState2[0],\n        setResult = _useState2[1];\n\n    (0, _react.useEffect)(function () {\n      // compile our kernel code\n      var compiler = new _gWebgpuCompiler.Compiler();\n      var precompiledBundle = compiler.compileBundle(gCode); // create world\n\n      var world = _gWebgpu.World.create({\n        engineOptions: {\n          supportCompute: true\n        }\n      });\n\n      var executeKernel = async function executeKernel() {\n        var kernel1 = world.createKernel(precompiledBundle).setDispatch([1, 1, 1]).setBinding({\n          vectorA: [1, 2, 3, 4, 5, 6, 7, 8],\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8]\n        });\n        var kernel2 = world.createKernel(precompiledBundle).setDispatch([1, 1, 1]).setBinding({\n          vectorA: kernel1,\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8]\n        });\n        var kernel3 = world.createKernel(precompiledBundle).setDispatch([1, 1, 1]).setBinding({\n          vectorA: kernel2,\n          vectorB: [1, 2, 3, 4, 5, 6, 7, 8]\n        });\n        await kernel1.execute();\n        await kernel2.execute();\n        await kernel3.execute();\n        setResult(await kernel3.getOutput());\n\n        window.gwebgpuClean = function () {\n          world.destroy();\n        };\n      };\n\n      executeKernel();\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"h2\", null, \" Create a pipeline with 3 kernels \"), /*#__PURE__*/_react.default.createElement(\"ul\", null, /*#__PURE__*/_react.default.createElement(\"li\", null, \"WorkGroup: 1\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Threads per WorkGroup: 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Kernel1 VectorA: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Kernel1 VectorB: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Kernel2 VectorC: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Kernel3 VectorD: 1, 2, 3, 4, 5, 6, 7, 8\"), /*#__PURE__*/_react.default.createElement(\"li\", null, \"Result: \", result.toString())));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"experiment/unitchart/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/experiment/unitchart/demo/index.tsx","order":0,"filename":"index.tsx","title":"Unitchart","screenshot":"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png","source":"import { Chart, Container, Layout } from '@antv/g-webgpu-unitchart';\nimport * as d3 from 'd3';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nlet chart;\n\nconst App = React.memo(function Fruchterman() {\n  const [item, setItem] = useState<object>();\n  const [tooltipPos, setTooltipPos] = useState<[number, number]>([0, 0]);\n\n  useEffect(() => {\n    (async () => {\n      const rawData = await d3.csv(\n        'https://intuinno.github.io/unit/data/titanic.csv',\n      );\n\n      const canvas = document.getElementById(\n        'application',\n      ) as HTMLCanvasElement;\n\n      const groupByClassLayouts = [\n        {\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Class',\n            isShared: false,\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n        },\n        {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten',\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          sort: {\n            key: 'Survived',\n          },\n        },\n      ];\n      const groupBySexLayouts = [\n        {\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Sex',\n            isShared: false,\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n        },\n        {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten',\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          sort: {\n            key: 'Survived',\n          },\n        },\n      ];\n      const groupByAgeLayouts = [\n        {\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Age',\n            isShared: false,\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n        },\n        {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten',\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false,\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5,\n          },\n          sort: {\n            key: 'Survived',\n          },\n        },\n      ];\n      chart = new Chart({\n        canvas,\n        title: 'Titanic',\n        data: rawData,\n        width: 600,\n        height: 600,\n        padding: {\n          top: 10,\n          left: 30,\n          bottom: 30,\n          right: 10,\n        },\n        layouts: [\n          { name: 'groupByClass', layouts: groupByClassLayouts },\n          { name: 'groupBySex', layouts: groupBySexLayouts },\n          { name: 'groupByAge', layouts: groupByAgeLayouts },\n        ],\n        mark: {\n          shape: 'circle',\n          color: {\n            key: 'Survived',\n            type: 'categorical',\n          },\n          size: {\n            type: 'max',\n            isShared: false,\n          },\n          isColorScaleShared: true,\n        },\n        onPick: (dataItem, position) => {\n          setItem(dataItem);\n          setTooltipPos(position);\n        },\n      });\n      chart.init();\n      chart.render({\n        layout: 'groupByClass',\n      });\n    })();\n\n    return function cleanup() {\n      if (chart) {\n        chart.destroy();\n      }\n    };\n  }, []);\n\n  const groupBySex = () => {\n    if (chart) {\n      chart.render({\n        layout: 'groupBySex',\n      });\n    }\n  };\n\n  const groupByClass = () => {\n    if (chart) {\n      chart.render({\n        layout: 'groupByClass',\n      });\n    }\n  };\n\n  const groupByAge = () => {\n    if (chart) {\n      chart.render({\n        layout: 'groupByAge',\n      });\n    }\n  };\n\n  return (\n    <>\n      <div\n        style={{\n          marginBottom: 16,\n        }}\n      >\n        <button onClick={groupBySex}>Group by Sex</button>\n        <button onClick={groupByClass}>Group by Class</button>\n        <button onClick={groupByAge}>Group by Age</button>\n      </div>\n      <canvas id=\"application\" width=\"600\" height=\"600\" />\n      <div\n        style={{\n          background: 'rgba(0,0,0,.65)',\n          color: 'white',\n          position: 'absolute',\n          top: tooltipPos[1],\n          left: tooltipPos[0],\n          visibility: item ? 'visible' : 'hidden',\n          padding: 4,\n        }}\n      >\n        {item &&\n          Object.keys(item).map((itemKey) => (\n            <p key={itemKey}>\n              {itemKey}: {item[itemKey]}\n            </p>\n          ))}\n      </div>\n    </>\n  );\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu-unitchart\", \"d3\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu-unitchart\"), require(\"d3\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpuUnitchart, global.d3, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpuUnitchart, d3, _react, _reactDom) {\n  \"use strict\";\n\n  d3 = _interopRequireWildcard(d3);\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\n  function _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\n  function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\n  function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n  function _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\n  function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n  var chart;\n\n  var App = /*#__PURE__*/_react.default.memo(function Fruchterman() {\n    var _useState = (0, _react.useState)(),\n        _useState2 = _slicedToArray(_useState, 2),\n        item = _useState2[0],\n        setItem = _useState2[1];\n\n    var _useState3 = (0, _react.useState)([0, 0]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        tooltipPos = _useState4[0],\n        setTooltipPos = _useState4[1];\n\n    (0, _react.useEffect)(function () {\n      (async function () {\n        var rawData = await d3.csv('https://intuinno.github.io/unit/data/titanic.csv');\n        var canvas = document.getElementById('application');\n        var groupByClassLayouts = [{\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Class',\n            isShared: false\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          }\n        }, {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten'\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          sort: {\n            key: 'Survived'\n          }\n        }];\n        var groupBySexLayouts = [{\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Sex',\n            isShared: false\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          }\n        }, {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten'\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          sort: {\n            key: 'Survived'\n          }\n        }];\n        var groupByAgeLayouts = [{\n          name: 'layout1',\n          type: 'gridxy',\n          subgroup: {\n            type: 'groupby',\n            key: 'Age',\n            isShared: false\n          },\n          aspectRatio: 'fillX',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          }\n        }, {\n          name: 'layout2',\n          type: 'gridxy',\n          subgroup: {\n            type: 'flatten'\n          },\n          aspectRatio: 'maxfill',\n          size: {\n            type: 'uniform',\n            isShared: false\n          },\n          direction: 'LRBT',\n          align: 'LB',\n          margin: {\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0\n          },\n          padding: {\n            top: 5,\n            left: 5,\n            bottom: 5,\n            right: 5\n          },\n          sort: {\n            key: 'Survived'\n          }\n        }];\n        chart = new _gWebgpuUnitchart.Chart({\n          canvas: canvas,\n          title: 'Titanic',\n          data: rawData,\n          width: 600,\n          height: 600,\n          padding: {\n            top: 10,\n            left: 30,\n            bottom: 30,\n            right: 10\n          },\n          layouts: [{\n            name: 'groupByClass',\n            layouts: groupByClassLayouts\n          }, {\n            name: 'groupBySex',\n            layouts: groupBySexLayouts\n          }, {\n            name: 'groupByAge',\n            layouts: groupByAgeLayouts\n          }],\n          mark: {\n            shape: 'circle',\n            color: {\n              key: 'Survived',\n              type: 'categorical'\n            },\n            size: {\n              type: 'max',\n              isShared: false\n            },\n            isColorScaleShared: true\n          },\n          onPick: function onPick(dataItem, position) {\n            setItem(dataItem);\n            setTooltipPos(position);\n          }\n        });\n        chart.init();\n        chart.render({\n          layout: 'groupByClass'\n        });\n      })();\n\n      return function cleanup() {\n        if (chart) {\n          chart.destroy();\n        }\n      };\n    }, []);\n\n    var groupBySex = function groupBySex() {\n      if (chart) {\n        chart.render({\n          layout: 'groupBySex'\n        });\n      }\n    };\n\n    var groupByClass = function groupByClass() {\n      if (chart) {\n        chart.render({\n          layout: 'groupByClass'\n        });\n      }\n    };\n\n    var groupByAge = function groupByAge() {\n      if (chart) {\n        chart.render({\n          layout: 'groupByAge'\n        });\n      }\n    };\n\n    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        marginBottom: 16\n      }\n    }, /*#__PURE__*/_react.default.createElement(\"button\", {\n      onClick: groupBySex\n    }, \"Group by Sex\"), /*#__PURE__*/_react.default.createElement(\"button\", {\n      onClick: groupByClass\n    }, \"Group by Class\"), /*#__PURE__*/_react.default.createElement(\"button\", {\n      onClick: groupByAge\n    }, \"Group by Age\")), /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      width: \"600\",\n      height: \"600\"\n    }), /*#__PURE__*/_react.default.createElement(\"div\", {\n      style: {\n        background: 'rgba(0,0,0,.65)',\n        color: 'white',\n        position: 'absolute',\n        top: tooltipPos[1],\n        left: tooltipPos[0],\n        visibility: item ? 'visible' : 'hidden',\n        padding: 4\n      }\n    }, item && Object.keys(item).map(function (itemKey) {\n      return /*#__PURE__*/_react.default.createElement(\"p\", {\n        key: itemKey\n      }, itemKey, \": \", item[itemKey]);\n    })));\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"},{"relativePath":"experiment/raytracer/demo/index.tsx","absolutePath":"/Users/pyq/workspace/webgpu/GWebGPUEngine/examples/experiment/raytracer/demo/index.tsx","order":0,"filename":"index.tsx","title":"RayTracer","screenshot":"https://gw.alipayobjects.com/mdn/rms_6ae20b/afts/img/A*FARSSo38alcAAAAAAAAAAAAAARQnAQ","source":"import { RayTracer } from '@antv/g-webgpu-raytracer';\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\nlet raytracer;\n\nconst App = React.memo(function RayTracerDemo() {\n  useEffect(() => {\n    (async () => {\n      const canvas = document.getElementById(\n        'application',\n      ) as HTMLCanvasElement;\n\n      raytracer = new RayTracer({\n        canvas,\n      });\n      await raytracer.init();\n    })();\n\n    return function cleanup() {\n      if (raytracer) {\n        raytracer.destroy();\n      }\n    };\n  }, []);\n\n  return <canvas id=\"application\" width=\"600\" height=\"600\" />;\n});\n\nReactDOM.render(<App />, document.getElementById('wrapper'));\n","babeledSource":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([\"@antv/g-webgpu-raytracer\", \"react\", \"react-dom\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(require(\"@antv/g-webgpu-raytracer\"), require(\"react\"), require(\"react-dom\"));\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(global.gWebgpuRaytracer, global.react, global.reactDom);\n    global.index = mod.exports;\n  }\n})(typeof globalThis !== \"undefined\" ? globalThis : typeof self !== \"undefined\" ? self : this, function (_gWebgpuRaytracer, _react, _reactDom) {\n  \"use strict\";\n\n  _react = _interopRequireWildcard(_react);\n  _reactDom = _interopRequireDefault(_reactDom);\n\n  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n  function _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\n  function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n  var raytracer;\n\n  var App = /*#__PURE__*/_react.default.memo(function RayTracerDemo() {\n    (0, _react.useEffect)(function () {\n      (async function () {\n        var canvas = document.getElementById('application');\n        raytracer = new _gWebgpuRaytracer.RayTracer({\n          canvas: canvas\n        });\n        await raytracer.init();\n      })();\n\n      return function cleanup() {\n        if (raytracer) {\n          raytracer.destroy();\n        }\n      };\n    }, []);\n    return /*#__PURE__*/_react.default.createElement(\"canvas\", {\n      id: \"application\",\n      width: \"600\",\n      height: \"600\"\n    });\n  });\n\n  _reactDom.default.render( /*#__PURE__*/_react.default.createElement(App, null), document.getElementById('wrapper'));\n});"}]}},"staticQueryHashes":["1015175297","3000541721","3000541721","3378097331"]}