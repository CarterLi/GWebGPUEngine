(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{144:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53),Object.defineProperty(exports,"__esModule",{value:!0}),exports.TearDownSystem=exports.CleanupSystem=exports.ExecuteSystem=exports.InitializeSystem=void 0;var _class,_class2,_temp,_class3,_class4,_temp2,_class5,_class6,_temp3,_class7,_class8,_temp4,_inversify=__webpack_require__(143);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var InitializeSystem=(0,_inversify.injectable)()((_temp=_class2=function InitializeSystem(){_classCallCheck(this,InitializeSystem),this.name=void 0,this.type=InitializeSystem.TYPE},_class2.TYPE="InitializeSystem",_class=_temp))||_class;exports.InitializeSystem=InitializeSystem;var ExecuteSystem=(0,_inversify.injectable)()((_temp2=_class4=function ExecuteSystem(){_classCallCheck(this,ExecuteSystem),this.name=void 0,this.type=ExecuteSystem.TYPE},_class4.TYPE="ExecuteSystem",_class3=_temp2))||_class3;exports.ExecuteSystem=ExecuteSystem;var CleanupSystem=(0,_inversify.injectable)()((_temp3=_class6=function CleanupSystem(){_classCallCheck(this,CleanupSystem),this.name=void 0,this.type=CleanupSystem.TYPE},_class6.TYPE="CleanupSystem",_class5=_temp3))||_class5;exports.CleanupSystem=CleanupSystem;var TearDownSystem=(0,_inversify.injectable)()((_temp4=_class8=function TearDownSystem(){_classCallCheck(this,TearDownSystem),this.name=void 0,this.type=TearDownSystem.TYPE},_class8.TYPE="TearDownSystem",_class7=_temp4))||_class7;exports.TearDownSystem=TearDownSystem},197:function(module,exports,__webpack_require__){"use strict";function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ComponentManager=exports.Component=void 0;exports.Component=function Component(){_classCallCheck(this,Component)};var ComponentManager=function(){function ComponentManager(clazz){_classCallCheck(this,ComponentManager),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=clazz}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(ComponentManager,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(entity){return-1<this.lookup[entity]}},{key:"create",value:function(entity,data){this.lookup[entity]=this.components.length;var component=new this.clazz(data||{});return this.components.push(component),this.entities.push(entity),component}},{key:"remove",value:function(entity){var componentIndex=this.lookup[entity];-1<componentIndex&&componentIndex<this.components.length-1&&(this.components[componentIndex]=this.components[this.components.length-1],this.entities[componentIndex]=this.entities[this.entities.length-1],this.lookup[this.entities[componentIndex]]=componentIndex),this.components.pop(),this.entities.pop(),delete this.lookup[entity]}},{key:"removeKeepSorted",value:function(entity){var componentIndex=this.lookup[entity];if(-1<componentIndex){var entity2=this.entities[componentIndex];if(componentIndex<this.components.length-1){for(var i=componentIndex+1;i<this.components.length;++i)this.components[i-1]=this.components[i];for(var _i=componentIndex+1;_i<this.entities.length;++_i)this.entities[_i-1]=this.entities[_i],this.lookup[this.entities[_i-1]]=_i-1}this.components.pop(),this.entities.pop(),delete this.lookup[entity2]}}},{key:"moveItem",value:function(srcIndex,destIndex){if(srcIndex!==destIndex){for(var next,srcComponent=this.components[srcIndex],srcEntity=this.entities[srcIndex],direction=srcIndex<destIndex?1:-1,i=srcIndex;i!==destIndex;i+=direction)next=i+direction,this.components[i]=this.components[next],this.entities[i]=this.entities[next],this.lookup[this.entities[i]]=i;this.components[destIndex]=srcComponent,this.entities[destIndex]=srcEntity,this.lookup[srcEntity]=destIndex}}},{key:"getEntity",value:function(index){return this.entities[index]}},{key:"getComponent",value:function(index){return this.components[index]}},{key:"getComponentByEntity",value:function(entity){var componentIndex=this.lookup[entity];return-1<componentIndex?this.components[componentIndex]:null}},{key:"getCount",value:function(){return this.components.length}}]),ComponentManager}();exports.ComponentManager=ComponentManager},198:function(module,exports,__webpack_require__){"use strict";__webpack_require__(13),__webpack_require__(19),__webpack_require__(11),Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDENTIFIER=void 0;var IDENTIFIER={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),CameraComponentManager:Symbol("CameraComponentManager"),Systems:Symbol("Systems"),World:Symbol("World"),SceneGraphSystem:Symbol("SceneGraphSystem")};exports.IDENTIFIER=IDENTIFIER},316:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cubeVertexArray=exports.cubeUVOffset=exports.cubeColorOffset=exports.cubePositionOffset=exports.cubeVertexSize=void 0;exports.cubeVertexSize=40;exports.cubePositionOffset=0;exports.cubeColorOffset=16;exports.cubeUVOffset=32;var cubeVertexArray=new Float32Array([1,-1,1,1,1,0,1,1,1,1,-1,-1,1,1,0,0,1,1,0,1,-1,-1,-1,1,0,0,0,1,0,0,1,-1,-1,1,1,0,0,1,1,0,1,-1,1,1,1,0,1,1,1,1,-1,-1,-1,1,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,0,1,1,-1,-1,1,1,0,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,0,0,-1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,-1,1,1,1,0,1,0,0,-1,1,-1,1,0,1,0,1,1,0,-1,1,1,1,0,1,1,1,1,1,1,1,-1,1,1,1,0,1,0,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,1,-1,1,0,1,0,1,0,0,-1,-1,-1,1,0,0,0,1,1,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,-1,1,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,-1,1,1,0,0,1,1,0,0,-1,-1,1,1,0,0,1,1,0,0,1,-1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,1,1,-1,-1,-1,1,0,0,0,1,0,1,-1,1,-1,1,0,1,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,-1,-1,1,1,0,0,1,1,1,-1,1,-1,1,0,1,0,1,0,0]);exports.cubeVertexArray=cubeVertexArray},322:function(module,exports,__webpack_require__){__webpack_require__(323),__webpack_require__(468),module.exports=__webpack_require__(469)},36:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Component",{enumerable:!0,get:function get(){return _ComponentManager.Component}}),Object.defineProperty(exports,"ComponentManager",{enumerable:!0,get:function get(){return _ComponentManager.ComponentManager}}),Object.defineProperty(exports,"createEntity",{enumerable:!0,get:function get(){return _Entity.createEntity}}),Object.defineProperty(exports,"Entity",{enumerable:!0,get:function get(){return _Entity.Entity}}),Object.defineProperty(exports,"IDENTIFIER",{enumerable:!0,get:function get(){return _identifier.IDENTIFIER}}),Object.defineProperty(exports,"container",{enumerable:!0,get:function get(){return _inversify.container}}),Object.defineProperty(exports,"lazyInject",{enumerable:!0,get:function get(){return _inversify.lazyInject}}),Object.defineProperty(exports,"lazyMultiInject",{enumerable:!0,get:function get(){return _inversify.lazyMultiInject}}),Object.defineProperty(exports,"CleanupSystem",{enumerable:!0,get:function get(){return _System.CleanupSystem}}),Object.defineProperty(exports,"ExecuteSystem",{enumerable:!0,get:function get(){return _System.ExecuteSystem}}),Object.defineProperty(exports,"InitializeSystem",{enumerable:!0,get:function get(){return _System.InitializeSystem}}),Object.defineProperty(exports,"System",{enumerable:!0,get:function get(){return _System.System}}),Object.defineProperty(exports,"TearDownSystem",{enumerable:!0,get:function get(){return _System.TearDownSystem}}),Object.defineProperty(exports,"World",{enumerable:!0,get:function get(){return _World.World}});var _ComponentManager=__webpack_require__(197),_Entity=__webpack_require__(676),_identifier=__webpack_require__(198),_inversify=__webpack_require__(677),_System=__webpack_require__(144),_World=__webpack_require__(715)},387:function(module,exports){},469:function(module,exports,__webpack_require__){"use strict";(function(module){__webpack_require__(470);var _react=__webpack_require__(247),_theming=__webpack_require__(656);(0,_react.addParameters)({options:{isFullscreen:!1,showAddonsPanel:!0,showSearchBox:!1,panelPosition:"right",hierarchySeparator:/\./,enableShortcuts:!0,theme:(0,_theming.create)({base:"light",brandTitle:"WebGPU Engine",brandUrl:"https://github.com/antvis/GWebGPUEngine",gridCellSize:12})}});var req=__webpack_require__(673);(0,_react.configure)((function loadStories(){req.keys().forEach(req)}),module)}).call(this,__webpack_require__(87)(module))},470:function(module,exports,__webpack_require__){var api=__webpack_require__(471),content=__webpack_require__(472);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1},exported=(api(content,options),content.locals?content.locals:{});module.exports=exported},472:function(module,exports,__webpack_require__){(exports=__webpack_require__(473)(!1)).push([module.i,"html,body{margin:0}.dg.ac{z-index:999 !important}\n",""]),module.exports=exports},673:function(module,exports,__webpack_require__){var map={"./base.stories.tsx":674};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=673},674:function(module,exports,__webpack_require__){"use strict";(function(module){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var _react=__webpack_require__(247),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2)),_Curl=_interopRequireDefault(__webpack_require__(675)),_Flocking=_interopRequireDefault(__webpack_require__(753)),_Fruchterman=_interopRequireDefault(__webpack_require__(754)),_Gravity=_interopRequireDefault(__webpack_require__(755)),_RotatingCube=_interopRequireDefault(__webpack_require__(756)),_RotatingCubeWithRecordBundle=_interopRequireDefault(__webpack_require__(757)),_TriangleMSAA=_interopRequireDefault(__webpack_require__(758));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var withSourceLoader=__webpack_require__(317).withSource,__STORY__=(__webpack_require__(317).addSource,"import { storiesOf } from '@storybook/react';\nimport * as React from 'react';\nimport Curl from './GPGPU/Curl';\nimport Flocking from './GPGPU/Flocking';\nimport Fruchterman from './GPGPU/Fruchterman';\nimport Gravity from './GPGPU/Gravity';\nimport RotatingCube from './Rendering/RotatingCube';\nimport RotatingCubeWithRecordBundle from './Rendering/RotatingCubeWithRecordBundle';\nimport TriangleMSAA from './Rendering/TriangleMSAA';\n\n// @ts-ignore\nstoriesOf('Rendering', module)\n  .add('TriangleMSAA', () => <TriangleMSAA />)\n  .add('RotatingCube', () => <RotatingCube />)\n  .add('RotatingCubeWithRecordBundle', () => <RotatingCubeWithRecordBundle />);\nstoriesOf('GPGPU', module)\n  .add('Flocking', () => <Flocking />)\n  .add('Curl', () => <Curl />)\n  .add('Gravity', () => <Gravity />)\n  .add('Fruchterman', () => <Fruchterman />);\n"),__ADDS_MAP__={"rendering--rotatingcubewithrecordbundle":{startLoc:{col:7,line:15},endLoc:{col:77,line:15},startBody:{col:39,line:15},endBody:{col:77,line:15}},"rendering--rotatingcube":{startLoc:{col:7,line:14},endLoc:{col:45,line:14},startBody:{col:23,line:14},endBody:{col:45,line:14}},"rendering--trianglemsaa":{startLoc:{col:7,line:13},endLoc:{col:45,line:13},startBody:{col:23,line:13},endBody:{col:45,line:13}},"gpgpu--fruchterman":{startLoc:{col:7,line:20},endLoc:{col:43,line:20},startBody:{col:22,line:20},endBody:{col:43,line:20}},"gpgpu--gravity":{startLoc:{col:7,line:19},endLoc:{col:35,line:19},startBody:{col:18,line:19},endBody:{col:35,line:19}},"gpgpu--curl":{startLoc:{col:7,line:18},endLoc:{col:29,line:18},startBody:{col:15,line:18},endBody:{col:29,line:18}},"gpgpu--flocking":{startLoc:{col:7,line:17},endLoc:{col:37,line:17},startBody:{col:19,line:17},endBody:{col:37,line:17}}},__MODULE_DEPENDENCIES__=[],__LOCAL_DEPENDENCIES__={},__IDS_TO_FRAMEWORKS__={};(0,_react.storiesOf)("Rendering",module).addParameters({storySource:{source:__STORY__,locationsMap:__ADDS_MAP__}}).addDecorator(withSourceLoader(__STORY__,__ADDS_MAP__,"/base.stories.tsx",__MODULE_DEPENDENCIES__,__LOCAL_DEPENDENCIES__,"/github/workspace/stories",__IDS_TO_FRAMEWORKS__)).add("TriangleMSAA",(function(){return React.createElement(_TriangleMSAA.default,null)})).add("RotatingCube",(function(){return React.createElement(_RotatingCube.default,null)})).add("RotatingCubeWithRecordBundle",(function(){return React.createElement(_RotatingCubeWithRecordBundle.default,null)})),(0,_react.storiesOf)("GPGPU",module).addParameters({storySource:{source:__STORY__,locationsMap:__ADDS_MAP__}}).addDecorator(withSourceLoader(__STORY__,__ADDS_MAP__,"/base.stories.tsx",__MODULE_DEPENDENCIES__,__LOCAL_DEPENDENCIES__,"/github/workspace/stories",__IDS_TO_FRAMEWORKS__)).add("Flocking",(function(){return React.createElement(_Flocking.default,null)})).add("Curl",(function(){return React.createElement(_Curl.default,null)})).add("Gravity",(function(){return React.createElement(_Gravity.default,null)})).add("Fruchterman",(function(){return React.createElement(_Fruchterman.default,null)}))}).call(this,__webpack_require__(87)(module))},675:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,computeStageDescriptor,computePipelineLayout,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},t=0,particleBuffers=new Array(2),particleBindGroups=new Array(2),_default=function(_super){function Curl(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Curl,_super),Curl.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{engineOptions:{supportCompute:!0},onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var vertexBufferData,simParamData,simParamBuffer,initialParticleData,computeBindGroupLayout,i;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,engine.compilePipelineStageDescriptor("layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = vec4(pos + a_particlePos, 0, 1);\n}","layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}",null)];case 1:return stageDescriptor=_a.sent(),[4,engine.compileComputePipelineStageDescriptor("vec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i = floor(v + dot(v, C.yy) );\n  vec2 x0 = v - i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x = a0.x * x0.x + h.x * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\n  // x1 = x0 - i1 + 1.0 * C.xxx;\n  // x2 = x0 - i2 + 2.0 * C.xxx;\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n  float mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\nfloat snoise(vec4 v)\n  {\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\n                        0.276393202250021, // 2 * G4\n                        0.414589803375032, // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\n// First corner\n  vec4 i = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v - i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n// i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\n  // x1 = x0 - i1 + 1.0 * C.xxxx\n  // x2 = x0 - i2 + 2.0 * C.xxxx\n  // x3 = x0 - i3 + 3.0 * C.xxxx\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0, ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n// Using  @eddietree implementation from \n// His brilliant demo 'Artifacts'\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = 1e-1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nstruct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) uniform SimParams {\n  float deltaT;\n  float noiseSize;\n} params;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesA {\n  Particle particles[1500];\n} particlesA;\n\nlayout(std140, set = 0, binding = 2) buffer ParticlesB {\n  Particle particles[1500];\n} particlesB;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= 1500) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec3 curl = curlNoise( vec3(particlesB.particles[index].pos.xy, 0.) * params.noiseSize );\n\n  vVel += curl.xy * .01;\n  vVel *= .97;\n  vVel = normalize(vVel);\n\n  vPos += vVel * params.deltaT;\n\n  // Wrap around boundary\n  if (vPos.x < -1.0) vPos.x = 1.0;\n  if (vPos.x > 1.0) vPos.x = -1.0;\n  if (vPos.y < -1.0) vPos.y = 1.0;\n  if (vPos.y > 1.0) vPos.y = -1.0;\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}",null)];case 2:for(computeStageDescriptor=_a.sent(),vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),verticesBuffer=engine.createVertexBuffer(vertexBufferData),simParamData=new Float32Array([.01,.1]),simParamBuffer=engine.createUniformBuffer(simParamData),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;for(i=0;i<2;++i)particleBuffers[i]=engine.createVertexBuffer(initialParticleData,128);for(computeBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:4,type:"uniform-buffer"},{binding:1,visibility:4,type:"storage-buffer"},{binding:2,visibility:4,type:"storage-buffer"}]}),computePipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]}),i=0;i<2;++i)particleBindGroups[i]=engine.getDevice().createBindGroup({layout:computeBindGroupLayout,bindings:[{binding:0,resource:{buffer:simParamBuffer,offset:0,size:simParamData.byteLength}},{binding:1,resource:{buffer:particleBuffers[i],offset:0,size:initialParticleData.byteLength}},{binding:2,resource:{buffer:particleBuffers[(i+1)%2],offset:0,size:initialParticleData.byteLength}}]});return[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setComputePipeline("compute",__assign({layout:computePipelineLayout},computeStageDescriptor)),engine.setComputeBindGroups([particleBindGroups[t%2]]),engine.dispatch(1500),engine.bindVertexInputs({indexBuffer:null,indexOffset:0,vertexStartSlot:0,vertexBuffers:[particleBuffers[(t+1)%2],verticesBuffer],vertexOffsets:[0,0]}),engine.drawArraysType("render",__assign(__assign({layout:engine.getDevice().createPipelineLayout({bindGroupLayouts:[]})},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}),0,3,1500),++t,[2]}))}))}})),[2]}))}))},Curl.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Curl.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},Curl}(React.Component);exports.default=_default},676:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createEntity=function createEntity(){return entitySequence++};var entitySequence=0},677:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lazyMultiInject=exports.lazyInject=exports.container=void 0,__webpack_require__(678);var _inversify=__webpack_require__(143),_inversifyInjectDecorators=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(705)),_ComponentManager=__webpack_require__(197),_CameraComponent=__webpack_require__(707),_System=__webpack_require__(711),_HierarchyComponent=__webpack_require__(712),_System2=__webpack_require__(713),_TransformComponent=__webpack_require__(714),_identifier=__webpack_require__(198);var container=new _inversify.Container;exports.container=container;var DECORATORS=(0,_inversifyInjectDecorators.default)(container,!1);exports.lazyInject=function(serviceIdentifier){var original=DECORATORS.lazyInject(serviceIdentifier);return function(proto,key,descriptor){original.call(this,proto,key),descriptor&&(descriptor.initializer=function(){return proto[key]})}};exports.lazyMultiInject=function(serviceIdentifier){var original=DECORATORS.lazyMultiInject(serviceIdentifier);return function(proto,key,descriptor){original.call(this,proto,key),descriptor&&(descriptor.initializer=function(){return proto[key]})}},container.bind(_identifier.IDENTIFIER.HierarchyComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_HierarchyComponent.HierarchyComponent)),container.bind(_identifier.IDENTIFIER.TransformComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_TransformComponent.TransformComponent)),container.bind(_identifier.IDENTIFIER.CameraComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_CameraComponent.CameraComponent)),container.bind(_identifier.IDENTIFIER.Systems).to(_System2.SceneGraphSystem).inSingletonScope(),container.bind(_identifier.IDENTIFIER.Systems).to(_System.CameraSystem).inSingletonScope()},707:function(module,exports,__webpack_require__){"use strict";__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(16),__webpack_require__(51),__webpack_require__(67),__webpack_require__(11),__webpack_require__(23),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraComponent=exports.CAMERA_TRACKING_MODE=exports.CAMERA_TYPE=void 0;var CAMERA_TYPE,CAMERA_TRACKING_MODE,_glMatrix=__webpack_require__(80),_=__webpack_require__(36),_math=__webpack_require__(708),_Landmark=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(710));function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}exports.CAMERA_TYPE=CAMERA_TYPE,function(CAMERA_TYPE){CAMERA_TYPE.ORBITING="ORBITING",CAMERA_TYPE.EXPLORING="EXPLORING",CAMERA_TYPE.TRACKING="TRACKING"}(CAMERA_TYPE||(exports.CAMERA_TYPE=CAMERA_TYPE={})),exports.CAMERA_TRACKING_MODE=CAMERA_TRACKING_MODE,function(CAMERA_TRACKING_MODE){CAMERA_TRACKING_MODE.DEFAULT="DEFAULT",CAMERA_TRACKING_MODE.ROTATIONAL="ROTATIONAL",CAMERA_TRACKING_MODE.TRANSLATIONAL="TRANSLATIONAL",CAMERA_TRACKING_MODE.CINEMATIC="CINEMATIC"}(CAMERA_TRACKING_MODE||(exports.CAMERA_TRACKING_MODE=CAMERA_TRACKING_MODE={}));var DEG_2_RAD=Math.PI/180,RAD_2_DEG=180/Math.PI,CameraComponent=function(_Component){function CameraComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CameraComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(CameraComponent).call(this,data))).matrix=_glMatrix.mat4.create(),_this.right=_glMatrix.vec3.fromValues(1,0,0),_this.up=_glMatrix.vec3.fromValues(0,1,0),_this.forward=_glMatrix.vec3.fromValues(0,0,1),_this.position=_glMatrix.vec3.fromValues(0,0,1),_this.focalPoint=_glMatrix.vec3.fromValues(0,0,0),_this.distanceVector=_glMatrix.vec3.fromValues(0,0,0),_this.distance=1,_this.azimuth=0,_this.elevation=0,_this.roll=0,_this.relAzimuth=0,_this.relElevation=0,_this.relRoll=0,_this.dollyingStep=0,_this.rotateWorld=!1,_this.fov=30,_this.near=.1,_this.far=1e4,_this.aspect=1,_this.perspective=_glMatrix.mat4.create(),_this.following=void 0,_this.type=CAMERA_TYPE.EXPLORING,_this.trackingMode=CAMERA_TRACKING_MODE.DEFAULT,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(CameraComponent,_Component),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(CameraComponent,[{key:"setType",value:function(type,trackingMode){this.type=type,this.type===CAMERA_TYPE.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===CAMERA_TYPE.TRACKING&&void 0!==trackingMode&&this.setTrackingMode(trackingMode)}},{key:"setTrackingMode",value:function(trackingMode){if(this.type!==CAMERA_TYPE.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");this.trackingMode=trackingMode}},{key:"setWorldRotation",value:function(flag){this.rotateWorld=flag,this._getAngles()}},{key:"getViewTransform",value:function(){return _glMatrix.mat4.invert(_glMatrix.mat4.create(),this.matrix)}},{key:"setMatrix",value:function(matrix){this.matrix=matrix,this._update()}},{key:"setPerspective",value:function(near,far,angle,aspect){this.fov=angle,this.near=near,this.far=far,this.aspect=aspect,this.updatePerspective()}},{key:"updatePerspective",value:function(){_glMatrix.mat4.perspective(this.perspective,this.fov*DEG_2_RAD,this.aspect,this.near,this.far)}},{key:"setPosition",value:function(x,y,z){return this._setPosition(x,y,z),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(x,y,z){var up=_glMatrix.vec3.fromValues(0,1,0);if(this.focalPoint=(0,_math.createVec3)(x,y,z),this.trackingMode===CAMERA_TRACKING_MODE.CINEMATIC){var d=_glMatrix.vec3.subtract(_glMatrix.vec3.create(),this.focalPoint,this.position);x=d[0],y=d[1],z=d[2];var r=_glMatrix.vec3.length(d),el=Math.asin(y/r)*RAD_2_DEG,az=90+Math.atan2(z,x)*RAD_2_DEG,m=_glMatrix.mat4.create();_glMatrix.mat4.rotateY(m,m,az*DEG_2_RAD),_glMatrix.mat4.rotateX(m,m,el*DEG_2_RAD),up=_glMatrix.vec3.transformMat4(_glMatrix.vec3.create(),[0,1,0],m)}return _glMatrix.mat4.invert(this.matrix,_glMatrix.mat4.lookAt(_glMatrix.mat4.create(),this.position,this.focalPoint,up)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(d){if(!(this.distance===d||0>d)){this.distance=d,this.dollyingStep=this.distance/100;var pos=_glMatrix.vec3.create(),n=this.forward,f=this.focalPoint;return pos[0]=d*n[0]+f[0],pos[1]=d*n[1]+f[1],pos[2]=d*n[2]+f[2],this._setPosition(pos),this}}},{key:"changeAzimuth",value:function(az){return this.setAzimuth(this.azimuth+az),this}},{key:"changeElevation",value:function(el){return this.setElevation(this.elevation+el),this}},{key:"changeRoll",value:function(rl){return this.setRoll(this.roll+rl),this}},{key:"setAzimuth",value:function(az){return this.azimuth=(0,_math.getAngle)(az),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(el){return this.elevation=(0,_math.getAngle)(el),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(angle){return this.roll=(0,_math.getAngle)(angle),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(azimuth,elevation,roll){if(this.type===CAMERA_TYPE.EXPLORING){azimuth=(0,_math.getAngle)(azimuth),elevation=(0,_math.getAngle)(elevation),roll=(0,_math.getAngle)(roll);var rotX=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[1,0,0],(this.rotateWorld?1:-1)*elevation*DEG_2_RAD),rotY=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,1,0],(this.rotateWorld?1:-1)*azimuth*DEG_2_RAD),rotZ=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,0,1],roll*DEG_2_RAD),rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotY,rotX);rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotQ,rotZ);var rotMatrix=_glMatrix.mat4.fromQuat(_glMatrix.mat4.create(),rotQ);_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,-this.distance]),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix),_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(90<Math.abs(this.elevation+elevation))return;this.relElevation=(0,_math.getAngle)(elevation),this.relAzimuth=(0,_math.getAngle)(azimuth),this.relRoll=(0,_math.getAngle)(roll),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(tx,ty){var coords=(0,_math.createVec3)(tx,ty,0),pos=_glMatrix.vec3.clone(this.position);return _glMatrix.vec3.add(pos,pos,_glMatrix.vec3.scale(_glMatrix.vec3.create(),this.right,coords[0])),_glMatrix.vec3.add(pos,pos,_glMatrix.vec3.scale(_glMatrix.vec3.create(),this.up,coords[1])),this._setPosition(pos),this}},{key:"dolly",value:function(value){var n=this.forward,pos=_glMatrix.vec3.clone(this.position),step=value*this.dollyingStep;return pos[0]+=step*n[0],pos[1]+=step*n[1],pos[2]+=step*n[2],this._setPosition(pos),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getDistance():this.type===CAMERA_TYPE.TRACKING&&_glMatrix.vec3.add(this.focalPoint,pos,this.distanceVector),this}},{key:"createLandmark",value:function(name){return new _Landmark.default(name,this)}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var rotX,rotY,rotZ=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,0,1],this.roll*DEG_2_RAD);_glMatrix.mat4.identity(this.matrix),rotX=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[1,0,0],(this.rotateWorld||this.type===CAMERA_TYPE.TRACKING?1:-1)*this.elevation*DEG_2_RAD),rotY=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,1,0],(this.rotateWorld?1:-1)*this.azimuth*DEG_2_RAD);var rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotY,rotX);rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotQ,rotZ);var rotMatrix=_glMatrix.mat4.fromQuat(_glMatrix.mat4.create(),rotQ);this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?(_glMatrix.mat4.translate(this.matrix,this.matrix,this.focalPoint),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix),_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===CAMERA_TYPE.TRACKING&&(_glMatrix.mat4.translate(this.matrix,this.matrix,this.position),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix))}},{key:"_setPosition",value:function(x,y,z){this.position=(0,_math.createVec3)(x,y,z);var m=this.matrix;m[12]=this.position[0],m[13]=this.position[1],m[14]=this.position[2],m[15]=1}},{key:"_getAxes",value:function(){_glMatrix.vec3.copy(this.right,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[1,0,0,0],this.matrix))),_glMatrix.vec3.copy(this.up,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,1,0,0],this.matrix))),_glMatrix.vec3.copy(this.forward,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,0,1,0],this.matrix))),_glMatrix.vec3.normalize(this.right,this.right),_glMatrix.vec3.normalize(this.up,this.up),_glMatrix.vec3.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var x=this.distanceVector[0],y=this.distanceVector[1],z=this.distanceVector[2],r=_glMatrix.vec3.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===CAMERA_TYPE.TRACKING||this.rotateWorld?(this.elevation=Math.asin(y/r)*RAD_2_DEG,this.azimuth=Math.atan2(-x,-z)*RAD_2_DEG):(this.elevation=-Math.asin(y/r)*RAD_2_DEG,this.azimuth=-Math.atan2(-x,-z)*RAD_2_DEG)}},{key:"_getPosition",value:function(){_glMatrix.vec3.copy(this.position,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){_glMatrix.vec3.transformMat3(this.distanceVector,[0,0,-this.distance],_glMatrix.mat3.fromMat4(_glMatrix.mat3.create(),this.matrix)),_glMatrix.vec3.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=_glMatrix.vec3.subtract(_glMatrix.vec3.create(),this.focalPoint,this.position),this.distance=_glMatrix.vec3.length(this.distanceVector),this.dollyingStep=this.distance/100}}]),CameraComponent}(_.Component);exports.CameraComponent=CameraComponent},708:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAngle=function getAngle(angle){if(void 0===angle)return 0;if(360<angle||-360>angle)return angle%360;return angle},exports.createVec3=function createVec3(x,y,z){if((0,_isNumber2.default)(x))return _glMatrix.vec3.fromValues(x,y,z);if(3===x.length)return _glMatrix.vec3.clone(x);return _glMatrix.vec3.fromValues(x[0],x[1],x[2])};var _isNumber2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(709)),_glMatrix=__webpack_require__(80)},710:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _glMatrix=__webpack_require__(80);function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var Landmark=function(){function Landmark(name,c){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Landmark),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=name,this.matrix=_glMatrix.mat4.clone(c.matrix),this.right=_glMatrix.vec3.clone(c.right),this.up=_glMatrix.vec3.clone(c.up),this.forward=_glMatrix.vec3.clone(c.forward),this.position=_glMatrix.vec3.clone(c.position),this.focalPoint=_glMatrix.vec3.clone(c.focalPoint),this.distanceVector=_glMatrix.vec3.clone(c.distanceVector),this.azimuth=c.azimuth,this.elevation=c.elevation,this.roll=c.roll,this.relAzimuth=c.relAzimuth,this.relElevation=c.relElevation,this.relRoll=c.relRoll,this.dollyingStep=c.dollyingStep,this.distance=c.distance}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Landmark,[{key:"retrieve",value:function(c){c.matrix=_glMatrix.mat4.copy(c.matrix,this.matrix),c.right=_glMatrix.vec3.copy(c.right,this.right),c.up=_glMatrix.vec3.copy(c.up,this.up),c.forward=_glMatrix.vec3.copy(c.forward,this.forward),c.position=_glMatrix.vec3.copy(c.position,this.position),c.focalPoint=_glMatrix.vec3.copy(c.focalPoint,this.focalPoint),c.distanceVector=_glMatrix.vec3.copy(c.distanceVector,this.distanceVector),c.azimuth=this.azimuth,c.elevation=this.elevation,c.roll=this.roll,c.relAzimuth=this.relAzimuth,c.relElevation=this.relElevation,c.relRoll=this.relRoll,c.dollyingStep=this.dollyingStep,c.distance=this.distance}}]),Landmark}();exports.default=Landmark},711:function(module,exports,__webpack_require__){"use strict";__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(28),__webpack_require__(33),__webpack_require__(16),__webpack_require__(107),__webpack_require__(92),__webpack_require__(53),__webpack_require__(51),__webpack_require__(34),__webpack_require__(67),__webpack_require__(11),__webpack_require__(23),__webpack_require__(35),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_temp,_inversify=__webpack_require__(143),_=__webpack_require__(36),_System=__webpack_require__(144);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var CameraSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_.IDENTIFIER.CameraComponentManager),_dec3=(0,_inversify.inject)(_.IDENTIFIER.TransformComponentManager),_dec((_temp=function(_ExecuteSystem){function CameraSystem(){var _getPrototypeOf2,_this;_classCallCheck(this,CameraSystem);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(CameraSystem)).call.apply(_getPrototypeOf2,[this].concat(args)))).name="camera",_initializerDefineProperty(_this,"camera",_descriptor,_assertThisInitialized(_this)),_initializerDefineProperty(_this,"transform",_descriptor2,_assertThisInitialized(_this)),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(CameraSystem,_ExecuteSystem),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(CameraSystem,[{key:"execute",value:function(){}},{key:"createCamera",value:function(cameraParams){var entity=(0,_.createEntity)();this.camera.create(entity,{}),this.transform.create(entity,{});var cameraComponent=this.camera.getComponentByEntity(entity),near=cameraParams.near,far=cameraParams.far,angle=cameraParams.angle,aspect=cameraParams.aspect;return null==cameraComponent||cameraComponent.setPerspective(near,far,angle,aspect),cameraComponent}},{key:"getTransformComponentManager",value:function(){return this.transform}}]),CameraSystem}(_System.ExecuteSystem),_descriptor=_applyDecoratedDescriptor((_class2=_temp).prototype,"camera",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.CameraSystem=CameraSystem},712:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(16),__webpack_require__(51),__webpack_require__(67),__webpack_require__(11),__webpack_require__(23),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.HierarchyComponent=void 0;var HierarchyComponent=function(_Component){function HierarchyComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HierarchyComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(HierarchyComponent).call(this,data))).parentID=void 0,_this.parentID=data.parentID||-1,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(HierarchyComponent,_Component),HierarchyComponent}(__webpack_require__(36).Component);exports.HierarchyComponent=HierarchyComponent},713:function(module,exports,__webpack_require__){"use strict";__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(28),__webpack_require__(33),__webpack_require__(16),__webpack_require__(107),__webpack_require__(92),__webpack_require__(53),__webpack_require__(51),__webpack_require__(34),__webpack_require__(67),__webpack_require__(11),__webpack_require__(23),__webpack_require__(35),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneGraphSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_temp,_glMatrix=__webpack_require__(80),_inversify=__webpack_require__(143),_=__webpack_require__(36),_System=__webpack_require__(144);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var SceneGraphSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_.IDENTIFIER.HierarchyComponentManager),_dec3=(0,_inversify.inject)(_.IDENTIFIER.TransformComponentManager),_dec((_temp=function(_ExecuteSystem){function SceneGraphSystem(){var _getPrototypeOf2,_this;_classCallCheck(this,SceneGraphSystem);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(SceneGraphSystem)).call.apply(_getPrototypeOf2,[this].concat(args)))).name="sceneGraph",_initializerDefineProperty(_this,"hierarchy",_descriptor,_assertThisInitialized(_this)),_initializerDefineProperty(_this,"transform",_descriptor2,_assertThisInitialized(_this)),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(SceneGraphSystem,_ExecuteSystem),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(SceneGraphSystem,[{key:"execute",value:function(){this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){for(var i=0;i<this.transform.getCount();++i)this.transform.getComponent(i).updateTransform()}},{key:"runHierarchyUpdateSystem",value:function(){for(var i=0;i<this.hierarchy.getCount();++i){var parentComponent=this.hierarchy.getComponent(i),entity=this.hierarchy.getEntity(i),transformChild=this.transform.getComponentByEntity(entity),transformParent=this.transform.getComponentByEntity(parentComponent.parentID);null!==transformChild&&null!==transformParent&&transformChild.updateTransformWithParent(transformParent)}}},{key:"attach",value:function(entity,parent,isChildAlreadyInLocalSpace){if(this.hierarchy.contains(entity)&&this.detach(entity),this.hierarchy.create(entity,{parentID:parent}),1<this.hierarchy.getCount())for(var parentCandidateEntity,i=this.hierarchy.getCount()-1;0<i;--i){parentCandidateEntity=this.hierarchy.getEntity(i);for(var j=0;j<i;++j)if(this.hierarchy.getComponent(j).parentID===parentCandidateEntity){this.hierarchy.moveItem(i,j),++i;break}}this.hierarchy.getComponentByEntity(entity);var transformParent=this.transform.getComponentByEntity(parent);null===transformParent&&(transformParent=this.transform.create(parent));var transformChild=this.transform.getComponentByEntity(entity);null===transformChild&&(transformChild=this.transform.create(entity),transformParent=this.transform.getComponentByEntity(parent)),!isChildAlreadyInLocalSpace&&transformParent&&(transformChild.matrixTransform(_glMatrix.mat4.invert(_glMatrix.mat4.create(),transformParent.worldTransform)),transformChild.updateTransform()),transformParent&&transformChild.updateTransformWithParent(transformParent)}},{key:"detach",value:function(entity){if(null!==this.hierarchy.getComponentByEntity(entity)){var transform=this.transform.getComponentByEntity(entity);null!==transform&&transform.applyTransform(),this.hierarchy.removeKeepSorted(entity)}}},{key:"detachChildren",value:function(parent){for(var i=0;i<this.hierarchy.getCount();){var _this$hierarchy$getCo;if((null===(_this$hierarchy$getCo=this.hierarchy.getComponent(i))||void 0===_this$hierarchy$getCo?void 0:_this$hierarchy$getCo.parentID)===parent){var entity=this.hierarchy.getEntity(i);this.detach(entity)}else++i}}}]),SceneGraphSystem}(_System.ExecuteSystem),_descriptor=_applyDecoratedDescriptor((_class2=_temp).prototype,"hierarchy",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.SceneGraphSystem=SceneGraphSystem},714:function(module,exports,__webpack_require__){"use strict";__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(16),__webpack_require__(51),__webpack_require__(67),__webpack_require__(11),__webpack_require__(23),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformComponent=void 0;var _glMatrix=__webpack_require__(80);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var TransformComponent=function(_Component){function TransformComponent(data){var _this,rotation,scaling,translation,rts,transformed,quatX,quatY,quatZ,aS,aR,aT,bS,bR,bT;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TransformComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(TransformComponent).call(this,data))).dirtyFlag=void 0,_this.localTranslation=_glMatrix.vec3.fromValues(0,0,0),_this.localRotation=_glMatrix.quat.fromValues(0,0,0,1),_this.localScale=_glMatrix.vec3.fromValues(1,1,1),_this.localTransform=_glMatrix.mat4.create(),_this.worldTransform=_glMatrix.mat4.create(),_this.getRotation=(rotation=_glMatrix.quat.create(),function(){return _glMatrix.mat4.getRotation(rotation,_this.worldTransform),rotation}),_this.getScale=(scaling=_glMatrix.vec3.create(),function(){return _glMatrix.mat4.getScaling(scaling,_this.worldTransform),scaling}),_this.getPosition=(translation=_glMatrix.vec3.create(),function(){return _glMatrix.mat4.getTranslation(translation,_this.worldTransform),translation}),_this.getLocalMatrix=(rts=_glMatrix.mat4.create(),function(){return _glMatrix.mat4.fromRotationTranslationScale(rts,_this.localRotation,_this.localTranslation,_this.localScale),rts}),_this.matrixTransform=(transformed=_glMatrix.mat4.create(),function(mat){_glMatrix.mat4.multiply(transformed,_this.getLocalMatrix(),mat),_glMatrix.mat4.getScaling(_this.localScale,transformed),_glMatrix.mat4.getTranslation(_this.localTranslation,transformed),_glMatrix.mat4.getRotation(_this.localRotation,transformed)}),_this.rotateRollPitchYaw=(quatX=_glMatrix.quat.create(),quatY=_glMatrix.quat.create(),quatZ=_glMatrix.quat.create(),function(x,y,z){_this.setDirty(),_glMatrix.quat.fromEuler(quatX,x,0,0),_glMatrix.quat.fromEuler(quatY,0,y,0),_glMatrix.quat.fromEuler(quatZ,0,0,z),_glMatrix.quat.multiply(_this.localRotation,quatX,_this.localRotation),_glMatrix.quat.multiply(_this.localRotation,_this.localRotation,quatY),_glMatrix.quat.multiply(_this.localRotation,quatZ,_this.localRotation),_glMatrix.quat.normalize(_this.localRotation,_this.localRotation)}),_this.lerp=(aS=_glMatrix.vec3.create(),aR=_glMatrix.quat.create(),aT=_glMatrix.vec3.create(),bS=_glMatrix.vec3.create(),bR=_glMatrix.quat.create(),bT=_glMatrix.vec3.create(),function(a,b,t){_this.setDirty(),_glMatrix.mat4.getScaling(aS,a.worldTransform),_glMatrix.mat4.getTranslation(aT,a.worldTransform),_glMatrix.mat4.getRotation(aR,a.worldTransform),_glMatrix.mat4.getScaling(bS,b.worldTransform),_glMatrix.mat4.getTranslation(bT,b.worldTransform),_glMatrix.mat4.getRotation(bR,b.worldTransform),_glMatrix.vec3.lerp(_this.localScale,aS,bS,t),_glMatrix.quat.slerp(_this.localRotation,aR,bR,t),_glMatrix.vec3.lerp(_this.localTranslation,aT,bT,t)}),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(TransformComponent,_Component),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(TransformComponent,[{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var value=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];value?this.dirtyFlag|=TransformComponent.DIRTY:this.dirtyFlag&=~TransformComponent.DIRTY}},{key:"updateTransform",value:function(){this.isDirty()&&(this.setDirty(!1),_glMatrix.mat4.copy(this.worldTransform,this.getLocalMatrix()))}},{key:"updateTransformWithParent",value:function(parent){_glMatrix.mat4.multiply(this.worldTransform,this.getLocalMatrix(),parent.worldTransform)}},{key:"applyTransform",value:function(){this.setDirty(),_glMatrix.mat4.getScaling(this.localScale,this.worldTransform),_glMatrix.mat4.getTranslation(this.localTranslation,this.worldTransform),_glMatrix.mat4.getRotation(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localTranslation=_glMatrix.vec3.fromValues(0,0,0),this.localRotation=_glMatrix.quat.fromValues(0,0,0,1),this.localScale=_glMatrix.vec3.fromValues(1,1,1)}},{key:"translate",value:function(translation){this.setDirty(),_glMatrix.vec3.add(this.localTranslation,this.localTranslation,translation)}},{key:"scale",value:function(scaling){this.setDirty(),_glMatrix.vec3.multiply(this.localScale,this.localScale,scaling)}},{key:"rotate",value:function(quaternion){this.setDirty(),_glMatrix.quat.multiply(this.localRotation,this.localRotation,quaternion),_glMatrix.quat.normalize(this.localRotation,this.localRotation)}}]),TransformComponent}(__webpack_require__(197).Component);exports.TransformComponent=TransformComponent,TransformComponent.DIRTY=1},715:function(module,exports,__webpack_require__){"use strict";function _typeof2(obj){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(109),__webpack_require__(123),__webpack_require__(33),__webpack_require__(16),__webpack_require__(53),__webpack_require__(310),__webpack_require__(311),__webpack_require__(51),__webpack_require__(34),__webpack_require__(67),__webpack_require__(11),__webpack_require__(74),__webpack_require__(23),__webpack_require__(35),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.World=void 0;var WebGPUConstants=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof2(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(312)),_eventemitter=__webpack_require__(289),_=__webpack_require__(36),_identifier=__webpack_require__(198),_System=__webpack_require__(144),_WebGPUEngine=__webpack_require__(716);function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var World=function(_EventEmitter){function World(canvas,options){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,World),(_this=_possibleConstructorReturn(this,_getPrototypeOf(World).call(this))).systems=void 0,_this.engine=void 0,_this.inited=!1,_this.onInit=void 0,_this.onUpdate=void 0,_this.rafHandle=void 0,_this.useRenderBundle=!1,_this.renderBundleRecorded=!1,_this.renderBundle=void 0,_this.update=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _this.systems.forEach((function(system){system.type===_System.ExecuteSystem.TYPE&&system.execute()})),_this.systems.forEach((function(system){system.type===_System.CleanupSystem.TYPE&&system.cleanup()})),_context.next=4,_this.render();case 4:_this.rafHandle=window.requestAnimationFrame(_this.update);case 5:case"end":return _context.stop()}}),_callee)}))),navigator.gpu?(_this.engine=new _WebGPUEngine.WebGPUEngine(canvas,function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}({swapChainFormat:WebGPUConstants.TextureFormat.BGRA8Unorm,antialiasing:!0},options.engineOptions)),_this.systems=_.container.getAll(_identifier.IDENTIFIER.Systems),_this.init(canvas),_this.onInit=options.onInit,_this.onUpdate=options.onUpdate,_this.useRenderBundle=!!options.useRenderBundle,_this):(window.alert("WebGPU is not supported by your browser."),_possibleConstructorReturn(_this))}var _render,_init;return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(World,_EventEmitter),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(World,[{key:"createCamera",value:function(cameraParams){var cameraSystem=this.systems.find((function(s){return"camera"===s.name}));return cameraSystem?cameraSystem.createCamera(cameraParams):null}},{key:"init",value:(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(canvas){return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.engine.init();case 2:this.systems.forEach((function(system){system.type===_System.InitializeSystem.TYPE&&system.initialize(canvas)})),this.update();case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _init.apply(this,arguments)})},{key:"destroy",value:function(){this.off("init"),this.off("update"),this.engine.dispose(),this.systems.forEach((function(system){system.type===_System.TearDownSystem.TYPE&&system.tearDown()})),window.cancelAnimationFrame(this.rafHandle)}},{key:"render",value:(_render=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.engine.beginFrame(),this.inited){_context3.next=6;break}return this.emit("init",this.engine),_context3.next=5,this.onInit(this.engine);case 5:this.inited=!0;case 6:if(!this.useRenderBundle){_context3.next=16;break}if(this.renderBundleRecorded){_context3.next=13;break}return this.engine.startRecordBundle(),_context3.next=11,this.onUpdate(this.engine);case 11:this.renderBundle=this.engine.stopRecordBundle(),this.renderBundleRecorded=!0;case 13:this.engine.executeBundles([this.renderBundle]),_context3.next=19;break;case 16:return this.emit("update",this.engine),_context3.next=19,this.onUpdate(this.engine);case 19:this.engine.endFrame();case 20:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _render.apply(this,arguments)})}]),World}(_eventemitter.EventEmitter);exports.World=World},716:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}__webpack_require__(13),__webpack_require__(19),__webpack_require__(22),__webpack_require__(717),__webpack_require__(109),__webpack_require__(33),__webpack_require__(16),__webpack_require__(718),__webpack_require__(720),__webpack_require__(310),__webpack_require__(311),__webpack_require__(34),__webpack_require__(11),__webpack_require__(74),__webpack_require__(65),__webpack_require__(23),__webpack_require__(721),__webpack_require__(725),__webpack_require__(726),__webpack_require__(727),__webpack_require__(729),__webpack_require__(730),__webpack_require__(731),__webpack_require__(732),__webpack_require__(733),__webpack_require__(734),__webpack_require__(735),__webpack_require__(736),__webpack_require__(737),__webpack_require__(738),__webpack_require__(739),__webpack_require__(741),__webpack_require__(742),__webpack_require__(743),__webpack_require__(744),__webpack_require__(745),__webpack_require__(746),__webpack_require__(747),__webpack_require__(748),__webpack_require__(749),__webpack_require__(750),__webpack_require__(751),__webpack_require__(35),__webpack_require__(24),Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGPUEngine=void 0;var WebGPUConstants=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(312)),_glslang=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(752));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var WebGPUEngine=function(){function WebGPUEngine(canvas){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,WebGPUEngine),this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.pipelines={},this.computePipelines={},this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.commandBuffers=[,,,].fill(void 0),this.currentRenderPass=null,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.options=void 0,this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.computeEncoderDescriptor={label:"compute"},this.canvas=canvas,this.options=options,this.mainPassSampleCount=options.antialiasing?this.defaultSampleCount:1}var _initGlslang,_compileComputePipelineStageDescriptor,_compilePipelineStageDescriptor,_compileRawPipelineStageDescriptor,_init;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(WebGPUEngine,[{key:"getDevice",value:function(){return this.device}},{key:"getSwapChain",value:function(){return this.swapChain}},{key:"init",value:(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.initGlslang();case 2:this.initContextAndSwapChain(),this.initMainAttachments();case 4:case"end":return _context.stop()}}),_callee,this)}))),function(){return _init.apply(this,arguments)})},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor)}},{key:"endFrame",value:function(){this.endRenderPass(),this.options.supportCompute&&this.endComputePass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.commandBuffers[2]=this.computeEncoder.finish(),this.device.defaultQueue.submit(this.commandBuffers),this.tempBuffers.forEach((function(buffer){return buffer.destroy()})),this.tempBuffers=[]}},{key:"startRecordBundle",value:function(){this.bundleEncoder=this.device.createRenderBundleEncoder({colorFormats:[WebGPUConstants.TextureFormat.BGRA8Unorm],depthStencilFormat:WebGPUConstants.TextureFormat.Depth24PlusStencil8,sampleCount:this.mainPassSampleCount})}},{key:"stopRecordBundle",value:function(){var bundle=this.bundleEncoder.finish();return this.bundleEncoder=null,bundle}},{key:"executeBundles",value:function(bundles){var _this$currentRenderPa;this.currentRenderPass||this.startMainRenderPass(),null===(_this$currentRenderPa=this.currentRenderPass)||void 0===_this$currentRenderPa||_this$currentRenderPa.executeBundles(bundles)}},{key:"enableScissor",value:function(x,y,width,height){this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass.setScissorRect(x,y,width,height)}},{key:"disableScissor",value:function(){var _this$currentRenderPa2;this.currentRenderPass||this.startMainRenderPass(),null===(_this$currentRenderPa2=this.currentRenderPass)||void 0===_this$currentRenderPa2||_this$currentRenderPa2.setScissorRect(0,0,this.canvas.width,this.canvas.height)}},{key:"setSize",value:function(){this.initMainAttachments()}},{key:"clear",value:function(color,backBuffer,depth){var stencil=3<arguments.length&&void 0!==arguments[3]&&arguments[3];this.mainColorAttachments[0].loadValue=backBuffer?color:WebGPUConstants.LoadOp.Load,this.mainDepthAttachment.depthLoadValue=depth?this.clearDepthValue:WebGPUConstants.LoadOp.Load,this.mainDepthAttachment.stencilLoadValue=stencil?this.clearStencilValue:WebGPUConstants.LoadOp.Load,this.startMainRenderPass(),this.options.supportCompute&&this.startComputePass()}},{key:"dispose",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy()}},{key:"compileRawPipelineStageDescriptor",value:(_compileRawPipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(vertexCode,fragmentCode){var vertexShader,fragmentShader;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.compileRawShaderToSpirV(vertexCode,"vertex");case 2:return vertexShader=_context2.sent,_context2.next=5,this.compileRawShaderToSpirV(fragmentCode,"fragment");case 5:return fragmentShader=_context2.sent,_context2.abrupt("return",this.createPipelineStageDescriptor(vertexShader,fragmentShader));case 7:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _compileRawPipelineStageDescriptor.apply(this,arguments)})},{key:"compilePipelineStageDescriptor",value:(_compilePipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(vertexCode,fragmentCode,defines){var shaderVersion,vertexShader,fragmentShader;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return shaderVersion="#version 450\n",_context3.next=3,this.compileShaderToSpirV(vertexCode,"vertex",defines,shaderVersion);case 3:return vertexShader=_context3.sent,_context3.next=6,this.compileShaderToSpirV(fragmentCode,"fragment",defines,shaderVersion);case 6:return fragmentShader=_context3.sent,_context3.abrupt("return",this.createPipelineStageDescriptor(vertexShader,fragmentShader));case 8:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _compilePipelineStageDescriptor.apply(this,arguments)})},{key:"compileComputePipelineStageDescriptor",value:(_compileComputePipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(computeCode,defines){var computeShader;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=3,this.compileShaderToSpirV(computeCode,"compute",defines,"#version 450\n");case 3:return computeShader=_context4.sent,_context4.abrupt("return",{computeStage:{module:this.device.createShaderModule({code:computeShader}),entryPoint:"main"}});case 5:case"end":return _context4.stop()}}),_callee4,this)}))),function(){return _compileComputePipelineStageDescriptor.apply(this,arguments)})},{key:"drawElementsType",value:function(pipelineName,descriptor,indexStart,indexCount){var instancesCount=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,renderPass=this.bundleEncoder||this.currentRenderPass;this.setRenderPipeline(pipelineName,descriptor),renderPass.drawIndexed(indexCount,instancesCount,indexStart,0,0)}},{key:"drawArraysType",value:function(pipelineName,descriptor,verticesStart,verticesCount){var instancesCount=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,renderPass=this.bundleEncoder||this.currentRenderPass;this.setRenderPipeline(pipelineName,descriptor),renderPass.draw(verticesCount,instancesCount,verticesStart,0)}},{key:"createVertexBuffer",value:function(data){var view,usage=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;view=data instanceof Array?new Float32Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data;var dataBuffer=this.createBuffer(view,WebGPUConstants.BufferUsage.Vertex|WebGPUConstants.BufferUsage.CopyDst|usage);return dataBuffer}},{key:"createUniformBuffer",value:function(data){var view;return view=data instanceof Array?new Float32Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data,this.createBuffer(view,WebGPUConstants.BufferUsage.Uniform|WebGPUConstants.BufferUsage.CopyDst)}},{key:"createIndexBuffer",value:function(data){var view;return view=data instanceof Array?new Uint16Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data,this.createBuffer(view,WebGPUConstants.BufferUsage.Index|WebGPUConstants.BufferUsage.CopyDst)}},{key:"setRenderBindGroups",value:function(bindGroups){for(var renderPass=this.bundleEncoder||this.currentRenderPass,i=0;i<bindGroups.length;i++)renderPass.setBindGroup(i,bindGroups[i])}},{key:"setComputeBindGroups",value:function(bindGroups){if(this.currentComputePass)for(var i=0;i<bindGroups.length;i++)this.currentComputePass.setBindGroup(i,bindGroups[i])}},{key:"setComputePipeline",value:function(computePipelineName,descriptor){var _this$currentComputeP;if(!this.computePipelines[computePipelineName]){var computePipeline=this.device.createComputePipeline(descriptor);this.computePipelines[computePipelineName]=computePipeline}null===(_this$currentComputeP=this.currentComputePass)||void 0===_this$currentComputeP||_this$currentComputeP.setPipeline(this.computePipelines[computePipelineName])}},{key:"setSubData",value:function(destBuffer,destOffset,srcArrayBuffer){var byteCount=srcArrayBuffer.byteLength,_this$device$createBu2=_slicedToArray(this.device.createBufferMapped({size:byteCount,usage:WebGPUConstants.BufferUsage.CopySrc}),2),srcBuffer=_this$device$createBu2[0],arrayBuffer=_this$device$createBu2[1];new Uint8Array(arrayBuffer).set(new Uint8Array(srcArrayBuffer.buffer)),srcBuffer.unmap(),this.uploadEncoder.copyBufferToBuffer(srcBuffer,0,destBuffer,destOffset,byteCount),this.tempBuffers.push(srcBuffer)}},{key:"bindVertexInputs",value:function(vertexInputs){var renderPass=this.bundleEncoder||this.currentRenderPass;vertexInputs.indexBuffer&&renderPass.setIndexBuffer(vertexInputs.indexBuffer,vertexInputs.indexOffset);for(var i=0;i<vertexInputs.vertexBuffers.length;i++)vertexInputs.vertexBuffers[i]&&renderPass.setVertexBuffer(vertexInputs.vertexStartSlot+i,vertexInputs.vertexBuffers[i],vertexInputs.vertexOffsets[i])}},{key:"dispatch",value:function(num){this.currentComputePass&&this.currentComputePass.dispatch(num)}},{key:"createBuffer",value:function(view,flags){var padding=view.byteLength%4,verticesBufferDescriptor={size:view.byteLength+padding,usage:flags},buffer=this.device.createBuffer(verticesBufferDescriptor);return this.setSubData(buffer,0,view),buffer}},{key:"initGlslang",value:(_initGlslang=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var _navigator,_navigator$gpu;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,(0,_glslang.default)();case 2:return this.glslang=_context5.sent,_context5.next=5,null===(_navigator=navigator)||void 0===_navigator||null===(_navigator$gpu=_navigator.gpu)||void 0===_navigator$gpu?void 0:_navigator$gpu.requestAdapter();case 5:return this.adapter=_context5.sent,_context5.next=8,this.adapter.requestDevice();case 8:this.device=_context5.sent;case 9:case"end":return _context5.stop()}}),_callee5,this)}))),function(){return _initGlslang.apply(this,arguments)})},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext("gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:WebGPUConstants.TextureUsage.OutputAttachment|WebGPUConstants.TextureUsage.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var mainTextureDescriptor={size:this.mainTextureExtends,arrayLayerCount:1,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:WebGPUConstants.TextureDimension.E2d,format:WebGPUConstants.TextureFormat.BGRA8Unorm,usage:WebGPUConstants.TextureUsage.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(mainTextureDescriptor),this.mainColorAttachments=[{attachment:this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:WebGPUConstants.StoreOp.Store}]}else this.mainColorAttachments=[{attachment:this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:WebGPUConstants.StoreOp.Store}];var depthTextureDescriptor={size:this.mainTextureExtends,arrayLayerCount:1,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:WebGPUConstants.TextureDimension.E2d,format:WebGPUConstants.TextureFormat.Depth24PlusStencil8,usage:WebGPUConstants.TextureUsage.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(depthTextureDescriptor),this.mainDepthAttachment={attachment:this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:WebGPUConstants.StoreOp.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:WebGPUConstants.StoreOp.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&this.endRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment})}},{key:"endRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.currentRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"setRenderPipeline",value:function(name,descriptor){var renderPass=this.bundleEncoder||this.currentRenderPass,pipeline=this.getRenderPipeline(name,descriptor);pipeline&&renderPass.setPipeline(pipeline)}},{key:"compileRawShaderToSpirV",value:function(source,type){return this.glslang.compileGLSL(source,type)}},{key:"compileShaderToSpirV",value:function(source,type,defines,shaderVersion){return this.compileRawShaderToSpirV(shaderVersion+(defines?defines+"\n":"")+source,type)}},{key:"createPipelineStageDescriptor",value:function(vertexShader,fragmentShader){return{vertexStage:{module:this.device.createShaderModule({code:vertexShader}),entryPoint:"main"},fragmentStage:{module:this.device.createShaderModule({code:fragmentShader}),entryPoint:"main"}}}},{key:"getRenderPipeline",value:function(name,descriptor){if(this.pipelines[name])return this.pipelines[name];var primitiveTopology=descriptor.primitiveTopology,rasterizationState=descriptor.rasterizationState,depthStencilState=descriptor.depthStencilState,colorStates=descriptor.colorStates,vertexStage=descriptor.vertexStage,fragmentStage=descriptor.fragmentStage,vertexState=descriptor.vertexState,layout=descriptor.layout;if(vertexStage&&fragmentStage){var renderPipeline=this.device.createRenderPipeline({sampleCount:this.mainPassSampleCount,primitiveTopology:primitiveTopology||"triangle-list",rasterizationState:_objectSpread({},this.getDefaultRasterizationStateDescriptor(),{},rasterizationState),depthStencilState:_objectSpread({},this.getDefaultDepthStencilStateDescriptor(),{},depthStencilState),colorStates:colorStates||this.getDefaultColorStateDescriptors(),layout:layout,vertexStage:vertexStage,fragmentStage:fragmentStage,vertexState:vertexState});return this.pipelines[name]=renderPipeline,renderPipeline}return null}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:WebGPUConstants.FrontFace.CCW,cullMode:WebGPUConstants.CullMode.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"getDefaultDepthStencilStateDescriptor",value:function(){var stencilFrontBack={compare:WebGPUConstants.CompareFunction.Always,depthFailOp:WebGPUConstants.StencilOperation.Keep,failOp:WebGPUConstants.StencilOperation.Keep,passOp:WebGPUConstants.StencilOperation.Keep};return{depthWriteEnabled:!1,depthCompare:WebGPUConstants.CompareFunction.Always,format:WebGPUConstants.TextureFormat.Depth24PlusStencil8,stencilFront:stencilFrontBack,stencilBack:stencilFrontBack,stencilReadMask:4294967295,stencilWriteMask:4294967295}}},{key:"getDefaultColorStateDescriptors",value:function(){return[{format:this.options.swapChainFormat,alphaBlend:{srcFactor:WebGPUConstants.BlendFactor.One,dstFactor:WebGPUConstants.BlendFactor.Zero,operation:WebGPUConstants.BlendOperation.Add},colorBlend:{srcFactor:WebGPUConstants.BlendFactor.One,dstFactor:WebGPUConstants.BlendFactor.Zero,operation:WebGPUConstants.BlendOperation.Add},writeMask:WebGPUConstants.ColorWrite.All}]}}]),WebGPUEngine}();exports.WebGPUEngine=WebGPUEngine},752:function(module,exports,__webpack_require__){"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var glslang;function _ref(){return(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var glslangModule;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!glslang){_context.next=2;break}return _context.abrupt("return",glslang);case 2:return _context.next=4,import("https://cdn.jsdelivr.net/npm/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js");case 4:return glslangModule=_context.sent,_context.next=7,glslangModule.default();case 7:return glslang=_context.sent,_context.abrupt("return",glslang);case 9:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}__webpack_require__(11),__webpack_require__(74),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function _default(){return _ref.apply(this,arguments)}},753:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,computeStageDescriptor,computePipelineLayout,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},t=0,particleBuffers=new Array(2),particleBindGroups=new Array(2),_default=function(_super){function Flocking(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Flocking,_super),Flocking.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{engineOptions:{supportCompute:!0},onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var vertexBufferData,simParamData,simParamBuffer,initialParticleData,computeBindGroupLayout,i;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,engine.compilePipelineStageDescriptor("layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = vec4(pos + a_particlePos, 0, 1);\n}","layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}",null)];case 1:return stageDescriptor=_a.sent(),[4,engine.compileComputePipelineStageDescriptor("// @see https://github.com/austinEng/Project6-Vulkan-Flocking/blob/master/data/shaders/computeparticles/particle.comp\n\nstruct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) uniform SimParams {\n  float deltaT;\n  float rule1Distance;\n  float rule2Distance;\n  float rule3Distance;\n  float rule1Scale;\n  float rule2Scale;\n  float rule3Scale;\n} params;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesA {\n  Particle particles[1500];\n} particlesA;\n\nlayout(std140, set = 0, binding = 2) buffer ParticlesB {\n  Particle particles[1500];\n} particlesB;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= 1500) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec2 cMass = vec2(0.0, 0.0);\n  vec2 cVel = vec2(0.0, 0.0);\n  vec2 colVel = vec2(0.0, 0.0);\n  int cMassCount = 0;\n  int cVelCount = 0;\n\n  vec2 pos;\n  vec2 vel;\n  for (int i = 0; i < 1500; ++i) {\n    if (i == index) { continue; }\n    pos = particlesA.particles[i].pos.xy;\n    vel = particlesA.particles[i].vel.xy;\n\n    if (distance(pos, vPos) < params.rule1Distance) {\n      cMass += pos;\n      cMassCount++;\n    }\n    if (distance(pos, vPos) < params.rule2Distance) {\n      colVel -= (pos - vPos);\n    }\n    if (distance(pos, vPos) < params.rule3Distance) {\n      cVel += vel;\n      cVelCount++;\n    }\n  }\n  if (cMassCount > 0) {\n    cMass = cMass / cMassCount - vPos;\n  }\n  if (cVelCount > 0) {\n    cVel = cVel / cVelCount;\n  }\n\n  vVel += cMass * params.rule1Scale + colVel * params.rule2Scale + cVel * params.rule3Scale;\n\n  // clamp velocity for a more pleasing simulation.\n  vVel = normalize(vVel) * clamp(length(vVel), 0.0, 0.1);\n\n  // kinematic update\n  vPos += vVel * params.deltaT;\n\n  // Wrap around boundary\n  if (vPos.x < -1.0) vPos.x = 1.0;\n  if (vPos.x > 1.0) vPos.x = -1.0;\n  if (vPos.y < -1.0) vPos.y = 1.0;\n  if (vPos.y > 1.0) vPos.y = -1.0;\n\n  particlesB.particles[index].pos = vPos;\n\n  // Write back\n  particlesB.particles[index].vel = vVel;\n}",null)];case 2:for(computeStageDescriptor=_a.sent(),vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),verticesBuffer=engine.createVertexBuffer(vertexBufferData),simParamData=new Float32Array([.04,.1,.025,.025,.02,.05,.005]),simParamBuffer=engine.createUniformBuffer(simParamData),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;for(i=0;i<2;++i)particleBuffers[i]=engine.createVertexBuffer(initialParticleData,128);for(computeBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:4,type:"uniform-buffer"},{binding:1,visibility:4,type:"storage-buffer"},{binding:2,visibility:4,type:"storage-buffer"}]}),computePipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]}),i=0;i<2;++i)particleBindGroups[i]=engine.getDevice().createBindGroup({layout:computeBindGroupLayout,bindings:[{binding:0,resource:{buffer:simParamBuffer,offset:0,size:simParamData.byteLength}},{binding:1,resource:{buffer:particleBuffers[i],offset:0,size:initialParticleData.byteLength}},{binding:2,resource:{buffer:particleBuffers[(i+1)%2],offset:0,size:initialParticleData.byteLength}}]});return[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setComputePipeline("compute",__assign({layout:computePipelineLayout},computeStageDescriptor)),engine.setComputeBindGroups([particleBindGroups[t%2]]),engine.dispatch(1500),engine.bindVertexInputs({indexBuffer:null,indexOffset:0,vertexStartSlot:0,vertexBuffers:[particleBuffers[(t+1)%2],verticesBuffer],vertexOffsets:[0,0]}),engine.drawArraysType("render",__assign(__assign({layout:engine.getDevice().createPipelineLayout({bindGroupLayouts:[]})},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}),0,3,1500),++t,[2]}))}))}})),[2]}))}))},Flocking.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Flocking.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},Flocking}(React.Component);exports.default=_default},754:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,lineStageDescriptor,computeStageDescriptor,computePipelineLayout,renderPipelineLayout,uniformBindGroup,particleBuffer,particleBindGroup,extrudeBuffer,colorBuffer,sizeBuffer,lineIndexBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},numParticles=0,numEdges=0,_default=function(_super){function Fruchterman(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.computed=!1,_this.iteration=0,_this.lineIndexBufferData=[],_this}return __extends(Fruchterman,_super),Fruchterman.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var data,nodes,canvas,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch("https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json")];case 1:return[4,_a.sent().json()];case 2:return data=_a.sent(),nodes=data.nodes.map((function(n){return{x:(2*Math.random()-1)/10,y:(2*Math.random()-1)/10,id:n.id}})),(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{engineOptions:{supportCompute:!0},onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,engine.compilePipelineStageDescriptor("layout(location = 0) in vec4 a_particlePos;\nlayout(location = 1) in vec2 a_extrude;\nlayout(location = 2) in vec4 a_color;\nlayout(location = 3) in float a_size;\n\nlayout(location = 0) out vec4 data;\nlayout(location = 1) out vec4 color;\n\nlayout(set = 0, binding = 0) uniform Uniforms {\n  float opacity;\n  float strokeWidth;\n  vec4 strokeColor;\n  float strokeOpacity;\n} uniforms;\n\nvoid main() {\n  float radius = a_size;\n  vec2 offset = a_extrude * (radius + uniforms.strokeWidth) / 600;\n\n  gl_Position = vec4(a_particlePos.xy + offset, 0, 1);\n\n  // anti-alias\n  float antialiasblur = 1.0 / (radius + uniforms.strokeWidth) * 4.0;\n\n  // construct point coords\n  data = vec4(a_extrude, antialiasblur, radius);\n  color = a_color;\n}","layout(location = 0) out vec4 fragColor;\n\nlayout(location = 0) in vec4 data;\nlayout(location = 1) in vec4 color;\n\nlayout(set = 0, binding = 0) uniform Uniforms {\n  float opacity;\n  float strokeWidth;\n  vec4 strokeColor;\n  float strokeOpacity;\n} uniforms;\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nvoid main() {\n  float antialiasblur = data.z;\n  float antialiased_blur = -max(0.0, antialiasblur);\n  float r = data.w / (data.w + uniforms.strokeWidth);\n\n  float outer_df = sdCircle(data.xy, 1.0);\n  float inner_df = sdCircle(data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n  \n  float color_t = smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n  vec4 strokeColor = vec4(1., 0., 0., 1.0);\n\n  fragColor = opacity_t * mix(\n    vec4(color.rgb, color.a * uniforms.opacity), strokeColor * uniforms.strokeOpacity, color_t);\n}",null)];case 1:return stageDescriptor=_a.sent(),[4,engine.compilePipelineStageDescriptor("layout(location = 0) in vec4 a_particlePos;\n\nvoid main() {\n  gl_Position = vec4(a_particlePos.xy, 0, 1);\n}","layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(vec3(102.0 / 255.0), 0.5);\n}",null)];case 2:return lineStageDescriptor=_a.sent(),[4,engine.compileComputePipelineStageDescriptor("// @see https://github.com/antvis/G6/blob/master/src/layout/fruchterman.ts\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js\n// @see https://github.com/l-l/UnityNetworkGraph/blob/master/Assets/Shaders/GraphCS.compute\n\n#define SPEED_DIVISOR 800.0\n\nlayout(std140, set = 0, binding = 0) uniform SimParams {\n  float nodeNum;\n  float k2;\n  float k;\n  float maxEdgePerVetex;\n  float gravity;\n  float speed;\n  float maxDisplace;\n} params;\n\nlayout(std140, set = 0, binding = 1) buffer NodesEdges {\n  vec4 nodesEdges[];\n} nodesEdges;\n\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= params.nodeNum) { return; }\n\n  vec4 currentNode = nodesEdges.nodesEdges[index];\n  float dx = 0.0, dy = 0.0;\n\n  // repulsive\n  for (int i = 0; i < params.nodeNum; ++i) {\n    if (i == index) { continue; }\n    vec4 node = nodesEdges.nodesEdges[i];\n\n    float vecX = currentNode.r - node.r;\n    float vecY = currentNode.g - node.g;\n    float vecLengthSqr = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    if (vecLengthSqr > 0.0) {\n      float repulsiveF = params.k2 / vecLengthSqr;\n      dx += vecX / vecLengthSqr * repulsiveF;\n      dy += vecY / vecLengthSqr * repulsiveF;\n    }\n  }\n\n  // attractive\n  int arr_offset = int(floor(currentNode.b + 0.5));\n  int length = int(floor(currentNode.a + 0.5));\n  vec4 node_buffer;\n  for (int p = 0; p < params.maxEdgePerVetex; p++) {\n    if (p >= length) break;\n    int arr_idx = arr_offset + p;\n    // when arr_idx % 4 == 0 update node_idx_buffer\n    int buf_offset = arr_idx - arr_idx / 4 * 4;\n    if (p == 0 || buf_offset == 0) {\n      node_buffer = nodesEdges.nodesEdges[int(floor(arr_idx / 4 + 0.5))];\n    }\n    float float_j = buf_offset == 0 ? node_buffer.r :\n                    buf_offset == 1 ? node_buffer.g :\n                    buf_offset == 2 ? node_buffer.b :\n                                      node_buffer.a;\n    uint jIndex= uint(floor(float_j + 0.5));\n    vec4 node_j = nodesEdges.nodesEdges[jIndex];\n    \n    float vecX = currentNode.r - node_j.r;\n    float vecY = currentNode.g - node_j.g;\n    float vecLength = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    float attractiveF = (vecLength * vecLength) / params.k;\n    if (vecLength > 0.0) {\n      dx -= (vecX / vecLength) * attractiveF;\n      dy -= (vecY / vecLength) * attractiveF;\n    }\n  }\n\n  // gravity\n  float gf = 0.01 * params.k * params.gravity;\n  dx -= gf * currentNode.r;\n  dy -= gf * currentNode.g;\n\n  // speed\n  dx *= params.speed;\n  dy *= params.speed;\n\n  // move\n  float distLength = sqrt(dx * dx + dy * dy);\n  if (distLength > 0.0) {\n    float limitedDist = min(params.maxDisplace * params.speed, distLength);\n\n    nodesEdges.nodesEdges[index].r += dx / distLength * limitedDist;\n    nodesEdges.nodesEdges[index].g += dy / distLength * limitedDist;\n  }\n}",null)];case 3:return computeStageDescriptor=_a.sent(),this.createComputePipelineLayout(engine,nodes,data.edges),this.createRenderPipelineLayout(engine),this.createCircleBuffers(engine,nodes),lineIndexBuffer=engine.createIndexBuffer(this.lineIndexBufferData),[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){if(engine.clear({r:1,g:1,b:1,a:1},!0,!0,!0),!this.computed){for(engine.setComputePipeline("compute",__assign({layout:computePipelineLayout},computeStageDescriptor)),engine.setComputeBindGroups([particleBindGroup]);this.iteration<8e3;)engine.dispatch(numParticles),this.iteration++;this.computed=!0}return this.drawLines(engine),this.drawCircles(engine),[2]}))}))}})),[2]}}))}))},Fruchterman.prototype.componentWillUnmount=function(){this.world&&(this.world.destroy(),extrudeBuffer.destroy(),sizeBuffer.destroy(),particleBuffer.destroy(),colorBuffer.destroy())},Fruchterman.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},Fruchterman.prototype.createComputePipelineLayout=function(engine,nodes,edges){numParticles=nodes.length,numEdges=edges.length;var nodesEdgesArray=this.buildTextureData(nodes,edges);particleBuffer=engine.createVertexBuffer(nodesEdgesArray,128);var simParamData=new Float32Array([numParticles,numParticles*numParticles/(numParticles+1)/300/300,Math.sqrt(numParticles*numParticles/(numParticles+1)/300),this.maxEdgePerVetex,50,.1,Math.sqrt(numParticles*numParticles)/10]),simParamBuffer=engine.createUniformBuffer(simParamData),computeBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:4,type:"uniform-buffer"},{binding:1,visibility:4,type:"storage-buffer"}]});computePipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]}),particleBindGroup=engine.getDevice().createBindGroup({layout:computeBindGroupLayout,bindings:[{binding:0,resource:{buffer:simParamBuffer,offset:0,size:simParamData.byteLength}},{binding:1,resource:{buffer:particleBuffer,offset:0,size:nodesEdgesArray.byteLength}}]})},Fruchterman.prototype.createRenderPipelineLayout=function(engine){var circleParamData=new Float32Array([1,2,1,1,0,1,.8]),circleParamBuffer=engine.createUniformBuffer(circleParamData),renderBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:3,type:"uniform-buffer"}]});renderPipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[renderBindGroupLayout]}),uniformBindGroup=engine.getDevice().createBindGroup({layout:renderBindGroupLayout,bindings:[{binding:0,resource:{buffer:circleParamBuffer}}]})},Fruchterman.prototype.createCircleBuffers=function(engine,nodes){var extrudeData=[],colorData=[],sizeData=[];nodes.forEach((function(){colorData.push(198/255,229/255,1,1),sizeData.push(10),extrudeData.push(1,1,-1,1,-1,-1,1,1,-1,-1,1,-1)})),extrudeBuffer=engine.createVertexBuffer(new Float32Array(extrudeData)),sizeBuffer=engine.createVertexBuffer(new Float32Array(sizeData)),colorBuffer=engine.createVertexBuffer(new Float32Array(colorData))},Fruchterman.prototype.drawCircles=function(engine){engine.bindVertexInputs({indexBuffer:null,vertexStartSlot:0,vertexBuffers:[particleBuffer,extrudeBuffer,colorBuffer,sizeBuffer],vertexOffsets:[0,0,0,0]}),engine.setRenderBindGroups([uniformBindGroup]),engine.drawArraysType("renderCircles",__assign(__assign({layout:renderPipelineLayout},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float4"}]},{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float2"}]},{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]},{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}]},colorStates:[{format:"bgra8unorm",colorBlend:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alphaBlend:{srcFactor:"one",dstFactor:"one",operation:"add"}}]}),0,6*numParticles,numParticles)},Fruchterman.prototype.drawLines=function(engine){engine.bindVertexInputs({indexBuffer:lineIndexBuffer,indexOffset:0,vertexStartSlot:0,vertexBuffers:[particleBuffer],vertexOffsets:[0]}),engine.drawElementsType("renderLines",__assign(__assign({},lineStageDescriptor),{primitiveTopology:"line-list",vertexState:{indexFormat:"uint16",vertexBuffers:[{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float4"}]}]}}),0,2*numEdges,1)},Fruchterman.prototype.buildTextureData=function(nodes,edges){var dataArray=[],nodeDict=[],mapIdPos={},i=0;for(i=0;i<nodes.length;i++){var n=nodes[i];mapIdPos[n.id]=i,dataArray.push(n.x),dataArray.push(n.y),dataArray.push(0),dataArray.push(0),nodeDict.push([])}for(i=0;i<edges.length;i++){var e=edges[i];nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]),nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]),this.lineIndexBufferData.push(mapIdPos[e.source],mapIdPos[e.target])}for(this.maxEdgePerVetex=0,i=0;i<nodes.length;i++){var offset=dataArray.length,dests=nodeDict[i],len=dests.length;dataArray[4*i+2]=offset,dataArray[4*i+3]=dests.length,this.maxEdgePerVetex=Math.max(this.maxEdgePerVetex,dests.length);for(var j=0;j<len;++j){var dest=dests[j];dataArray.push(+dest)}}for(;dataArray.length%4!=0;)dataArray.push(0);return new Float32Array(dataArray)},Fruchterman}(React.Component);exports.default=_default},755:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,computeStageDescriptor,computePipelineLayout,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},t=0,particleBuffers=new Array(2),particleBindGroups=new Array(2),_default=function(_super){function Gravity(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Gravity,_super),Gravity.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{engineOptions:{supportCompute:!0},onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var vertexBufferData,simParamData,simParamBuffer,initialParticleData,computeBindGroupLayout,i;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,engine.compilePipelineStageDescriptor("layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = vec4(pos + a_particlePos, 0, 1);\n}","layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}",null)];case 1:return stageDescriptor=_a.sent(),[4,engine.compileComputePipelineStageDescriptor("struct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) uniform SimParams {\n  float deltaT;\n  float noiseSize;\n} params;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesA {\n  Particle particles[1500];\n} particlesA;\n\nlayout(std140, set = 0, binding = 2) buffer ParticlesB {\n  Particle particles[1500];\n} particlesB;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= 1500) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec2 force = vec2(0.);\n  vec2 dif = particlesB.particles[index].pos - vec2(0.);\n  force -= length( dif ) * length( dif ) * normalize( dif ) * .1;\n\n  vVel += force;\n  vVel = normalize(vVel);\n\n  vPos += vVel * params.deltaT;\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}",null)];case 2:for(computeStageDescriptor=_a.sent(),vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),verticesBuffer=engine.createVertexBuffer(vertexBufferData),simParamData=new Float32Array([.01,.1]),simParamBuffer=engine.createUniformBuffer(simParamData),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;for(i=0;i<2;++i)particleBuffers[i]=engine.createVertexBuffer(initialParticleData,128);for(computeBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:4,type:"uniform-buffer"},{binding:1,visibility:4,type:"storage-buffer"},{binding:2,visibility:4,type:"storage-buffer"}]}),computePipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]}),i=0;i<2;++i)particleBindGroups[i]=engine.getDevice().createBindGroup({layout:computeBindGroupLayout,bindings:[{binding:0,resource:{buffer:simParamBuffer,offset:0,size:simParamData.byteLength}},{binding:1,resource:{buffer:particleBuffers[i],offset:0,size:initialParticleData.byteLength}},{binding:2,resource:{buffer:particleBuffers[(i+1)%2],offset:0,size:initialParticleData.byteLength}}]});return[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setComputePipeline("compute",__assign({layout:computePipelineLayout},computeStageDescriptor)),engine.setComputeBindGroups([particleBindGroups[t%2]]),engine.dispatch(1500),engine.bindVertexInputs({indexBuffer:null,indexOffset:0,vertexStartSlot:0,vertexBuffers:[particleBuffers[(t+1)%2],verticesBuffer],vertexOffsets:[0,0]}),engine.drawArraysType("render",__assign(__assign({layout:engine.getDevice().createPipelineLayout({bindGroupLayouts:[]})},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}),0,3,1500),++t,[2]}))}))}})),[2]}))}))},Gravity.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Gravity.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},Gravity}(React.Component);exports.default=_default},756:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),_glMatrix=__webpack_require__(80),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2)),_cube=__webpack_require__(316);function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,pipelineLayout,camera,uniformBuffer,uniformBindGroup,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=(_glMatrix.mat4.create(),function(_super){function RotatingCube(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RotatingCube,_super),RotatingCube.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var uniformsBindGroupLayout;return __generator(this,(function(_a){switch(_a.label){case 0:return"\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",[4,engine.compilePipelineStageDescriptor("\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",null)];case 1:return stageDescriptor=_a.sent(),verticesBuffer=engine.createVertexBuffer(_cube.cubeVertexArray),uniformsBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:1,type:"uniform-buffer"}]}),pipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[uniformsBindGroupLayout]}),uniformBuffer=engine.createUniformBuffer(new Float32Array(16)),uniformBindGroup=engine.getDevice().createBindGroup({layout:uniformsBindGroupLayout,bindings:[{binding:0,resource:{buffer:uniformBuffer}}]}),[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setSubData(uniformBuffer,0,this.getTransformationMatrix()),engine.bindVertexInputs({indexBuffer:null,vertexStartSlot:0,vertexBuffers:[verticesBuffer],vertexOffsets:[0]}),engine.setRenderBindGroups([uniformBindGroup]),engine.drawArraysType("render",__assign(__assign({layout:pipelineLayout},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:_cube.cubeVertexSize,stepMode:"vertex",attributes:[{shaderLocation:0,offset:_cube.cubePositionOffset,format:"float4"},{shaderLocation:1,offset:_cube.cubeColorOffset,format:"float4"}]}]},rasterizationState:{cullMode:"back"},depthStencilState:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}}),0,36,1),[2]}))}))}}),(camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:72,far:100,near:1})).setPosition(0,-5,-5)),[2]}))}))},RotatingCube.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},RotatingCube.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},RotatingCube.prototype.getTransformationMatrix=function(){camera.rotate(1,0,0);var viewMatrix=camera.getViewTransform(),modelViewProjectionMatrix=_glMatrix.mat4.create();return _glMatrix.mat4.multiply(modelViewProjectionMatrix,camera.perspective,viewMatrix),modelViewProjectionMatrix},RotatingCube}(React.Component));exports.default=_default},757:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),_glMatrix=__webpack_require__(80),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2)),_cube=__webpack_require__(316);function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,pipelineLayout,uniformBuffer,uniformBindGroup,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},projectionMatrix=_glMatrix.mat4.create(),_default=function(_super){function RotatingCubeWithRecordBundle(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RotatingCubeWithRecordBundle,_super),RotatingCubeWithRecordBundle.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{useRenderBundle:!0,onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var aspect,uniformsBindGroupLayout;return __generator(this,(function(_a){switch(_a.label){case 0:return"\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",[4,engine.compilePipelineStageDescriptor("\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",null)];case 1:return stageDescriptor=_a.sent(),aspect=Math.abs(canvas.width/canvas.height),projectionMatrix=_glMatrix.mat4.create(),_glMatrix.mat4.perspective(projectionMatrix,2*Math.PI/5,aspect,1,100),verticesBuffer=engine.createVertexBuffer(_cube.cubeVertexArray),uniformsBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:1,type:"uniform-buffer"}]}),pipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[uniformsBindGroupLayout]}),uniformBuffer=engine.createUniformBuffer(new Float32Array(16)),uniformBindGroup=engine.getDevice().createBindGroup({layout:uniformsBindGroupLayout,bindings:[{binding:0,resource:{buffer:uniformBuffer}}]}),[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setSubData(uniformBuffer,0,this.getTransformationMatrix()),engine.bindVertexInputs({indexBuffer:null,vertexStartSlot:0,vertexBuffers:[verticesBuffer],vertexOffsets:[0]}),engine.setRenderBindGroups([uniformBindGroup]),engine.drawArraysType("render",__assign(__assign({layout:pipelineLayout},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:_cube.cubeVertexSize,stepMode:"vertex",attributes:[{shaderLocation:0,offset:_cube.cubePositionOffset,format:"float4"},{shaderLocation:1,offset:_cube.cubeColorOffset,format:"float4"}]}]},rasterizationState:{cullMode:"back"},depthStencilState:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}}),0,36,1),[2]}))}))}})),[2]}))}))},RotatingCubeWithRecordBundle.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},RotatingCubeWithRecordBundle.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},RotatingCubeWithRecordBundle.prototype.getTransformationMatrix=function(){var viewMatrix=_glMatrix.mat4.create();_glMatrix.mat4.translate(viewMatrix,viewMatrix,_glMatrix.vec3.fromValues(0,0,-5));var now=Date.now()/1e3;_glMatrix.mat4.rotate(viewMatrix,viewMatrix,1,_glMatrix.vec3.fromValues(Math.sin(now),Math.cos(now),0));var modelViewProjectionMatrix=_glMatrix.mat4.create();return _glMatrix.mat4.multiply(modelViewProjectionMatrix,projectionMatrix,viewMatrix),modelViewProjectionMatrix},RotatingCubeWithRecordBundle}(React.Component);exports.default=_default},758:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpuCore=__webpack_require__(36),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(2));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function TriangleMSAA(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TriangleMSAA,_super),TriangleMSAA.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpuCore.World(canvas,{onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return"\n            const vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\n            void main() {\n                gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n            }\n          ","\n            layout(location = 0) out vec4 outColor;\n            void main() {\n                outColor = vec4(1.0, 0.0, 0.0, 1.0);\n            }\n          ",[4,engine.compilePipelineStageDescriptor("\n            const vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\n            void main() {\n                gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n            }\n          ","\n            layout(location = 0) out vec4 outColor;\n            void main() {\n                outColor = vec4(1.0, 0.0, 0.0, 1.0);\n            }\n          ",null)];case 1:return stageDescriptor=_a.sent(),[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.drawArraysType("render",__assign(__assign({layout:engine.getDevice().createPipelineLayout({bindGroupLayouts:[]})},stageDescriptor),{primitiveTopology:"triangle-list"}),0,3,1),[2]}))}))}})),[2]}))}))},TriangleMSAA.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},TriangleMSAA.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},TriangleMSAA}(React.Component);exports.default=_default}},[[322,1,2]]]);
//# sourceMappingURL=main.ec8a2a01c4609668906b.bundle.js.map