(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{159:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createEntity=function createEntity(){return entitySequence++},exports.EMPTY=void 0;exports.EMPTY=-1;var entitySequence=1},218:function(module,exports,__webpack_require__){"use strict";__webpack_require__(155),__webpack_require__(17),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ComponentManager=exports.Component=void 0;var _Entity=__webpack_require__(159);function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}exports.Component=function Component(){_classCallCheck(this,Component)};var ComponentManager=function(){function ComponentManager(clazz){_classCallCheck(this,ComponentManager),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=clazz}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(ComponentManager,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(entity){return-1<this.lookup[entity]}},{key:"create",value:function(entity,data){this.lookup[entity]=this.components.length;var component=new this.clazz(data||{});return this.components.push(component),this.entities.push(entity),component}},{key:"remove",value:function(entity){var componentIndex=this.lookup[entity];-1<componentIndex&&componentIndex<this.components.length-1&&(this.components[componentIndex]=this.components[this.components.length-1],this.entities[componentIndex]=this.entities[this.entities.length-1],this.lookup[this.entities[componentIndex]]=componentIndex),this.components.pop(),this.entities.pop(),delete this.lookup[entity]}},{key:"removeKeepSorted",value:function(entity){var componentIndex=this.lookup[entity];if(-1<componentIndex){var entity2=this.entities[componentIndex];if(componentIndex<this.components.length-1){for(var _i=componentIndex+1;_i<this.components.length;++_i)this.components[_i-1]=this.components[_i];for(var _i2=componentIndex+1;_i2<this.entities.length;++_i2)this.entities[_i2-1]=this.entities[_i2],this.lookup[this.entities[_i2-1]]=_i2-1}this.components.pop(),this.entities.pop(),delete this.lookup[entity2]}}},{key:"moveItem",value:function(srcIndex,destIndex){if(srcIndex!==destIndex){for(var next,srcComponent=this.components[srcIndex],srcEntity=this.entities[srcIndex],direction=srcIndex<destIndex?1:-1,_i3=srcIndex;_i3!==destIndex;_i3+=direction)next=_i3+direction,this.components[_i3]=this.components[next],this.entities[_i3]=this.entities[next],this.lookup[this.entities[_i3]]=_i3;this.components[destIndex]=srcComponent,this.entities[destIndex]=srcEntity,this.lookup[srcEntity]=destIndex}}},{key:"getEntity",value:function(index){return this.entities[index]}},{key:"getComponent",value:function(index){return this.components[index]}},{key:"getComponentByEntity",value:function(entity){var componentIndex=this.lookup[entity];return-1<componentIndex?this.components[componentIndex]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(componentIdx){for(var _i4=0,_Object$keys=Object.keys(this.lookup);_i4<_Object$keys.length;_i4++){var entityInNum=+_Object$keys[_i4];if(this.lookup[entityInNum]===componentIdx)return entityInNum}return _Entity.EMPTY}},{key:"find",value:function(callback){for(var _component,_i5=0;_i5<this.getCount();_i5++)if(callback(_component=this.getComponent(_i5),_i5))return _component;return null}},{key:"findIndex",value:function(callback){for(var _i6=0;_i6<this.getCount();_i6++)if(callback(this.getComponent(_i6),_i6))return _i6;return-1}},{key:"forEach",value:function(callback){for(var _i7=0,_Object$keys2=Object.keys(this.lookup);_i7<_Object$keys2.length;_i7++){var entityInNum=+_Object$keys2[_i7],componentIndex=this.lookup[entityInNum];callback(entityInNum,this.getComponent(componentIndex))}}},{key:"map",value:function(callback){for(var result=[],_i8=0,_Object$keys3=Object.keys(this.lookup);_i8<_Object$keys3.length;_i8++){var entityInNum=+_Object$keys3[_i8],componentIndex=this.lookup[entityInNum];result.push(callback(entityInNum,this.getComponent(componentIndex)))}return result}}]),ComponentManager}();exports.ComponentManager=ComponentManager},24:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Component",{enumerable:!0,get:function(){return _ComponentManager.Component}}),Object.defineProperty(exports,"ComponentManager",{enumerable:!0,get:function(){return _ComponentManager.ComponentManager}}),Object.defineProperty(exports,"CameraSystem",{enumerable:!0,get:function(){return _System.CameraSystem}}),Object.defineProperty(exports,"ComputeSystem",{enumerable:!0,get:function(){return _System2.ComputeSystem}}),Object.defineProperty(exports,"FrameGraphSystem",{enumerable:!0,get:function(){return _System3.FrameGraphSystem}}),Object.defineProperty(exports,"GeometrySystem",{enumerable:!0,get:function(){return _System4.GeometrySystem}}),Object.defineProperty(exports,"IBoxGeometryParams",{enumerable:!0,get:function(){return _System4.IBoxGeometryParams}}),Object.defineProperty(exports,"InteractionSystem",{enumerable:!0,get:function(){return _System5.InteractionSystem}}),Object.defineProperty(exports,"IMaterialParams",{enumerable:!0,get:function(){return _System6.IMaterialParams}}),Object.defineProperty(exports,"MaterialSystem",{enumerable:!0,get:function(){return _System6.MaterialSystem}}),Object.defineProperty(exports,"IMeshParams",{enumerable:!0,get:function(){return _System7.IMeshParams}}),Object.defineProperty(exports,"MeshSystem",{enumerable:!0,get:function(){return _System7.MeshSystem}}),Object.defineProperty(exports,"SceneSystem",{enumerable:!0,get:function(){return _System8.SceneSystem}}),Object.defineProperty(exports,"SceneGraphSystem",{enumerable:!0,get:function(){return _System9.SceneGraphSystem}}),Object.defineProperty(exports,"CameraComponent",{enumerable:!0,get:function(){return _CameraComponent.CameraComponent}}),Object.defineProperty(exports,"ComputeComponent",{enumerable:!0,get:function(){return _ComputeComponent.ComputeComponent}}),Object.defineProperty(exports,"ComputeType",{enumerable:!0,get:function(){return _ComputeComponent.ComputeType}}),Object.defineProperty(exports,"IUniform",{enumerable:!0,get:function(){return _MaterialComponent.IUniform}}),Object.defineProperty(exports,"MaterialComponent",{enumerable:!0,get:function(){return _MaterialComponent.MaterialComponent}}),Object.defineProperty(exports,"CullableComponent",{enumerable:!0,get:function(){return _CullableComponent.CullableComponent}}),Object.defineProperty(exports,"MeshComponent",{enumerable:!0,get:function(){return _MeshComponent.MeshComponent}}),Object.defineProperty(exports,"TransformComponent",{enumerable:!0,get:function(){return _TransformComponent.TransformComponent}}),Object.defineProperty(exports,"IRenderPath",{enumerable:!0,get:function(){return _RenderPath.IRenderPath}}),Object.defineProperty(exports,"createEntity",{enumerable:!0,get:function(){return _Entity.createEntity}}),Object.defineProperty(exports,"Entity",{enumerable:!0,get:function(){return _Entity.Entity}}),Object.defineProperty(exports,"IDENTIFIER",{enumerable:!0,get:function(){return _identifier.IDENTIFIER}}),Object.defineProperty(exports,"container",{enumerable:!0,get:function(){return _inversify.container}}),Object.defineProperty(exports,"lazyInject",{enumerable:!0,get:function(){return _inversify.lazyInject}}),Object.defineProperty(exports,"lazyMultiInject",{enumerable:!0,get:function(){return _inversify.lazyMultiInject}}),Object.defineProperty(exports,"IRenderEngine",{enumerable:!0,get:function(){return _IRenderEngine.IRenderEngine}}),Object.defineProperty(exports,"IWebGPUEngineOptions",{enumerable:!0,get:function(){return _IRenderEngine.IWebGPUEngineOptions}}),Object.defineProperty(exports,"ISystem",{enumerable:!0,get:function(){return _ISystem.ISystem}}),__webpack_require__(362);var _ComponentManager=__webpack_require__(218),_System=__webpack_require__(363),_System2=__webpack_require__(370),_System3=__webpack_require__(371),_System4=__webpack_require__(372),_System5=__webpack_require__(380),_System6=__webpack_require__(381),_System7=__webpack_require__(382),_System8=__webpack_require__(385),_System9=__webpack_require__(386),_CameraComponent=__webpack_require__(387),_ComputeComponent=__webpack_require__(388),_MaterialComponent=__webpack_require__(389),_CullableComponent=__webpack_require__(390),_MeshComponent=__webpack_require__(391),_TransformComponent=__webpack_require__(392),_RenderPath=__webpack_require__(800),_Entity=__webpack_require__(159),_identifier=__webpack_require__(41),_inversify=__webpack_require__(801),_IRenderEngine=__webpack_require__(813),_ISystem=__webpack_require__(814)},363:function(module,exports,__webpack_require__){"use strict";__webpack_require__(16),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_inversify=__webpack_require__(37),_=__webpack_require__(24),_identifier=__webpack_require__(41);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var CameraSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.CameraComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.TransformComponentManager),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function CameraSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CameraSystem),_initializerDefineProperty(this,"camera",_descriptor,this),_initializerDefineProperty(this,"transform",_descriptor2,this)}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(CameraSystem,[{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.camera.clear()}},{key:"createCamera",value:function(cameraParams){var entity=(0,_.createEntity)();this.camera.create(entity,{}),this.transform.create(entity,{});var cameraComponent=this.camera.getComponentByEntity(entity),near=cameraParams.near,far=cameraParams.far,angle=cameraParams.angle,aspect=cameraParams.aspect;return null==cameraComponent||cameraComponent.setPerspective(near,far,angle,aspect),entity}},{key:"getTransformComponentManager",value:function(){return this.transform}}]),CameraSystem}()).prototype,"camera",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.CameraSystem=CameraSystem},370:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(40),__webpack_require__(67),__webpack_require__(16),__webpack_require__(6),__webpack_require__(64),__webpack_require__(34),__webpack_require__(32),__webpack_require__(155),__webpack_require__(106),__webpack_require__(107),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(9),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ComputeSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_inversify=__webpack_require__(37),_2=__webpack_require__(24),_identifier=__webpack_require__(41);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var ComputeSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.ComputeComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function ComputeSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ComputeSystem),_initializerDefineProperty(this,"compute",_descriptor,this),_initializerDefineProperty(this,"engine",_descriptor2,this)}var _compile,_execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(ComputeSystem,[{key:"execute",value:(_execute=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _this=this;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Promise.all(this.compute.map(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(entity,component){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(component.finished){_context.next=19;break}if(!component.dirty){_context.next=6;break}return _context.next=4,_this.compile(component);case 4:component.strategy.init(),component.dirty=!1;case 6:if(!(component.iteration<=component.maxIteration)){_context.next=12;break}_this.engine.setComputePipeline("compute-".concat(entity),_objectSpread({layout:component.pipelineLayout},component.stageDescriptor)),_this.engine.setComputeBindGroups([component.strategy.getBindingGroup()]),component.strategy.run(),_context.next=19;break;case 12:if(component.finished=!0,!component.onCompleted){_context.next=19;break}return _context.t0=component,_context.next=17,_this.engine.readData(_this.getParticleBuffer(entity),component.particleData.byteLength,component.particleDataConstructor);case 17:_context.t1=_context.sent,_context.t0.onCompleted.call(_context.t0,_context.t1);case 19:case"end":return _context.stop()}}),_callee)})));return function(){return _ref.apply(this,arguments)}}()));case 2:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.compute.forEach((function(_,compute){compute.bindings.forEach((function(binding){binding.buffer&&binding.buffer.destroy()})),compute.strategy.destroy()})),this.compute.clear()}},{key:"createComputePipeline",value:function(_ref2){var type=_ref2.type,shader=_ref2.shader,shaderInWebGL=_ref2.shaderInWebGL,particleCount=_ref2.particleCount,particleData=_ref2.particleData,_ref2$maxIteration=_ref2.maxIteration,maxIteration=void 0===_ref2$maxIteration?Number.MAX_VALUE:_ref2$maxIteration,_ref2$onCompleted=_ref2.onCompleted,onCompleted=void 0===_ref2$onCompleted?null:_ref2$onCompleted,entity=(0,_2.createEntity)(),strategy=_2.container.getNamed(_identifier.IDENTIFIER.ComputeStrategy,type);return this.compute.create(entity,{type:type,strategy:strategy,shaderGLSL:"#define PARTICLE_NUM ".concat(particleCount," \n ").concat(shader),shaderInWebGL:"#define PARTICLE_NUM ".concat(particleCount," \n ").concat(shaderInWebGL),particleCount:particleCount,particleData:particleData,particleDataConstructor:particleData.constructor,maxIteration:maxIteration,onCompleted:onCompleted}),strategy.component=this.compute.getComponentByEntity(entity),entity}},{key:"setBinding",value:function(entity,name,data,descriptor){var compute=this.compute.getComponentByEntity(entity);compute&&compute.bindings.push(_objectSpread({name:name,data:data},descriptor))}},{key:"getParticleBuffer",value:function(entity){return this.compute.getComponentByEntity(entity).strategy.getGPUBuffer()}},{key:"compile",value:(_compile=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(component){return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.engine.compileComputePipelineStageDescriptor(this.engine.supportWebGPU?component.shaderGLSL:component.shaderInWebGL,null,component.particleData);case 2:component.stageDescriptor=_context3.sent;case 3:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _compile.apply(this,arguments)})}]),ComputeSystem}()).prototype,"compute",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"engine",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.ComputeSystem=ComputeSystem},371:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(122),__webpack_require__(787),__webpack_require__(16),__webpack_require__(6),__webpack_require__(34),__webpack_require__(32),__webpack_require__(66),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(9),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.FrameGraphSystem=void 0;var _dec,_dec2,_dec3,_dec4,_class,_class2,_descriptor,_descriptor2,_descriptor3,_inversify=__webpack_require__(37),_=__webpack_require__(24),_Entity=__webpack_require__(159),_identifier=__webpack_require__(41);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var FrameGraphSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.NameComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.PassNodeComponentManager),_dec4=(0,_inversify.inject)(_identifier.IDENTIFIER.ResourceHandleComponentManager),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function FrameGraphSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FrameGraphSystem),_initializerDefineProperty(this,"nameManager",_descriptor,this),_initializerDefineProperty(this,"passNodeManager",_descriptor2,this),_initializerDefineProperty(this,"resourceHandleManager",_descriptor3,this),this.rootNodes=[]}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(FrameGraphSystem,[{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.passNodeManager.clear(),this.resourceHandleManager.clear()}},{key:"setup",value:function(){this.passNodeManager.forEach((function(entity,passNode){passNode.setup()}))}},{key:"compile",value:function(){var _this=this;this.passNodeManager.forEach((function(entity,passNode){_this.compilePassNode(entity,passNode),passNode.compiled=!0})),this.rootNodes=[],this.passNodeManager.forEach((function(entity,passNode){0===passNode.prevs.length&&_this.rootNodes.push(entity)}))}},{key:"getPassNodeEntityByName",value:function(passNodeName){var namedPassNodeIndex=this.nameManager.findIndex((function(c){return c.name===passNodeName})),entity=this.nameManager.getEntityByComponentIndex(namedPassNodeIndex);return this.passNodeManager.getComponentByEntity(entity)?entity:_Entity.EMPTY}},{key:"getResourceHandleEntityByName",value:function(resourceHandleName){var namedResourceHandleIndex=this.nameManager.findIndex((function(c){return c.name===resourceHandleName})),entity=this.nameManager.getEntityByComponentIndex(namedResourceHandleIndex);return this.resourceHandleManager.getComponentByEntity(entity)?entity:_Entity.EMPTY}},{key:"registerPassNode",value:function(passNodeName){var existedPassNodeEntity=this.getPassNodeEntityByName(passNodeName);if(existedPassNodeEntity===_Entity.EMPTY){var entity=(0,_.createEntity)();return this.nameManager.create(entity,{name:passNodeName}),this.passNodeManager.create(entity,{}),entity}return existedPassNodeEntity}},{key:"confirmInput",value:function(entity,resources){var _this2=this,passNode=this.passNodeManager.getComponentByEntity(entity);passNode&&(passNode.inputResources=[],resources.forEach((function(resourceName){var existedResourceHandleEntity=_this2.getResourceHandleEntityByName(resourceName);if(existedResourceHandleEntity===_Entity.EMPTY){var resourceEntity=(0,_.createEntity)();_this2.nameManager.create(resourceEntity,{name:resourceName}),_this2.resourceHandleManager.create(resourceEntity,{}),passNode.inputResources.push(resourceEntity)}else passNode.inputResources.push(existedResourceHandleEntity)})))}},{key:"confirmOutput",value:function(entity,resources){var _this3=this,passNode=this.passNodeManager.getComponentByEntity(entity);passNode&&(passNode.outputResources=[],resources.forEach((function(resourceName){var existedResourceHandleEntity=_this3.getResourceHandleEntityByName(resourceName);if(existedResourceHandleEntity===_Entity.EMPTY){var resourceEntity=(0,_.createEntity)();_this3.nameManager.create(resourceEntity,{name:resourceName}),_this3.resourceHandleManager.create(resourceEntity,{writer:entity}),passNode.outputResources.push(resourceEntity)}else passNode.outputResources.push(existedResourceHandleEntity)})))}},{key:"compilePassNode",value:function(entity,passNode){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=passNode.inputResources[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var resourceEntity=_step.value,resource=this.resourceHandleManager.getComponentByEntity(resourceEntity),resourceName=this.nameManager.getComponentByEntity(resourceEntity);if(resource){var parentPassNodeEntity=resource.writer,parentPassNode=this.passNodeManager.getComponentByEntity(parentPassNodeEntity);if(!parentPassNode)continue;if(!parentPassNode.compiled&&!this.compilePassNode(parentPassNodeEntity,parentPassNode))return!1;this.hasOutput(parentPassNode,(null==resourceName?void 0:resourceName.name)||"")&&this.addInputPass(passNode,parentPassNode,entity,parentPassNodeEntity)}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=passNode.outputResources[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _resourceEntity=_step2.value,_resource=this.resourceHandleManager.getComponentByEntity(_resourceEntity);_resource&&(_resource.writer=entity)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return!0}},{key:"hasOutput",value:function(passNode,outputResourceName){var _this4=this;return!!passNode.outputResources.find((function(resourceEntity){var resourceName=_this4.nameManager.getComponentByEntity(resourceEntity);return resourceName&&resourceName.name===outputResourceName}))}},{key:"addInputPass",value:function(passNode,inputPassNode,passNodeEntity,inputPassNodeEntity){var _this5=this;inputPassNode.nexts.find((function(e){var inputPassNodeName=(_this5.nameManager.getComponentByEntity(e)||{name:""}).name,_ref2$name=(_this5.nameManager.getComponentByEntity(passNodeEntity)||{name:""}).name;return inputPassNodeName===(void 0===_ref2$name?"":_ref2$name)}))||passNode.prevs.find((function(e){var inputPassNodeName=(_this5.nameManager.getComponentByEntity(e)||{name:""}).name,_ref4$name=(_this5.nameManager.getComponentByEntity(inputPassNodeEntity)||{name:""}).name;return(void 0===_ref4$name?"":_ref4$name)===inputPassNodeName}))||(inputPassNode.nexts.push(passNodeEntity),passNode.prevs.push(inputPassNodeEntity),inputPassNode.ref++)}}]),FrameGraphSystem}()).prototype,"nameManager",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"passNodeManager",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor3=_applyDecoratedDescriptor(_class2.prototype,"resourceHandleManager",[_dec4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.FrameGraphSystem=FrameGraphSystem},372:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(67),__webpack_require__(16),__webpack_require__(6),__webpack_require__(34),__webpack_require__(32),__webpack_require__(221),__webpack_require__(106),__webpack_require__(107),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(48),__webpack_require__(9),__webpack_require__(375),__webpack_require__(224),__webpack_require__(790),__webpack_require__(225),__webpack_require__(226),__webpack_require__(227),__webpack_require__(228),__webpack_require__(229),__webpack_require__(230),__webpack_require__(231),__webpack_require__(792),__webpack_require__(232),__webpack_require__(233),__webpack_require__(234),__webpack_require__(235),__webpack_require__(236),__webpack_require__(237),__webpack_require__(238),__webpack_require__(239),__webpack_require__(240),__webpack_require__(241),__webpack_require__(242),__webpack_require__(243),__webpack_require__(244),__webpack_require__(245),__webpack_require__(246),__webpack_require__(247),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.GeometrySystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_glMatrix=__webpack_require__(38),_inversify=__webpack_require__(37),_2=__webpack_require__(24),_identifier=__webpack_require__(41),_aabb=__webpack_require__(794);function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var GeometrySystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.GeometryComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function GeometrySystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GeometrySystem),_initializerDefineProperty(this,"geometry",_descriptor,this),_initializerDefineProperty(this,"engine",_descriptor2,this)}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(GeometrySystem,[{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){var _this=this;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:this.geometry.forEach((function(entity,component){component.dirty&&(component.attributes.forEach((function(attribute){attribute.data&&(attribute.buffer=_this.engine.createVertexBuffer(attribute.data))})),component.indices&&(component.indicesBuffer=_this.engine.createIndexBuffer(component.indices)),component.dirty=!1)}));case 1:case"end":return _context.stop()}}),_callee,this)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.geometry.forEach((function(_,geometry){geometry.indicesBuffer&&geometry.indicesBuffer.destroy(),geometry.attributes.forEach((function(attribute){attribute.buffer&&attribute.buffer.destroy()}))})),this.geometry.clear()}},{key:"setAttribute",value:function(entity,name,data,descriptor,bufferGetter){var geometry=this.geometry.getComponentByEntity(entity);geometry&&geometry.attributes.push(function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}({name:name,data:data},descriptor,{bufferGetter:bufferGetter}))}},{key:"setIndex",value:function(entity,data){var geometry=this.geometry.getComponentByEntity(entity);geometry&&(geometry.indices=new Uint32Array(data.buffer))}},{key:"createBufferGeometry",value:function(){var _ref=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{vertexCount:3},vertexCount=_ref.vertexCount,entity=(0,_2.createEntity)();return this.geometry.create(entity,{vertexCount:vertexCount}),entity}},{key:"createInstancedBufferGeometry",value:function(_ref2){var maxInstancedCount=_ref2.maxInstancedCount,vertexCount=_ref2.vertexCount,entity=(0,_2.createEntity)();return this.geometry.create(entity,{maxInstancedCount:maxInstancedCount,vertexCount:vertexCount}),entity}},{key:"createBox",value:function(){var params=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},ws=params.widthSegments||1,hs=params.heightSegments||1,ds=params.depthSegments||1,_ref3=params.halfExtents||_glMatrix.vec3.fromValues(.5,.5,.5),_ref4=_slicedToArray(_ref3,3),hex=_ref4[0],hey=_ref4[1],hez=_ref4[2],corners=[_glMatrix.vec3.fromValues(-hex,-hey,hez),_glMatrix.vec3.fromValues(hex,-hey,hez),_glMatrix.vec3.fromValues(hex,hey,hez),_glMatrix.vec3.fromValues(-hex,hey,hez),_glMatrix.vec3.fromValues(hex,-hey,-hez),_glMatrix.vec3.fromValues(-hex,-hey,-hez),_glMatrix.vec3.fromValues(-hex,hey,-hez),_glMatrix.vec3.fromValues(hex,hey,-hez)],faceAxes=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],faceNormals=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],sides={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},positions=[],normals=[],uvs=[],uvs1=[],indices=[],vcounter=0,generateFace=function(side,uSegments,vSegments){var u,v,i,j;for(i=0;i<=uSegments;i++)for(j=0;j<=vSegments;j++){var temp1=_glMatrix.vec3.create(),temp2=_glMatrix.vec3.create(),temp3=_glMatrix.vec3.create(),r=_glMatrix.vec3.create();_glMatrix.vec3.lerp(temp1,corners[faceAxes[side][0]],corners[faceAxes[side][1]],i/uSegments),_glMatrix.vec3.lerp(temp2,corners[faceAxes[side][0]],corners[faceAxes[side][2]],j/vSegments),_glMatrix.vec3.sub(temp3,temp2,corners[faceAxes[side][0]]),_glMatrix.vec3.add(r,temp1,temp3),u=i/uSegments,v=j/vSegments,positions.push(r[0],r[1],r[2]),normals.push(faceNormals[side][0],faceNormals[side][1],faceNormals[side][2]),uvs.push(u,v),u=.875*(u/=3)+4/64,v=.875*(v/=3)+4/64,u+=side%3/3,v+=Math.floor(side/3)/3,uvs1.push(u,v),i<uSegments&&j<vSegments&&(indices.push(vcounter+vSegments+1,vcounter+1,vcounter),indices.push(vcounter+vSegments+1,vcounter+vSegments+2,vcounter+1)),vcounter++}};generateFace(sides.FRONT,ws,hs),generateFace(sides.BACK,ws,hs),generateFace(sides.TOP,ws,ds),generateFace(sides.BOTTOM,ws,ds),generateFace(sides.RIGHT,ds,hs),generateFace(sides.LEFT,ds,hs);var aabb=(0,_aabb.generateAABBFromVertices)(positions),entity=(0,_2.createEntity)();return this.geometry.create(entity,{indices:Uint32Array.from(indices),aabb:aabb,attributes:[{name:"position",data:Float32Array.from(positions),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{name:"normal",data:Float32Array.from(normals),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{name:"uv",data:Float32Array.from(uvs),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}),entity}}]),GeometrySystem}()).prototype,"geometry",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"engine",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.GeometrySystem=GeometrySystem},379:function(module,exports,__webpack_require__){"use strict";__webpack_require__(375),Object.defineProperty(exports,"__esModule",{value:!0}),exports.AABB=void 0;var _glMatrix=__webpack_require__(38);function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var AABB=function(){function AABB(center,halfExtents){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AABB),this.center=void 0,this.halfExtents=void 0,this.min=_glMatrix.vec3.create(),this.max=_glMatrix.vec3.create(),this.update(center,halfExtents)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(AABB,[{key:"update",value:function(center,halfExtents){this.center=center||_glMatrix.vec3.create(),this.halfExtents=halfExtents||_glMatrix.vec3.fromValues(.5,.5,.5),this.min=_glMatrix.vec3.sub(this.min,this.center,this.halfExtents),this.max=_glMatrix.vec3.add(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(min,max){_glMatrix.vec3.add(this.center,max,min),_glMatrix.vec3.scale(this.center,this.center,.5),_glMatrix.vec3.sub(this.halfExtents,max,min),_glMatrix.vec3.scale(this.halfExtents,this.halfExtents,.5),_glMatrix.vec3.copy(this.min,min),_glMatrix.vec3.copy(this.max,max)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(aabb){var tc=this.center,tcx=tc[0],tcy=tc[1],tcz=tc[2],th=this.halfExtents,thx=th[0],thy=th[1],thz=th[2],tminx=tcx-thx,tmaxx=tcx+thx,tminy=tcy-thy,tmaxy=tcy+thy,tminz=tcz-thz,tmaxz=tcz+thz,oc=aabb.center,ocx=oc[0],ocy=oc[1],ocz=oc[2],oh=aabb.halfExtents,ohx=oh[0],ohy=oh[1],ohz=oh[2],ominx=ocx-ohx,omaxx=ocx+ohx,ominy=ocy-ohy,omaxy=ocy+ohy,ominz=ocz-ohz,omaxz=ocz+ohz;ominx<tminx&&(tminx=ominx),omaxx>tmaxx&&(tmaxx=omaxx),ominy<tminy&&(tminy=ominy),omaxy>tmaxy&&(tmaxy=omaxy),ominz<tminz&&(tminz=ominz),omaxz>tmaxz&&(tmaxz=omaxz),tc[0]=.5*(tminx+tmaxx),tc[1]=.5*(tminy+tmaxy),tc[2]=.5*(tminz+tmaxz),th[0]=.5*(tmaxx-tminx),th[1]=.5*(tmaxy-tminy),th[2]=.5*(tmaxz-tminz),this.min[0]=tminx,this.min[1]=tminy,this.min[2]=tminz,this.max[0]=tmaxx,this.max[1]=tmaxy,this.max[2]=tmaxz}},{key:"intersects",value:function(aabb){var aMax=this.getMax(),aMin=this.getMin(),bMax=aabb.getMax(),bMin=aabb.getMin();return aMin[0]<=bMax[0]&&aMax[0]>=bMin[0]&&aMin[1]<=bMax[1]&&aMax[1]>=bMin[1]&&aMin[2]<=bMax[2]&&aMax[2]>=bMin[2]}},{key:"containsPoint",value:function(point){var min=this.getMin(),max=this.getMax();return!(point[0]<min[0]||point[0]>max[0]||point[1]<min[1]||point[1]>max[1]||point[2]<min[2]||point[2]>max[2])}},{key:"getNegativeFarPoint",value:function(plane){return 273===plane.pnVertexFlag?_glMatrix.vec3.copy(_glMatrix.vec3.create(),this.min):272===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.min[1],this.max[2]):257===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.max[1],this.min[2]):256===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.max[1],this.max[2]):17===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.min[1],this.min[2]):16===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.min[1],this.max[2]):1===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.max[1],this.min[2]):_glMatrix.vec3.fromValues(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(plane){return 273===plane.pnVertexFlag?_glMatrix.vec3.copy(_glMatrix.vec3.create(),this.max):272===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.max[1],this.min[2]):257===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.min[1],this.max[2]):256===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.max[0],this.min[1],this.min[2]):17===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.max[1],this.max[2]):16===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.max[1],this.min[2]):1===plane.pnVertexFlag?_glMatrix.vec3.fromValues(this.min[0],this.min[1],this.max[2]):_glMatrix.vec3.fromValues(this.min[0],this.min[1],this.min[2])}}]),AABB}();exports.AABB=AABB},380:function(module,exports,__webpack_require__){"use strict";__webpack_require__(16),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.InteractionSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_class3,_temp,_hammerjs=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(795)),_inversify=__webpack_require__(37),_identifier=__webpack_require__(41);function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var InteractionSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.SceneComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.CameraComponentManager),_dec((_temp=_class3=function(){function InteractionSystem(){var _this=this;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InteractionSystem),this.isMoving=!1,this.lastX=-1,this.lastY=-1,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.hammertime=void 0,this.canvas=void 0,_initializerDefineProperty(this,"scene",_descriptor,this),_initializerDefineProperty(this,"camera",_descriptor2,this),this.onPanend=function(){_this.isMoving=!1},this.onPanstart=function(e){_this.lastX=e.center.x,_this.lastY=e.center.y,_this.isMoving=!0,_this.deltaZ=0},this.onPanmove=function(e){_this.isMoving&&(_this.deltaX=e.center.x-_this.lastX,_this.deltaY=e.center.y-_this.lastY,_this.lastX=e.center.x,_this.lastY=e.center.y,_this.onChangeCamera({deltaX:_this.deltaX,deltaY:_this.deltaY,deltaZ:_this.deltaZ}))},this.onMousewheel=function(e){_this.deltaZ=e.deltaY,_this.onChangeCamera({deltaX:_this.deltaX,deltaY:_this.deltaY,deltaZ:_this.deltaZ})},this.onPinch=function(e){_this.deltaZ=10*(1-e.scale)},this.onChangeCamera=function(data){var deltaX=data.deltaX,deltaY=data.deltaY,deltaZ=data.deltaZ;_this.scene.forEach((function(entity,scene){var camera=_this.camera.getComponentByEntity(scene.camera);camera.rotate(deltaX,deltaY,0),camera.dolly(deltaZ)}))}}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(InteractionSystem,[{key:"initialize",value:function(canvas){var hammertime=new _hammerjs.default(canvas);hammertime.get("pan").set({direction:_hammerjs.default.DIRECTION_ALL}),hammertime.get("pinch").set({enable:!0}),hammertime.on("panstart",this.onPanstart),hammertime.on("panmove",this.onPanmove),hammertime.on("panend",this.onPanend),hammertime.on("pinch",this.onPinch),this.hammertime=hammertime,canvas.addEventListener("wheel",this.onMousewheel),this.canvas=canvas}},{key:"tearDown",value:function(){this.hammertime.off("panstart",this.onPanstart),this.hammertime.off("panmove",this.onPanmove),this.hammertime.off("panend",this.onPanend),this.hammertime.off("pinch",this.onPinch),this.canvas.removeEventListener("wheel",this.onMousewheel)}}]),InteractionSystem}(),_class3.UP_EVENT="mouseup",_class3.MOVE_EVENT="mousemove",_class3.DOWN_EVENT="mousedown",_class3.OUT_EVENT="mouseout",_class3.WHEEL_EVENT="mousewheel",_descriptor=_applyDecoratedDescriptor((_class2=_temp).prototype,"scene",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"camera",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.InteractionSystem=InteractionSystem},381:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(67),__webpack_require__(122),__webpack_require__(16),__webpack_require__(6),__webpack_require__(64),__webpack_require__(34),__webpack_require__(32),__webpack_require__(221),__webpack_require__(66),__webpack_require__(106),__webpack_require__(107),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(9),__webpack_require__(224),__webpack_require__(225),__webpack_require__(226),__webpack_require__(227),__webpack_require__(228),__webpack_require__(229),__webpack_require__(230),__webpack_require__(231),__webpack_require__(232),__webpack_require__(233),__webpack_require__(234),__webpack_require__(235),__webpack_require__(236),__webpack_require__(237),__webpack_require__(238),__webpack_require__(239),__webpack_require__(240),__webpack_require__(241),__webpack_require__(242),__webpack_require__(243),__webpack_require__(244),__webpack_require__(245),__webpack_require__(246),__webpack_require__(247),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialSystem=void 0;var _dec,_dec2,_dec3,_class,_class2,_descriptor,_descriptor2,_inversify=__webpack_require__(37),_=__webpack_require__(24),_identifier=__webpack_require__(41),_shader=__webpack_require__(796);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var MaterialSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.MaterialComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function MaterialSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MaterialSystem),_initializerDefineProperty(this,"material",_descriptor,this),_initializerDefineProperty(this,"engine",_descriptor2,this)}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(MaterialSystem,[{key:"execute",value:(_execute=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _this=this;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Promise.all(this.material.map(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(entity,component){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!component.dirty){_context.next=6;break}return _context.next=3,_this.engine.compilePipelineStageDescriptor(component.vertexShaderGLSL,component.fragmentShaderGLSL,null);case 3:component.stageDescriptor=_context.sent,_this.generateUniforms(component),component.dirty=!1;case 6:case"end":return _context.stop()}}),_callee)})));return function(){return _ref.apply(this,arguments)}}()));case 2:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.material.clear()}},{key:"createBasicMaterial",value:function(params){var entity=(0,_.createEntity)();return this.material.create(entity,_objectSpread({vertexShaderGLSL:"layout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nlayout(set = 0, binding = 1) uniform Uniforms {\n  vec4 color;\n} uniforms;\n\nlayout(location = 0) in vec3 position;\n// layout(location = 1) in vec3 barycentric;\n\nlayout(location = 0) out vec4 fragColor;\n// layout(location = 1) out vec3 v_Barycentric;\n\nvoid main() {\n  gl_Position = builtin.projectionMatrix * builtin.modelViewMatrix * vec4(position, 1.0);\n  fragColor = uniforms.color;\n  // v_Barycentric = barycentric;\n}",fragmentShaderGLSL:"// layout(set = 0, binding = 1) uniform WireframeUniforms {\n//   float lineWidth;\n//   vec4 lineColor;\n// } wireframe;\n\nlayout(location = 0) in vec4 fragColor;\n// layout(location = 1) in vec3 v_Barycentric;\n\nlayout(location = 0) out vec4 outColor;\n\n// wireframe\n// float edgeFactor() {\n//   vec3 d = fwidth(v_Barycentric);\n//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);\n//   return min(min(a3.x, a3.y), a3.z);\n// }\n\nvoid main() {\n  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));\n  outColor = fragColor;\n}"},params)),this.addBuiltinUniforms(entity),entity}},{key:"createShaderMaterial",value:function(params){var entity=(0,_.createEntity)();return this.material.create(entity,_objectSpread({vertexShaderGLSL:params.vertexShader,fragmentShaderGLSL:params.fragmentShader},params)),this.addBuiltinUniforms(entity),entity}},{key:"addUniform",value:function(entity,uniform){var component=this.material.getComponentByEntity(entity),_ref2=component.uniforms[uniform.binding]||{},uniforms=_ref2.uniforms,length=_ref2.length;uniforms||(component.uniforms[uniform.binding]={uniforms:[],length:0});var uniformLength=(0,_shader.getLengthFromFormat)(uniform.format);component.uniforms[uniform.binding].uniforms.push({binding:uniform.binding,name:uniform.name,format:uniform.format,offset:length||0,length:uniformLength,data:uniform.data,dirty:uniform.dirty}),component.uniforms[uniform.binding].length+=4*uniformLength}},{key:"setUniform",value:function(entity,name,data){var force=3<arguments.length&&void 0!==arguments[3]&&arguments[3],component=this.material.getComponentByEntity(entity),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=component.uniforms[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var binding=_step.value,targetUniform=binding.uniforms.find((function(u){return u.name===name}));if(targetUniform)return void(force?binding.buffer&&data&&(this.engine.setSubData(binding.buffer,targetUniform.offset||0,data),targetUniform.dirty=!1):(targetUniform.dirty=!0,targetUniform.data=data))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"addBuiltinUniforms",value:function(entity){this.addUniform(entity,{binding:0,name:"projectionMatrix",format:"mat4",data:null,dirty:!0}),this.addUniform(entity,{binding:0,name:"modelViewMatrix",format:"mat4",data:null,dirty:!0})}},{key:"generateUniforms",value:function(component){var _this2=this,entries=component.uniforms.map((function(uniform,i){return{binding:i,visibility:3,type:"uniform-buffer"}}));component.uniformsBindGroupLayout=this.engine.getDevice().createBindGroupLayout({entries:entries}),component.pipelineLayout=this.engine.getDevice().createPipelineLayout({bindGroupLayouts:[component.uniformsBindGroupLayout]});var bindGroupBindings=component.uniforms.map((function(uniform,i){var uniformBuffer=_this2.engine.createUniformBuffer(new Float32Array(uniform.length));return uniform.buffer=uniformBuffer,{binding:i,resource:{buffer:uniformBuffer}}}));component.uniformBindGroup=this.engine.getDevice().createBindGroup({layout:component.uniformsBindGroupLayout,entries:bindGroupBindings})}}]),MaterialSystem}()).prototype,"material",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"engine",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.MaterialSystem=MaterialSystem},382:function(module,exports,__webpack_require__){"use strict";__webpack_require__(16),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshSystem=void 0;var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_dec8,_dec9,_dec10,_class,_class2,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_glMatrix=__webpack_require__(38),_inversify=__webpack_require__(37),_=__webpack_require__(24),_identifier=__webpack_require__(41),_Frustum=__webpack_require__(383),_math=__webpack_require__(384);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var MeshSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.SceneComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.CameraComponentManager),_dec4=(0,_inversify.inject)(_identifier.IDENTIFIER.MeshComponentManager),_dec5=(0,_inversify.inject)(_identifier.IDENTIFIER.CullableComponentManager),_dec6=(0,_inversify.inject)(_identifier.IDENTIFIER.GeometryComponentManager),_dec7=(0,_inversify.inject)(_identifier.IDENTIFIER.MaterialComponentManager),_dec8=(0,_inversify.inject)(_identifier.IDENTIFIER.HierarchyComponentManager),_dec9=(0,_inversify.inject)(_identifier.IDENTIFIER.NameComponentManager),_dec10=(0,_inversify.inject)(_identifier.IDENTIFIER.TransformComponentManager),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function MeshSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeshSystem),_initializerDefineProperty(this,"scene",_descriptor,this),_initializerDefineProperty(this,"camera",_descriptor2,this),_initializerDefineProperty(this,"mesh",_descriptor3,this),_initializerDefineProperty(this,"cullable",_descriptor4,this),_initializerDefineProperty(this,"geometry",_descriptor5,this),_initializerDefineProperty(this,"material",_descriptor6,this),_initializerDefineProperty(this,"hierarchy",_descriptor7,this),_initializerDefineProperty(this,"nameManager",_descriptor8,this),_initializerDefineProperty(this,"transform",_descriptor9,this),this.planes=void 0}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(MeshSystem,[{key:"setFrustumPlanes",value:function(planes){this.planes=planes}},{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){var _this=this;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:this.scene.forEach((function(sceneEntity,scene){var camera=_this.camera.getComponentByEntity(scene.camera);_this.mesh.forEach((function(entity,component){var hierarchyComponent=_this.hierarchy.getComponentByEntity(entity),cullableComponent=_this.cullable.getComponentByEntity(entity),geometryComponent=_this.geometry.getComponentByEntity(component.geometry),meshTransform=_this.transform.getComponentByEntity(entity);if(geometryComponent&&geometryComponent.aabb&&meshTransform&&component.aabbDirty){var worldTransform=meshTransform.worldTransform,_geometryComponent$aa=geometryComponent.aabb,center=_geometryComponent$aa.center,halfExtents=_geometryComponent$aa.halfExtents,transformedCenter=_glMatrix.vec3.transformMat4(_glMatrix.vec3.create(),center,worldTransform),rotationScale=(0,_math.getRotationScale)(worldTransform,_glMatrix.mat3.create()),transformedHalfExtents=_glMatrix.vec3.transformMat3(_glMatrix.vec3.create(),halfExtents,rotationScale);component.aabb.update(transformedCenter,transformedHalfExtents),component.aabbDirty=!1}if(cullableComponent&&geometryComponent){var parentCullableComponent=_this.cullable.getComponentByEntity((null==hierarchyComponent?void 0:hierarchyComponent.parentID)||-1);cullableComponent.visibilityPlaneMask=_this.computeVisibilityWithPlaneMask(component.aabb,(null==parentCullableComponent?void 0:parentCullableComponent.visibilityPlaneMask)||_Frustum.Mask.INDETERMINATE,_this.planes||camera.getFrustum().planes),cullableComponent.visible=cullableComponent.visibilityPlaneMask!==_Frustum.Mask.OUTSIDE}}))}));case 1:case"end":return _context.stop()}}),_callee,this)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"createMesh",value:function(params){var entity=(0,_.createEntity)();return this.mesh.create(entity,params),this.transform.create(entity),this.cullable.create(entity),entity}},{key:"computeVisibilityWithPlaneMask",value:function(aabb,parentPlaneMask,planes){if(parentPlaneMask===_Frustum.Mask.OUTSIDE||parentPlaneMask===_Frustum.Mask.INSIDE)return parentPlaneMask;for(var flag,mask=_Frustum.Mask.INSIDE,k=0,len=planes.length;k<len;++k)if(flag=31>k?1<<k:0,!(31>k&&0==(parentPlaneMask&flag))){var _planes$k=planes[k],normal=_planes$k.normal,distance=_planes$k.distance;if(0<_glMatrix.vec3.dot(normal,aabb.getNegativeFarPoint(planes[k]))+distance)return _Frustum.Mask.OUTSIDE;0<_glMatrix.vec3.dot(normal,aabb.getPositiveFarPoint(planes[k]))+distance&&(mask|=flag)}return mask}}]),MeshSystem}()).prototype,"scene",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"camera",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor3=_applyDecoratedDescriptor(_class2.prototype,"mesh",[_dec4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor4=_applyDecoratedDescriptor(_class2.prototype,"cullable",[_dec5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor5=_applyDecoratedDescriptor(_class2.prototype,"geometry",[_dec6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor6=_applyDecoratedDescriptor(_class2.prototype,"material",[_dec7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor7=_applyDecoratedDescriptor(_class2.prototype,"hierarchy",[_dec8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor8=_applyDecoratedDescriptor(_class2.prototype,"nameManager",[_dec9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor9=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec10],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.MeshSystem=MeshSystem},383:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(16),__webpack_require__(6),__webpack_require__(2),__webpack_require__(48),__webpack_require__(9),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.Frustum=exports.Mask=void 0;var _glMatrix=__webpack_require__(38),_Plane=__webpack_require__(797);function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}exports.Mask={OUTSIDE:4294967295,INSIDE:0,INDETERMINATE:2147483647};var Frustum=function(){function Frustum(planes){if(function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Frustum),this.planes=[],planes)this.planes=planes;else for(var i=0;6>i;i++)this.planes.push(new _Plane.Plane)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Frustum,[{key:"extractFromVPMatrix",value:function(vpMatrix){var _vpMatrix=_slicedToArray(vpMatrix,16),m0=_vpMatrix[0],m1=_vpMatrix[1],m2=_vpMatrix[2],m3=_vpMatrix[3],m4=_vpMatrix[4],m5=_vpMatrix[5],m6=_vpMatrix[6],m7=_vpMatrix[7],m8=_vpMatrix[8],m9=_vpMatrix[9],m10=_vpMatrix[10],m11=_vpMatrix[11],m12=_vpMatrix[12],m13=_vpMatrix[13],m14=_vpMatrix[14],m15=_vpMatrix[15];_glMatrix.vec3.set(this.planes[0].normal,m3-m0,m7-m4,m11-m8),this.planes[0].distance=-(m15-m12),_glMatrix.vec3.set(this.planes[1].normal,m3+m0,m7+m4,m11+m8),this.planes[1].distance=-(m15+m12),_glMatrix.vec3.set(this.planes[2].normal,m3+m1,m7+m5,m11+m9),this.planes[2].distance=-(m15+m13),_glMatrix.vec3.set(this.planes[3].normal,m3-m1,m7-m5,m11-m9),this.planes[3].distance=-(m15-m13),_glMatrix.vec3.set(this.planes[4].normal,m3-m2,m7-m6,m11-m10),this.planes[4].distance=-(m15-m14),_glMatrix.vec3.set(this.planes[5].normal,m3+m2,m7+m6,m11+m10),this.planes[5].distance=-(m15+m14),this.planes.forEach((function(plane){plane.normalize(),plane.updatePNVertexFlag()}))}}]),Frustum}();exports.Frustum=Frustum},384:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAngle=function getAngle(angle){if(void 0===angle)return 0;if(360<angle||-360>angle)return angle%360;return angle},exports.createVec3=function createVec3(x,y,z){if((0,_isNumber2.default)(x))return _glMatrix.vec3.fromValues(x,y,z);if(3===x.length)return _glMatrix.vec3.clone(x);return _glMatrix.vec3.fromValues(x[0],x[1],x[2])},exports.getRotationScale=function getRotationScale(matrix,result){return result[0]=matrix[0],result[1]=matrix[1],result[2]=matrix[2],result[3]=matrix[4],result[4]=matrix[5],result[5]=matrix[6],result[6]=matrix[8],result[7]=matrix[9],result[8]=matrix[10],result};var _isNumber2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(798)),_glMatrix=__webpack_require__(38)},385:function(module,exports,__webpack_require__){"use strict";__webpack_require__(16),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneSystem=void 0;var _dec,_dec2,_class,_class2,_descriptor,_inversify=__webpack_require__(37),_=__webpack_require__(24),_identifier=__webpack_require__(41);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var SceneSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.SceneComponentManager),_dec((_descriptor=function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}((_class2=function(){function SceneSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SceneSystem),function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}(this,"scene",_descriptor,this)}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(SceneSystem,[{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.scene.clear()}},{key:"createScene",value:function(_ref){var camera=_ref.camera,entity=(0,_.createEntity)();return this.scene.create(entity,{camera:camera}),entity}},{key:"addMesh",value:function(sceneEntity,meshEntity){var scene=this.scene.getComponentByEntity(sceneEntity);scene&&scene.meshes.push(meshEntity)}}]),SceneSystem}()).prototype,"scene",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.SceneSystem=SceneSystem},386:function(module,exports,__webpack_require__){"use strict";__webpack_require__(16),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneGraphSystem=void 0;var _dec,_dec2,_dec3,_dec4,_class,_class2,_descriptor,_descriptor2,_descriptor3,_glMatrix=__webpack_require__(38),_inversify=__webpack_require__(37),_identifier=__webpack_require__(41);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var SceneGraphSystem=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.HierarchyComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.TransformComponentManager),_dec4=(0,_inversify.inject)(_identifier.IDENTIFIER.MeshComponentManager),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function SceneGraphSystem(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SceneGraphSystem),_initializerDefineProperty(this,"hierarchy",_descriptor,this),_initializerDefineProperty(this,"transform",_descriptor2,this),_initializerDefineProperty(this,"mesh",_descriptor3,this)}var _execute;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(SceneGraphSystem,[{key:"execute",value:(_execute=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return _context.stop()}}),_callee,this)}))),function(){return _execute.apply(this,arguments)})},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var _this=this;this.transform.forEach((function(entity,transform){if(transform.isDirty()){var mesh=_this.mesh.getComponentByEntity(entity);mesh&&(mesh.aabbDirty=!0),transform.updateTransform()}}))}},{key:"runHierarchyUpdateSystem",value:function(){var _this2=this;this.hierarchy.forEach((function(entity,parentComponent){var transformChild=_this2.transform.getComponentByEntity(entity),transformParent=_this2.transform.getComponentByEntity(parentComponent.parentID);null!==transformChild&&null!==transformParent&&transformChild.updateTransformWithParent(transformParent)}))}},{key:"attach",value:function(entity,parent,isChildAlreadyInLocalSpace){if(this.hierarchy.contains(entity)&&this.detach(entity),this.hierarchy.create(entity,{parentID:parent}),1<this.hierarchy.getCount())for(var parentCandidateEntity,i=this.hierarchy.getCount()-1;0<i;--i){parentCandidateEntity=this.hierarchy.getEntity(i);for(var j=0;j<i;++j)if(this.hierarchy.getComponent(j).parentID===parentCandidateEntity){this.hierarchy.moveItem(i,j),++i;break}}this.hierarchy.getComponentByEntity(entity);var transformParent=this.transform.getComponentByEntity(parent);null===transformParent&&(transformParent=this.transform.create(parent));var transformChild=this.transform.getComponentByEntity(entity);null===transformChild&&(transformChild=this.transform.create(entity),transformParent=this.transform.getComponentByEntity(parent)),!isChildAlreadyInLocalSpace&&transformParent&&(transformChild.matrixTransform(_glMatrix.mat4.invert(_glMatrix.mat4.create(),transformParent.worldTransform)),transformChild.updateTransform()),transformParent&&transformChild.updateTransformWithParent(transformParent)}},{key:"detach",value:function(entity){if(null!==this.hierarchy.getComponentByEntity(entity)){var transform=this.transform.getComponentByEntity(entity);null!==transform&&transform.applyTransform(),this.hierarchy.removeKeepSorted(entity)}}},{key:"detachChildren",value:function(parent){for(var i=0;i<this.hierarchy.getCount();){var _this$hierarchy$getCo;if((null===(_this$hierarchy$getCo=this.hierarchy.getComponent(i))||void 0===_this$hierarchy$getCo?void 0:_this$hierarchy$getCo.parentID)===parent){var entity=this.hierarchy.getEntity(i);this.detach(entity)}else++i}}}]),SceneGraphSystem}()).prototype,"hierarchy",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor3=_applyDecoratedDescriptor(_class2.prototype,"mesh",[_dec4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.SceneGraphSystem=SceneGraphSystem},387:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraComponent=exports.CAMERA_TRACKING_MODE=exports.CAMERA_TYPE=void 0;var CAMERA_TYPE,CAMERA_TRACKING_MODE,_glMatrix=__webpack_require__(38),_=__webpack_require__(24),_Frustum=__webpack_require__(383),_math=__webpack_require__(384),_Landmark=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(799));function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}exports.CAMERA_TYPE=CAMERA_TYPE,function(CAMERA_TYPE){CAMERA_TYPE.ORBITING="ORBITING",CAMERA_TYPE.EXPLORING="EXPLORING",CAMERA_TYPE.TRACKING="TRACKING"}(CAMERA_TYPE||(exports.CAMERA_TYPE=CAMERA_TYPE={})),exports.CAMERA_TRACKING_MODE=CAMERA_TRACKING_MODE,function(CAMERA_TRACKING_MODE){CAMERA_TRACKING_MODE.DEFAULT="DEFAULT",CAMERA_TRACKING_MODE.ROTATIONAL="ROTATIONAL",CAMERA_TRACKING_MODE.TRANSLATIONAL="TRANSLATIONAL",CAMERA_TRACKING_MODE.CINEMATIC="CINEMATIC"}(CAMERA_TRACKING_MODE||(exports.CAMERA_TRACKING_MODE=CAMERA_TRACKING_MODE={}));var DEG_2_RAD=Math.PI/180,RAD_2_DEG=180/Math.PI,CameraComponent=function(_Component){function CameraComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CameraComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(CameraComponent).call(this,data))).matrix=_glMatrix.mat4.create(),_this.right=_glMatrix.vec3.fromValues(1,0,0),_this.up=_glMatrix.vec3.fromValues(0,1,0),_this.forward=_glMatrix.vec3.fromValues(0,0,1),_this.position=_glMatrix.vec3.fromValues(0,0,1),_this.focalPoint=_glMatrix.vec3.fromValues(0,0,0),_this.distanceVector=_glMatrix.vec3.fromValues(0,0,0),_this.distance=1,_this.azimuth=0,_this.elevation=0,_this.roll=0,_this.relAzimuth=0,_this.relElevation=0,_this.relRoll=0,_this.dollyingStep=0,_this.rotateWorld=!1,_this.fov=30,_this.near=.1,_this.far=1e4,_this.aspect=1,_this.perspective=_glMatrix.mat4.create(),_this.following=void 0,_this.type=CAMERA_TYPE.EXPLORING,_this.trackingMode=CAMERA_TRACKING_MODE.DEFAULT,_this.frustum=new _Frustum.Frustum,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(CameraComponent,_Component),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(CameraComponent,[{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"setType",value:function(type,trackingMode){this.type=type,this.type===CAMERA_TYPE.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===CAMERA_TYPE.TRACKING&&void 0!==trackingMode&&this.setTrackingMode(trackingMode)}},{key:"setTrackingMode",value:function(trackingMode){if(this.type!==CAMERA_TYPE.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");this.trackingMode=trackingMode}},{key:"setWorldRotation",value:function(flag){this.rotateWorld=flag,this._getAngles()}},{key:"getViewTransform",value:function(){return _glMatrix.mat4.invert(_glMatrix.mat4.create(),this.matrix)}},{key:"setMatrix",value:function(matrix){this.matrix=matrix,this._update()}},{key:"setPerspective",value:function(near,far,angle,aspect){this.fov=angle,this.near=near,this.far=far,this.aspect=aspect,this.updatePerspective()}},{key:"updatePerspective",value:function(){_glMatrix.mat4.perspective(this.perspective,this.fov*DEG_2_RAD,this.aspect,this.near,this.far)}},{key:"setPosition",value:function(x,y,z){return this._setPosition(x,y,z),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(x,y,z){var up=_glMatrix.vec3.fromValues(0,1,0);if(this.focalPoint=(0,_math.createVec3)(x,y,z),this.trackingMode===CAMERA_TRACKING_MODE.CINEMATIC){var d=_glMatrix.vec3.subtract(_glMatrix.vec3.create(),this.focalPoint,this.position);x=d[0],y=d[1],z=d[2];var r=_glMatrix.vec3.length(d),el=Math.asin(y/r)*RAD_2_DEG,az=90+Math.atan2(z,x)*RAD_2_DEG,m=_glMatrix.mat4.create();_glMatrix.mat4.rotateY(m,m,az*DEG_2_RAD),_glMatrix.mat4.rotateX(m,m,el*DEG_2_RAD),up=_glMatrix.vec3.transformMat4(_glMatrix.vec3.create(),[0,1,0],m)}return _glMatrix.mat4.invert(this.matrix,_glMatrix.mat4.lookAt(_glMatrix.mat4.create(),this.position,this.focalPoint,up)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(d){if(!(this.distance===d||0>d)){this.distance=d,this.dollyingStep=this.distance/100;var pos=_glMatrix.vec3.create(),n=this.forward,f=this.focalPoint;return pos[0]=d*n[0]+f[0],pos[1]=d*n[1]+f[1],pos[2]=d*n[2]+f[2],this._setPosition(pos),this}}},{key:"changeAzimuth",value:function(az){return this.setAzimuth(this.azimuth+az),this}},{key:"changeElevation",value:function(el){return this.setElevation(this.elevation+el),this}},{key:"changeRoll",value:function(rl){return this.setRoll(this.roll+rl),this}},{key:"setAzimuth",value:function(az){return this.azimuth=(0,_math.getAngle)(az),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(el){return this.elevation=(0,_math.getAngle)(el),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(angle){return this.roll=(0,_math.getAngle)(angle),this.computeMatrix(),this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(azimuth,elevation,roll){if(this.type===CAMERA_TYPE.EXPLORING){azimuth=(0,_math.getAngle)(azimuth),elevation=(0,_math.getAngle)(elevation),roll=(0,_math.getAngle)(roll);var rotX=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[1,0,0],(this.rotateWorld?1:-1)*elevation*DEG_2_RAD),rotY=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,1,0],(this.rotateWorld?1:-1)*azimuth*DEG_2_RAD),rotZ=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,0,1],roll*DEG_2_RAD),rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotY,rotX);rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotQ,rotZ);var rotMatrix=_glMatrix.mat4.fromQuat(_glMatrix.mat4.create(),rotQ);_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,-this.distance]),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix),_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(90<Math.abs(this.elevation+elevation))return;this.relElevation=(0,_math.getAngle)(elevation),this.relAzimuth=(0,_math.getAngle)(azimuth),this.relRoll=(0,_math.getAngle)(roll),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getPosition():this.type===CAMERA_TYPE.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(tx,ty){var coords=(0,_math.createVec3)(tx,ty,0),pos=_glMatrix.vec3.clone(this.position);return _glMatrix.vec3.add(pos,pos,_glMatrix.vec3.scale(_glMatrix.vec3.create(),this.right,coords[0])),_glMatrix.vec3.add(pos,pos,_glMatrix.vec3.scale(_glMatrix.vec3.create(),this.up,coords[1])),this._setPosition(pos),this}},{key:"dolly",value:function(value){var n=this.forward,pos=_glMatrix.vec3.clone(this.position),step=value*this.dollyingStep;return pos[0]+=step*n[0],pos[1]+=step*n[1],pos[2]+=step*n[2],this._setPosition(pos),this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?this._getDistance():this.type===CAMERA_TYPE.TRACKING&&_glMatrix.vec3.add(this.focalPoint,pos,this.distanceVector),this}},{key:"createLandmark",value:function(name){return new _Landmark.default(name,this)}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var rotX,rotY,rotZ=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,0,1],this.roll*DEG_2_RAD);_glMatrix.mat4.identity(this.matrix),rotX=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[1,0,0],(this.rotateWorld||this.type===CAMERA_TYPE.TRACKING?1:-1)*this.elevation*DEG_2_RAD),rotY=_glMatrix.quat.setAxisAngle(_glMatrix.quat.create(),[0,1,0],(this.rotateWorld?1:-1)*this.azimuth*DEG_2_RAD);var rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotY,rotX);rotQ=_glMatrix.quat.multiply(_glMatrix.quat.create(),rotQ,rotZ);var rotMatrix=_glMatrix.mat4.fromQuat(_glMatrix.mat4.create(),rotQ);this.type===CAMERA_TYPE.ORBITING||this.type===CAMERA_TYPE.EXPLORING?(_glMatrix.mat4.translate(this.matrix,this.matrix,this.focalPoint),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix),_glMatrix.mat4.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===CAMERA_TYPE.TRACKING&&(_glMatrix.mat4.translate(this.matrix,this.matrix,this.position),_glMatrix.mat4.multiply(this.matrix,this.matrix,rotMatrix))}},{key:"_setPosition",value:function(x,y,z){this.position=(0,_math.createVec3)(x,y,z);var m=this.matrix;m[12]=this.position[0],m[13]=this.position[1],m[14]=this.position[2],m[15]=1}},{key:"_getAxes",value:function(){_glMatrix.vec3.copy(this.right,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[1,0,0,0],this.matrix))),_glMatrix.vec3.copy(this.up,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,1,0,0],this.matrix))),_glMatrix.vec3.copy(this.forward,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,0,1,0],this.matrix))),_glMatrix.vec3.normalize(this.right,this.right),_glMatrix.vec3.normalize(this.up,this.up),_glMatrix.vec3.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var x=this.distanceVector[0],y=this.distanceVector[1],z=this.distanceVector[2],r=_glMatrix.vec3.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===CAMERA_TYPE.TRACKING||this.rotateWorld?(this.elevation=Math.asin(y/r)*RAD_2_DEG,this.azimuth=Math.atan2(-x,-z)*RAD_2_DEG):(this.elevation=-Math.asin(y/r)*RAD_2_DEG,this.azimuth=-Math.atan2(-x,-z)*RAD_2_DEG)}},{key:"_getPosition",value:function(){_glMatrix.vec3.copy(this.position,(0,_math.createVec3)(_glMatrix.vec4.transformMat4(_glMatrix.vec4.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){_glMatrix.vec3.transformMat3(this.distanceVector,[0,0,-this.distance],_glMatrix.mat3.fromMat4(_glMatrix.mat3.create(),this.matrix)),_glMatrix.vec3.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=_glMatrix.vec3.subtract(_glMatrix.vec3.create(),this.focalPoint,this.position),this.distance=_glMatrix.vec3.length(this.distanceVector),this.dollyingStep=this.distance/100}}]),CameraComponent}(_.Component);exports.CameraComponent=CameraComponent},388:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ComputeComponent=void 0;var ComputeComponent=function(_Component){function ComputeComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ComputeComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(ComputeComponent).call(this,data))).type=void 0,_this.strategy=void 0,_this.dirty=!0,_this.shaderGLSL=void 0,_this.shaderInWebGL=void 0,_this.stageDescriptor=void 0,_this.pipelineLayout=void 0,_this.bindings=[],_this.particleCount=void 0,_this.particleData=void 0,_this.particleDataConstructor=void 0,_this.particleBuffers=[,,],_this.particleBindGroups=[,,],_this.iteration=0,_this.maxIteration=void 0,_this.finished=!1,_this.onCompleted=void 0,Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(ComputeComponent,_Component),ComputeComponent}(__webpack_require__(24).Component);exports.ComputeComponent=ComputeComponent},389:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialComponent=void 0;var MaterialComponent=function(_Component){function MaterialComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MaterialComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(MaterialComponent).call(this,data))).vertexShaderGLSL=void 0,_this.fragmentShaderGLSL=void 0,_this.dirty=!0,_this.stageDescriptor=void 0,_this.primitiveTopology="triangle-list",_this.uniforms=[],_this.uniformsBindGroupLayout=void 0,_this.pipelineLayout=void 0,_this.uniformBindGroup=void 0,_this.colorStates=void 0,_this.depthStencilState=void 0,_this.rasterizationState=void 0,Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MaterialComponent,_Component),MaterialComponent}(__webpack_require__(24).Component);exports.MaterialComponent=MaterialComponent},390:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.CullableComponent=exports.Strategy=void 0;var _=__webpack_require__(24);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Strategy={Standard:0};exports.Strategy=Strategy;var CullableComponent=function(_Component){function CullableComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CullableComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(CullableComponent).call(this,data))).strategy=Strategy.Standard,_this.visibilityPlaneMask=0,_this.visible=!1,Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(CullableComponent,_Component),CullableComponent}(_.Component);exports.CullableComponent=CullableComponent},391:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshComponent=void 0;var _=__webpack_require__(24),_AABB=__webpack_require__(379);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MeshComponent=function(_Component){function MeshComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeshComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(MeshComponent).call(this,data))).material=void 0,_this.geometry=void 0,_this.aabb=new _AABB.AABB,_this.aabbDirty=!0,Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MeshComponent,_Component),MeshComponent}(_.Component);exports.MeshComponent=MeshComponent},392:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformComponent=void 0;var _glMatrix=__webpack_require__(38);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var TransformComponent=function(_Component){function TransformComponent(data){var _this,rotation,scaling,translation,rts,transformed,quatX,quatY,quatZ,aS,aR,aT,bS,bR,bT;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TransformComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(TransformComponent).call(this,data))).dirtyFlag=void 0,_this.localTranslation=_glMatrix.vec3.fromValues(0,0,0),_this.localRotation=_glMatrix.quat.fromValues(0,0,0,1),_this.localScale=_glMatrix.vec3.fromValues(1,1,1),_this.localTransform=_glMatrix.mat4.create(),_this.worldTransform=_glMatrix.mat4.create(),_this.getRotation=(rotation=_glMatrix.quat.create(),function(){return _glMatrix.mat4.getRotation(rotation,_this.worldTransform),rotation}),_this.getScale=(scaling=_glMatrix.vec3.create(),function(){return _glMatrix.mat4.getScaling(scaling,_this.worldTransform),scaling}),_this.getPosition=(translation=_glMatrix.vec3.create(),function(){return _glMatrix.mat4.getTranslation(translation,_this.worldTransform),translation}),_this.getLocalMatrix=(rts=_glMatrix.mat4.create(),function(){return _glMatrix.mat4.fromRotationTranslationScale(rts,_this.localRotation,_this.localTranslation,_this.localScale),rts}),_this.matrixTransform=(transformed=_glMatrix.mat4.create(),function(mat){_glMatrix.mat4.multiply(transformed,_this.getLocalMatrix(),mat),_glMatrix.mat4.getScaling(_this.localScale,transformed),_glMatrix.mat4.getTranslation(_this.localTranslation,transformed),_glMatrix.mat4.getRotation(_this.localRotation,transformed)}),_this.rotateRollPitchYaw=(quatX=_glMatrix.quat.create(),quatY=_glMatrix.quat.create(),quatZ=_glMatrix.quat.create(),function(x,y,z){_this.setDirty(),_glMatrix.quat.fromEuler(quatX,x,0,0),_glMatrix.quat.fromEuler(quatY,0,y,0),_glMatrix.quat.fromEuler(quatZ,0,0,z),_glMatrix.quat.multiply(_this.localRotation,quatX,_this.localRotation),_glMatrix.quat.multiply(_this.localRotation,_this.localRotation,quatY),_glMatrix.quat.multiply(_this.localRotation,quatZ,_this.localRotation),_glMatrix.quat.normalize(_this.localRotation,_this.localRotation)}),_this.lerp=(aS=_glMatrix.vec3.create(),aR=_glMatrix.quat.create(),aT=_glMatrix.vec3.create(),bS=_glMatrix.vec3.create(),bR=_glMatrix.quat.create(),bT=_glMatrix.vec3.create(),function(a,b,t){_this.setDirty(),_glMatrix.mat4.getScaling(aS,a.worldTransform),_glMatrix.mat4.getTranslation(aT,a.worldTransform),_glMatrix.mat4.getRotation(aR,a.worldTransform),_glMatrix.mat4.getScaling(bS,b.worldTransform),_glMatrix.mat4.getTranslation(bT,b.worldTransform),_glMatrix.mat4.getRotation(bR,b.worldTransform),_glMatrix.vec3.lerp(_this.localScale,aS,bS,t),_glMatrix.quat.slerp(_this.localRotation,aR,bR,t),_glMatrix.vec3.lerp(_this.localTranslation,aT,bT,t)}),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(TransformComponent,_Component),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(TransformComponent,[{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var value=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];value?this.dirtyFlag|=TransformComponent.DIRTY:this.dirtyFlag&=~TransformComponent.DIRTY}},{key:"updateTransform",value:function(){this.isDirty()&&(this.setDirty(!1),_glMatrix.mat4.copy(this.worldTransform,this.getLocalMatrix()))}},{key:"updateTransformWithParent",value:function(parent){_glMatrix.mat4.multiply(this.worldTransform,this.getLocalMatrix(),parent.worldTransform)}},{key:"applyTransform",value:function(){this.setDirty(),_glMatrix.mat4.getScaling(this.localScale,this.worldTransform),_glMatrix.mat4.getTranslation(this.localTranslation,this.worldTransform),_glMatrix.mat4.getRotation(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localTranslation=_glMatrix.vec3.fromValues(0,0,0),this.localRotation=_glMatrix.quat.fromValues(0,0,0,1),this.localScale=_glMatrix.vec3.fromValues(1,1,1)}},{key:"translate",value:function(translation){this.setDirty(),_glMatrix.vec3.add(this.localTranslation,this.localTranslation,translation)}},{key:"scale",value:function(scaling){this.setDirty(),_glMatrix.vec3.multiply(this.localScale,this.localScale,scaling)}},{key:"rotate",value:function(quaternion){this.setDirty(),_glMatrix.quat.multiply(this.localRotation,this.localRotation,quaternion),_glMatrix.quat.normalize(this.localRotation,this.localRotation)}}]),TransformComponent}(__webpack_require__(218).Component);exports.TransformComponent=TransformComponent,TransformComponent.DIRTY=1},41:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(2),Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDENTIFIER=void 0;var IDENTIFIER={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),SceneSystem:Symbol("SceneSystem"),SceneComponentManager:Symbol("SceneComponentManager"),CameraComponentManager:Symbol("CameraComponentManager"),CameraSystem:Symbol("CameraSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),InteractionSystem:Symbol("InteractionSystem"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine")};exports.IDENTIFIER=IDENTIFIER},410:function(module,exports,__webpack_require__){__webpack_require__(411),__webpack_require__(556),module.exports=__webpack_require__(557)},475:function(module,exports){},557:function(module,exports,__webpack_require__){"use strict";(function(module){__webpack_require__(558);var _react=__webpack_require__(303),_theming=__webpack_require__(742);(0,_react.addParameters)({options:{isFullscreen:!1,showAddonsPanel:!0,showSearchBox:!1,panelPosition:"right",hierarchySeparator:/\./,enableShortcuts:!0,theme:(0,_theming.create)({base:"light",brandTitle:"WebGPU Engine",brandUrl:"https://github.com/antvis/GWebGPUEngine",gridCellSize:12})}});var req=__webpack_require__(757);(0,_react.configure)((function loadStories(){req.keys().forEach(req)}),module)}).call(this,__webpack_require__(101)(module))},558:function(module,exports,__webpack_require__){var api=__webpack_require__(559),content=__webpack_require__(560);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1},exported=(api(content,options),content.locals?content.locals:{});module.exports=exported},560:function(module,exports,__webpack_require__){(exports=__webpack_require__(561)(!1)).push([module.i,"html,body{margin:0}.dg.ac{z-index:999 !important}\n",""]),module.exports=exports},69:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"World",{enumerable:!0,get:function(){return _World.World}});var _World=__webpack_require__(760)},757:function(module,exports,__webpack_require__){var map={"./base.stories.tsx":758};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=757},758:function(module,exports,__webpack_require__){"use strict";(function(module){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var _react=__webpack_require__(303),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3)),_Curl=_interopRequireDefault(__webpack_require__(759)),_Flocking=_interopRequireDefault(__webpack_require__(823)),_Fruchterman=_interopRequireDefault(__webpack_require__(824)),_FruchtermanRenderWithG=_interopRequireDefault(__webpack_require__(825)),_Gravity=_interopRequireDefault(__webpack_require__(844)),_Instanced=_interopRequireDefault(__webpack_require__(845)),_RotatingCube=_interopRequireDefault(__webpack_require__(846)),_RotatingCubeWithRecordBundle=_interopRequireDefault(__webpack_require__(848)),_TriangleMSAA=_interopRequireDefault(__webpack_require__(850));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var withSourceLoader=__webpack_require__(400).withSource,__STORY__=(__webpack_require__(400).addSource,"import { storiesOf } from '@storybook/react';\nimport * as React from 'react';\nimport Curl from './GPGPU/Curl';\nimport Flocking from './GPGPU/Flocking';\nimport Fruchterman from './GPGPU/Fruchterman';\nimport FruchtermanRenderWithG from './GPGPU/FruchtermanRenderWithG';\nimport Gravity from './GPGPU/Gravity';\nimport Instanced from './Rendering/Instanced';\nimport RotatingCube from './Rendering/RotatingCube';\nimport RotatingCubeWithRecordBundle from './Rendering/RotatingCubeWithRecordBundle';\nimport TriangleMSAA from './Rendering/TriangleMSAA';\n\n// @ts-ignore\nstoriesOf('Rendering', module)\n  .add('TriangleMSAA', () => <TriangleMSAA />)\n  .add('RotatingCube', () => <RotatingCube />)\n  .add('RotatingCubeWithRecordBundle', () => <RotatingCubeWithRecordBundle />)\n  .add('Instanced', () => <Instanced />);\nstoriesOf('GPGPU', module)\n  .add('Flocking', () => <Flocking />)\n  .add('Curl', () => <Curl />)\n  .add('Gravity', () => <Gravity />)\n  .add('Fruchterman', () => <Fruchterman />)\n  .add('FruchtermanRenderWithG', () => <FruchtermanRenderWithG />);\n"),__ADDS_MAP__={"rendering--instanced":{startLoc:{col:7,line:18},endLoc:{col:39,line:18},startBody:{col:20,line:18},endBody:{col:39,line:18}},"rendering--rotatingcubewithrecordbundle":{startLoc:{col:7,line:17},endLoc:{col:77,line:17},startBody:{col:39,line:17},endBody:{col:77,line:17}},"rendering--rotatingcube":{startLoc:{col:7,line:16},endLoc:{col:45,line:16},startBody:{col:23,line:16},endBody:{col:45,line:16}},"rendering--trianglemsaa":{startLoc:{col:7,line:15},endLoc:{col:45,line:15},startBody:{col:23,line:15},endBody:{col:45,line:15}},"gpgpu--fruchtermanrenderwithg":{startLoc:{col:7,line:24},endLoc:{col:65,line:24},startBody:{col:33,line:24},endBody:{col:65,line:24}},"gpgpu--fruchterman":{startLoc:{col:7,line:23},endLoc:{col:43,line:23},startBody:{col:22,line:23},endBody:{col:43,line:23}},"gpgpu--gravity":{startLoc:{col:7,line:22},endLoc:{col:35,line:22},startBody:{col:18,line:22},endBody:{col:35,line:22}},"gpgpu--curl":{startLoc:{col:7,line:21},endLoc:{col:29,line:21},startBody:{col:15,line:21},endBody:{col:29,line:21}},"gpgpu--flocking":{startLoc:{col:7,line:20},endLoc:{col:37,line:20},startBody:{col:19,line:20},endBody:{col:37,line:20}}},__MODULE_DEPENDENCIES__=[],__LOCAL_DEPENDENCIES__={},__IDS_TO_FRAMEWORKS__={};(0,_react.storiesOf)("Rendering",module).addParameters({storySource:{source:__STORY__,locationsMap:__ADDS_MAP__}}).addDecorator(withSourceLoader(__STORY__,__ADDS_MAP__,"/base.stories.tsx",__MODULE_DEPENDENCIES__,__LOCAL_DEPENDENCIES__,"/Users/pyq/workspace/webgpu/GWebGPUEngine/stories",__IDS_TO_FRAMEWORKS__)).add("TriangleMSAA",(function(){return React.createElement(_TriangleMSAA.default,null)})).add("RotatingCube",(function(){return React.createElement(_RotatingCube.default,null)})).add("RotatingCubeWithRecordBundle",(function(){return React.createElement(_RotatingCubeWithRecordBundle.default,null)})).add("Instanced",(function(){return React.createElement(_Instanced.default,null)})),(0,_react.storiesOf)("GPGPU",module).addParameters({storySource:{source:__STORY__,locationsMap:__ADDS_MAP__}}).addDecorator(withSourceLoader(__STORY__,__ADDS_MAP__,"/base.stories.tsx",__MODULE_DEPENDENCIES__,__LOCAL_DEPENDENCIES__,"/Users/pyq/workspace/webgpu/GWebGPUEngine/stories",__IDS_TO_FRAMEWORKS__)).add("Flocking",(function(){return React.createElement(_Flocking.default,null)})).add("Curl",(function(){return React.createElement(_Curl.default,null)})).add("Gravity",(function(){return React.createElement(_Gravity.default,null)})).add("Fruchterman",(function(){return React.createElement(_Fruchterman.default,null)})).add("FruchtermanRenderWithG",(function(){return React.createElement(_FruchtermanRenderWithG.default,null)}))}).call(this,__webpack_require__(101)(module))},759:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function Curl(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Curl,_super),Curl.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,vertexBufferData,simParamData,initialParticleData,i,compute_1,camera,scene,geometry,material,mesh,_this=this;return __generator(this,(function(_a){if(canvas=document.getElementById("application")){for(vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),simParamData=new Float32Array([.01,.1]),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;this.world=new _gWebgpu.World(canvas,{engineOptions:{supportCompute:!0}}),compute_1=this.world.createComputePipeline({type:"particle",shader:"vec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i = floor(v + dot(v, C.yy) );\n  vec2 x0 = v - i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x = a0.x * x0.x + h.x * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\n  // x1 = x0 - i1 + 1.0 * C.xxx;\n  // x2 = x0 - i2 + 2.0 * C.xxx;\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n  float mod289(float x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat permute(float x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n  {\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n  }\n\nfloat snoise(vec4 v)\n  {\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\n                        0.276393202250021, // 2 * G4\n                        0.414589803375032, // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\n// First corner\n  vec4 i = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v - i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n// i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\n  // x1 = x0 - i1 + 1.0 * C.xxxx\n  // x2 = x0 - i2 + 2.0 * C.xxxx\n  // x3 = x0 - i3 + 3.0 * C.xxxx\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n// Permutations\n  i = mod289(i);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0, ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n  }\n\n// Using  @eddietree implementation from \n// His brilliant demo 'Artifacts'\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = 1e-1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nstruct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) buffer ParticlesA {\n  Particle particles[PARTICLE_NUM];\n} particlesA;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesB {\n  Particle particles[PARTICLE_NUM];\n} particlesB;\n\nlayout(std140, set = 0, binding = 2) uniform SimParams {\n  float deltaT;\n  float noiseSize;\n} params;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= PARTICLE_NUM) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec3 curl = curlNoise( vec3(particlesB.particles[index].pos.xy, 0.) * params.noiseSize );\n\n  vVel += curl.xy * .01;\n  vVel *= .97;\n  vVel = normalize(vVel);\n\n  vPos += vVel * params.deltaT;\n\n  // Wrap around boundary\n  if (vPos.x < -1.0) vPos.x = 1.0;\n  if (vPos.x > 1.0) vPos.x = -1.0;\n  if (vPos.y < -1.0) vPos.y = 1.0;\n  if (vPos.y > 1.0) vPos.y = -1.0;\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}",particleCount:1500,particleData:initialParticleData}),this.world.setBinding(compute_1,"simParams",simParamData,{binding:2,type:"uniform-buffer"}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:50,far:1e3,near:.1}),this.world.getCamera(camera).setPosition(0,0,2),scene=this.world.createScene({camera:camera}),geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:1500}),this.world.setAttribute(geometry,"particle",null,{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},(function(){return _this.world.getParticleBuffer(compute_1)})),this.world.setAttribute(geometry,"position",vertexBufferData,{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}),material=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = builtin.projectionMatrix * builtin.modelViewMatrix * vec4(pos + a_particlePos, 0, 1);\n}",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}"}),mesh=this.world.createMesh({geometry:geometry,material:material}),this.world.add(scene,mesh)}return[2]}))}))},Curl.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Curl.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600"})},Curl}(React.Component);exports.default=_default},760:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(67),__webpack_require__(16),__webpack_require__(6),__webpack_require__(106),__webpack_require__(107),__webpack_require__(30),__webpack_require__(17),__webpack_require__(36),__webpack_require__(2),__webpack_require__(31),__webpack_require__(9),__webpack_require__(204),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.World=void 0;var _gWebgpuCore=__webpack_require__(24),_gWebgpuEngine=__webpack_require__(815),WebGPUConstants=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(394));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var World=function(_EventEmitter){function World(canvas){var _this,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,World),(_this=_possibleConstructorReturn(this,_getPrototypeOf(World).call(this))).systems=void 0,_this.engine=void 0,_this.canvas=void 0,_this.forwardRenderPath=void 0,_this.inited=!1,_this.onInit=void 0,_this.onUpdate=void 0,_this.rafHandle=void 0,_this.useRenderBundle=!1,_this.renderBundleRecorded=!1,_this.renderBundle=void 0,_this.update=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.render();case 2:_this.systems.forEach((function(system){system.cleanup&&system.cleanup()})),_this.rafHandle=window.requestAnimationFrame(_this.update);case 4:case"end":return _context.stop()}}),_callee)})));var engineClazz=navigator.gpu?_gWebgpuEngine.WebGPUEngine:_gWebgpuEngine.WebGLEngine;return _gWebgpuCore.container.isBound(_gWebgpuCore.IDENTIFIER.RenderEngine)||_gWebgpuCore.container.bind(_gWebgpuCore.IDENTIFIER.RenderEngine).to(engineClazz).inSingletonScope(),_this.engine=_gWebgpuCore.container.get(_gWebgpuCore.IDENTIFIER.RenderEngine),_this.systems=_gWebgpuCore.container.getAll(_gWebgpuCore.IDENTIFIER.Systems),_this.forwardRenderPath=_gWebgpuCore.container.get(_gWebgpuCore.IDENTIFIER.ForwardRenderPath),_this.canvas=canvas,_this.init(canvas,options.engineOptions),options.onInit&&(_this.onInit=options.onInit),options.onUpdate&&(_this.onUpdate=options.onUpdate),_this.useRenderBundle=!!options.useRenderBundle,_this}var _render,_init;return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(World,_EventEmitter),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(World,[{key:"getCamera",value:function(entity){return _gWebgpuCore.container.get(_gWebgpuCore.IDENTIFIER.CameraComponentManager).getComponentByEntity(entity)}},{key:"getTransform",value:function(entity){return _gWebgpuCore.container.get(_gWebgpuCore.IDENTIFIER.TransformComponentManager).getComponentByEntity(entity)}},{key:"createScene",value:function(sceneParams){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.SceneSystem).createScene(sceneParams)}},{key:"createCamera",value:function(cameraParams){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.CameraSystem).createCamera(cameraParams)}},{key:"createMesh",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.MeshSystem).createMesh(params)}},{key:"createBoxGeometry",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.GeometrySystem).createBox(params)}},{key:"createBufferGeometry",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.GeometrySystem).createBufferGeometry(params)}},{key:"createInstancedBufferGeometry",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.GeometrySystem).createInstancedBufferGeometry(params)}},{key:"createBasicMaterial",value:function(){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.MaterialSystem).createBasicMaterial()}},{key:"createShaderMaterial",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.MaterialSystem).createShaderMaterial(params)}},{key:"setAttribute",value:function(entity,name,data,descriptor,bufferGetter){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.GeometrySystem).setAttribute(entity,name,data,descriptor,bufferGetter)}},{key:"createComputePipeline",value:function(params){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.ComputeSystem).createComputePipeline(params)}},{key:"addUniform",value:function(entity,uniform){_gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.MaterialSystem).addUniform(entity,uniform)}},{key:"setUniform",value:function(materialEntity,uniformName,data){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.MaterialSystem).setUniform(materialEntity,uniformName,data)}},{key:"setIndex",value:function(entity,data){_gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.GeometrySystem).setIndex(entity,data)}},{key:"setBinding",value:function(entity,name,data,descriptor){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.ComputeSystem).setBinding(entity,name,data,descriptor)}},{key:"getParticleBuffer",value:function(entity){return _gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.ComputeSystem).getParticleBuffer(entity)}},{key:"add",value:function(sceneEntity,meshEntity){_gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.SceneSystem).addMesh(sceneEntity,meshEntity)}},{key:"attach",value:function(entity,parent,isChildAlreadyInLocalSpace){_gWebgpuCore.container.getNamed(_gWebgpuCore.IDENTIFIER.Systems,_gWebgpuCore.IDENTIFIER.SceneGraphSystem).attach(entity,parent,isChildAlreadyInLocalSpace)}},{key:"init",value:(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(canvas,engineOptions){return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.engine.init(canvas,_objectSpread({swapChainFormat:WebGPUConstants.TextureFormat.BGRA8Unorm,antialiasing:!0},engineOptions));case 2:return _context2.next=4,this.update();case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _init.apply(this,arguments)})},{key:"destroy",value:function(){this.off("init"),this.off("update"),this.engine.dispose(),this.systems.forEach((function(system){system.tearDown&&system.tearDown()})),window.cancelAnimationFrame(this.rafHandle)}},{key:"render",value:(_render=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,system,_this2=this;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.engine.beginFrame(),this.engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),this.inited){_context3.next=9;break}if(this.systems.forEach((function(system){system.initialize&&system.initialize(_this2.canvas)})),this.emit("init",this.engine),!this.onInit){_context3.next=8;break}return _context3.next=8,this.onInit(this.engine);case 8:this.inited=!0;case 9:_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,_context3.prev=12,_iterator=this.systems[Symbol.iterator]();case 14:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context3.next=22;break}if(!(system=_step.value).execute){_context3.next=19;break}return _context3.next=19,system.execute();case 19:_iteratorNormalCompletion=!0,_context3.next=14;break;case 22:_context3.next=28;break;case 24:_context3.prev=24,_context3.t0=_context3.catch(12),_didIteratorError=!0,_iteratorError=_context3.t0;case 28:_context3.prev=28,_context3.prev=29,_iteratorNormalCompletion||null==_iterator.return||_iterator.return();case 31:if(_context3.prev=31,!_didIteratorError){_context3.next=34;break}throw _iteratorError;case 34:return _context3.finish(31);case 35:return _context3.finish(28);case 36:if(!this.useRenderBundle){_context3.next=47;break}if(this.renderBundleRecorded){_context3.next=44;break}if(this.engine.startRecordBundle(),!this.onUpdate){_context3.next=42;break}return _context3.next=42,this.onUpdate(this.engine);case 42:this.renderBundle=this.engine.stopRecordBundle(),this.renderBundleRecorded=!0;case 44:this.engine.executeBundles([this.renderBundle]),_context3.next=52;break;case 47:if(this.emit("update",this.engine),!this.onUpdate){_context3.next=51;break}return _context3.next=51,this.onUpdate(this.engine);case 51:this.forwardRenderPath.render();case 52:this.engine.endFrame();case 53:case"end":return _context3.stop()}}),_callee3,this,[[12,24,28,36],[29,,31,35]])}))),function(){return _render.apply(this,arguments)})}]),World}(__webpack_require__(345).EventEmitter);exports.World=World},794:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateAABBFromVertices=function generateAABBFromVertices(positions){for(var aabb=new _AABB.AABB,min=_glMatrix.vec3.fromValues(positions[0],positions[1],positions[2]),max=_glMatrix.vec3.fromValues(positions[0],positions[1],positions[2]),i=3;i<positions.length;){var x=positions[i++],y=positions[i++],z=positions[i++];x<min[0]&&(min[0]=x),y<min[1]&&(min[1]=y),z<min[2]&&(min[2]=z),x>max[0]&&(max[0]=x),y>max[1]&&(max[1]=y),z>max[2]&&(max[2]=z)}return aabb.setMinMax(min,max),aabb};var _glMatrix=__webpack_require__(38),_AABB=__webpack_require__(379)},796:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLengthFromFormat=function getLengthFromFormat(format){if("float4"===format)return 4;if("float3"===format)return 3;if("float2"===format)return 2;if("float"===format)return 1;if("mat3"===format)return 9;if("mat4"===format)return 16;return 0}},797:function(module,exports,__webpack_require__){"use strict";__webpack_require__(155),Object.defineProperty(exports,"__esModule",{value:!0}),exports.Plane=void 0;var _glMatrix=__webpack_require__(38);function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var Plane=function(){function Plane(distance,normal){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Plane),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=distance||0,this.normal=normal||_glMatrix.vec3.fromValues(0,1,0),this.updatePNVertexFlag()}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Plane,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(+(0<=this.normal[0])<<8)+(+(0<=this.normal[1])<<4)+ +(0<=this.normal[2])}},{key:"distanceToPoint",value:function(point){return _glMatrix.vec3.dot(point,this.normal)-this.distance}},{key:"normalize",value:function(){var invLen=1/_glMatrix.vec3.len(this.normal);_glMatrix.vec3.scale(this.normal,this.normal,invLen),this.distance*=invLen}},{key:"intersectsLine",value:function(start,end,point){var d0=this.distanceToPoint(start),t=d0/(d0-this.distanceToPoint(end)),intersects=0<=t&&1>=t;return intersects&&point&&_glMatrix.vec3.lerp(point,start,end,t),intersects}}]),Plane}();exports.Plane=Plane},799:function(module,exports,__webpack_require__){"use strict";__webpack_require__(66),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _glMatrix=__webpack_require__(38);function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var Landmark=function(){function Landmark(name,c){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Landmark),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=name,this.matrix=_glMatrix.mat4.clone(c.matrix),this.right=_glMatrix.vec3.clone(c.right),this.up=_glMatrix.vec3.clone(c.up),this.forward=_glMatrix.vec3.clone(c.forward),this.position=_glMatrix.vec3.clone(c.position),this.focalPoint=_glMatrix.vec3.clone(c.focalPoint),this.distanceVector=_glMatrix.vec3.clone(c.distanceVector),this.azimuth=c.azimuth,this.elevation=c.elevation,this.roll=c.roll,this.relAzimuth=c.relAzimuth,this.relElevation=c.relElevation,this.relRoll=c.relRoll,this.dollyingStep=c.dollyingStep,this.distance=c.distance}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Landmark,[{key:"retrieve",value:function(c){c.matrix=_glMatrix.mat4.copy(c.matrix,this.matrix),c.right=_glMatrix.vec3.copy(c.right,this.right),c.up=_glMatrix.vec3.copy(c.up,this.up),c.forward=_glMatrix.vec3.copy(c.forward,this.forward),c.position=_glMatrix.vec3.copy(c.position,this.position),c.focalPoint=_glMatrix.vec3.copy(c.focalPoint,this.focalPoint),c.distanceVector=_glMatrix.vec3.copy(c.distanceVector,this.distanceVector),c.azimuth=this.azimuth,c.elevation=this.elevation,c.roll=this.roll,c.relAzimuth=this.relAzimuth,c.relElevation=this.relElevation,c.relRoll=this.relRoll,c.dollyingStep=this.dollyingStep,c.distance=this.distance}}]),Landmark}();exports.default=Landmark},800:function(module,exports,__webpack_require__){},801:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lazyMultiInject=exports.lazyInject=exports.container=void 0,__webpack_require__(362);var _inversify=__webpack_require__(37),_inversifyInjectDecorators=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(802)),_ComponentManager=__webpack_require__(218),_CameraComponent=__webpack_require__(387),_System=__webpack_require__(363),_ComputeComponent=__webpack_require__(388),_LayoutComputeStrategy=__webpack_require__(804),_ParticleComputeStrategy=__webpack_require__(805),_System2=__webpack_require__(370),_PassNodeComponent=__webpack_require__(806),_ResourceHandleComponent=__webpack_require__(807),_System3=__webpack_require__(371),_GeometryComponent=__webpack_require__(808),_System4=__webpack_require__(372),_System5=__webpack_require__(380),_MaterialComponent=__webpack_require__(389),_System6=__webpack_require__(381),_CullableComponent=__webpack_require__(390),_MeshComponent=__webpack_require__(391),_System7=__webpack_require__(382),_Forward=__webpack_require__(809),_SceneComponent=__webpack_require__(810),_System8=__webpack_require__(385),_HierarchyComponent=__webpack_require__(811),_NameComponent=__webpack_require__(812),_System9=__webpack_require__(386),_TransformComponent=__webpack_require__(392),_identifier=__webpack_require__(41);var container=new _inversify.Container;exports.container=container;var DECORATORS=(0,_inversifyInjectDecorators.default)(container,!1);exports.lazyInject=function(serviceIdentifier){var original=DECORATORS.lazyInject(serviceIdentifier);return function(proto,key,descriptor){original.call(this,proto,key),descriptor&&(descriptor.initializer=function(){return proto[key]})}};exports.lazyMultiInject=function(serviceIdentifier){var original=DECORATORS.lazyMultiInject(serviceIdentifier);return function(proto,key,descriptor){original.call(this,proto,key),descriptor&&(descriptor.initializer=function(){return proto[key]})}},container.bind(_identifier.IDENTIFIER.NameComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_NameComponent.NameComponent)),container.bind(_identifier.IDENTIFIER.HierarchyComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_HierarchyComponent.HierarchyComponent)),container.bind(_identifier.IDENTIFIER.TransformComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_TransformComponent.TransformComponent)),container.bind(_identifier.IDENTIFIER.CameraComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_CameraComponent.CameraComponent)),container.bind(_identifier.IDENTIFIER.ResourceHandleComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_ResourceHandleComponent.ResourceHandleComponent)),container.bind(_identifier.IDENTIFIER.PassNodeComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_PassNodeComponent.PassNodeComponent)),container.bind(_identifier.IDENTIFIER.MeshComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_MeshComponent.MeshComponent)),container.bind(_identifier.IDENTIFIER.CullableComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_CullableComponent.CullableComponent)),container.bind(_identifier.IDENTIFIER.GeometryComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_GeometryComponent.GeometryComponent)),container.bind(_identifier.IDENTIFIER.MaterialComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_MaterialComponent.MaterialComponent)),container.bind(_identifier.IDENTIFIER.SceneComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_SceneComponent.SceneComponent)),container.bind(_identifier.IDENTIFIER.ComputeComponentManager).toConstantValue(new _ComponentManager.ComponentManager(_ComputeComponent.ComputeComponent)),container.bind(_identifier.IDENTIFIER.Systems).to(_System9.SceneGraphSystem).whenTargetNamed(_identifier.IDENTIFIER.SceneGraphSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System8.SceneSystem).whenTargetNamed(_identifier.IDENTIFIER.SceneSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System.CameraSystem).whenTargetNamed(_identifier.IDENTIFIER.CameraSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System3.FrameGraphSystem).whenTargetNamed(_identifier.IDENTIFIER.FrameGraphSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System7.MeshSystem).whenTargetNamed(_identifier.IDENTIFIER.MeshSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System4.GeometrySystem).whenTargetNamed(_identifier.IDENTIFIER.GeometrySystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System6.MaterialSystem).whenTargetNamed(_identifier.IDENTIFIER.MaterialSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System5.InteractionSystem).whenTargetNamed(_identifier.IDENTIFIER.InteractionSystem),container.bind(_identifier.IDENTIFIER.Systems).to(_System2.ComputeSystem).whenTargetNamed(_identifier.IDENTIFIER.ComputeSystem),container.bind(_identifier.IDENTIFIER.ForwardRenderPath).to(_Forward.ForwardRenderPath).inSingletonScope(),container.bind(_identifier.IDENTIFIER.ComputeStrategy).to(_ParticleComputeStrategy.ParticleComputeStrategy).whenTargetNamed("particle"),container.bind(_identifier.IDENTIFIER.ComputeStrategy).to(_LayoutComputeStrategy.LayoutComputeStrategy).whenTargetNamed("layout")},804:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(40),__webpack_require__(16),__webpack_require__(86),__webpack_require__(6),__webpack_require__(64),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(48),__webpack_require__(9),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayoutComputeStrategy=void 0;var _dec,_dec2,_class,_class2,_descriptor,_inversify=__webpack_require__(37),_identifier=__webpack_require__(41);function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var LayoutComputeStrategy=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}((_class2=function(){function LayoutComputeStrategy(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LayoutComputeStrategy),this.component=void 0,function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}(this,"engine",_descriptor,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(LayoutComputeStrategy,[{key:"init",value:function(){var _this=this,component=this.component;if(this.engine.supportWebGPU){component.particleBuffers=[this.engine.createVertexBuffer(component.particleData,128)],component.bindings.forEach((function(binding){"uniform-buffer"===binding.type&&binding.data?binding.buffer=_this.engine.createUniformBuffer(binding.data):"storage-buffer"===binding.type&&binding.data&&(binding.buffer=_this.engine.createVertexBuffer(binding.data,128))}));var computeBindGroupLayout=this.engine.getDevice().createBindGroupLayout({entries:[{binding:0,visibility:4,type:"storage-buffer"}].concat(_toConsumableArray(component.bindings.map((function(binding){return{binding:binding.binding,visibility:4,type:binding.type}}))))});component.pipelineLayout=this.engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]}),component.particleBindGroups[0]=this.engine.getDevice().createBindGroup({layout:computeBindGroupLayout,entries:[{binding:0,resource:{buffer:component.particleBuffers[0],offset:0,size:component.particleData.byteLength}}].concat(_toConsumableArray(component.bindings.map((function(binding){var _binding$data;return{binding:binding.binding,resource:{buffer:binding.buffer,offset:0,size:(null===(_binding$data=binding.data)||void 0===_binding$data?void 0:_binding$data.byteLength)||0}}}))))})}}},{key:"run",value:function(){for(;this.component.iteration<=this.component.maxIteration;)this.engine.dispatch(this.component.particleCount),this.component.iteration++}},{key:"getBindingGroup",value:function(){return this.component.particleBindGroups[0]}},{key:"getGPUBuffer",value:function(){return this.component.particleBuffers[0]}},{key:"destroy",value:function(){this.component.particleBuffers[0]&&this.component.particleBuffers[0].destroy()}}]),LayoutComputeStrategy}()).prototype,"engine",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.LayoutComputeStrategy=LayoutComputeStrategy},805:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(40),__webpack_require__(16),__webpack_require__(86),__webpack_require__(6),__webpack_require__(64),__webpack_require__(34),__webpack_require__(32),__webpack_require__(17),__webpack_require__(2),__webpack_require__(48),__webpack_require__(9),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParticleComputeStrategy=void 0;var _dec,_dec2,_class,_class2,_descriptor,_inversify=__webpack_require__(37),_identifier=__webpack_require__(41);function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var ParticleComputeStrategy=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}((_class2=function(){function ParticleComputeStrategy(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParticleComputeStrategy),this.component=void 0,function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}(this,"engine",_descriptor,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(ParticleComputeStrategy,[{key:"init",value:function(){var _this=this,component=this.component;component.particleBuffers=[this.engine.createVertexBuffer(component.particleData,128),this.engine.createVertexBuffer(component.particleData,128)],component.bindings.forEach((function(binding){"uniform-buffer"===binding.type&&binding.data?binding.buffer=_this.engine.createUniformBuffer(binding.data):"storage-buffer"===binding.type&&binding.data&&(binding.buffer=_this.engine.createVertexBuffer(binding.data,128))}));var computeBindGroupLayout=this.engine.getDevice().createBindGroupLayout({entries:[{binding:0,visibility:4,type:"storage-buffer"},{binding:1,visibility:4,type:"storage-buffer"}].concat(_toConsumableArray(component.bindings.map((function(binding){return{binding:binding.binding,visibility:4,type:binding.type}}))))});component.pipelineLayout=this.engine.getDevice().createPipelineLayout({bindGroupLayouts:[computeBindGroupLayout]});for(var i=0;2>i;i++)component.particleBindGroups[i]=this.engine.getDevice().createBindGroup({layout:computeBindGroupLayout,entries:[{binding:0,resource:{buffer:component.particleBuffers[i],offset:0,size:component.particleData.byteLength}},{binding:1,resource:{buffer:component.particleBuffers[(i+1)%2],offset:0,size:component.particleData.byteLength}}].concat(_toConsumableArray(component.bindings.map((function(binding){var _binding$data;return{binding:binding.binding,resource:{buffer:binding.buffer,offset:0,size:(null===(_binding$data=binding.data)||void 0===_binding$data?void 0:_binding$data.byteLength)||0}}}))))})}},{key:"run",value:function(){this.engine.dispatch(this.component.particleCount),this.component.iteration++}},{key:"getBindingGroup",value:function(){return this.component.particleBindGroups[this.component.iteration%2]}},{key:"getGPUBuffer",value:function(){return this.component.particleBuffers[this.component.iteration%2]}},{key:"destroy",value:function(){this.component.particleBuffers.forEach((function(buffer){return buffer.destroy()}))}}]),ParticleComputeStrategy}()).prototype,"engine",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.ParticleComputeStrategy=ParticleComputeStrategy},806:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.PassNodeComponent=void 0;var PassNodeComponent=function(_Component){function PassNodeComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PassNodeComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(PassNodeComponent).call(this,data))).writer=void 0,_this.inputResources=[],_this.outputResources=[],_this.nexts=[],_this.prevs=[],_this.compiled=!1,_this.ref=0,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(PassNodeComponent,_Component),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(PassNodeComponent,[{key:"setup",value:function(){}},{key:"execute",value:function(){}}]),PassNodeComponent}(__webpack_require__(24).Component);exports.PassNodeComponent=PassNodeComponent},807:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResourceHandleComponent=void 0;var _=__webpack_require__(24),_Entity=__webpack_require__(159);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ResourceHandleComponent=function(_Component){function ResourceHandleComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ResourceHandleComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(ResourceHandleComponent).call(this,data))).writer=void 0,_this.writer=data.writer||_Entity.EMPTY,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(ResourceHandleComponent,_Component),ResourceHandleComponent}(_.Component);exports.ResourceHandleComponent=ResourceHandleComponent},808:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.GeometryComponent=void 0;var GeometryComponent=function(_Component){function GeometryComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GeometryComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(GeometryComponent).call(this,data))).dirty=!0,_this.attributes=[],_this.indices=void 0,_this.indicesBuffer=void 0,_this.vertexCount=void 0,_this.maxInstancedCount=void 0,_this.aabb=void 0,Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(GeometryComponent,_Component),GeometryComponent}(__webpack_require__(24).Component);exports.GeometryComponent=GeometryComponent},809:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4),__webpack_require__(393),__webpack_require__(67),__webpack_require__(16),__webpack_require__(64),__webpack_require__(34),__webpack_require__(32),__webpack_require__(66),__webpack_require__(106),__webpack_require__(107),__webpack_require__(17),__webpack_require__(18),Object.defineProperty(exports,"__esModule",{value:!0}),exports.ForwardRenderPath=void 0;var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_dec8,_dec9,_dec10,_dec11,_class,_class2,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_glMatrix=__webpack_require__(38),_inversify=__webpack_require__(37),_identifier=__webpack_require__(41);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _initializerDefineProperty(target,property,descriptor,context){descriptor&&Object.defineProperty(target,property,{enumerable:descriptor.enumerable,configurable:descriptor.configurable,writable:descriptor.writable,value:descriptor.initializer?descriptor.initializer.call(context):void 0})}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach((function(key){desc[key]=descriptor[key]})),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce((function(desc,decorator){return decorator(target,property,desc)||desc}),desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var ForwardRenderPath=(_dec=(0,_inversify.injectable)(),_dec2=(0,_inversify.inject)(_identifier.IDENTIFIER.SceneComponentManager),_dec3=(0,_inversify.inject)(_identifier.IDENTIFIER.CameraComponentManager),_dec4=(0,_inversify.inject)(_identifier.IDENTIFIER.MeshComponentManager),_dec5=(0,_inversify.inject)(_identifier.IDENTIFIER.GeometryComponentManager),_dec6=(0,_inversify.inject)(_identifier.IDENTIFIER.MaterialComponentManager),_dec7=(0,_inversify.inject)(_identifier.IDENTIFIER.CullableComponentManager),_dec8=(0,_inversify.inject)(_identifier.IDENTIFIER.TransformComponentManager),_dec9=(0,_inversify.inject)(_identifier.IDENTIFIER.Systems),_dec10=(0,_inversify.named)(_identifier.IDENTIFIER.MaterialSystem),_dec11=(0,_inversify.inject)(_identifier.IDENTIFIER.RenderEngine),_dec((_descriptor=_applyDecoratedDescriptor((_class2=function(){function ForwardRenderPath(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ForwardRenderPath),_initializerDefineProperty(this,"scene",_descriptor,this),_initializerDefineProperty(this,"camera",_descriptor2,this),_initializerDefineProperty(this,"mesh",_descriptor3,this),_initializerDefineProperty(this,"geometry",_descriptor4,this),_initializerDefineProperty(this,"material",_descriptor5,this),_initializerDefineProperty(this,"cullable",_descriptor6,this),_initializerDefineProperty(this,"transform",_descriptor7,this),_initializerDefineProperty(this,"materialSystem",_descriptor8,this),_initializerDefineProperty(this,"engine",_descriptor9,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(ForwardRenderPath,[{key:"render",value:function(){var _this=this;this.scene.forEach((function(sceneEntity,scene){var camera=_this.camera.getComponentByEntity(scene.camera),viewMatrix=camera.getViewTransform(),viewProjectionMatrix=_glMatrix.mat4.multiply(_glMatrix.mat4.create(),camera.getPerspective(),viewMatrix);camera.getFrustum().extractFromVPMatrix(viewProjectionMatrix),scene.meshes.forEach((function(meshEntity){var _this$cullable$getCom;if(null===(_this$cullable$getCom=_this.cullable.getComponentByEntity(meshEntity))||void 0===_this$cullable$getCom?void 0:_this$cullable$getCom.visible){var mesh=_this.mesh.getComponentByEntity(meshEntity),material=_this.material.getComponentByEntity(mesh.material),geometry=_this.geometry.getComponentByEntity(mesh.geometry);if(!material.dirty&&!geometry.dirty){var transform=_this.transform.getComponentByEntity(meshEntity);if(transform){var modelViewMatrix=_glMatrix.mat4.multiply(_glMatrix.mat4.create(),viewMatrix,transform.worldTransform);_this.materialSystem.setUniform(mesh.material,"projectionMatrix",camera.getPerspective()),_this.materialSystem.setUniform(mesh.material,"modelViewMatrix",modelViewMatrix)}if(material.uniforms.forEach((function(binding){binding.uniforms.forEach((function(uniform){uniform.dirty&&_this.materialSystem.setUniform(mesh.material,uniform.name,uniform.data,!0)}))})),_this.engine.setRenderBindGroups([material.uniformBindGroup]),geometry.attributes.length){var vertexBuffers=geometry.attributes.map((function(attribute){return attribute.buffer?attribute.buffer:attribute.bufferGetter?attribute.bufferGetter():null})).filter((function(v){return v}));_this.engine.bindVertexInputs({indexBuffer:geometry.indicesBuffer,indexOffset:0,vertexStartSlot:0,vertexBuffers:vertexBuffers,vertexOffsets:Array(vertexBuffers.length).fill(0)})}geometry.indices&&geometry.indices.length?_this.engine.drawElementsType("render-".concat(meshEntity,"-elements"),_objectSpread({layout:material.pipelineLayout},material.stageDescriptor,{primitiveTopology:material.primitiveTopology||"triangle-list",vertexState:{indexFormat:"uint32",vertexBuffers:geometry.attributes.map((function(attribute){return{arrayStride:attribute.arrayStride,stepMode:attribute.stepMode,attributes:attribute.attributes}}))},rasterizationState:material.rasterizationState||{cullMode:"back"},depthStencilState:material.depthStencilState||{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},colorStates:material.colorStates}),0,geometry.indices.length,geometry.maxInstancedCount||1):_this.engine.drawArraysType("render-".concat(meshEntity,"-arrays"),_objectSpread({layout:material.pipelineLayout},material.stageDescriptor,{primitiveTopology:material.primitiveTopology||"triangle-list",vertexState:{vertexBuffers:geometry.attributes.map((function(attribute){return{arrayStride:attribute.arrayStride,stepMode:attribute.stepMode,attributes:attribute.attributes}}))},rasterizationState:material.rasterizationState||{cullMode:"back"},depthStencilState:material.depthStencilState||{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},colorStates:material.colorStates}),0,geometry.vertexCount||3,geometry.maxInstancedCount||1)}}}))}))}}]),ForwardRenderPath}()).prototype,"scene",[_dec2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class2.prototype,"camera",[_dec3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor3=_applyDecoratedDescriptor(_class2.prototype,"mesh",[_dec4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor4=_applyDecoratedDescriptor(_class2.prototype,"geometry",[_dec5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor5=_applyDecoratedDescriptor(_class2.prototype,"material",[_dec6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor6=_applyDecoratedDescriptor(_class2.prototype,"cullable",[_dec7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor7=_applyDecoratedDescriptor(_class2.prototype,"transform",[_dec8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor8=_applyDecoratedDescriptor(_class2.prototype,"materialSystem",[_dec9,_dec10],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_descriptor9=_applyDecoratedDescriptor(_class2.prototype,"engine",[_dec11],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_class=_class2))||_class);exports.ForwardRenderPath=ForwardRenderPath},810:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(35),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneComponent=void 0;var SceneComponent=function(_Component){function SceneComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SceneComponent),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(SceneComponent).call(this,data))).camera=void 0,_this.meshes=[],Object.assign(_assertThisInitialized(_this),data),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(SceneComponent,_Component),SceneComponent}(__webpack_require__(24).Component);exports.SceneComponent=SceneComponent},811:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.HierarchyComponent=void 0;var HierarchyComponent=function(_Component){function HierarchyComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HierarchyComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(HierarchyComponent).call(this,data))).parentID=void 0,_this.parentID=data.parentID||-1,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(HierarchyComponent,_Component),HierarchyComponent}(__webpack_require__(24).Component);exports.HierarchyComponent=HierarchyComponent},812:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(6),__webpack_require__(66),__webpack_require__(30),__webpack_require__(36),__webpack_require__(2),__webpack_require__(9),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.NameComponent=void 0;var NameComponent=function(_Component){function NameComponent(data){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NameComponent),(_this=_possibleConstructorReturn(this,_getPrototypeOf(NameComponent).call(this,data))).name=void 0,_this.name=data.name||"",_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(NameComponent,_Component),NameComponent}(__webpack_require__(24).Component);exports.NameComponent=NameComponent},813:function(module,exports,__webpack_require__){},814:function(module,exports,__webpack_require__){},815:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"WebGLEngine",{enumerable:!0,get:function(){return _webgl.WebGLEngine}}),Object.defineProperty(exports,"WebGPUEngine",{enumerable:!0,get:function(){return _webgpu.WebGPUEngine}});var _webgl=__webpack_require__(816),_webgpu=__webpack_require__(818)},816:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2),__webpack_require__(31),Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLEngine=void 0;var _class,_inversify=__webpack_require__(37),_regl=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(817));function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var WebGLEngine=(0,_inversify.injectable)()(_class=function(){function WebGLEngine(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLEngine),this.supportWebGPU=!1,this.canvas=void 0,this.options=void 0,this.gl=void 0,this.computeCommand=void 0,this.texInput=void 0,this.texOutput=void 0}var _readData,_compileComputePipelineStageDescriptor,_init;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(WebGLEngine,[{key:"init",value:(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee(canvas){var options,_this=this,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return options=1<_args.length&&void 0!==_args[1]?_args[1]:{},this.canvas=canvas,this.options=options,_context.next=5,new Promise((function(resolve,reject){(0,_regl.default)({container:_this.canvas,attributes:{alpha:!0,antialias:options.antialiasing,premultipliedAlpha:!0},extensions:["OES_element_index_uint","OES_standard_derivatives","OES_texture_float","WEBGL_depth_texture","angle_instanced_arrays","EXT_texture_filter_anisotropic"],optionalExtensions:["oes_texture_float_linear"],profile:!0,onDone:function(err,r){!err&&r||reject(err),resolve(r)}})}));case 5:this.gl=_context.sent;case 6:case"end":return _context.stop()}}),_callee,this)}))),function(){return _init.apply(this,arguments)})},{key:"compileComputePipelineStageDescriptor",value:(_compileComputePipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(computeCode,defines,data){var drawParams,_this2=this;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return this.texInput=this.gl.texture({width:960,height:1,data:data}),this.texOutput=this.gl.texture({width:960,height:1,data:data}),drawParams={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:(defines?defines+"\n":"")+computeCode,uniforms:{u_Data:function(){return _this2.texInput},u_TexSize:960,u_K:.8504989743232727,u_K2:.002411161782220006,u_MaxEdgePerVetex:50,u_Gravity:50,u_Speed:.1,u_MaxDisplace:21.799999237060547},vert:"attribute vec3 a_Position;\nattribute vec2 a_TexCoord;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  gl_Position = vec4(a_Position, 1.0);\n  v_TexCoord = a_TexCoord;\n}",primitive:"triangle strip",count:4},this.computeCommand=this.gl(drawParams),_context2.abrupt("return",{computeStage:{module:{label:"compute"},entryPoint:"main"}});case 5:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _compileComputePipelineStageDescriptor.apply(this,arguments)})},{key:"dispatch",value:function(){var _this3=this;this.texFBO=this.gl.framebuffer({color:this.texOutput}),this.texFBO.use((function(){_this3.computeCommand()}));var tmp=this.texOutput;this.texOutput=this.texInput,this.texInput=tmp}},{key:"readData",value:(_readData=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(srcBuffer,byteCount,arrayClazz){var pixels,_this4=this;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return this.gl({framebuffer:this.texFBO})((function(){pixels=_this4.gl.read()})),_context3.abrupt("return",new arrayClazz(pixels));case 2:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _readData.apply(this,arguments)})},{key:"setComputePipeline",value:function(){}},{key:"setComputeBindGroups",value:function(){}},{key:"clear",value:function(color){3<arguments.length&&void 0!==arguments[3]&&arguments[3],Array.isArray(color)||(color=[color.r,color.g,color.b,color.a]),this.gl.clear({color:color})}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}},{key:"dispose",value:function(){}}]),WebGLEngine}())||_class;exports.WebGLEngine=WebGLEngine},818:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}__webpack_require__(4),__webpack_require__(8),__webpack_require__(11),__webpack_require__(393),__webpack_require__(67),__webpack_require__(16),__webpack_require__(6),__webpack_require__(819),__webpack_require__(221),__webpack_require__(106),__webpack_require__(107),__webpack_require__(17),__webpack_require__(2),__webpack_require__(31),__webpack_require__(48),__webpack_require__(9),__webpack_require__(224),__webpack_require__(820),__webpack_require__(821),__webpack_require__(225),__webpack_require__(226),__webpack_require__(227),__webpack_require__(228),__webpack_require__(229),__webpack_require__(230),__webpack_require__(231),__webpack_require__(232),__webpack_require__(233),__webpack_require__(234),__webpack_require__(235),__webpack_require__(236),__webpack_require__(237),__webpack_require__(238),__webpack_require__(239),__webpack_require__(240),__webpack_require__(241),__webpack_require__(242),__webpack_require__(243),__webpack_require__(244),__webpack_require__(245),__webpack_require__(246),__webpack_require__(247),__webpack_require__(204),__webpack_require__(18),__webpack_require__(10),Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGPUEngine=void 0;var _class,WebGPUConstants=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(394)),_inversify=__webpack_require__(37),_glslang=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(822));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}var WebGPUEngine=(0,_inversify.injectable)()(_class=function(){function WebGPUEngine(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGPUEngine),this.supportWebGPU=!0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.pipelines={},this.computePipelines={},this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.commandBuffers=[,,,].fill(void 0),this.currentRenderPass=null,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.options=void 0,this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.computeEncoderDescriptor={label:"compute"}}var _initGlslang,_readData,_compileComputePipelineStageDescriptor,_compilePipelineStageDescriptor,_compileRawPipelineStageDescriptor,_init;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(WebGPUEngine,[{key:"getDevice",value:function(){return this.device}},{key:"getSwapChain",value:function(){return this.swapChain}},{key:"init",value:(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee(canvas){var options,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return options=1<_args.length&&void 0!==_args[1]?_args[1]:{},this.canvas=canvas,this.options=options,this.mainPassSampleCount=options.antialiasing?this.defaultSampleCount:1,_context.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return _context.stop()}}),_callee,this)}))),function(){return _init.apply(this,arguments)})},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor)}},{key:"endFrame",value:function(){this.endRenderPass(),this.options.supportCompute&&this.endComputePass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.commandBuffers[2]=this.computeEncoder.finish(),this.device.defaultQueue.submit(this.commandBuffers),this.tempBuffers.forEach((function(buffer){return buffer.destroy()})),this.tempBuffers=[]}},{key:"startRecordBundle",value:function(){this.bundleEncoder=this.device.createRenderBundleEncoder({colorFormats:[WebGPUConstants.TextureFormat.BGRA8Unorm],depthStencilFormat:WebGPUConstants.TextureFormat.Depth24PlusStencil8,sampleCount:this.mainPassSampleCount})}},{key:"stopRecordBundle",value:function(){var bundle=this.bundleEncoder.finish();return this.bundleEncoder=null,bundle}},{key:"executeBundles",value:function(bundles){var _this$currentRenderPa;this.currentRenderPass||this.startMainRenderPass(),null===(_this$currentRenderPa=this.currentRenderPass)||void 0===_this$currentRenderPa||_this$currentRenderPa.executeBundles(bundles)}},{key:"enableScissor",value:function(x,y,width,height){this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass.setScissorRect(x,y,width,height)}},{key:"disableScissor",value:function(){var _this$currentRenderPa2;this.currentRenderPass||this.startMainRenderPass(),null===(_this$currentRenderPa2=this.currentRenderPass)||void 0===_this$currentRenderPa2||_this$currentRenderPa2.setScissorRect(0,0,this.canvas.width,this.canvas.height)}},{key:"setSize",value:function(){this.initMainAttachments()}},{key:"clear",value:function(color,backBuffer,depth){var stencil=3<arguments.length&&void 0!==arguments[3]&&arguments[3];this.mainColorAttachments[0].loadValue=backBuffer?color:WebGPUConstants.LoadOp.Load,this.mainDepthAttachment.depthLoadValue=depth?this.clearDepthValue:WebGPUConstants.LoadOp.Load,this.mainDepthAttachment.stencilLoadValue=stencil?this.clearStencilValue:WebGPUConstants.LoadOp.Load,this.startMainRenderPass(),this.options.supportCompute&&this.startComputePass()}},{key:"dispose",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy()}},{key:"compileRawPipelineStageDescriptor",value:(_compileRawPipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(vertexCode,fragmentCode){var vertexShader,fragmentShader;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.compileRawShaderToSpirV(vertexCode,"vertex");case 2:return vertexShader=_context2.sent,_context2.next=5,this.compileRawShaderToSpirV(fragmentCode,"fragment");case 5:return fragmentShader=_context2.sent,_context2.abrupt("return",this.createPipelineStageDescriptor(vertexShader,fragmentShader));case 7:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _compileRawPipelineStageDescriptor.apply(this,arguments)})},{key:"compilePipelineStageDescriptor",value:(_compilePipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(vertexCode,fragmentCode,defines){var shaderVersion,vertexShader,fragmentShader;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return shaderVersion="#version 450\n",_context3.next=3,this.compileShaderToSpirV(vertexCode,"vertex",defines,shaderVersion);case 3:return vertexShader=_context3.sent,_context3.next=6,this.compileShaderToSpirV(fragmentCode,"fragment",defines,shaderVersion);case 6:return fragmentShader=_context3.sent,_context3.abrupt("return",this.createPipelineStageDescriptor(vertexShader,fragmentShader));case 8:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _compilePipelineStageDescriptor.apply(this,arguments)})},{key:"compileComputePipelineStageDescriptor",value:(_compileComputePipelineStageDescriptor=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(computeCode,defines){var computeShader;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=3,this.compileShaderToSpirV(computeCode,"compute",defines,"#version 450\n");case 3:return computeShader=_context4.sent,_context4.abrupt("return",{computeStage:{module:this.device.createShaderModule({code:computeShader}),entryPoint:"main"}});case 5:case"end":return _context4.stop()}}),_callee4,this)}))),function(){return _compileComputePipelineStageDescriptor.apply(this,arguments)})},{key:"drawElementsType",value:function(pipelineName,descriptor,indexStart,indexCount){var instancesCount=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,renderPass=this.bundleEncoder||this.currentRenderPass;this.setRenderPipeline(pipelineName,descriptor),renderPass.drawIndexed(indexCount,instancesCount,indexStart,0,0)}},{key:"drawArraysType",value:function(pipelineName,descriptor,verticesStart,verticesCount){var instancesCount=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,renderPass=this.bundleEncoder||this.currentRenderPass;this.setRenderPipeline(pipelineName,descriptor),renderPass.draw(verticesCount,instancesCount,verticesStart,0)}},{key:"createVertexBuffer",value:function(data){var view,usage=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;view=data instanceof Array?new Float32Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data;var dataBuffer=this.createBuffer(view,WebGPUConstants.BufferUsage.Vertex|WebGPUConstants.BufferUsage.CopyDst|WebGPUConstants.BufferUsage.CopySrc|usage);return dataBuffer}},{key:"createUniformBuffer",value:function(data){var view;return view=data instanceof Array?new Float32Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data,this.createBuffer(view,WebGPUConstants.BufferUsage.Uniform|WebGPUConstants.BufferUsage.CopyDst)}},{key:"createIndexBuffer",value:function(data){var view;return view=data instanceof Array?new Uint16Array(data):data instanceof ArrayBuffer?new Uint8Array(data):data,this.createBuffer(view,WebGPUConstants.BufferUsage.Index|WebGPUConstants.BufferUsage.CopyDst)}},{key:"setRenderBindGroups",value:function(bindGroups){for(var renderPass=this.bundleEncoder||this.currentRenderPass,i=0;i<bindGroups.length;i++)renderPass.setBindGroup(i,bindGroups[i])}},{key:"setComputeBindGroups",value:function(bindGroups){if(this.currentComputePass)for(var i=0;i<bindGroups.length;i++)this.currentComputePass.setBindGroup(i,bindGroups[i])}},{key:"setComputePipeline",value:function(computePipelineName,descriptor){var _this$currentComputeP;if(!this.computePipelines[computePipelineName]){var computePipeline=this.device.createComputePipeline(descriptor);this.computePipelines[computePipelineName]=computePipeline}null===(_this$currentComputeP=this.currentComputePass)||void 0===_this$currentComputeP||_this$currentComputeP.setPipeline(this.computePipelines[computePipelineName])}},{key:"setSubData",value:function(destBuffer,destOffset,srcArrayBuffer){var byteCount=srcArrayBuffer.byteLength,_this$device$createBu2=_slicedToArray(this.device.createBufferMapped({size:byteCount,usage:WebGPUConstants.BufferUsage.CopySrc}),2),srcBuffer=_this$device$createBu2[0],arrayBuffer=_this$device$createBu2[1];new Uint8Array(arrayBuffer).set(new Uint8Array(srcArrayBuffer.buffer)),srcBuffer.unmap(),this.uploadEncoder.copyBufferToBuffer(srcBuffer,0,destBuffer,destOffset,byteCount),this.tempBuffers.push(srcBuffer)}},{key:"readData",value:(_readData=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(srcBuffer,byteCount,arrayClazz){var gpuReadBuffer,arraybuffer;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return gpuReadBuffer=this.device.createBuffer({size:byteCount,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),this.uploadEncoder.copyBufferToBuffer(srcBuffer,0,gpuReadBuffer,0,byteCount),this.commandBuffers[0]=this.uploadEncoder.finish(),this.device.defaultQueue.submit(this.commandBuffers),this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),_context5.next=7,gpuReadBuffer.mapReadAsync();case 7:return arraybuffer=_context5.sent,this.tempBuffers.push(gpuReadBuffer),_context5.abrupt("return",new arrayClazz(arraybuffer));case 10:case"end":return _context5.stop()}}),_callee5,this)}))),function(){return _readData.apply(this,arguments)})},{key:"bindVertexInputs",value:function(vertexInputs){var renderPass=this.bundleEncoder||this.currentRenderPass;vertexInputs.indexBuffer&&renderPass.setIndexBuffer(vertexInputs.indexBuffer,vertexInputs.indexOffset);for(var i=0;i<vertexInputs.vertexBuffers.length;i++)vertexInputs.vertexBuffers[i]&&renderPass.setVertexBuffer(vertexInputs.vertexStartSlot+i,vertexInputs.vertexBuffers[i],vertexInputs.vertexOffsets[i])}},{key:"dispatch",value:function(num){this.currentComputePass&&this.currentComputePass.dispatch(num)}},{key:"createBuffer",value:function(view,flags){var padding=view.byteLength%4,verticesBufferDescriptor={size:view.byteLength+padding,usage:flags},buffer=this.device.createBuffer(verticesBufferDescriptor);return this.setSubData(buffer,0,view),buffer}},{key:"initGlslang",value:(_initGlslang=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var _navigator,_navigator$gpu;return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,(0,_glslang.default)();case 2:return this.glslang=_context6.sent,_context6.next=5,null===(_navigator=navigator)||void 0===_navigator||null===(_navigator$gpu=_navigator.gpu)||void 0===_navigator$gpu?void 0:_navigator$gpu.requestAdapter();case 5:return this.adapter=_context6.sent,_context6.next=8,this.adapter.requestDevice();case 8:this.device=_context6.sent;case 9:case"end":return _context6.stop()}}),_callee6,this)}))),function(){return _initGlslang.apply(this,arguments)})},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext("gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:WebGPUConstants.TextureUsage.OutputAttachment|WebGPUConstants.TextureUsage.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var mainTextureDescriptor={size:this.mainTextureExtends,arrayLayerCount:1,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:WebGPUConstants.TextureDimension.E2d,format:WebGPUConstants.TextureFormat.BGRA8Unorm,usage:WebGPUConstants.TextureUsage.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(mainTextureDescriptor),this.mainColorAttachments=[{attachment:this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:WebGPUConstants.StoreOp.Store}]}else this.mainColorAttachments=[{attachment:this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:WebGPUConstants.StoreOp.Store}];var depthTextureDescriptor={size:this.mainTextureExtends,arrayLayerCount:1,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:WebGPUConstants.TextureDimension.E2d,format:WebGPUConstants.TextureFormat.Depth24PlusStencil8,usage:WebGPUConstants.TextureUsage.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(depthTextureDescriptor),this.mainDepthAttachment={attachment:this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:WebGPUConstants.StoreOp.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:WebGPUConstants.StoreOp.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&this.endRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment})}},{key:"endRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.currentRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"setRenderPipeline",value:function(name,descriptor){var renderPass=this.bundleEncoder||this.currentRenderPass,pipeline=this.getRenderPipeline(name,descriptor);pipeline&&renderPass.setPipeline(pipeline)}},{key:"compileRawShaderToSpirV",value:function(source,type){return this.glslang.compileGLSL(source,type)}},{key:"compileShaderToSpirV",value:function(source,type,defines,shaderVersion){return this.compileRawShaderToSpirV(shaderVersion+(defines?defines+"\n":"")+source,type)}},{key:"createPipelineStageDescriptor",value:function(vertexShader,fragmentShader){return{vertexStage:{module:this.device.createShaderModule({code:vertexShader}),entryPoint:"main"},fragmentStage:{module:this.device.createShaderModule({code:fragmentShader}),entryPoint:"main"}}}},{key:"getRenderPipeline",value:function(name,descriptor){if(this.pipelines[name])return this.pipelines[name];var primitiveTopology=descriptor.primitiveTopology,rasterizationState=descriptor.rasterizationState,depthStencilState=descriptor.depthStencilState,colorStates=descriptor.colorStates,vertexStage=descriptor.vertexStage,fragmentStage=descriptor.fragmentStage,vertexState=descriptor.vertexState,layout=descriptor.layout;if(vertexStage&&fragmentStage){var renderPipeline=this.device.createRenderPipeline({sampleCount:this.mainPassSampleCount,primitiveTopology:primitiveTopology||"triangle-list",rasterizationState:_objectSpread({},this.getDefaultRasterizationStateDescriptor(),{},rasterizationState),depthStencilState:_objectSpread({},this.getDefaultDepthStencilStateDescriptor(),{},depthStencilState),colorStates:colorStates||this.getDefaultColorStateDescriptors(),layout:layout,vertexStage:vertexStage,fragmentStage:fragmentStage,vertexState:vertexState});return this.pipelines[name]=renderPipeline,renderPipeline}return null}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:WebGPUConstants.FrontFace.CCW,cullMode:WebGPUConstants.CullMode.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"getDefaultDepthStencilStateDescriptor",value:function(){var stencilFrontBack={compare:WebGPUConstants.CompareFunction.Always,depthFailOp:WebGPUConstants.StencilOperation.Keep,failOp:WebGPUConstants.StencilOperation.Keep,passOp:WebGPUConstants.StencilOperation.Keep};return{depthWriteEnabled:!1,depthCompare:WebGPUConstants.CompareFunction.Always,format:WebGPUConstants.TextureFormat.Depth24PlusStencil8,stencilFront:stencilFrontBack,stencilBack:stencilFrontBack,stencilReadMask:4294967295,stencilWriteMask:4294967295}}},{key:"getDefaultColorStateDescriptors",value:function(){return[{format:this.options.swapChainFormat,alphaBlend:{srcFactor:WebGPUConstants.BlendFactor.One,dstFactor:WebGPUConstants.BlendFactor.Zero,operation:WebGPUConstants.BlendOperation.Add},colorBlend:{srcFactor:WebGPUConstants.BlendFactor.One,dstFactor:WebGPUConstants.BlendFactor.Zero,operation:WebGPUConstants.BlendOperation.Add},writeMask:WebGPUConstants.ColorWrite.All}]}}]),WebGPUEngine}())||_class;exports.WebGPUEngine=WebGPUEngine},822:function(module,exports,__webpack_require__){"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var glslang;function _ref(){return(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var glslangModule;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!glslang){_context.next=2;break}return _context.abrupt("return",glslang);case 2:return _context.next=4,import("https://cdn.jsdelivr.net/npm/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js");case 4:return glslangModule=_context.sent,_context.next=7,glslangModule.default();case 7:return glslang=_context.sent,_context.abrupt("return",glslang);case 9:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}__webpack_require__(2),__webpack_require__(31),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function _default(){return _ref.apply(this,arguments)}},823:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function Flocking(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Flocking,_super),Flocking.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,vertexBufferData,simParamData,initialParticleData,i,compute_1,camera,scene,geometry,material,mesh,_this=this;return __generator(this,(function(_a){if(canvas=document.getElementById("application")){for(vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),simParamData=new Float32Array([.04,.1,.025,.025,.02,.05,.005]),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;this.world=new _gWebgpu.World(canvas,{engineOptions:{supportCompute:!0}}),compute_1=this.world.createComputePipeline({type:"particle",shader:"// @see https://github.com/austinEng/Project6-Vulkan-Flocking/blob/master/data/shaders/computeparticles/particle.comp\n\nstruct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) buffer ParticlesA {\n  Particle particles[PARTICLE_NUM];\n} particlesA;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesB {\n  Particle particles[PARTICLE_NUM];\n} particlesB;\n\nlayout(std140, set = 0, binding = 2) uniform SimParams {\n  float deltaT;\n  float rule1Distance;\n  float rule2Distance;\n  float rule3Distance;\n  float rule1Scale;\n  float rule2Scale;\n  float rule3Scale;\n} params;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= PARTICLE_NUM) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec2 cMass = vec2(0.0, 0.0);\n  vec2 cVel = vec2(0.0, 0.0);\n  vec2 colVel = vec2(0.0, 0.0);\n  int cMassCount = 0;\n  int cVelCount = 0;\n\n  vec2 pos;\n  vec2 vel;\n  for (int i = 0; i < PARTICLE_NUM; ++i) {\n    if (i == index) { continue; }\n    pos = particlesA.particles[i].pos.xy;\n    vel = particlesA.particles[i].vel.xy;\n\n    if (distance(pos, vPos) < params.rule1Distance) {\n      cMass += pos;\n      cMassCount++;\n    }\n    if (distance(pos, vPos) < params.rule2Distance) {\n      colVel -= (pos - vPos);\n    }\n    if (distance(pos, vPos) < params.rule3Distance) {\n      cVel += vel;\n      cVelCount++;\n    }\n  }\n  if (cMassCount > 0) {\n    cMass = cMass / cMassCount - vPos;\n  }\n  if (cVelCount > 0) {\n    cVel = cVel / cVelCount;\n  }\n\n  vVel += cMass * params.rule1Scale + colVel * params.rule2Scale + cVel * params.rule3Scale;\n\n  // clamp velocity for a more pleasing simulation.\n  vVel = normalize(vVel) * clamp(length(vVel), 0.0, 0.1);\n\n  // kinematic update\n  vPos += vVel * params.deltaT;\n\n  // Wrap around boundary\n  if (vPos.x < -1.0) vPos.x = 1.0;\n  if (vPos.x > 1.0) vPos.x = -1.0;\n  if (vPos.y < -1.0) vPos.y = 1.0;\n  if (vPos.y > 1.0) vPos.y = -1.0;\n\n  particlesB.particles[index].pos = vPos;\n\n  // Write back\n  particlesB.particles[index].vel = vVel;\n}",particleCount:1500,particleData:initialParticleData}),this.world.setBinding(compute_1,"simParams",simParamData,{binding:2,type:"uniform-buffer"}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:50,far:1e3,near:.1}),this.world.getCamera(camera).setPosition(0,0,2),scene=this.world.createScene({camera:camera}),geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:1500}),this.world.setAttribute(geometry,"particle",null,{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},(function(){return _this.world.getParticleBuffer(compute_1)})),this.world.setAttribute(geometry,"position",vertexBufferData,{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}),material=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = builtin.projectionMatrix * builtin.modelViewMatrix * vec4(pos + a_particlePos, 0, 1);\n}",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}"}),mesh=this.world.createMesh({geometry:geometry,material:material}),this.world.add(scene,mesh)}return[2]}))}))},Flocking.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Flocking.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600"})},Flocking}(React.Component);exports.default=_default},824:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},numParticles=0,numEdges=0,_default=function(_super){function Fruchterman(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.lineIndexBufferData=[],_this}return __extends(Fruchterman,_super),Fruchterman.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var data,nodes,edges,canvas,nodesEdgesArray,simParamData,compute,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch("https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json")];case 1:return[4,_a.sent().json()];case 2:return data=_a.sent(),nodes=data.nodes.map((function(n){return{x:(2*Math.random()-1)/10,y:(2*Math.random()-1)/10,id:n.id}})),edges=data.edges,(canvas=document.getElementById("application"))&&(numParticles=nodes.length,numEdges=edges.length,nodesEdgesArray=this.buildTextureData(nodes,edges),simParamData=new Float32Array([numParticles*numParticles/(numParticles+1)/300/300,Math.sqrt(numParticles*numParticles/(numParticles+1)/300),this.maxEdgePerVetex,50,.1,Math.sqrt(numParticles*numParticles)/10]),this.world=new _gWebgpu.World(canvas,{engineOptions:{supportCompute:!0}}),compute=this.world.createComputePipeline({type:"layout",shader:"// @see https://github.com/antvis/G6/blob/master/src/layout/fruchterman.ts\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js\n// @see https://github.com/l-l/UnityNetworkGraph/blob/master/Assets/Shaders/GraphCS.compute\n\n#define SPEED_DIVISOR 800.0\n\nlayout(std140, set = 0, binding = 0) buffer NodesEdges {\n  vec4 nodesEdges[];\n} nodesEdges;\n\nlayout(std140, set = 0, binding = 1) uniform SimParams {\n  float k2;\n  float k;\n  float maxEdgePerVetex;\n  float gravity;\n  float speed;\n  float maxDisplace;\n} params;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= PARTICLE_NUM) { return; }\n\n  vec4 currentNode = nodesEdges.nodesEdges[index];\n  float dx = 0.0, dy = 0.0;\n\n  // repulsive\n  for (int i = 0; i < PARTICLE_NUM; ++i) {\n    if (i == index) { continue; }\n    vec4 node = nodesEdges.nodesEdges[i];\n\n    float vecX = currentNode.r - node.r;\n    float vecY = currentNode.g - node.g;\n    float vecLengthSqr = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    if (vecLengthSqr > 0.0) {\n      float repulsiveF = params.k2 / vecLengthSqr;\n      dx += vecX / vecLengthSqr * repulsiveF;\n      dy += vecY / vecLengthSqr * repulsiveF;\n    }\n  }\n\n  // attractive\n  int arr_offset = int(floor(currentNode.b + 0.5));\n  int length = int(floor(currentNode.a + 0.5));\n  vec4 node_buffer;\n  for (int p = 0; p < params.maxEdgePerVetex; p++) {\n    if (p >= length) break;\n    int arr_idx = arr_offset + p;\n    // when arr_idx % 4 == 0 update node_idx_buffer\n    int buf_offset = arr_idx - arr_idx / 4 * 4;\n    if (p == 0 || buf_offset == 0) {\n      node_buffer = nodesEdges.nodesEdges[int(floor(arr_idx / 4 + 0.5))];\n    }\n    float float_j = buf_offset == 0 ? node_buffer.r :\n                    buf_offset == 1 ? node_buffer.g :\n                    buf_offset == 2 ? node_buffer.b :\n                                      node_buffer.a;\n    uint jIndex= uint(floor(float_j + 0.5));\n    vec4 node_j = nodesEdges.nodesEdges[jIndex];\n    \n    float vecX = currentNode.r - node_j.r;\n    float vecY = currentNode.g - node_j.g;\n    float vecLength = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    float attractiveF = (vecLength * vecLength) / params.k;\n    if (vecLength > 0.0) {\n      dx -= (vecX / vecLength) * attractiveF;\n      dy -= (vecY / vecLength) * attractiveF;\n    }\n  }\n\n  // gravity\n  float gf = 0.01 * params.k * params.gravity;\n  dx -= gf * currentNode.r;\n  dy -= gf * currentNode.g;\n\n  // speed\n  dx *= params.speed;\n  dy *= params.speed;\n\n  // move\n  float distLength = sqrt(dx * dx + dy * dy);\n  if (distLength > 0.0) {\n    float limitedDist = min(params.maxDisplace * params.speed, distLength);\n\n    nodesEdges.nodesEdges[index].r += dx / distLength * limitedDist;\n    nodesEdges.nodesEdges[index].g += dy / distLength * limitedDist;\n  }\n}",particleCount:numParticles,particleData:nodesEdgesArray,maxIteration:8e3,onCompleted:function onCompleted(finalParticleData){var scene=_this.createScene(canvas);_this.renderLines(scene,finalParticleData,nodes),_this.renderCircles(scene,finalParticleData,nodes)}}),this.world.setBinding(compute,"simParams",simParamData,{binding:1,type:"uniform-buffer"})),[2]}}))}))},Fruchterman.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Fruchterman.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600"})},Fruchterman.prototype.createScene=function(canvas){var camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:50,far:1e3,near:.1});return this.world.getCamera(camera).setPosition(0,0,2),this.world.createScene({camera:camera})},Fruchterman.prototype.renderCircles=function(scene,particleData,nodes){var geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:numParticles,vertexCount:6*numParticles}),extrudeData=[],colorData=[],sizeData=[];nodes.forEach((function(){colorData.push(198/255,229/255,1,1),sizeData.push(10),extrudeData.push(1,1,-1,1,-1,-1,1,1,-1,-1,1,-1)})),this.world.setAttribute(geometry,"particle",particleData,{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float4"}]}),this.world.setAttribute(geometry,"extrude",new Float32Array(extrudeData),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),this.world.setAttribute(geometry,"color",new Float32Array(colorData),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),this.world.setAttribute(geometry,"size",new Float32Array(sizeData),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]});var material=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec4 a_particlePos;\nlayout(location = 1) in vec2 a_extrude;\nlayout(location = 2) in vec4 a_color;\nlayout(location = 3) in float a_size;\n\nlayout(location = 0) out vec4 data;\nlayout(location = 1) out vec4 color;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nlayout(set = 0, binding = 1) uniform Uniforms {\n  float opacity;\n  float strokeWidth;\n  vec4 strokeColor;\n  float strokeOpacity;\n} uniforms;\n\nvoid main() {\n  float radius = a_size;\n  vec2 offset = a_extrude * (radius + uniforms.strokeWidth) / 600;\n\n  gl_Position = builtin.projectionMatrix\n    * builtin.modelViewMatrix\n    * vec4(a_particlePos.xy + offset, 0, 1);\n\n  // anti-alias\n  float antialiasblur = 1.0 / (radius + uniforms.strokeWidth) * 4.0;\n\n  // construct point coords\n  data = vec4(a_extrude, antialiasblur, radius);\n  color = a_color;\n}",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nlayout(location = 0) in vec4 data;\nlayout(location = 1) in vec4 color;\n\nlayout(set = 0, binding = 0) uniform Uniforms {\n  float opacity;\n  float strokeWidth;\n  vec4 strokeColor;\n  float strokeOpacity;\n} uniforms;\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nvoid main() {\n  float antialiasblur = data.z;\n  float antialiased_blur = -max(0.0, antialiasblur);\n  float r = data.w / (data.w + uniforms.strokeWidth);\n\n  float outer_df = sdCircle(data.xy, 1.0);\n  float inner_df = sdCircle(data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n  \n  float color_t = smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n  vec4 strokeColor = vec4(1., 0., 0., 1.0);\n\n  fragColor = opacity_t * mix(\n    vec4(color.rgb, color.a * uniforms.opacity), strokeColor * uniforms.strokeOpacity, color_t);\n}",rasterizationState:{cullMode:"none"},depthStencilState:{depthWriteEnabled:!1},colorStates:[{format:"bgra8unorm",colorBlend:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alphaBlend:{srcFactor:"one",dstFactor:"one",operation:"add"}}]});this.world.addUniform(material,{binding:1,name:"opacity",format:"float",data:Float32Array.from([1]),dirty:!0}),this.world.addUniform(material,{binding:1,name:"strokeWidth",format:"float",data:Float32Array.from([2]),dirty:!0}),this.world.addUniform(material,{binding:1,name:"strokeColor",format:"float4",data:Float32Array.from([1,1,0,1]),dirty:!0}),this.world.addUniform(material,{binding:1,name:"strokeOpacity",format:"float",data:Float32Array.from([.8]),dirty:!0});var mesh=this.world.createMesh({geometry:geometry,material:material});this.world.add(scene,mesh)},Fruchterman.prototype.renderLines=function(scene,particleData,nodes){var geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:1,vertexCount:2*numEdges});this.world.setAttribute(geometry,"particle",particleData,{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float4"}]}),this.world.setIndex(geometry,new Uint32Array(this.lineIndexBufferData));var material=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec4 a_particlePos;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nvoid main() {\n  gl_Position = builtin.projectionMatrix\n    * builtin.modelViewMatrix\n    * vec4(a_particlePos.xy, 0, 1);\n}",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(vec3(102.0 / 255.0), 0.5);\n}",primitiveTopology:"line-list"}),mesh=this.world.createMesh({geometry:geometry,material:material});this.world.add(scene,mesh)},Fruchterman.prototype.buildTextureData=function(nodes,edges){var dataArray=[],nodeDict=[],mapIdPos={},i=0;for(i=0;i<nodes.length;i++){var n=nodes[i];mapIdPos[n.id]=i,dataArray.push(n.x),dataArray.push(n.y),dataArray.push(0),dataArray.push(0),nodeDict.push([])}for(i=0;i<edges.length;i++){var e=edges[i];nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]),nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]),this.lineIndexBufferData.push(mapIdPos[e.source],mapIdPos[e.target])}for(this.maxEdgePerVetex=0,i=0;i<nodes.length;i++){var offset=dataArray.length,dests=nodeDict[i],len=dests.length;dataArray[4*i+2]=offset,dataArray[4*i+3]=dests.length,this.maxEdgePerVetex=Math.max(this.maxEdgePerVetex,dests.length);for(var j=0;j<len;++j){var dest=dests[j];dataArray.push(+dest)}}for(;dataArray.length%4!=0;)dataArray.push(0);return new Float32Array(dataArray)},Fruchterman}(React.Component);exports.default=_default},825:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gCanvas=__webpack_require__(853),_gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},numParticles=0,_default=function(_super){function Fruchterman(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.lineIndexBufferData=[],_this}return __extends(Fruchterman,_super),Fruchterman.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var data,nodes,edges,canvas,nodesEdgesArray,simParamData,compute,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch("https://gw.alipayobjects.com/os/basement_prod/7bacd7d1-4119-4ac1-8be3-4c4b9bcbc25f.json")];case 1:return[4,_a.sent().json()];case 2:return data=_a.sent(),nodes=data.nodes.map((function(n){return{x:(2*Math.random()-1)/10,y:(2*Math.random()-1)/10,id:n.id}})),edges=data.edges,(canvas=document.getElementById("application"))&&(numParticles=nodes.length,edges.length,nodesEdgesArray=this.buildTextureData(nodes,edges),simParamData=new Float32Array([numParticles*numParticles/(numParticles+1)/300/300,Math.sqrt(numParticles*numParticles/(numParticles+1)/300),this.maxEdgePerVetex,50,.1,Math.sqrt(numParticles*numParticles)/10]),this.world=new _gWebgpu.World(canvas,{engineOptions:{supportCompute:!0}}),compute=this.world.createComputePipeline({type:"layout",shader:"// @see https://github.com/antvis/G6/blob/master/src/layout/fruchterman.ts\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js\n// @see https://github.com/l-l/UnityNetworkGraph/blob/master/Assets/Shaders/GraphCS.compute\n\n#define SPEED_DIVISOR 800.0\n\nlayout(std140, set = 0, binding = 0) buffer NodesEdges {\n  vec4 nodesEdges[];\n} nodesEdges;\n\nlayout(std140, set = 0, binding = 1) uniform SimParams {\n  float k2;\n  float k;\n  float maxEdgePerVetex;\n  float gravity;\n  float speed;\n  float maxDisplace;\n} params;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= PARTICLE_NUM) { return; }\n\n  vec4 currentNode = nodesEdges.nodesEdges[index];\n  float dx = 0.0, dy = 0.0;\n\n  // repulsive\n  for (int i = 0; i < PARTICLE_NUM; ++i) {\n    if (i == index) { continue; }\n    vec4 node = nodesEdges.nodesEdges[i];\n\n    float vecX = currentNode.r - node.r;\n    float vecY = currentNode.g - node.g;\n    float vecLengthSqr = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    if (vecLengthSqr > 0.0) {\n      float repulsiveF = params.k2 / vecLengthSqr;\n      dx += vecX / vecLengthSqr * repulsiveF;\n      dy += vecY / vecLengthSqr * repulsiveF;\n    }\n  }\n\n  // attractive\n  int arr_offset = int(floor(currentNode.b + 0.5));\n  int length = int(floor(currentNode.a + 0.5));\n  vec4 node_buffer;\n  for (int p = 0; p < params.maxEdgePerVetex; p++) {\n    if (p >= length) break;\n    int arr_idx = arr_offset + p;\n    // when arr_idx % 4 == 0 update node_idx_buffer\n    int buf_offset = arr_idx - arr_idx / 4 * 4;\n    if (p == 0 || buf_offset == 0) {\n      node_buffer = nodesEdges.nodesEdges[int(floor(arr_idx / 4 + 0.5))];\n    }\n    float float_j = buf_offset == 0 ? node_buffer.r :\n                    buf_offset == 1 ? node_buffer.g :\n                    buf_offset == 2 ? node_buffer.b :\n                                      node_buffer.a;\n    uint jIndex= uint(floor(float_j + 0.5));\n    vec4 node_j = nodesEdges.nodesEdges[jIndex];\n    \n    float vecX = currentNode.r - node_j.r;\n    float vecY = currentNode.g - node_j.g;\n    float vecLength = sqrt(vecX * vecX + vecY * vecY) + 0.01;\n    float attractiveF = (vecLength * vecLength) / params.k;\n    if (vecLength > 0.0) {\n      dx -= (vecX / vecLength) * attractiveF;\n      dy -= (vecY / vecLength) * attractiveF;\n    }\n  }\n\n  // gravity\n  float gf = 0.01 * params.k * params.gravity;\n  dx -= gf * currentNode.r;\n  dy -= gf * currentNode.g;\n\n  // speed\n  dx *= params.speed;\n  dy *= params.speed;\n\n  // move\n  float distLength = sqrt(dx * dx + dy * dy);\n  if (distLength > 0.0) {\n    float limitedDist = min(params.maxDisplace * params.speed, distLength);\n\n    nodesEdges.nodesEdges[index].r += dx / distLength * limitedDist;\n    nodesEdges.nodesEdges[index].g += dy / distLength * limitedDist;\n  }\n}",shaderInWebGL:"// GLSL 1.0 used as Fragment Shader in WebGL\n// @see https://github.com/antvis/G6/blob/master/src/layout/fruchterman.ts\n// @see https://github.com/nblintao/ParaGraphL/blob/master/sigma.layout.paragraphl.js\n// @see https://github.com/l-l/UnityNetworkGraph/blob/master/Assets/Shaders/GraphCS.compute\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#define SPEED_DIVISOR 800.0\n#define MAX_EDGE_PER_VERTEX 50\n\nuniform sampler2D u_Data;\n\nuniform float u_TexSize;\nuniform float u_K;\nuniform float u_K2;\nuniform int u_MaxEdgePerVetex;\nuniform float u_Gravity;\nuniform float u_Speed;\nuniform float u_MaxDisplace;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  int i = int(floor(v_TexCoord.s * u_TexSize + 0.5));\n  vec4 node_i = texture2D(u_Data, vec2(v_TexCoord.s, 1));\n  float dx = 0.0, dy = 0.0;\n  gl_FragColor = node_i;\n\n  if (i > PARTICLE_NUM) { return; }\n\n  // repulsive\n  for (int j = 0; j < PARTICLE_NUM; j++) {\n    if (i != j + 1) {\n      vec4 node_j = texture2D(u_Data, vec2((float(j) + 0.5) / u_TexSize , 1));\n      float xDist = node_i.r - node_j.r;\n      float yDist = node_i.g - node_j.g;\n      float dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\n      if (dist > 0.0) {\n        float repulsiveF = u_K2 / dist;\n        dx += xDist / dist * repulsiveF;\n        dy += yDist / dist * repulsiveF;\n      }\n    }\n  }\n  int arr_offset = int(floor(node_i.b + 0.5));\n  int length = int(floor(node_i.a + 0.5));\n  vec4 node_buffer;\n  for (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {\n    if (p >= length) break;\n    int arr_idx = arr_offset + p;\n    // when arr_idx % 4 == 0 update node_idx_buffer\n    int buf_offset = arr_idx - arr_idx / 4 * 4;\n    if (p == 0 || buf_offset == 0) {\n      node_buffer = texture2D(u_Data, vec2((float(arr_idx / 4) + 0.5) /\n                                          u_TexSize , 1));\n    }\n    float float_j = buf_offset == 0 ? node_buffer.r :\n                    buf_offset == 1 ? node_buffer.g :\n                    buf_offset == 2 ? node_buffer.b :\n                                      node_buffer.a;\n    vec4 node_j = texture2D(u_Data, vec2((float_j + 0.5) /\n                                    u_TexSize, 1));\n    float xDist = node_i.r - node_j.r;\n    float yDist = node_i.g - node_j.g;\n    float dist = sqrt(xDist * xDist + yDist * yDist) + 0.01;\n    float attractiveF = dist * dist / u_K;\n    if (dist > 0.0) {\n      dx -= xDist / dist * attractiveF;\n      dy -= yDist / dist * attractiveF;\n    }\n  }\n  // Gravity\n  float d = sqrt(node_i.r * node_i.r + node_i.g * node_i.g);\n  float gf = 0.01 * u_K * u_Gravity * d;\n  dx -= gf * node_i.r / d;\n  dy -= gf * node_i.g / d;\n\n  // Speed\n  dx *= u_Speed;\n  dy *= u_Speed;\n\n  // move\n  float distLength = sqrt(dx * dx + dy * dy);\n  if (distLength > 0.0) {\n    float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\n  \n    gl_FragColor.r += dx / distLength * limitedDist;\n    gl_FragColor.g += dy / distLength * limitedDist;\n  }\n}",particleCount:numParticles,particleData:nodesEdgesArray,maxIteration:8e3,onCompleted:function onCompleted(finalParticleData){_this.renderCircles(finalParticleData),_this.world.destroy()}}),this.world.setBinding(compute,"simParams",simParamData,{binding:1,type:"uniform-buffer"})),[2]}}))}))},Fruchterman.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Fruchterman.prototype.render=function(){return React.createElement(React.Fragment,null,React.createElement("canvas",{id:"application",style:{display:"none"}}),React.createElement("div",{id:"container"}))},Fruchterman.prototype.renderCircles=function(finalParticleData){for(var canvas=new _gCanvas.Canvas({container:"container",width:600,height:600}),i=0;i<this.lineIndexBufferData.length;i+=2){var x1=finalParticleData[4*this.lineIndexBufferData[i]],y1=finalParticleData[4*this.lineIndexBufferData[i]+1],x2=finalParticleData[4*this.lineIndexBufferData[i+1]],y2=finalParticleData[4*this.lineIndexBufferData[i+1]+1];canvas.addGroup().addShape("line",{attrs:{x1:this.convertWebGLCoord2Canvas(x1,600),y1:this.convertWebGLCoord2Canvas(y1,600),x2:this.convertWebGLCoord2Canvas(x2,600),y2:this.convertWebGLCoord2Canvas(y2,600),stroke:"#1890FF",lineWidth:1}})}for(i=0;i<4*numParticles;i+=4){var x=finalParticleData[i],y=finalParticleData[i+1];canvas.addGroup().addShape("circle",{attrs:{x:this.convertWebGLCoord2Canvas(x,600),y:this.convertWebGLCoord2Canvas(y,600),r:5,fill:"red",stroke:"blue",lineWidth:2}})}},Fruchterman.prototype.convertWebGLCoord2Canvas=function(c,size){return(c+1)/2*size},Fruchterman.prototype.buildTextureData=function(nodes,edges){var dataArray=[],nodeDict=[],mapIdPos={},i=0;for(i=0;i<nodes.length;i++){var n=nodes[i];mapIdPos[n.id]=i,dataArray.push(n.x),dataArray.push(n.y),dataArray.push(0),dataArray.push(0),nodeDict.push([])}for(i=0;i<edges.length;i++){var e=edges[i];nodeDict[mapIdPos[e.source]].push(mapIdPos[e.target]),nodeDict[mapIdPos[e.target]].push(mapIdPos[e.source]),this.lineIndexBufferData.push(mapIdPos[e.source],mapIdPos[e.target])}for(this.maxEdgePerVetex=0,i=0;i<nodes.length;i++){var offset=dataArray.length,dests=nodeDict[i],len=dests.length;dataArray[4*i+2]=offset,dataArray[4*i+3]=dests.length,this.maxEdgePerVetex=Math.max(this.maxEdgePerVetex,dests.length);for(var j=0;j<len;++j){var dest=dests[j];dataArray.push(+dest)}}for(;dataArray.length%4!=0;)dataArray.push(0);return new Float32Array(dataArray)},Fruchterman}(React.Component);exports.default=_default},844:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function Gravity(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Gravity,_super),Gravity.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,vertexBufferData,simParamData,initialParticleData,i,compute_1,camera,scene,geometry,material,mesh,_this=this;return __generator(this,(function(_a){if(canvas=document.getElementById("application")){for(vertexBufferData=new Float32Array([-.01,-.02,.01,-.02,0,.02]),simParamData=new Float32Array([.01,.1]),initialParticleData=new Float32Array(6e3),i=0;i<1500;++i)initialParticleData[4*i+0]=2*(Math.random()-.5),initialParticleData[4*i+1]=2*(Math.random()-.5),initialParticleData[4*i+2]=2*(Math.random()-.5)*.1,initialParticleData[4*i+3]=2*(Math.random()-.5)*.1;this.world=new _gWebgpu.World(canvas,{engineOptions:{supportCompute:!0}}),compute_1=this.world.createComputePipeline({type:"particle",shader:"struct Particle {\n  vec2 pos;\n  vec2 vel;\n};\n\nlayout(std140, set = 0, binding = 0) buffer ParticlesA {\n  Particle particles[PARTICLE_NUM];\n} particlesA;\n\nlayout(std140, set = 0, binding = 1) buffer ParticlesB {\n  Particle particles[PARTICLE_NUM];\n} particlesB;\n\nlayout(std140, set = 0, binding = 2) uniform SimParams {\n  float deltaT;\n  float noiseSize;\n} params;\n\nvoid main() {\n  uint index = gl_GlobalInvocationID.x;\n  if (index >= PARTICLE_NUM) { return; }\n\n  vec2 vPos = particlesA.particles[index].pos;\n  vec2 vVel = particlesA.particles[index].vel;\n\n  vec2 force = vec2(0.);\n  vec2 dif = particlesB.particles[index].pos - vec2(0.);\n  force -= length( dif ) * length( dif ) * normalize( dif ) * .1;\n\n  vVel += force;\n  vVel = normalize(vVel);\n\n  vPos += vVel * params.deltaT;\n\n  particlesB.particles[index].pos = vPos;\n  particlesB.particles[index].vel = vVel;\n}",particleCount:1500,particleData:initialParticleData}),this.world.setBinding(compute_1,"simParams",simParamData,{binding:2,type:"uniform-buffer"}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:50,far:1e3,near:.1}),this.world.getCamera(camera).setPosition(0,0,2),scene=this.world.createScene({camera:camera}),geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:1500}),this.world.setAttribute(geometry,"particle",null,{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float2"},{shaderLocation:1,offset:8,format:"float2"}]},(function(){return _this.world.getParticleBuffer(compute_1)})),this.world.setAttribute(geometry,"position",vertexBufferData,{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}),material=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec2 a_particlePos;\nlayout(location = 1) in vec2 a_particleVel;\nlayout(location = 2) in vec2 a_pos;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nvoid main() {\n  float angle = -atan(a_particleVel.x, a_particleVel.y);\n  vec2 pos = vec2(a_pos.x * cos(angle) - a_pos.y * sin(angle),\n          a_pos.x * sin(angle) + a_pos.y * cos(angle));\n  gl_Position = builtin.projectionMatrix * builtin.modelViewMatrix * vec4(pos + a_particlePos, 0, 1);\n}",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(1.0);\n}"}),mesh=this.world.createMesh({geometry:geometry,material:material}),this.world.add(scene,mesh)}return[2]}))}))},Gravity.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},Gravity.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},Gravity}(React.Component);exports.default=_default},845:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),_glMatrix=__webpack_require__(38),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3)),_stats=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(399));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function Instanced(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Instanced,_super),Instanced.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,vector,positions,offsets,colors,orientationsStart,orientationsEnd,i,camera,scene,geometry,material_1,mesh,_this=this;return __generator(this,(function(_a){if(canvas=document.getElementById("application")){for(this.initStats(),5e4,vector=_glMatrix.vec4.create(),offsets=[],colors=[],orientationsStart=[],orientationsEnd=[],(positions=[]).push(.025,-.025,0),positions.push(-.025,.025,0),positions.push(0,0,.025),i=0;i<5e4;i++)offsets.push(Math.random()-.5,Math.random()-.5,Math.random()-.5),colors.push(Math.random(),Math.random(),Math.random(),Math.random()),_glMatrix.vec4.set(vector,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),_glMatrix.vec4.normalize(vector,vector),orientationsStart.push(vector[0],vector[1],vector[2],vector[3]),_glMatrix.vec4.set(vector,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),_glMatrix.vec4.normalize(vector,vector),orientationsEnd.push(vector[0],vector[1],vector[2],vector[3]);this.world=new _gWebgpu.World(canvas,{onUpdate:function onUpdate(){var time=performance.now();_this.world.setUniform(material_1,"sineTime",Float32Array.from([Math.sin(5e-4*time)])),_this.world.setUniform(material_1,"time",Float32Array.from([5e-4*time])),_this.stats&&_this.stats.update()}}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:50,far:10,near:1}),this.world.getCamera(camera).setPosition(0,0,2),scene=this.world.createScene({camera:camera}),geometry=this.world.createInstancedBufferGeometry({maxInstancedCount:5e4}),this.world.setAttribute(geometry,"position",Float32Array.from(positions),{arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]}),this.world.setAttribute(geometry,"offset",Float32Array.from(offsets),{arrayStride:12,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float3"}]}),this.world.setAttribute(geometry,"color",Float32Array.from(colors),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),this.world.setAttribute(geometry,"orientationsStart",Float32Array.from(orientationsStart),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float4"}]}),this.world.setAttribute(geometry,"orientationsEnd",Float32Array.from(orientationsEnd),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float4"}]}),material_1=this.world.createShaderMaterial({vertexShader:"layout(location = 0) in vec3 position;\nlayout(location = 1) in vec3 offset;\nlayout(location = 2) in vec4 color;\nlayout(location = 3) in vec4 orientationStart;\nlayout(location = 4) in vec4 orientationEnd;\n\nlayout(location = 0) out vec3 v_Position;\nlayout(location = 1) out vec4 v_Color;\n\nlayout(set = 0, binding = 0) uniform Builtin {\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} builtin;\n\nlayout(set = 0, binding = 1) uniform SimParams {\n  float sineTime;\n  float time;\n} params;\n\nvoid main() {\n  v_Position = offset * max( abs( params.sineTime * 2.0 + 1.0 ), 0.5 ) + position;\n  vec4 orientation = normalize( mix( orientationStart, orientationEnd, params.sineTime ) );\n  vec3 vcV = cross( orientation.xyz, v_Position );\n  v_Position = vcV * ( 2.0 * orientation.w ) + ( cross( orientation.xyz, vcV ) * 2.0 + v_Position );\n\n  v_Color = color;\n\n  gl_Position = builtin.projectionMatrix * builtin.modelViewMatrix * vec4( v_Position, 1.0 );\n}\n",fragmentShader:"layout(location = 0) out vec4 fragColor;\n\nlayout(location = 0) in vec3 v_Position;\nlayout(location = 1) in vec4 v_Color;\n\nlayout(std140, set = 0, binding = 1) uniform SimParams {\n  float sineTime;\n  float time;\n} params;\n\nvoid main() {\n  vec4 color = v_Color;\n\tcolor.r += sin(v_Position.x * 10.0 + params.time) * 0.5;\n  fragColor = color;\n}\n"}),this.world.addUniform(material_1,{binding:1,name:"time",format:"float",data:null,dirty:!0}),this.world.addUniform(material_1,{binding:1,name:"sineTime",format:"float",data:null,dirty:!0}),mesh=this.world.createMesh({geometry:geometry,material:material_1}),this.world.add(scene,mesh)}return[2]}))}))},Instanced.prototype.componentWillUnmount=function(){this.world&&this.world.destroy(),this.$stats&&document.body.removeChild(this.$stats),this.gui&&this.gui.destroy()},Instanced.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600"})},Instanced.prototype.initStats=function(){this.stats=new _stats.default,this.stats.showPanel(0);var $stats=this.stats.dom;$stats.style.position="absolute",$stats.style.left="0px",$stats.style.top="0px",document.body.appendChild($stats),this.$stats=$stats},Instanced}(React.Component);exports.default=_default},846:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),dat=_interopRequireWildcard(__webpack_require__(847)),_glMatrix=__webpack_require__(38),React=_interopRequireWildcard(__webpack_require__(3)),_stats=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(399));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var _extendStatics,meshTransform,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function RotatingCube(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RotatingCube,_super),RotatingCube.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,camera,scene,boxGeometry,material_1,mesh,material2,mesh2,gui,cubeFolder,cube,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.initStats(),this.world=new _gWebgpu.World(canvas,{onUpdate:function onUpdate(){meshTransform.rotate(_glMatrix.quat.fromEuler(_glMatrix.quat.create(),0,1,0)),_this.stats&&_this.stats.update()}}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:72,far:100,near:1}),this.world.getCamera(camera).setPosition(0,5,5),scene=this.world.createScene({camera:camera}),boxGeometry=this.world.createBoxGeometry({halfExtents:_glMatrix.vec3.fromValues(1,1,1)}),material_1=this.world.createBasicMaterial(),this.world.addUniform(material_1,{binding:1,name:"color",format:"float4",data:null,dirty:!0}),mesh=this.world.createMesh({geometry:boxGeometry,material:material_1}),(meshTransform=this.world.getTransform(mesh)).translate(_glMatrix.vec3.fromValues(-2.5,0,0)),material2=this.world.createBasicMaterial(),this.world.addUniform(material2,{binding:1,name:"color",format:"float4",data:null,dirty:!0}),mesh2=this.world.createMesh({geometry:boxGeometry,material:material2}),this.world.getTransform(mesh2).translate(_glMatrix.vec3.fromValues(2.5,0,0)),this.world.add(scene,mesh),this.world.add(scene,mesh2),gui=new dat.GUI,this.gui=gui,cubeFolder=gui.addFolder("cube"),cube={scale:1,color:[255,255,255]},cubeFolder.add(cube,"scale",.1,5).onChange((function(size){meshTransform.localScale=_glMatrix.vec3.fromValues(1,1,1),meshTransform.scale(_glMatrix.vec3.fromValues(size,size,size))})),cubeFolder.addColor(cube,"color").onChange((function(color){_this.world.setUniform(material_1,"color",_glMatrix.vec4.fromValues(color[0]/255,color[1]/255,color[2]/255,1))}))),[2]}))}))},RotatingCube.prototype.componentWillUnmount=function(){this.world&&this.world.destroy(),this.$stats&&document.body.removeChild(this.$stats),this.gui&&this.gui.destroy()},RotatingCube.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600"})},RotatingCube.prototype.initStats=function(){this.stats=new _stats.default,this.stats.showPanel(0);var $stats=this.stats.dom;$stats.style.position="absolute",$stats.style.left="0px",$stats.style.top="0px",document.body.appendChild($stats),this.$stats=$stats},RotatingCube}(React.Component);exports.default=_default},848:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),_glMatrix=__webpack_require__(38),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3)),_cube=__webpack_require__(849);function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,stageDescriptor,pipelineLayout,uniformBuffer,uniformBindGroup,verticesBuffer,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},projectionMatrix=_glMatrix.mat4.create(),_default=function(_super){function RotatingCubeWithRecordBundle(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RotatingCubeWithRecordBundle,_super),RotatingCubeWithRecordBundle.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,_this=this;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&(this.world=new _gWebgpu.World(canvas,{useRenderBundle:!0,onInit:function onInit(engine){return __awaiter(_this,void 0,void 0,(function(){var aspect,uniformsBindGroupLayout;return __generator(this,(function(_a){switch(_a.label){case 0:return"\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",[4,engine.compilePipelineStageDescriptor("\n            layout(set = 0, binding = 0) uniform Uniforms {\n              mat4 modelViewProjectionMatrix;\n            } uniforms;\n\n            layout(location = 0) in vec4 position;\n            layout(location = 1) in vec4 color;\n\n            layout(location = 0) out vec4 fragColor;\n\n            void main() {\n              gl_Position = uniforms.modelViewProjectionMatrix * position;\n              fragColor = color;\n            }\n            ","\n            layout(location = 0) in vec4 fragColor;\n            layout(location = 0) out vec4 outColor;\n\n            void main() {\n              outColor = fragColor;\n            }\n            ",null)];case 1:return stageDescriptor=_a.sent(),aspect=Math.abs(canvas.width/canvas.height),projectionMatrix=_glMatrix.mat4.create(),_glMatrix.mat4.perspective(projectionMatrix,2*Math.PI/5,aspect,1,100),verticesBuffer=engine.createVertexBuffer(_cube.cubeVertexArray),uniformsBindGroupLayout=engine.getDevice().createBindGroupLayout({bindings:[{binding:0,visibility:1,type:"uniform-buffer"}]}),pipelineLayout=engine.getDevice().createPipelineLayout({bindGroupLayouts:[uniformsBindGroupLayout]}),uniformBuffer=engine.createUniformBuffer(new Float32Array(16)),uniformBindGroup=engine.getDevice().createBindGroup({layout:uniformsBindGroupLayout,bindings:[{binding:0,resource:{buffer:uniformBuffer}}]}),[2]}}))}))},onUpdate:function onUpdate(engine){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){return engine.clear({r:0,g:0,b:0,a:1},!0,!0,!0),engine.setSubData(uniformBuffer,0,this.getTransformationMatrix()),engine.bindVertexInputs({indexBuffer:null,vertexStartSlot:0,vertexBuffers:[verticesBuffer],vertexOffsets:[0]}),engine.setRenderBindGroups([uniformBindGroup]),engine.drawArraysType("render",__assign(__assign({layout:pipelineLayout},stageDescriptor),{primitiveTopology:"triangle-list",vertexState:{vertexBuffers:[{arrayStride:_cube.cubeVertexSize,stepMode:"vertex",attributes:[{shaderLocation:0,offset:_cube.cubePositionOffset,format:"float4"},{shaderLocation:1,offset:_cube.cubeColorOffset,format:"float4"}]}]},rasterizationState:{cullMode:"back"},depthStencilState:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}}),0,36,1),[2]}))}))}})),[2]}))}))},RotatingCubeWithRecordBundle.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},RotatingCubeWithRecordBundle.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},RotatingCubeWithRecordBundle.prototype.getTransformationMatrix=function(){var viewMatrix=_glMatrix.mat4.create();_glMatrix.mat4.translate(viewMatrix,viewMatrix,_glMatrix.vec3.fromValues(0,0,-5));var now=Date.now()/1e3;_glMatrix.mat4.rotate(viewMatrix,viewMatrix,1,_glMatrix.vec3.fromValues(Math.sin(now),Math.cos(now),0));var modelViewProjectionMatrix=_glMatrix.mat4.create();return _glMatrix.mat4.multiply(modelViewProjectionMatrix,projectionMatrix,viewMatrix),modelViewProjectionMatrix},RotatingCubeWithRecordBundle}(React.Component);exports.default=_default},849:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cubeVertexArray=exports.cubeUVOffset=exports.cubeColorOffset=exports.cubePositionOffset=exports.cubeVertexSize=void 0;exports.cubeVertexSize=40;exports.cubePositionOffset=0;exports.cubeColorOffset=16;exports.cubeUVOffset=32;var cubeVertexArray=new Float32Array([1,-1,1,1,1,0,1,1,1,1,-1,-1,1,1,0,0,1,1,0,1,-1,-1,-1,1,0,0,0,1,0,0,1,-1,-1,1,1,0,0,1,1,0,1,-1,1,1,1,0,1,1,1,1,-1,-1,-1,1,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,0,1,1,-1,-1,1,1,0,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,0,0,-1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,-1,1,1,1,0,1,0,0,-1,1,-1,1,0,1,0,1,1,0,-1,1,1,1,0,1,1,1,1,1,1,1,-1,1,1,1,0,1,0,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,1,-1,1,0,1,0,1,0,0,-1,-1,-1,1,0,0,0,1,1,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,-1,1,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,-1,1,1,0,0,1,1,0,0,-1,-1,1,1,0,0,1,1,0,0,1,-1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,1,1,-1,-1,-1,1,0,0,0,1,0,1,-1,1,-1,1,0,1,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,-1,-1,1,1,0,0,1,1,1,-1,1,-1,1,0,1,0,1,0,0]);exports.cubeVertexArray=cubeVertexArray},850:function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _gWebgpu=__webpack_require__(69),React=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__(3));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var _extendStatics,__extends=(_extendStatics=function extendStatics(d,b){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},_default=function(_super){function TriangleMSAA(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TriangleMSAA,_super),TriangleMSAA.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,(function(){var canvas,camera,scene,material,geometry,mesh;return __generator(this,(function(_a){return(canvas=document.getElementById("application"))&&("\n        const vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\n        void main() {\n            gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n        }\n      ","\n        layout(location = 0) out vec4 outColor;\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n      ",this.world=new _gWebgpu.World(canvas,{}),camera=this.world.createCamera({aspect:Math.abs(canvas.width/canvas.height),angle:72,far:100,near:1}),this.world.getCamera(camera).setPosition(0,5,5),scene=this.world.createScene({camera:camera}),material=this.world.createShaderMaterial({vertexShader:"\n        const vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\n        void main() {\n            gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n        }\n      ",fragmentShader:"\n        layout(location = 0) out vec4 outColor;\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n      "}),geometry=this.world.createBufferGeometry(),mesh=this.world.createMesh({geometry:geometry,material:material}),this.world.add(scene,mesh)),[2]}))}))},TriangleMSAA.prototype.componentWillUnmount=function(){this.world&&this.world.destroy()},TriangleMSAA.prototype.render=function(){return React.createElement("canvas",{id:"application",width:"600",height:"600",style:{pointerEvents:"none"}})},TriangleMSAA}(React.Component);exports.default=_default}},[[410,1,2]]]);
//# sourceMappingURL=main.496722a9719547e99d1f.bundle.js.map